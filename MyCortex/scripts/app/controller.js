var MyCortexControllers = angular.module("AllyControllers", ['ngTable', 'smart-table', 'frapontillo.bootstrap-duallistbox', 'daypilot', 'angucomplete-alt',
    'treestructure', 'angular-bootstrap-select', 'highcharts-ng']);
var baseUrl = $("base").first().attr("href");
if (baseUrl == "/") {
    baseUrl = "";
}

var DatetimepickerdtToday = new Date();
var Datetimepickermonth = DatetimepickerdtToday.getMonth() + 1;
var Datetimepickerday = DatetimepickerdtToday.getDate();
var Datetimepickeryear = DatetimepickerdtToday.getFullYear();
if (Datetimepickermonth < 10)
    Datetimepickermonth = '0' + Datetimepickermonth.toString();
if (Datetimepickerday < 10)
    Datetimepickerday = '0' + Datetimepickerday.toString();
var DatetimepickermaxDate = Datetimepickeryear + '-' + Datetimepickermonth + '-' + Datetimepickerday;

MyCortexControllers.factory('rememberMe', function () {
    function fetchValue(name) {
        var gCookieVal = document.cookie.split("; ");
        for (var i = 0; i < gCookieVal.length; i++) {
            // a name/value pair (a crumb) is separated by an equal sign
            var gCrumb = gCookieVal[i].split("=");
            if (name === gCrumb[0]) {
                var value = '';
                try {
                    value = angular.fromJson(gCrumb[1]);
                } catch (e) {
                    value = unescape(gCrumb[1]);
                }
                return value;
            }
        }
        // a cookie with the requested name does not exist
        return null;
    }

    return function (name, values) {
        if (arguments.length === 1) return fetchValue(name);
        var cookie = name + '=';
        if (typeof values === 'object') {
            var expires = '';
            cookie += (typeof values.value === 'object') ? angular.toJson(values.value) + ';' : values.value + ';';
            if (values.expires) {
                var date = new Date();
                date.setTime(date.getTime() + (values.expires * 24 * 60 * 60 * 1000));
                expires = date.toGMTString();
            }
            cookie += (!values.session) ? 'expires=' + expires + ';' : '';
            cookie += (values.path) ? 'path=' + values.path + ';' : '';
            cookie += (values.secure) ? 'secure;' : '';
        } else {
            cookie += values + ';';
        }
        document.cookie = cookie;
    }

});


MyCortexControllers.controller("ParentController", ['$scope',
    function ($scope) {
        $scope.$on('$viewContentLoaded', function () {
            angular.element(".date input").keydown(function (event) {
                if (event.which != 46)
                    return false;
            });
        });
    }
]);
MyCortexControllers.directive('stRatio', function () {
    return {
        link: function (scope, element, attr) {
            var ratio = +(attr.stRatio);

            element.css('width', ratio + '%');

        }
    };
});
MyCortexControllers.directive('searchWatchModel', function () {
    return {
        require: '^stTable',
        scope: {
            searchWatchModel: '='
        },
        link: function (scope, ele, attr, ctrl) {
            var table = ctrl;

            scope.$watch('searchWatchModel', function (val) {
                ctrl.search(val);
            });

        }
    };
});

MyCortexControllers.directive('multiselectDropdown', [function () {
    return function (scope, element, attributes) {
        // Below setup the dropdown:
        element.multiselect({
            maxHeight: 200,
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            // Replicate the native functionality on the elements so
            // that angular can handle the changes for us.
            onChange: function (optionElement, checked) {
                optionElement.removeAttr('selected');
                if (checked) {
                    optionElement.prop('selected', 'selected');
                }
                element.change();
            }
        });
        // Watch for any changes to the length of our select element
        scope.$watch(function () {
            return element[0].length;
        }, function () {
            element.multiselect('rebuild');
        });
        // Watch for any changes from outside the directive and refresh
        scope.$watch(attributes.ngModel, function () {
            element.multiselect('refresh');
        });
        // Below maybe some additional setup
    }
}]);
MyCortexControllers.directive('fileModel', ['$parse', function ($parse) {
    return {
        restrict: 'A',
        link: function (scope, element, attrs) {
            var model = $parse(attrs.fileModel);
            var modelSetter = model.assign;
            element.bind('change', function () {
                scope.$apply(function () {
                    modelSetter(scope, element[0].files[0]);
                });
            });
        }
    };
}]);
MyCortexControllers.directive("fileread", [
    function () {
        return {
            scope: {
                fileread: "="
            },
            link: function (scope, element, attributes) {
                element.bind("change", function (changeEvent) {
                    var reader = new FileReader();
                    reader.onload = function (loadEvent) {
                        scope.$apply(function () {
                            scope.fileread = loadEvent.target.result;
                            //scope.filename = changeEvent.target.files[0].name;
                        });
                    }
                    if (changeEvent.target.files.length !== 0) {
                        reader.readAsDataURL(changeEvent.target.files[0]);
                    }
                });
            }
        }
    }
]);

MyCortexControllers.directive('toggleCheckbox', function () {
    // based on https://github.com/minhur/bootstrap-toggle/issues/19

    return {
        restrict: 'A',
        require: 'ngModel',
        link: function (scope, element, attributes, ngModelController) {
            element.on('change.toggle', function (event) { // note that ".toogle" is our namespace, used further down to remove the handler again
                var checked = element.prop('checked');
                ngModelController.$setViewValue(checked);
            });

            ngModelController.$render = function () {
                element.bootstrapToggle(ngModelController.$viewValue ? 'on' : 'off');
            };

            scope.$on('$destroy', function () {
                // clean up
                element.off('change.toggle');
                element.bootstrapToggle('destroy');
            });

            // we set the 'checked' property once so the Bootstrap toggle is initialized to the correct value, i.e.,  without flashing the 'off' state and then switch to the 'on' state in case of an initial value of 'true';
            // this is not needed if your markup already contains the correct 'checked' property;
            // note that we can't use ngModelController.$viewValue since at this stage, it's still uninitialized as NaN
            var initialValue = scope.$eval(attributes.ngModel);
            element.prop('checked', initialValue);
        }
    };
});
MyCortexControllers.directive('uploadFile', ['$parse', function ($parse) {
    return {
        restrict: 'A',
        link: function (scope, element, attrs) {
            var file_uploaded = $parse(attrs.uploadFile);
            element.bind('change', function () {
                scope.$apply(function () {
                    file_uploaded.assign(scope, element[0].files[0]);
                });
            });
        }
    };
}]);
MyCortexControllers.directive("datepicker", function () {
    function link(scope, element, attrs) {
        // CALL THE "datepicker()" METHOD USING THE "element" OBJECT.
        /*element.datepicker({
            dateFormat: "dd-MMM-yyyy"
        });*/
        element.datepicker({
            format: "dd-M-yyyy",
            forceParse: false,
            autoclose: true,
            todayHighlight: true,
            toggleActive: true,
            todayBtn: true
        });
    }
    return {
        require: 'ngModel',
        link: link
    };
});
MyCortexControllers.service('fileUpload', ['$http', function ($http) {
    this.uploadFileToUrl = function (file, uploadUrl) {
        var fd = new FormData();
        fd.append('file', file);
        $http.post(uploadUrl, fd, {
            transformRequest: angular.identity,
            headers: { 'Content-Type': undefined }
        })
            .success(function () {
            })
            .error(function () {
            });
    }
}]);

MyCortexControllers.service('InstSub', ['$log', function ($log) {
    this.myService = 0;
    this.SubscriptionInstiID = 0;
    return {
        getInstiID: function () {
            return this.myService;
        },
        setInstiID: function (data) {
            this.myService = data;
        },
        getSubID: function () {
            return this.SubscriptionInstiID;
        },
        setSubID: function (data) {
            this.SubscriptionInstiID = data;
        }
    };
}]);


/* THIS IS FOR LOGIN CONTROLLER FUNCTION */
MyCortexControllers.controller("UnderConstructionController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', '$rootScope', '$timeout', 'rememberMe',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $rootScope, $timeout, $rememberMeService) {
        $scope.underConstruction = function () {

        }
    }
]);

/* THIS IS FOR LOGIN CONTROLLER FUNCTION */
MyCortexControllers.controller("homeController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', '$rootScope', '$timeout', 'rememberMe',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $rootScope, $timeout, $rememberMeService) {
        $scope.UserId = $window.localStorage['UserId'];
        $scope.UserTypeId = $window.localStorage['UserTypeId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.page_size = 0;
        $scope.ConfigCode = "PAGINATION";
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            if (data[0] != undefined) {
                $scope.page_size = parseInt(data[0].ConfigValue);
                $window.localStorage['Pagesize'] = $scope.page_size;
            }
        });

        if ($scope.UserTypeId != 1) {
            $http.get(baseUrl + '/api/Login/GetPasswordHistory_Count/?UserId=' + $scope.UserId).success(function (data) {
                $scope.PasswordCount = data.PasswordCount;
                if ($scope.PasswordCount == "0") {
                    window.location.href = baseUrl + "/Home/Index#/ChangePassword/1";
                }
                else {
                    if ($window.localStorage['UserTypeId'] == "1")
                        window.location.href = baseUrl + "/Home/Index#/Institution";
                    else if ($window.localStorage['UserTypeId'] == "3")
                        window.location.href = baseUrl + "/Home/Index#/InstitutionSubscriptionHospitalAdmin_view";
                    else if ($window.localStorage['UserTypeId'] == "2")
                        window.location.href = baseUrl + "/Home/Index#/PatientVitals/0/1";
                    else if ($window.localStorage['UserTypeId'] == "4")
                        window.location.href = baseUrl + "/Home/Index#/Thirtydays_appointments";
                    else if ($window.localStorage['UserTypeId'] == "5")
                        window.location.href = baseUrl + "/Home/Index#/CareGiverAssignedPatients";
                    else if ($window.localStorage['UserTypeId'] == "6")
                        window.location.href = baseUrl + "/Home/Index#/Carecoordinator/1";
                    else if ($window.localStorage['UserTypeId'] == "7")
                        window.location.href = baseUrl + "/Home/Index#/TodaysAppoint_ments";
                }
            });
        }
        else {
            //for Super Admin
            if ($window.localStorage['UserTypeId'] == "1")
                window.location.href = baseUrl + "/Home/Index#/Institution";
            else if ($window.localStorage['UserTypeId'] == "3")
                window.location.href = baseUrl + "/Home/Index#/InstitutionSubscriptionHospitalAdmin_view";
            else if ($window.localStorage['UserTypeId'] == "2")
                window.location.href = baseUrl + "/Home/Index#/PatientVitals/0/1";
            else if ($window.localStorage['UserTypeId'] == "4")
                window.location.href = baseUrl + "/Home/Index#/Thirtydays_appointments";
            else if ($window.localStorage['UserTypeId'] == "5")
                window.location.href = baseUrl + "/Home/Index#/CareGiverAssignedPatients";
            else if ($window.localStorage['UserTypeId'] == "6")
                window.location.href = baseUrl + "/Home/Index#/Carecoordinator/1";
            else if ($window.localStorage['UserTypeId'] == "7")
                window.location.href = baseUrl + "/Home/Index#/TodaysAppoint_ments";
        }
        //else
        //    window.location.href = baseUrl + "/Home/Index#/InstitutionHospitalAdmin_view";
    }
]);

/* THIS IS FOR LOGIN CONTROLLER FUNCTION */
MyCortexControllers.controller("GooglehomeController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', '$rootScope', '$timeout', 'rememberMe',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $rootScope, $timeout, $rememberMeService) {

        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.page_size = 0;
        $scope.ConfigCode = "PAGINATION";
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            if (data[0] != undefined) {
                $scope.page_size = parseInt(data[0].ConfigValue);
                $window.localStorage['Pagesize'] = $scope.page_size;
            }
        });


        $scope.getCredentialDetails = function () {
            $http.get(baseUrl + '/api/Login/GoogleLogin_get_Email/').success(function (data) {


                $scope.UserId = data.UserId;
                $scope.UserTypeId = data.UserTypeId;
                $scope.InstitutionId = data.InstitutionId;
                $window.localStorage['UserId'] = $scope.UserId;
                $window.localStorage['UserTypeId'] = $scope.UserTypeId;
                $window.localStorage['InstitutionId'] = $scope.InstitutionId;

                if ($window.localStorage['UserTypeId'] == "1")
                    window.location.href = baseUrl + "/Home/Index#/Institution";
                else if ($window.localStorage['UserTypeId'] == "3")
                    window.location.href = baseUrl + "/Home/Index#/InstitutionSubscriptionHospitalAdmin_view";
                else if ($window.localStorage['UserTypeId'] == "2")
                    window.location.href = baseUrl + "/Home/Index#/PatientVitals/0/1";
                else if ($window.localStorage['UserTypeId'] == "4")
                    window.location.href = baseUrl + "/Home/Index#/TodaysAppoint_ments";
                else if ($window.localStorage['UserTypeId'] == "5")
                    window.location.href = baseUrl + "/Home/Index#/CareGiverAssignedPatients";
                else if ($window.localStorage['UserTypeId'] == "6")
                    window.location.href = baseUrl + "/Home/Index#/Carecoordinator/1";
                else if ($window.localStorage['UserTypeId'] == "7")
                    window.location.href = baseUrl + "/Home/Index#/TodaysAppoint_ments";
            });
        }
        $scope.getCredentialDetails();

    }
]);
MyCortexControllers.controller("UsersLogController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'InstSub', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, InstSub, toastr) {
        $scope.CreatedBy = $window.localStorage['UserId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.rowCollectionFilter = [];
        $scope.MenuTypeId = 0;

        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        
        // load users list
        $scope.User_Log_List = function () {
            $("#chatLoaderPV").show();
            $scope.CCCG_DetailsList = [];           
            $http.get(baseUrl + 'api/UsersLog/GetAll_UserLists/?InstitutionId='+ $scope.InstituteId).success(function (data) {
                $scope.CCCG_DetailsList = data;
            });           
        }
        //select on Change load -userslist
        $scope.SearchByUserID = function () {
            $("#chatLoaderPV").show();            
            $http.get(baseUrl + '/api/UsersLog/Admin_Userslog_List/?Institution_Id=' + $scope.InstituteId + "&login_session_id=" + $scope.LoginSessionId + "&User_Id=" + $scope.SelectedCCCG).success(function (data) {
                $scope.emptydata = [];
                $scope.UserDetailsList = [];
                $scope.UserDetailsList = data;
                $scope.rowCollectionFilter = angular.copy($scope.UserDetailsList);
                if ($scope.rowCollectionFilter.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                    $scope.SearchMsg = "No Data Available";
                }
                $("#chatLoaderPV").hide();                
            });
        }
        /* Filter the User Log list function.*/
        $scope.filterListUserLog = function () {            
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.UserDetailsList);
            }
            else {                
                $scope.rowCollectionFilter = $ff($scope.UserDetailsList, function (value) {                     
                 return angular.lowercase(value.FULLNAME).match(searchstring) ||
                        angular.lowercase($filter('date')(value.LOGINTIME, "dd-MMM-yyyy hh:mm a")).match(searchstring) ||
                        angular.lowercase($filter('date')(value.LOGOUTTIME, "dd-MMM-yyyy hh:mm a")).match(searchstring);
                });
                if ($scope.rowCollectionFilter.length > 0) {
                    $scope.flag = 1;
                } else {
                    $scope.flag = 0;
                }                
            }
        };
    }
]);

/* THIS IS FOR INSTITUTION CONTROLLER FUNCTION */
MyCortexControllers.controller("InstitutionController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'InstSub', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, InstSub, toastr) {
        $scope.CreatedBy = $window.localStorage['UserId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.CountryFlag = false;
        $scope.StateFlag = false;
        $scope.CityFlag = false;
        $scope.CountryDuplicateId = "0";
        $scope.StateDuplicateId = "0";
        $scope.LocationDuplicateId = "0";
        $scope.Mode = $routeParams.Mode;
        //$scope.myService = myService;
        if ($routeParams.ModeType == undefined) {
            $scope.ModeType = "1";
        }
        else {
            $scope.ModeType = $routeParams.ModeType;
        }
        if ($scope.CreatedBy == 1 || $scope.CreatedBy == 3) {
            document.getElementById("mydiv").style.display = "none";
        }
        $scope.loadCount = 3;
        $scope.DropDownListValue = 2;
        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        //Declaration and initialization of Scope Variables.
        $scope.listdata = [];
        $scope.Institution_Name = "";
        $scope.INSTITUTION_SHORTNAME = "";
        $scope.Address1 = "";
        $scope.Address2 = "";
        $scope.Address3 = "";
        $scope.ZipCode = "";
        $scope.Email = "";
        $scope.CountryId = "0";
        $scope.StateNameId = "0";
        $scope.LocationNameId = "0";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.IsActive = true;
        $scope.rowCollection = [];
        $scope.rowCollectionFilter = [];
        $scope.Id = 0;
        $scope.PhotoValue = 0;

        $scope.AddInstitutionpopup = function () {
            $scope.Id = 0;
            $scope.loadCount = 0;
            $scope.InstitutionClear();
            $scope.DropDownListValue = 1;
            $('#btnsave1').attr("disabled", false);
            $('#btnsave2').attr("disabled", false);
            angular.element('#InstitutionCreateModal').modal('show');
        }

        $scope.CancelInstitutionpopup = function () {
            angular.element('#InstitutionCreateModal').modal('hide');
        }

        $scope.ViewInstitutionpopup = function () {
            angular.element('#ViewInstitutionModal').modal('show');
        }

        $scope.CancelViewInstitutionpopup = function () {
            angular.element('#ViewInstitutionModal').modal('hide');
        }

        /* on click view, view popup opened*/
        $scope.ViewInstitution = function (CatId) {
            $scope.InstitutionClear();
            $scope.Id = CatId;
            $scope.DropDownListValue = 2;
            $scope.InstitutionDetails_View();
            angular.element('#ViewInstitutionModal').modal('show');
        };
        $scope.editInstbutton = 0;
        /* on click Edit, edit popup opened*/
        $scope.EditInstitution = function (CatId, activeFlag) {
            if (activeFlag == 1) {
                $scope.InstitutionClear();
                $scope.Id = CatId;
                $scope.DropDownListValue = 1;
                $scope.InstitutionDetails_View();
                $('#btnsave').attr("disabled", false);
                angular.element('#InstitutionCreateModal').modal('show');
                $('#rowid').prop('disabled', true);
                $scope.editInstbutton = 1;
            }
            else {
                //alert("Inactive record cannot be edited");
                toastr.info("Inactive record cannot be edited", "info");
            }
        };

        /* 
         Calling api method for the dropdown list in the html page for the fields 
         Country,State,Locaiton
         */
        /*  $scope.State_Template = [];
          $scope.City_Template = [];
          $scope.CountryNameList = [];
          $scope.StateNameList = [];
          $scope.CityNameList = [];*/

        $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
            $scope.CountryNameList = data;
        });

        $scope.CountryBased_StateFunction = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.CountryId).success(function (data) {
                    $scope.StateName_List = data;
                    $scope.LocationName_List = [];
                    $scope.LocationNameId = "0";
                    if ($scope.StateFlag == true) {
                        $scope.StateNameId = $scope.StateDuplicateId
                    }
                });
            }
        }
        $scope.StateBased_CityFunction = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.CountryId + '&StateId=' + $scope.StateNameId).success(function (data) {
                    $scope.LocationName_List = data;
                });
                if ($scope.CityFlag == true) {
                    $scope.LocationNameId = $scope.LocationDuplicateId
                }
            }
        }

        $scope.searchquery = "";
        /* Filter the master list function.*/
        $scope.filterInstitutionList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = [];
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.Institution_Name).match(searchstring) ||
                        angular.lowercase(value.INSTITUTION_SHORTNAME).match(searchstring) ||
                        angular.lowercase(value.CountryName).match(searchstring) ||
                        angular.lowercase(value.StateName).match(searchstring) ||
                        angular.lowercase(value.CityName).match(searchstring);
                });
            }
        }

        /* Validating the create page mandatory fields
            checking mandatory for the follwing fields
            InstituionName,InstitutionPrintName,Email,CountryName,StateName,LocationName,Registrationdate
            and showing alert message when it is null.
            */
        $scope.InstitutionAddEdit_Validations = function () {
            if (typeof ($scope.Institution_Name) == "undefined" || $scope.Institution_Name == "") {
                //alert("Please enter Institution Name");
                toastr.warning('Please enter Institution Name', 'warning');
                return false;
            }
            else if (typeof ($scope.INSTITUTION_SHORTNAME) == "undefined" || $scope.INSTITUTION_SHORTNAME == "") {
                //alert("Please enter Short Name");
                toastr.warning('Please enter Short Name', 'warning');
                return false;
            }
            else if (typeof ($scope.Email) == "undefined" || $scope.Email == "") {
                //alert("Please enter Email");
                toastr.warning("Please enter Email", "warning");
                return false;
            }
            else if (EmailFormate($scope.Email) == false) {
                //alert("Invalid email format");
                toastr.warning("Invalid email format", "warning");
                return false;
            }
            else if (typeof ($scope.CountryId) == "undefined" || $scope.CountryId == "0") {
                //alert("Please select Country");
                toastr.warning("Please select Country", "warning");
                return false;
            }
            else if (typeof ($scope.StateNameId) == "undefined" || $scope.StateNameId == "0") {
                //alert("Please select State");
                toastr.warning("Please select State", "warning");
                return false;
            }
            else if (typeof ($scope.LocationNameId) == "undefined" || $scope.LocationNameId == "0") {
                //alert("Please select City");
                toastr.warning("Please select City", "warning");
                return false;
            }
            return true;
        }
        $('#InstitutionCreateModal').on('hide.bs.modal', function () {
            console.log('hide');
            //return false;
        })
        /*This is for getting a file url for uploading the url into the database*/
        $scope.dataURItoBlob = function (dataURI) {
            var binary = atob(dataURI.split(',')[1]);
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            var array = [];
            for (var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {
                type: mimeString
            });
        }

        /* Read file name for the  Photo and file */
        $scope.photoChange = function () {
            if ($('#InstitutionLogo')[0].files[0] != undefined) {
                $scope.FileName = $('#InstitutionLogo')[0].files[0]['name'];
            }
        }

        //this is for image upload function//
        $scope.uploadImage = function (Photo) {
            var filename = "";
            //var fd = new FormData();
            if ($('#InstitutionLogo')[0].files[0] != undefined) {
                FileName = $('#InstitutionLogo')[0].files[0]['name'];
            }
        }
        $scope.InstitutionAndSubscription = 0;
        $scope.Institution_AddEdit_AndSubscription = function () {
            $scope.InstitutionAndSubscription = 1;
            $scope.Institution_AddEdit();

        }

        /*on click Save calling the insert update function for Institution
             and check the Institution Name already exist,if exist it display alert message or its 
             calling the insert update function*/
        $scope.BlobFileName = "";
        $scope.Institution_AddEdit = function () {
            if ($scope.InstitutionAddEdit_Validations() == true) {
                $("#chatLoaderPV").show();
                $scope.PhotoFullpath = $('#item-img-output').attr('src');
                var FileName = "";
                var Licensefilename = "";
                var fd = new FormData();
                var imgBlob;
                var NationalimgBlob;
                var InsuranceimgBlob;
                var imgBlobfile;
                var itemIndexLogo = -1;
                var NationalitemIndexLogo = -1;
                var InsuranceitemIndexLogo = -1;
                var itemIndexdoc = -1;
                var fd = new FormData();
                //if ($('#InstitutionLogo')[0].files[0] != undefined) {
                //    FileName = $('#InstitutionLogo')[0].files[0]['name'];
                //    imgBlob = $scope.dataURItoBlob($scope.uploadme);
                //    itemIndexLogo = 0;
                //}
                //if (itemIndexLogo != -1) {
                //    fd.append('file', imgBlob);
                //}
                ///*
                //calling the api method for read the file path 
                //and saving the image uploaded in the local server. 
                //*/

                //$http.post(baseUrl + '/api/Common/AttachFile',
                //fd,
                //{
                //    transformRequest: angular.identity,
                //    headers: {
                //        'Content-Type': undefined
                //    }
                //}
                //)
                //.success(function (response) {
                //    if ($scope.FileName == "") {
                //        $scope.InstitutionLogo = "";
                //    }
                //    else if (itemIndexLogo > -1) {
                //        if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                //            $scope.InstitutionLogo = response[itemIndexLogo];
                //        }
                //    }
                var obj = {
                    Id: $scope.Id,
                    Institution_Name: $scope.Institution_Name,
                    INSTITUTION_SHORTNAME: $scope.INSTITUTION_SHORTNAME,
                    Institution_Address1: $scope.Address1,
                    Institution_Address2: $scope.Address2,
                    Institution_Address3: $scope.Address3,
                    ZipCode: $scope.ZipCode == 0 ? null : $scope.ZipCode,
                    Email: $scope.Email,
                    CountryId: $scope.CountryId,
                    StateId: $scope.StateNameId,
                    CityId: $scope.LocationNameId,
                    FileName: $scope.FileName,
                    Photo_Fullpath: $scope.PhotoFullpath,
                    Photo: $scope.InstitutionLogo,
                    Created_by: $scope.CreatedBy
                };
                $('#btnsave1').attr("disabled", true);
                $('#btnsave2').attr("disabled", true);
                $http.post(baseUrl + '/api/Institution/Institution_AddEdit/', obj).success(function (data) {
                    var insId = data.Institute[0].Id;
                    //alert(data.Message);
                    if (data.ReturnFlag == "1") {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == "0") {
                        toastr.info(data.Message, "info");
                    }
                    $('#btnsave1').attr("disabled", false);
                    $('#btnsave2').attr("disabled", false);


                    if ($scope.PhotoValue == 1) {
                        if ($('#InstitutionLogo')[0].files[0] != undefined) {
                            FileName = $('#InstitutionLogo')[0].files[0]['name'];
                            imgBlob = $scope.dataURItoBlob($scope.PhotoFullpath);
                            itemIndexLogo = 0;
                        }

                        if (itemIndexLogo != -1) {
                            fd.append('file', imgBlob);
                        }

                        $http.post(baseUrl + '/api/Institution/AttachPhoto?Id=' + insId,
                            fd,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.FileName == "") {
                                    $scope.InstitutionLogo = "";
                                }
                                else if (itemIndexLogo > -1) {
                                    if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                                        $scope.InstitutionLogo = response[itemIndexLogo];
                                    }
                                }
                                $("#InstitutionLogo").val('');
                                if (data.ReturnFlag == 1) {
                                    $scope.CancelInstitution();
                                    if ($scope.InstitutionAndSubscription == 0) {
                                        InstSub.setInstiID(0);
                                        $scope.InstitutionDetailsListGo();
                                    }
                                    if ($scope.InstitutionAndSubscription == 1) {
                                        InstSub.setInstiID(insId);
                                        window.location.href = baseUrl + "/Home/Index#/Institution_Subscription";
                                    }
                                }
                            })
                    }
                    else {
                        $("#InstitutionLogo").val('');
                        if (data.ReturnFlag == 1) {
                            $scope.CancelInstitution();
                            if ($scope.InstitutionAndSubscription == 0) {
                                InstSub.setInstiID(0);
                                $scope.InstitutionDetailsListGo();
                            }
                            if ($scope.InstitutionAndSubscription == 1) {
                                InstSub.setInstiID(insId);
                                window.location.href = baseUrl + "/Home/Index#/Institution_Subscription";
                            }
                        }
                    }
                    $("#chatLoaderPV").hide();

                })
                    .error(function (response) {
                        $scope.Photo = "";
                        $scope.CancelInstitution();
                        $scope.InstitutionDetailsListGo();
                    });

                //})
            }
        }
        $scope.InstitutionClear = function () {
            $scope.Institution_Name = "";
            $scope.INSTITUTION_SHORTNAME = "";
            $scope.Address1 = "";
            $scope.Address2 = "";
            $scope.Address3 = "";
            $scope.ZipCode = "";
            $scope.Email = "";
            $scope.CountryId = "0";
            $scope.StateNameId = "0";
            $scope.LocationNameId = "0";
            $scope.FileName = "";
            $scope.Photo_Fullpath = "";
            $scope.InstitutionLogo = "";
            $scope.uploadme = "";
            $scope.PhotoValue = 0;
            $('#InstitutionLogo').val('');
        }
        $scope.PhotoUplaodSelected = function () {
            $scope.PhotoValue = 1;

        };
        $scope.NationalityPhotoUplaodSelected = function () {
            $scope.PhotoValue1 = 1;
            $scope.NationalPhotoValue = 1;
        };
        $scope.InsurancePhotoUplaodSelected = function () {
            $scope.PhotoValue2 = 1;
            $scope.InsurancePhotoValue = 1;
        };

        /* Clear the uploaded image */
        $scope.imageclear = function () {
            $scope.InstitutionLogo = "";
            $scope.FileName = "";
            $scope.uploadme = "";
            $('#InstitutionLogo').val('');

        };
        /*THIS IS FOR LIST FUNCTION*/
        $scope.InstitutionDetailsListGo = function () {
            if ($window.localStorage['UserTypeId'] == 1) {

                $("#chatLoaderPV").show();
                $scope.emptydata = [];
                $scope.rowCollection = [];
                $scope.Institution_Id = "";
                $scope.TimeZone_Id = "";

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }

                $http.get(baseUrl + '/api/Institution/InstitutionDetails_List/Id?=' + $scope.Institution_Id + '&IsActive=' + $scope.ISact).success(function (data) {
                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        /*THIS IS FOR View FUNCTION*/
        $scope.InstitutionDetails_View = function () {
            $("#chatLoaderPV").show();
            $scope.loadCount = 3;
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/Institution/Institution_GetPhoto/?Id=' + $scope.Id).success(function (data) {
                if (data.PhotoBlob != null) {
                    $scope.uploadme = 'data:image/png;base64,' + data.PhotoBlob;
                }
                else {
                    $scope.uploadme = null;
                }
            })
            $http.get(baseUrl + '/api/Institution/InstitutionDetails_View/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.DuplicatesId = data.Id;
                $scope.Institution_Name = data.Institution_Name;
                $scope.INSTITUTION_SHORTNAME = data.INSTITUTION_SHORTNAME;
                $scope.Address1 = data.Institution_Address1;
                $scope.Address2 = data.Institution_Address2;
                $scope.Address3 = data.Institution_Address3;
                $scope.ZipCode = data.ZipCode;
                if (data.Email == null)
                    $scope.Email = "";
                else
                    $scope.Email = data.Email;
                $scope.CountryId = data.CountryId.toString();
                $scope.CountryDuplicateId = $scope.CountryId;
                $scope.CountryFlag = true;
                //$scope.Country_onChange();

                // $scope.CountryBased_StateFunction();
                $scope.ViewCountryName = data.CountryName;
                $scope.StateNameId = data.StateId.toString();
                $scope.StateDuplicateId = $scope.StateNameId;
                $scope.StateFlag = true;
                //  $scope.StateBased_CityFunction();
                // $scope.State_onChange();
                $scope.ViewStateName = data.StateName;
                $scope.LocationNameId = data.CityId.toString();
                $scope.LocationDuplicateId = $scope.LocationNameId;
                $scope.CityFlag = true;
                if ($scope.DropDownListValue == 1) {
                    $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                        $scope.CountryNameList = data;
                        if ($scope.CountryFlag == true) {
                            $scope.CountryId = $scope.CountryDuplicateId;
                            $scope.CountryFlag = false;
                            $scope.loadCount = $scope.loadCount - 1;
                        }
                    });
                    $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + data.CountryId.toString()).success(function (data) {
                        $scope.StateName_List = data;
                        if ($scope.StateFlag == true) {
                            $scope.StateNameId = $scope.StateDuplicateId;
                            $scope.StateFlag = false;
                            $scope.loadCount = $scope.loadCount - 1;
                        }
                    });
                    $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + data.CountryId.toString() + '&StateId=' + data.StateId.toString()).success(function (data) {
                        //$scope.LocationName_List =data ;    
                        $scope.LocationName_List = data;
                        if ($scope.CityFlag == true) {
                            $scope.LocationNameId = $scope.LocationDuplicateId;
                            $scope.CityFlag = false;
                            $scope.loadCount = $scope.loadCount - 1;
                        }
                    });
                }
                $scope.ViewCityName = data.CityName;
                $scope.Photo = data.Photo;
                $scope.InstitutionLogo = data.Photo;
                //$scope.uploadme = data.Photo;
                $scope.FileName = data.FileName;
                $scope.PhotoFullpath = data.Photo_Fullpath;
                $("#chatLoaderPV").hide();
            });
        }

        /* THIS IS FUNCTION FOR CLOSE Page  */
        $scope.CancelInstitution = function () {
            angular.element('#InstitutionCreateModal').modal('hide');
        };

        /* 
        Calling the api method to detele the details of the Institution 
        for the  Institution Id,
        and redirected to the list page.
        */
        $scope.DeleteInstitution = function (comId) {
            $scope.Id = comId;
            $scope.Institution_Delete();
        };
        $scope.Institution_Delete = function () {
            var del = confirm("Do you like to deactivate the selected Institution?");
            if (del == true) {
                $http.get(baseUrl + '/api/Institution/InstitutionDetails_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Institution has been deactivated Successfully");
                    toastr.success("Selected Institution has been deactivated Successfully", "success");
                    $scope.InstitutionDetailsListGo();
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting Institution!" + data;
                });
            };
        };

        /*'Active' the Institution*/
        $scope.ReInsertInstitution = function (comId) {
            $scope.Id = comId;
            $scope.ReInsertInstitutionDetails();

        };

        /* 
        Calling the api method to inactived the details of the company 
        for the  company Id,
        and redirected to the list page.
        */
        $scope.ReInsertInstitutionDetails = function () {
            var Ins = confirm("Do you like to activate the selected Institution?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/Institution/InstitutionDetails_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Institution has been activated successfully");
                    toastr.success("Selected Institution has been activated successfully", "success");
                    $scope.InstitutionDetailsListGo();
                }).error(function (data) {
                    $scope.error = "An error has occurred while ReInsertInstitutionDetails" + data;
                });
            };
        }

        /*
        Calling the api method to insert the default data of the Institution
        for the  Institution Id,
        and redirected to the list page.
        */
        $scope.InsertDefaultData = function () {
            $http.get(baseUrl + '/api/Institution/InstitutionDefaultData_Insert/?Id=' + $scope.Id).success(function (data) {
                //alert("Institution Default Data Inserted successfully");
                toastr.success("Institution Default Data Inserted successfully", "success");
                // $scope.InstitutionDetailsListGo();
            }).error(function (data) {
                $scope.error = "An error has occurred while InsertInstitution Default Records" + data;
            });

        };
    }

]);

/* THIS IS FOR LOGIN CONTROLLER FUNCTION */
MyCortexControllers.controller("InstitutionSubscriptionController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'InstSub', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, InstSub, toastr) {

        //Declaration and initialization of Scope Variables.
        $scope.serviceData = InstSub.getInstiID();
        $scope.ChildId = 0;
        $scope.Institution_Id = "0";
        $scope.TimeZone_Id = "0";
        $scope.TimeZoneId = "0";
        $scope.AppointmentModule_Id = "0";
        $scope.AppointmentModuleId = "0";
        $scope.Health_Care_Professionals = "";
        $scope.Patients = "";
        $scope.Contract_Period_From = "";
        $scope.Contract_Period_To = "";
        $scope.V_Contract_Period_From = "";
        $scope.V_Contract_Period_To = "";
        $scope.Subscription_Type = "1";
        $scope.Chroniccc = false;
        $scope.Chroniccg = false;
        $scope.Chroniccl = false;
        $scope.Chronicsc = false;
        $scope.Hcp_Pat = false;

        $scope.InstitutionViewList = [];
        $scope.IsActive = true;
        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        /*$scope.myService = myService;
        $scope.update();
        $scope.update = function (str) {
            $scope.myService.setValue(str);
        }*/

        $scope.AddIntstitutionSubPopup = function () {
            $scope.Id = 0;
            $scope.Institution_Id = "0";
            $scope.TimeZone_Id = "0";
            $scope.Hcp_Pat = false;
            $scope.ClearInstitutionSubscriptionPopup();
            $('#btnsave').attr("disabled", false);
            $('#btnsave1').attr("disabled", false);
            angular.element('#InstitutionSubscriptionCreateModal').modal('show');
        }
        $scope.CancelIntstitutionSubPopup = function () {
            angular.element('#InstitutionSubscriptionCreateModal').modal('hide');
        }
        $scope.EditInstSub = 0;
        $scope.EditIntstitutionSubPopup = function (InsSubId, ActiveFlag) {
            if (ActiveFlag == "1") {
                $scope.ClearInstitutionSubscriptionPopup();
                $scope.Id = InsSubId;
                $scope.Hcp_Pat = true;
                $scope.InstitutionSubscriptionDetails_View();
                $('#btnsave').attr("disabled", false);
                angular.element('#InstitutionSubscriptionCreateModal').modal('show');
                $('#subscriptionrowid').prop('disabled', true);
                $scope.EditInstSub = 1;
            }
            else {
                //alert("Inactive Institution's Subscription cannot be edited")
                toastr.info("Inactive Institution's Subscription cannot be edited", "info");
            }
        }
        $scope.ViewIntstitutionSubPopup = function (InsSubId) {
            $scope.ClearInstitutionSubscriptionPopup();
            $scope.Id = InsSubId;
            $scope.InstitutionSubscriptionDetails_View();
            angular.element('#ViewInstitutionSubscriptionModal').modal('show');
        }
        $scope.CancelViewIntstitutionSubPopup = function () {
            angular.element('#ViewInstitutionSubscriptionModal').modal('hide');
        }
        /* on click Add Institution Subscription tool tip in list page calling the Add New  method and Open the Institution Subscription Details Add*/
        $scope.AddInstitutionSubsciption = function () {
            $scope.Id = 1;
            $location.path("/SaveInstitution_Subscription/");
        };
        // This is for to get Institution Details List 
        $scope.status = 0;
        $http.get(baseUrl + '/api/Common/InstitutionNameList/?status=' + $scope.status).success(function (data) {
            $scope.InstitutiondetailsListTemp = [];
            $scope.InstitutiondetailsListTemp = data;
            var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
            $scope.InstitutiondetailsListTemp.splice(0, 0, obj);
            //$scope.InstitutiondetailsListTemp.push(obj);
            $scope.InstitutiondetailsList = angular.copy($scope.InstitutiondetailsListTemp);
            $scope.Institution_Id = $scope.serviceData.toString();
            $scope.InstituteGetDetails();

        })
        // This is for to get Institution Modiule List 
        $http.get(baseUrl + '/api/InstitutionSubscription/ModuleNameList/').success(function (data) {
            // only active Module    
            $scope.InstitutiontypeList = data;
        });
        $http.get(baseUrl + '/api/DoctorShift/TimeZoneList/?Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
            $scope.TimeZoneListID = data;
        });
        // This is for to get Institution Language List 
        $http.get(baseUrl + '/api/InstitutionSubscription/LanguageNameList/').success(function (data) {
            // only active Language    
            $scope.LanguageList = data;
        });
        $http.get(baseUrl + '/api/InstitutionSubscription/PaymentModule_List/').success(function (data) {
            // only active Language    
            $scope.PaymentList = data;
        });
        $http.get(baseUrl + '/api/Common/InstitutionInsurance/').success(function (data) {
            $scope.InstitutionInsuranceName = data;
        });

        $http.get(baseUrl + '/api/Common/InstitutionPayment/').success(function (data) {
            $scope.InstitutionPaymentMethod = data;
        });
        $http.get(baseUrl + '/api/DoctorShift/AppointmentModuleList/').success(function (data) {
            // only active Language    
            $scope.AppointmentModuleListID = data;
        });
        /*This is for Auto fill Details by selected Name of the Institution */
        $scope.InstituteGetDetails = function () {
            if ($scope.Institution_Id == "0") // if Select option selected
            {
                $scope.ClearInstitutionSubscriptionPopup();
                return false;
            }

            $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionDetailList/?Id=' + $scope.Institution_Id).success(function (data) {
                if (data.Email == null)
                    $scope.Email = "";
                else
                    $scope.Email = data.Email;
                $scope.Address1 = data.Institution_Address1;
                $scope.Address2 = data.Institution_Address2;
                $scope.Address3 = data.Institution_Address3;
                $scope.ZipCode = data.ZipCode;
                $scope.Country = data.CountryName;
                $scope.State = data.StateName;
                $scope.City = data.CityName;
            }).error(function (data) {
                $scope.error = "AN error has occured while Listing the records!" + data;
            });
            $scope.loading = false;
        }
        $scope.SubscriptionAndAdmin = 0;
        $scope.AndSubscription_AndAdmin = function () {
            $scope.SubscriptionAndAdmin = 1;
            $scope.Institution_SubscriptionAddEdit();
        }
        /* Validating the create page mandatory fields
        checking mandatory for the follwing fields
        Health Care Professionals,Patients,Contract Period From,Contract Period To
        and showing alert message when it is null.
        */
        $scope.Institution_SubscriptionAddEditValidations = function () {
            if (typeof ($scope.Institution_Id) == "undefined" || $scope.Institution_Id == "0") {
                //alert("Please select Institution");
                toastr.warning("Please select Institution", "warning");
                return false;
            }
            else if (typeof ($scope.TimeZone_Id) == "undefined" || $scope.TimeZone_Id == "0") {
                //alert("Please select TimeZone");
                toastr.warning("Please select TimeZone", "warning");
                return false;
            }
            else if (typeof ($scope.Health_Care_Professionals) == "undefined" || $scope.Health_Care_Professionals == "") {
                //alert("Please enter No. of Health Care Professionals");
                toastr.warning("Please enter No. of Health Care Professionals", "warning");
                return false;
            }
            else if (typeof ($scope.Patients) == "undefined" || $scope.Patients == "") {
                //alert("Please enter No. of Patients");
                toastr.warning("Please enter No. of Patients", "warning");
                return false;
            }
            else if (typeof ($scope.Contract_Period_From) == "undefined" || $scope.Contract_Period_From == "") {
                //alert("Please select Contract Period From");
                toastr.warning("Please select Contract Period From", "warning");
                return false;
            }
            else if (typeof ($scope.Contract_Period_To) == "undefined" || $scope.Contract_Period_To == "") {
                //alert("Please select Contract Period To");
                toastr.warning("Please select Contract Period To", "warning");
                return false;
            }
            else if (typeof ($scope.AppointmentModule_Id) == "undefined" || $scope.AppointmentModule_Id == "0") {
                //alert("Please select AppointmentModule");
                toastr.warning("Please select AppointmentModule", "warning");
                return false;
            }
            if (($scope.Contract_Period_From != "0") && ($scope.Contract_Period_To != "0")) {

                $scope.Contract_Period_From = moment($scope.Contract_Period_From).format('DD-MMM-YYYY');
                $scope.Contract_Period_To = moment($scope.Contract_Period_To).format('DD-MMM-YYYY');

                if ((ParseDate($scope.Contract_Period_To) < ParseDate($scope.Contract_Period_From))) {
                    //alert("Contract Period From should not be greater than Contract Period To");
                    toastr.warning("Contract Period From should not be greater than Contract Period To", "warning");
                    $scope.Contract_Period_From = DateFormatEdit($scope.Contract_Period_From);
                    $scope.Contract_Period_To = DateFormatEdit($scope.Contract_Period_To);
                    return false;
                }
                $scope.Contract_Period_From = DateFormatEdit($scope.Contract_Period_From);
                $scope.Contract_Period_To = DateFormatEdit($scope.Contract_Period_To);
            }

            return true;
        };
        /*on click Save calling the insert update function for Institution Subscription */
        $scope.InstitutionAddList = [];
        $scope.InstitutionAddLanguageList = [];
        $scope.InstitutionAddInsuranceList = [];
        $scope.InstitutionAddPaymentList = [];
        $scope.InstitutionModule_List = [];
        $scope.InstitutionLanguage_List = [];
        $scope.InstitutionInsurance_List = [];
        $scope.InstitutionPayment_List = [];
        $scope.Institution_SubscriptionAddEdit = function () {
            $scope.InstitutionModule_List = [];
            $scope.InstitutionLanguage_List = [];
            $scope.InstitutionInsurance_List = [];
            $scope.InstitutionPayment_List = [];
            if ($scope.Institution_SubscriptionAddEditValidations() == true) {
                $("#chatLoaderPV").show();
                angular.forEach($scope.InstitutionAddList, function (SelectedInstitutiontype, index) {
                    if (SelectedInstitutiontype == true) {
                        {
                            var obj = {
                                Id: 0,
                                Institution_Subcription_Id: $scope.Id,
                                ModuleId: index + 1
                            }
                            $scope.InstitutionModule_List.push(obj);
                        }
                    }
                });
                angular.forEach($scope.InstitutionAddLanguageList, function (SelectedInstitutiontype, index) {
                    if (SelectedInstitutiontype == true) {
                        {
                            var obj = {
                                Id: 0,
                                Institution_Subcription_Id: $scope.Id,
                                LanguageId: index + 1
                            }
                            $scope.InstitutionLanguage_List.push(obj);
                        }
                    }
                });
                angular.forEach($scope.InstitutionAddInsuranceList, function (SelectedInstitutiontype, index) {
                    if (SelectedInstitutiontype == true) {
                        {
                            var obj = {
                                Id: $scope.InstitutionInsuranceName[index].Id
                            }
                            $scope.InstitutionInsurance_List.push(obj);
                        }
                    }
                });
                angular.forEach($scope.InstitutionAddPaymentList, function (SelectedInstitutiontype, index) {
                    if (SelectedInstitutiontype == true) {
                        {
                            var obj = {
                                Id: $scope.InstitutionPaymentMethod[index].Id
                            }
                            $scope.InstitutionPayment_List.push(obj);
                        }
                    }
                });
                var obj1 = $scope.InstitutionInsurance_List;
                var obj2 = $scope.InstitutionPayment_List;
                var Payment_List_Id = obj2.concat(obj1);
                var objInstituteName = $scope.InstitutionInsuranceName;
                var obj2InstitutePay = $scope.InstitutionPaymentMethod;
                var InstitutionSelectedPaymentList = obj2InstitutePay.concat(objInstituteName);
                /*Array.prototype.push.apply(obj2InstitutePay, objInstituteName);
                console.log(obj2InstitutePay);*/
                var obj = {
                    Id: $scope.Id,
                    Institution_Id: $scope.Institution_Id,
                    Health_Care_Professionals: $scope.Health_Care_Professionals,
                    No_Of_Patients: $scope.Patients,
                    Contract_PeriodFrom: moment($scope.Contract_Period_From).format('DD-MMM-YYYY'),
                    Contract_PeriodTo: moment($scope.Contract_Period_To).format('DD-MMM-YYYY'),
                    Subscription_Type: $scope.Subscription_Type,
                    Institution_Modules: $scope.InstitutionModule_List,
                    Module_List: $scope.InstitutiontypeList,
                    Institution_Languages: $scope.InstitutionLanguage_List,
                    Language_List: $scope.LanguageList,
                    TimeZone_ID: $scope.TimeZone_Id,
                    Appointment_Module_Id: $scope.AppointmentModule_Id,
                    Payment_List: InstitutionSelectedPaymentList,
                    Payment_Module_Id: Payment_List_Id,
                    ChronicCc: $scope.Chroniccc,
                    ChronicCg: $scope.Chroniccg,
                    ChronicCl: $scope.Chroniccl,
                    ChronicSc: $scope.Chronicsc
                }
                $('#btnsave').attr("disabled", true);
                $('#btnsave1').attr("disabled", true);
                $http.post(baseUrl + '/api/InstitutionSubscription/InstitutionSubscription_AddEdit/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 0) {
                        toastr.error(data.Message, "Warning");
                    }
                    else if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    $('#btnsave').attr("disabled", false);
                    $('#btnsave1').attr("disabled", false);
                    if (data.ReturnFlag == "1") {
                        $scope.CancelIntstitutionSubPopup();
                        $scope.TimeZone_Id = "";
                        $scope.AppointmentModule_Id = "";
                        if ($scope.SubscriptionAndAdmin == 0) {
                            InstSub.setSubID(0);
                            $scope.InstitutionSubscriptionDetailsListTemplate();
                        }
                        if ($scope.SubscriptionAndAdmin == 1) {
                            InstSub.setSubID(data.Institute[0].Institution_Id);
                            window.location.href = baseUrl + "/Home/Index#/SuperAdmin_UserList/1";
                        }
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "An error has occurred while adding InstitutionSubcription details" + data.ExceptionMessage;
                });
            }
        }
        $scope.searchquery = "";
        /* Filter the master list function.*/
        $scope.filterInstitutionSubscriptionList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.Institution.Institution_Name).match(searchstring) ||
                        angular.lowercase(value.Institution.INSTITUTION_SHORTNAME).match(searchstring) ||
                        angular.lowercase($filter('date')(value.Contract_PeriodFrom, "dd-MMM-yyyy")).match(searchstring) ||
                        angular.lowercase($filter('date')(value.Contract_PeriodTo, "dd-MMM-yyyy")).match(searchstring);
                });
            }
        }

        /*THIS IS FOR LIST FUNCTION*/
        $scope.InstitutionSubscriptionDetailsListTemplate = function () {
            if ($window.localStorage['UserTypeId'] == 1) {
                $("#chatLoaderPV").show();
                $scope.rowCollectionTemplate = [];
                $scope.Institution_Id = "0";
                $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionSubscription_List/Id?=' + $scope.Institution_Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.rowCollectionTemplate = data;
                    $scope.rowCollection = $ff($scope.rowCollectionTemplate, function (value) {
                        return value.Institution.IsActive == "1";
                    });
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };
        /*THIS IS FOR LIST FUNCTION*/
        $scope.InstitutionSubscriptionDetailsFilter = function () {

            if ($scope.IsActive == true) {
                $scope.rowCollection = $ff($scope.rowCollectionTemplate, function (value) {
                    return value.Institution.IsActive == "1";
                })
            }
            else if ($scope.IsActive == false) {
                $scope.rowCollection = angular.copy($scope.rowCollectionTemplate);
            }

            $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.flag = 1;
            }
            else {
                $scope.flag = 0;
            }
        };
        $scope.InstitutionChildList = [];
        $scope.InstitutionLanguageList = [];
        /*THIS IS FOR View FUNCTION*/
        $scope.InstitutionSubscriptionDetails_View = function () {
            if ($window.localStorage['UserTypeId'] == 3 || $window.localStorage['UserTypeId'] == 1) {

                $("#chatLoaderPV").show();
                if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                    $scope.Id = $routeParams.Id;
                    $scope.DuplicatesId = $routeParams.Id;
                }
                $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionSubscriptionDetails_View/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.DuplicatesId = data.Id;
                    $scope.InstitutiontypeList = data.Module_List;
                    $scope.InstitutionChildList = data.ChildModuleList;
                    $scope.LanguageList = data.Language_List;
                    $scope.InstitutionLanguageList = data.ChildLanguageList;
                    $scope.PaymentList = data.Payment_List;
                    $scope.InstitutionInsurnceList = data.ChildInsuranceList;
                    $scope.InstitutionPaymentList = data.ChildPaymentList;
                    $scope.Institution_Id = data.Institution_Id.toString();
                    $scope.ViewInstitution_Name = data.Institution.Institution_Name;
                    $scope.Email = data.Institution.Email;
                    $scope.Address1 = data.Institution.Institution_Address1;
                    $scope.Address2 = data.Institution.Institution_Address2;
                    $scope.Address3 = data.Institution.Institution_Address3;
                    $scope.ZipCode = data.Institution.ZipCode;
                    $scope.Country = data.Institution.CountryName;
                    $scope.State = data.Institution.StateName;
                    $scope.City = data.Institution.CityName;
                    $scope.TimeZoneId = data.TimeZone_ID;
                    $scope.TimeZone_Id = data.TimeZone_ID;
                    $scope.AppointmentModuleId = data.Appointment_Module_Id;
                    $scope.AppointmentModule_Id = data.Appointment_Module_Id;
                    //$scope.Contract_Period_From = $filter('date')(data.Contract_PeriodFrom, "dd-MMM-yyyy");
                    $scope.Contract_Period_From = DateFormatEdit($filter('date')(data.Contract_PeriodFrom, "dd-MMM-yyyy"));
                    $scope.Health_Care_Professionals = data.Health_Care_Professionals;
                    $scope.Patients = data.No_Of_Patients;
                    //$scope.Contract_Period_To = $filter('date')(data.Contract_PeriodTo, "dd-MMM-yyyy");
                    $scope.Contract_Period_To = DateFormatEdit($filter('date')(data.Contract_PeriodTo, "dd-MMM-yyyy"));
                    $scope.Subscription_Type = data.Subscription_Type;
                    $scope.InsSub_Id = data.SubscriptionId;
                    $scope.Chroniccc = data.ChronicCc;
                    $scope.Chroniccg = data.ChronicCg;
                    $scope.Chroniccl = data.ChronicCl;
                    $scope.Chronicsc = data.ChronicSc;
                    $scope.Created_No_Of_Patient = data.Created_No_Of_Patient;
                    $scope.Created_No_Of_HealthCareProf = data.Created_No_Of_HealthCareProf;
                    $scope.Remaining_No_Of_Patient = data.Remaining_No_Of_Patient;
                    $scope.Remaining_No_Of_HealthCareProf = data.Remaining_No_Of_HealthCareProf;

                    angular.forEach($scope.InstitutiontypeList, function (item, modIndex) {

                        if ($ff($scope.InstitutionChildList, function (value) {
                            return value.ModuleId == item.Id;
                        }).length > 0) {
                            $scope.InstitutionAddList[modIndex] = true;
                        }
                        else {
                            $scope.InstitutionAddList[modIndex] = false;
                        }
                    })

                    angular.forEach($scope.LanguageList, function (item, modIndex) {

                        if ($ff($scope.InstitutionLanguageList, function (value) {
                            return value.LanguageId == item.Id;
                        }).length > 0) {
                            $scope.InstitutionAddLanguageList[modIndex] = true;
                        }
                        else {
                            $scope.InstitutionAddLanguageList[modIndex] = false;
                        }
                    })
                    $scope.InstitutionAddInsuranceList = [];
                    angular.forEach($scope.InstitutionInsuranceName, function (item, modIndex) {

                        if ($ff($scope.InstitutionInsurnceList, function (value) {
                            return value.Id == item.Id;
                        }).length > 0) {
                            $scope.InstitutionAddInsuranceList[modIndex] = true;
                        }
                        else {
                            $scope.InstitutionAddInsuranceList[modIndex] = false;
                        }
                    })
                    $scope.InstitutionAddPaymentList = [];
                    angular.forEach($scope.InstitutionPaymentMethod, function (item, modIndex) {

                        if ($ff($scope.InstitutionPaymentList, function (value) {
                            return value.Id == item.Id;
                        }).length > 0) {
                            $scope.InstitutionAddPaymentList[modIndex] = true;
                        }
                        else {
                            $scope.InstitutionAddPaymentList[modIndex] = false;
                        }
                    })
                    $("#chatLoaderPV").hide();
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        //This is for clear the contents in the Page
        $scope.ClearInstitutionSubscriptionPopup = function () {
            $scope.Health_Care_Professionals = "";
            $scope.Patients = "";
            $scope.Contract_Period_From = "";
            $scope.Contract_Period_To = "";
            $scope.Subscription_Type = "1";
            $scope.InstitutionModule_List = [];
            $scope.InstitutionAddList = [];
            $scope.InstitutionAddLanguageList = [];
            $scope.Institution_Id = "0";

            $scope.Email = "";
            $scope.Address1 = "";
            $scope.Address2 = "";
            $scope.Address3 = "";
            $scope.ZipCode = "";
            $scope.Country = "";
            $scope.State = "";
            $scope.City = "";
            $scope.TimeZone_ID = "0";
            $scope.TimeZoneId = "0";
            $scope.AppointmentModule_Id = "0";
            $scope.AppointmentModuleId = "0";
            $scope.InstitutionAddInsuranceList = [];
            $scope.InstitutionAddPaymentList = [];

        $scope.Chroniccc = false;
        $scope.Chroniccg = false;
        $scope.Chroniccl = false;
        $scope.Chronicsc = false;
        $scope.Hcp_Pat = false;
        $scope.Created_No_Of_Patient = "";
        $scope.Created_No_Of_HealthCareProf = "";
        $scope.Remaining_No_Of_Patient = "";
        $scope.Remaining_No_Of_HealthCareProf = "";

    }
    $scope.InstitutionSubscription_Delete = function () {
        //alert("Subscription cannot be activated / deactivated")
        toastr.info("Subscription cannot be activated / deactivated", "info");
    };
    if ($scope.serviceData > 0) {
        $scope.AddIntstitutionSubPopup();
    }

    }
]);

// This is for User controller functions/ /
MyCortexControllers.controller("UserController", ['$scope', '$q', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'InstSub', 'toastr',
    function ($scope, $q, $http, $filter, $routeParams, $location, $window, $ff, InstSub, toastr) {
        //$scope.alertConfrimationVisible = false;
        //$scope.alertType = "alert-danger";
        //$scope.alertConfrimationMessage = "Do you like to deactivate the selected User?";
        //$scope.btn1Type = "btn-success";
        //$scope.btn2Type = "btn-danger";
        //$scope.btn1Text = "Ok";
        //$scope.btn2Text = "Cancel";
        //$scope.alertbtn1Show = true;
        //$scope.alertbtn2Show = true;
        $scope.SearchMsg = "No Data Available";
        $scope.AdminFlowdata = InstSub.getSubID();
        $scope.currentTab = "1";
        $scope.CountryFlag = false;
        $scope.StateFlag = false;
        $scope.CityFlag = false;
        $scope.CountryDuplicateId = "0";
        $scope.StateDuplicateId = "0";
        $scope.LocationDuplicateId = "0";
        $scope.Id = "0";
        $scope.rowId = "0"
        $scope.UserType = "0";
        $scope.InstitutionId = "0";
        $scope.FirstName = "";
        $scope.MiddleName = "";
        $scope.LastName = "";
        $scope.Employee_No = "";
        $scope.EmailId = "";
        $scope.MobileNo = "";
        $scope.MobileNo_CC = "";
        $scope.DepartmentId = "0";
        $scope.UserTypeId = "0";
        $scope.GenderId = "0";
        $scope.Health_License = "";
        $scope.Title_Id = 0;
        $scope.NationalityId = "0";
        $scope.DOB = "";
        $scope.Address1 = "";
        $scope.Address2 = "";
        $scope.Address3 = "";
        $scope.PostalZipCode = "";
        $scope.EMR_Avalability = "";
        $scope.EthnicGroupId = "0";
        $scope.CountryId = "0";
        $scope.StateId = "0";
        $scope.CityId = "0";
        $scope.MaritalStatusId = "0";
        $scope.BloodGroupId = "0";
        $scope.Smoker = "0";
        $scope.Diabetic = "0";
        $scope.HyperTension = "0";
        $scope.Cholestrol = "0";
        $scope.CurrentMedicineflag = "0";
        $scope.PastMedicineflag = "0";
        $scope.MedicalHistoryflag = "0";
        $scope.MNR_No = "";
        $scope.FullNameFormula = "";
        $scope.PrefixMRN = "";
        $scope.PatientNo = "";
        $scope.Createdby_ShortName = "";
        $scope.NationalId = "";
        $scope.InsuranceId = "";
        $scope.EMERG_CONT_FIRSTNAME = "";
        $scope.EMERG_CONT_MIDDLENAME = "";
        $scope.EMERG_CONT_LASTNAME = "";
        $scope.CAFFEINATEDBEVERAGES_TEXT = "";
        $scope.ALCOHALSUBSTANCE_TEXT = "";
        $scope.SMOKESUBSTANCE_TEXT = "";
        $scope.ALERGYSUBSTANCE_TEXT = "";
        $scope.EXCERCISE_TEXT = "";
        $scope.MaritalStatusId = "0";
        $scope.BloodGroupId = "0";
        $scope.EMERG_CONT_RELATIONSHIP_ID = "0";
        $scope.DIETDESCRIBE_ID = "0";
        $scope.EXCERCISE_SCHEDULEID = "0";
        $scope.ALERGYSUBSTANCE_ID = "0";
        $scope.SMOKESUBSTANCE_ID = "0";
        $scope.ALCOHALSUBSTANCE_ID = "0";
        $scope.CAFFEINATED_BEVERAGESID = "0";
        $scope.InstitutionList = [];
        $scope.DepartmentList = [];
        $scope.UserDetailsList = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];
        $scope.searchquery = "";
        $scope.UserTypeList = [];
        $scope.GroupTypeList = [];
        $scope.IsActive = true;
        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.CountryList = [];
        $scope.StateList = [];
        $scope.LocationList = [];
        $scope.SelectedInstitution = "0";
        $scope.UserGroupDetails_List = [];
        $scope.UserInstitutionDetails_List = [];
        $scope.UserLanguageDetails_List = [];
        $scope.SelectedLanuage = [];
        $scope.Patientsearchquery = "";
        $scope.UserDetailsList = [];
        $scope.rowCollectionFilter = [];
        $scope.MedicineRow = "-1";
        $scope.MedicalHistoryRow = "-1";
        $scope.HealthProblemRow = "-1";
        $scope.BusinessUserList = [];
        $scope.BusinessUserFilter = [];
        $scope.BusinessUserflag = 0;
        $scope.Filter_PatientNo = "";
        $scope.Filter_FirstName = "";
        $scope.Filter_LastName = "";
        $scope.Filter_MRN = "";
        $scope.filter_InsuranceId = "";
        $scope.filter_MOBILE_NO = "";
        $scope.filter_HomePhoneNo = "";
        $scope.filter_Email = "";
        $scope.Filter_GenderId = "0";
        $scope.filter_NationalityId = "0";
        $scope.filter_EthinicGroupId = "0";
        $scope.filter_MaritalStatus = "0";
        $scope.filter_CountryId = "0";
        $scope.filter_StataId = "0";
        $scope.filter_CityId = "0";
        $scope.filter_BloodGroupId = "0";
        $scope.filter_GroupId = "0";
        $scope.searchquery = "";
        $scope.SearchEncryptedQuery = "";
        $scope.Business_Usersearchquery = "";
        $scope.PatientList = [];
        $scope.PatientListFilter = [];
        $scope.Patientemptydata = [];
        $scope.Patientflag = 0;
        $scope.Patientsearchquery = "";
        $scope.PatientChronicCondition_List = [];
        $scope.ChildId = "0";
        $scope.HealthProblem_Id = "0";
        $scope.Medical_History_Id = "0";
        $scope.VACCINATIONS = "2";
        $scope.CURRENTLY_TAKEMEDICINE = "2";
        $scope.PAST_MEDICALHISTORY = "1";
        $scope.FAMILYHEALTH_PROBLEMHISTORY = "2";
        $scope.MenuTypeId = 0;
        $scope.PageParameter = $routeParams.PageParameter;
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.Pat_UserTypeId = $window.localStorage['UserTypeId'];

        $scope.InsCountryId = "0";
        $scope.InsStateId = "0";
        $scope.InsCityId = "0";
        $scope.PhotoValue = 0;
        $scope.PhotoValue1 = 0;
        $scope.PhotoValue2 = 0;
        $scope.UserPhotoValue = 0;
        $scope.Patient_Type = "1";
        $scope.Emergency_MobileNo = "";
        $scope.CertificateValue = 0;
        var photoview = false;
        var photoview1 = false;
        var photoview2 = false;
        $scope.uploadview = false;
        $scope.Nationaluploadview = false;
        $scope.Insuranceuploadview = false;
        $scope.uploadme = null;
        $scope.uploadme1 = null;
        $scope.uploadme2 = null;
        $scope.DropDownListValue = 2;
        $scope.EditParameter = $routeParams.Editpatient;
        //List Page Pagination.
        $scope.current_page = 1;
        $scope.total_pages = 1;
        $scope.Chronic = [];
        $scope.Chronic_Details = [];
        $scope.Chronic_Name = "";
        $scope.Member_ID = "";
        $scope.Policy_Number = "";
        $scope.Reference_ID = "";
        $scope.Expiry_Date = "";
        $scope.SelectedPayor = "0";
        $scope.SelectedPlan = "0";
        $scope.EditPayorId = [];
        $scope.EditPlanId = [];
        $scope.DoctorInstitutionList = [];
        $scope.LanguageList = [];
        $scope.UserGroupDetails_List = [];
        $scope.GroupTypeList = [];
        $scope.UserInstitutionDetails_List = [];
        $scope.UserLanguageDetails_List = [];
        $scope.PatientChronicCondition_List = [];
        $scope.ChronicConditionList = [];
        $scope.AddMedicines = [];
        $scope.AddMedicalHistory = [];
        $scope.AddHealthProblem = [];
        $scope.DoctorInstitutionList = [];
        $scope.DoctorInstitutionList = [];

        $scope.EditgroupOption = 0;
        if ($window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 5 || $window.localStorage['UserTypeId'] == 6) {
            $scope.EditgroupOption = 1;
        }

        $scope.loadCount = 3;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.LoginType = $routeParams.LoginUserType;

        $scope.ClearGroup = function () {
            $scope.SelectedGroup = "0";
        }

        $scope.genderChange = function () {
            var genderId = document.getElementById('Select3').value;
            if (genderId != "0") {
                $('#divGender').removeClass("ng-invalid");
                $('#divGender').addClass("ng-valid");
            }
            else {
                $('#divGender').removeClass("ng-valid");
                $('#divGender').addClass("ng-invalid");
            }
        }

        $scope.departmentChange = function () {
            var deptId = document.getElementById('Select1').value;
            if (deptId != "0") {
                $('#divDepartment').removeClass("ng-invalid");
                $('#divDepartment').addClass("ng-valid");
            }
            else {
                $('#divDepartment').removeClass("ng-valid");
                $('#divDepartment').addClass("ng-invalid");
            }
        }

        $scope.UserTypeChange = function () {
            var userType = document.getElementById('Select2').value;
            if (userType != "0") {
                $('#divUserType').removeClass("ng-invalid");
                $('#divUserType').addClass("ng-valid");
            }
            else {
                $('#divUserType').removeClass("ng-valid");
                $('#divUserType').addClass("ng-invalid");
            }
        }

        $scope.nationalityChange = function () {
            var nationality = document.getElementById('Select5').value;
            if (nationality != "0") {
                $('#divNationality').removeClass("ng-invalid");
                $('#divNationality').addClass("ng-valid");
            }
            else {
                $('#divNationality').removeClass("ng-valid");
                $('#divNationality').addClass("ng-invalid");
            }
        }

        $scope.countryChange = function () {
            var country = document.getElementById('countryselectpicker').value;
            if (country != "0") {
                $('#divCountry').removeClass("ng-invalid");
                $('#divCountry').addClass("ng-valid");
            }
            else {
                $('#divCountry').removeClass("ng-valid");
                $('#divCountry').addClass("ng-invalid");
            }
        }

        $scope.cityChange = function () {
            var city = document.getElementById('SelectCity').value;
            if (city != "0") {
                $('#divCity').removeClass("ng-invalid");
                $('#divCity').addClass("ng-valid");
            }
            else {
                $('#divCity').removeClass("ng-valid");
                $('#divCity').addClass("ng-invalid");
            }
        }

        $scope.stateChange = function () {
            var state = document.getElementById('stateselectpicker').value;
            if (state != "0") {
                $('#divState').removeClass("ng-invalid");
                $('#divState').addClass("ng-valid");
            }
            else {
                $('#divState').removeClass("ng-valid");
                $('#divState').addClass("ng-invalid");
            }
        }

        $scope.TabClick = false;

        $scope.checkTab = function () {
            if ($scope.FirstName != "" && $scope.LastName != "" && $scope.Employee_No != ""
                && $scope.GenderId != "" && $scope.DepartmentId != "" && $scope.EmailId != ""
                && $scope.MobileNo != "") {
                $scope.currentTab = 2;
            }
            else if ($scope.Health_License != "" && $scope.NationalityId != "" && $scope.DOB != "") {
                $scope.currentTab = 3;
            }
            else
                $scope.currentTab = 1;
        }

        $scope.Businessuesrclickcount = 1;
        $scope.AddUserPopUP = function () {
            $scope.submitted = false;
            $('#btnsave').attr("disabled", false);
            $('#btnsave2').attr("disabled", false);
            $("#UserLogo").val('');
            photoview = false;
            photoview1 = false;
            photoview2 = false;
            $scope.uploadview = false;
            $scope.loadCount = 3;
            $scope.currentTab = "1";
            $scope.getBase64Image();
            if ($scope.Pat_UserTypeId != 1) {
                $scope.InstitutionSubscriptionLicensecheck(4);
            }
            // var UserTypeId = 4;
            //$scope.InstitutionSubscriptionLicensecheck(UserTypeId);
            $scope.AppConfigurationProfileImageList();
            $scope.DropDownListValue = 1;
            if ($scope.Businessuesrclickcount == 1) {
                $scope.BusinessUserDropdownList();
            }
            $scope.status = 1;
            $('[data-id="selectpicker"]').prop('disabled', false);
            $scope.SuperAdminDropdownsList();
            angular.element('#UserModal').modal('show');
        }

        $scope.DefaultCountryState = function () {
            //$scope.CountryId = $scope.InsCountryId;
            //$scope.StateId = $scope.InsStateId;
            //$scope.CountryBased_StateFunction();
            ////$scope.Country_onChange();
            //$scope.CityId = $scope.InsCityId;
            $scope.loadCount = $scope.loadCount - 1;
            $scope.CountryId = $scope.InsCountryId;

            var cId = $scope.CountryId;
            if (cId != "0") {
                $('#divCountry').removeClass("ng-invalid");
                $('#divCountry').addClass("ng-valid");
            }

            $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.InsCountryId).success(function (data) {
                $scope.StateName_List = data;
                $scope.StateId = $scope.InsStateId;
                $scope.loadCount = $scope.loadCount - 1;

                var sId = $scope.StateId;
                if (sId != "0") {
                    $('#divState').removeClass("ng-invalid");
                    $('#divState').addClass("ng-valid");
                }

            });
            $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.InsCountryId + '&StateId=' + $scope.InsStateId).success(function (data) {
                //$scope.LocationName_List =data ;    
                $scope.LocationName_List = data;
                $scope.CityId = $scope.InsCityId;
                $scope.loadCount = $scope.loadCount - 1;

                var cId = $scope.CityId;
                if (cId != "0") {
                    $('#divCity').removeClass("ng-invalid");
                    $('#divCity').addClass("ng-valid");
                }
            });

            //$scope.StateBased_CityFunction();
            ////$scope.State_onChange();

            //$scope.CountryDuplicateId = $scope.CountryId;
            //$scope.StateDuplicateId = $scope.StateId;
            //$scope.LocationDuplicateId = $scope.CityId;

            //if ($scope.CountryFlag = true) {
            //    $scope.CountryId = $scope.CountryDuplicateId;
            //    $scope.CountryFlag = false;
            //}
            //if ($scope.StateFlag = true) {
            //    $scope.StateId = $scope.StateDuplicateId;
            //    $scope.StateFlag = false;
            //}
            //if ($scope.CityFlag = true) {
            //    $scope.CityId = $scope.LocationDuplicateId;
            //    $scope.CityFlag = false;
            //}
        }
        $scope.ViewUserPopUP = function (CatId) {
            $("#UserLogo").val('');
            $scope.uploadme = null;
            $scope.uploadme1 = null;
            $scope.uploadme2 = null;
            $scope.Id = CatId;
            photoview = true;
            photoview1 = false;
            photoview2 = false;
            $scope.uploadview = false;
            $scope.DropDownListValue = 2;
            $scope.Admin_View($scope.MenuTypeId);
            $scope.currentTab = "1";
            angular.element('#UserViewModel').modal('show');
        }

        $scope.EditUserPopUP = function (CatId) {
            $('#btnsave').attr("disabled", false);
            $('#btnsave2').attr("disabled", false);
            $scope.uploadme = null;
            $scope.uploadme1 = null;
            $scope.uploadme2 = null;
            $scope.Id = CatId;
            photoview = true;
            photoview1 = false;
            photoview2 = false;
            $scope.uploadview = false;
            $scope.EditParameter = 4;
            $scope.DropDownListValue = 1;
            $scope.status = 0;
            $('[data-id="selectpicker"]').prop('disabled', true);
            $scope.SuperAdminDropdownsList();
            if ($scope.Businessuesrclickcount == 1) {
                $scope.InstitutionBased_CountryStateList();
                $scope.BusinessUserDropdownList();
            }
            $scope.AppConfigurationProfileImageList();
            $scope.Admin_View($scope.MenuTypeId);
            $scope.currentTab = "1";
            angular.element('#UserModal').modal('show');
            $('#spradminrowid').prop('disabled', true);
            $('#hosadminrowid').prop('disabled', true);
        }

        $scope.PatientView_Cancel = function () {
            if ($scope.PageParameter == 2) {
                $scope.currentTab = "1";
                $location.path("/PatientList/3");
                $scope.ClearPopUp();
            }
            else if ($scope.PageParameter == 1) {
                $window.localStorage['CurrentTabId'] = 1;
                $location.path("/PatientVitals/0/1");
            }
            else if ($scope.PageParameter == 3) {
                // Today Appointment Page
                $location.path("/PatientVitals/" + $scope.Id + "/2");
            }
            else if ($scope.PageParameter == 4) {
                // 30days Appointment Page
                $location.path("/PatientVitals/" + $scope.Id + "/3");
            }
            else if ($scope.PageParameter == 5) {
                // User Profile Patient Vitals
                $location.path("/PatientVitals/" + $scope.Id + "/4");
            }
            else if ($scope.PageParameter == 6) {
                // Diagostic Alert
                $location.path("/PatientVitals/" + $scope.Id + "/5");
            }
            else if ($scope.PageParameter == 7) {
                // Compliance Alert
                $location.path("/PatientVitals/" + $scope.Id + "/6");
            }
            else if ($scope.PageParameter == 8) {
                // Care Giver Assigned Patients
                $location.path("/PatientVitals/" + $scope.Id + "/7");
            }
            else if ($scope.PageParameter == 0) {
                // Patient Approval
                $location.path("/PatientApproval");
            }
        };

        photoview = false;
        photoview1 = false;
        photoview2 = false;
        var request = "";
        $scope.getBase64Image = function () {
            if ($scope.UserPhotoValue == 0) {
                var maleId = 0;
                var feMaleId = 0;
                angular.forEach($scope.GenderList, function (value, index) {
                    $scope.Gender_Name = value.Gender_Name;
                    if ($scope.Gender_Name.toLowerCase() == "male") {
                        maleId = value.Id;
                    }
                    else if ($scope.Gender_Name.toLowerCase() == "female") {
                        feMaleId = value.Id;
                    }
                });

                var picPath = "";
                //super clinician           
                if ($scope.UserTypeId == 7 && $scope.GenderId == maleId) {
                    picPath = "../../Images/Clinician_Male.png";
                }
                else if ($scope.UserTypeId == 7 && $scope.GenderId == feMaleId) {
                    picPath = "../../Images/Clinician_Female.png";
                }
                //care coordinator
                else if ($scope.UserTypeId == 6 && $scope.GenderId == maleId) {
                    picPath = "../../Images/CC_Male.png";
                }
                else if ($scope.UserTypeId == 6 && $scope.GenderId == feMaleId) {
                    picPath = "../../Images/CC_Female.png";
                }
                //care giver
                else if ($scope.UserTypeId == 5 && $scope.GenderId == maleId) {
                    picPath = "../../Images/CG_Male.png";
                }
                else if ($scope.UserTypeId == 5 && $scope.GenderId == feMaleId) {
                    picPath = "../../Images/CG_Female.png";
                }
                //clinician
                else if ($scope.UserTypeId == 4 && $scope.GenderId == maleId) {
                    picPath = "../../Images/Clinician_Male.png";
                }
                else if ($scope.UserTypeId == 4 && $scope.GenderId == feMaleId) {
                    picPath = "../../Images/Clinician_Female.png";
                }
                else {
                    picPath = "../../Images/others.png";
                }
                if (photoview == false) {
                    var request = new XMLHttpRequest();
                    request.open('GET', picPath, true);
                    request.responseType = 'blob';
                    request.onload = function () {
                        var reader = new FileReader();
                        reader.readAsDataURL(request.response);
                        reader.onload = function (e) {
                            $scope.uploadmes = e.target.result;
                            $scope.uploadme = $scope.uploadmes;
                            $scope.uploadme1 = $scope.uploadmes;
                            $scope.uploadme2 = $scope.uploadmes;
                            $scope.$apply();
                        };
                    };
                    request.send();
                }
            }
        };

        // patient creation
        $scope.PatientgetBase64Image = function () {
            if ($scope.UserPhotoValue == 0) {
                var maleId = 0;
                var feMaleId = 0;
                angular.forEach($scope.GenderList, function (value, index) {
                    $scope.Gender_Name = value.Gender_Name;
                    if ($scope.Gender_Name.toLowerCase() == "male") {
                        maleId = value.Id;
                    }
                    else if ($scope.Gender_Name.toLowerCase() == "female") {
                        feMaleId = value.Id;
                    }
                });

                var picPath = "../../Images/others.png";
                if (typeof ($scope.Gender_Name) != "undefined")
                    if ($scope.GenderId == feMaleId) {
                        picPath = "../../Images/Patient_Female.png";
                    }
                    else if ($scope.GenderId == maleId) {
                        picPath = "../../Images/Patient_Male.png";
                    }


                if (photoview == false) {
                    var request = new XMLHttpRequest();
                    request.open('GET', picPath, true);
                    request.responseType = 'blob';
                    request.onload = function () {
                        var reader = new FileReader();
                        reader.readAsDataURL(request.response);
                        reader.onload = function (e) {
                            $scope.uploadmes = e.target.result;
                            $scope.uploadme = $scope.uploadmes;
                            $scope.uploadme1 = $scope.uploadmes;
                            $scope.uploadme2 = $scope.uploadmes;
                            $scope.$apply();
                        };
                    };
                    request.send();
                }
            }
        };

        //Admin creation
        $scope.AdmingetBase64Image = function () {
            if ($scope.UserPhotoValue == 0) {
                var maleId = 0;
                var feMaleId = 0;
                angular.forEach($scope.GenderList, function (value, index) {
                    $scope.Gender_Name = value.Gender_Name;
                    if ($scope.Gender_Name.toLowerCase() == "male") {
                        maleId = value.Id;
                    }
                    else if ($scope.Gender_Name.toLowerCase() == "female") {
                        feMaleId = value.Id;
                    }
                });

                var picPath = "";
                if ($scope.GenderId == feMaleId) {
                    picPath = "../../Images/female.png";
                }
                else if ($scope.GenderId == maleId) {
                    picPath = "../../Images/male.png";
                }
                else {
                    picPath = "../../Images/others.png";
                }
                if (photoview == false) {
                    var request = new XMLHttpRequest();
                    request.open('GET', picPath, true);
                    request.responseType = 'blob';
                    request.onload = function () {
                        var reader = new FileReader();
                        reader.readAsDataURL(request.response);
                        reader.onload = function (e) {
                            $scope.uploadmes = e.target.result;
                            $scope.uploadme = $scope.uploadmes;
                            $scope.uploadme1 = $scope.uploadmes;
                            $scope.uploadme2 = $scope.uploadmes;
                            $scope.$apply();
                        };
                    };
                    request.send();
                }
            }
        };
        $scope.CancelPopup = function () {
            angular.element('#UserModal').modal('hide');
            angular.element('#UserViewModel').modal('hide');
            angular.element('#PatientCreateModal').modal('hide');
            angular.element('#PatientViewModel').modal('hide');
            $scope.ClearPopUp();
        }

        $scope.AddPatientPopup = function () {
            $scope.currentTab = "1";
            $scope.DropDownListValue = 1;
            var UserTypeId = 2;
            $scope.InstitutionSubscriptionLicensecheck(UserTypeId);
            $scope.AppConfigurationProfileImageList();
            $location.path("/PatientCreate/" + "2" + "/" + "3");
        }
        $scope.SubscriptionValidation = function () {
            if ($scope.Id == 0 && $scope.InstitutionId > 0)
                $scope.InstitutionSubscriptionLicensecheck(3);
        }
        $scope.InstitutionSubscriptionLicensecheck = function (UserTypeId) {
            if (UserTypeId == 3) {
                var obj = {
                    INSTITUTION_ID: $scope.InstitutionId,
                    UserType_Id: UserTypeId,
                };
            }
            else {
                var obj = {
                    INSTITUTION_ID: $window.localStorage['InstitutionId'],
                    UserType_Id: UserTypeId,
                };
            }
            $http.post(baseUrl + '/api/User/InstitutionSubscriptionLicensecheck/', obj).success(function (data) {
                if (data.ReturnFlag == 0) {
                    //alert(data.Message);
                    toastr.warning(data.Message, "warning");
                }
            }).error(function (data) {
                $scope.error = "An error has occurred InstitutionSubscriptionLicensecheck" + data;
            });

        };
        $scope.ViewId = 1;
        $scope.ViewPatientPopUp = function (CatId) {
            $scope.Id = CatId;
            $scope.currentTab = "1";
            $scope.DropDownListValue = 1;
            //$scope.Admin_View($scope.MenuTypeId);
            $location.path("/PatientView/" + $scope.Id + "/2" + "/" + "3");
        }
        $scope.EditPatientPopUp = function (CatId) {
            $scope.Id = CatId;
            $scope.DropDownListValue = 3;
            $('#btnsave1').attr("disabled", false);
            $scope.AppConfigurationProfileImageList();
            //$scope.Admin_View($scope.MenuTypeId);
            $location.path("/PatientEdit/" + $scope.Id + "/2" + "/" + "3" + "/4");

        }

        $scope.ClearPopUp = function () {
            $scope.Id = "0";
            $scope.UserType = "0";
            $scope.InstitutionId = "0";
            $scope.FirstName = "";
            $scope.MiddleName = "";
            $scope.LastName = "";
            $scope.Employee_No = "";
            $scope.EmailId = "";
            $scope.MobileNo = "";
            $scope.MobileNo_CC = "";
            $scope.DepartmentId = "0";
            $scope.UserTypeId = "0";
            $scope.GenderId = "0";
            $scope.Health_License = "";
            $scope.Title_Id = 0;
            $scope.NationalityId = "0";
            $scope.DOB = "";
            $scope.Address1 = "";
            $scope.Address2 = "";
            $scope.Address3 = "";
            $scope.PostalZipCode = "";
            $scope.EMR_Avalability = "";
            $scope.EthnicGroupId = "0";
            $scope.CountryId = "0";
            $scope.StateId = "0";
            $scope.CityId = "0";
            $scope.MaritalStatusId = "0";
            $scope.BloodGroupId = "0";
            $scope.Smoker = "0";
            $scope.Diabetic = "0";
            $scope.HyperTension = "0";
            $scope.Cholestrol = "0";
            //$scope.CurrentMedicineflag = "0";
            //$scope.PastMedicineflag = "0";
            //$scope.MedicalHistoryflag = "0";
            $scope.MNR_No = "";
            $scope.FullNameFormula = "";
            $scope.PrefixMRN = "";
            $scope.PatientNo = "";
            $scope.NationalId = "";
            $scope.InsuranceId = "";
            $scope.EMERG_CONT_FIRSTNAME = "";
            $scope.EMERG_CONT_MIDDLENAME = "";
            $scope.EMERG_CONT_LASTNAME = "";
            $scope.CAFFEINATEDBEVERAGES_TEXT = "";
            $scope.ALCOHALSUBSTANCE_TEXT = "";
            $scope.SMOKESUBSTANCE_TEXT = "";
            $scope.ALERGYSUBSTANCE_TEXT = "";
            $scope.EXCERCISE_TEXT = "";
            $scope.MaritalStatusId = "0";
            $scope.BloodGroupId = "0";
            $scope.EMERG_CONT_RELATIONSHIP_ID = "0";
            $scope.DIETDESCRIBE_ID = "0";
            $scope.EXCERCISE_SCHEDULEID = "0";
            $scope.ALERGYSUBSTANCE_ID = "0";
            $scope.SMOKESUBSTANCE_ID = "0";
            $scope.ALCOHALSUBSTANCE_ID = "0";
            $scope.CAFFEINATED_BEVERAGESID = "0";
            $scope.ChronicConditionList = [];
            $scope.RelationshipList = [];
            $scope.PayorMasterList = [];
            $scope.PayorBasedPlanList = [];
            $scope.DietTypeList = [];
            $scope.ScheduleList = [];
            $scope.AlergySubstanceList = [];
            $scope.BloodGroupList = [];
            $scope.EthnicGroupList = [];
            $scope.MaritalStatusList = [];
            $scope.PatientChronicCondition_List = [];
            $scope.SelectedGroup = "0";
            $scope.SelectedInstitution = "0";
            $scope.SelectedLanguage = "0";
            $scope.Home_PhoneNo = "";
            $scope.HomeAreaCode = "";
            $scope.Photo = "";
            $scope.FileName = "";
            $scope.uploadme = null;
            $scope.uploadme1 = null;
            $scope.uploadme2 = null;
            $('#UserLogo').val('');
            $('#NationalLogo').val('');
            $('#InsuranceLogo').val('');
            $scope.PhotoValue = 0;
            $scope.PhotoValue1 = 0;
            $scope.PhotoValue2 = 0;
            $scope.resumedoc = "";
            $('#Userdocument').val('');
            $scope.CertificateFileName = "";
            $scope.Google_EmailId = "";
            $scope.FB_EmailId = "";
            $scope.SelectedChronicCondition = "0";
            $scope.MedicineRow = "-1";
            //$scope.MedicalHistoryRow = "-1";
            $scope.HealthProblemRow = "-1";
            $scope.PhotoValue = 0;
            $scope.CertificateValue = 0;
            $scope.Emergency_MobileNo = "";
            $scope.EditFileName = "";
            $scope.Editresumedoc = "";
            $('#EditDocument').val('');
            $scope.CertificateFileName = "";
            $scope.appleUserID = "";
            $scope.PATIENT_ID = "";
            $scope.TimeZone_Id = "0";
            $scope.TimeZoneId = "0";
            $scope.Member_ID = "";
            $scope.Policy_Number = "";
            $scope.Reference_ID = "";
            $scope.ExpiryDate = "";
            $scope.SelectedPayor = "0";
            $scope.SelectedPlan = "0";
        }


        // editable time value from app settings	

        $scope.AppConfigurationProfileImageList = function () {
            $scope.ProfileImageSize = "5242880";    // 5 MB
            $scope.ConfigCode = "PROFILE_PICTURE";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).
                success(function (data) {
                    if (data[0] != undefined) {
                        $scope.ProfileImageSize = parseInt(data[0].ConfigValue);
                    }
                });
        }

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }
        //$http.get(baseUrl + '/api/Common/InstitutionNameList/').success(function (data) {
        //    $scope.InstitutionList = data;
        //});
        $scope.SuperAdminDropdownsList = function () {
            if ($scope.LoginType == 1 || $scope.LoginType == 3) {
                $http.get(baseUrl + '/api/Common/InstitutionNameList/?status=' + $scope.status).success(function (data) {
                    $scope.InstitutiondetailsListTemp = [];
                    $scope.InstitutiondetailsListTemp = data;
                    var obj = { "Id": 0, "Name": "Select", "IsActive": 0 };
                    $scope.InstitutiondetailsListTemp.splice(0, 0, obj);
                    //$scope.InstitutiondetailsListTemp.push(obj);
                    $scope.InstitutionList = angular.copy($scope.InstitutiondetailsListTemp);
                    $scope.InstitutionId = $scope.AdminFlowdata.toString();
                });
                $http.get(baseUrl + '/api/Common/GenderList/').success(
                    function (data) {
                        $scope.GenderList = data;
                    });

                $http.get(baseUrl + '/api/User/DepartmentList/').success(function (data) {
                    $scope.DepartmentList = data;
                });
            }
        }

        $scope.Businesstab1 = 0;
        $scope.BusinessUserDropdownList = function () {
            if ($scope.LoginType == 2 && $scope.DropDownListValue == 1) {

                $http.get(baseUrl + '/api/User/BusinessUser_UserTypeList/').success(function (data) {
                    console.log(data);
                    $scope.UserTypeList = data;
                    $scope.Businesstab1 = $scope.Businesstab1 + 1;
                });

                $http.get(baseUrl + '/api/Common/GenderList/').success(
                    function (data) {
                        $scope.GenderList = data;
                        $scope.Businesstab1 = $scope.Businesstab1 + 1;
                    });
                $http.get(baseUrl + '/api/User/DepartmentList/').success(function (data) {
                    $scope.DepartmentList = data;
                    $scope.Businesstab1 = $scope.Businesstab1 + 1;
                });
            }
            $scope.Businessuesrclickcount = $scope.Businessuesrclickcount + 1;
        }

        $scope.$watch('Businesstab1', function () {
            if ($scope.Businesstab1 == 3) {
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                    $scope.Businesstab1 = $scope.Businesstab1 + 1;
                });
                $http.get(baseUrl + '/api/User/DoctorInstitutionList/').success(function (data) {
                    $scope.DoctorInstitutionList = data;
                    $scope.Businesstab1 = $scope.Businesstab1 + 1;
                });
            }
            if ($scope.Businesstab1 == 5) {
                $http.get(baseUrl + '/api/Common/LanguageList/').success(function (data) {
                    $scope.LanguageList = data;
                    $scope.Businesstab1 = $scope.Businesstab1 + 1;
                });
            }
        });

        if ($scope.LoginType == 2) {
            $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.GroupTypeList = data;
            });
        }
        //$scope.Patientcreatefunction = function()
        //{
        $scope.tab1 = 0;
        $scope.Patientcreatefunction = function () {
            $http.get(baseUrl + '/api/Common/GenderList/').success(
                function (data) {
                    $scope.GenderList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                    $scope.PatientgetBase64Image();
                });

            $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.GroupTypeList = data;
                $scope.tab1 = $scope.tab1 + 1;
            });

            $http.get(baseUrl + '/api/PayorMaster/PayorList/?IsActive=' + 1 + '&InstitutionId=' + $scope.InstituteId + '&StartRowNumber=' + 1 + '&EndRowNumber=' + 30).success(function (data) {
                $scope.PayorMasterList = data;
            });

            $scope.ConfigCode = "MRN_PREFIX";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data2) {
                if (data2.length !== 0) {
                    $scope.PrefixMRN = data2[0].ConfigValue;
                }
            });
        }

        $scope.$watch('tab1', function () {
            if ($scope.tab1 == 2) {
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityListTemp = [];
                    $scope.NationalityListTemp = data;
                    /*var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                    $scope.NationalityListTemp.splice(0, 0, obj);*/
                    $scope.NationalityList = angular.copy($scope.NationalityListTemp);
                    $scope.tab1 = $scope.tab1 + 1;
                });

                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusListTemp = [];
                    $scope.MaritalStatusListTemp = data;
                    /* var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                     $scope.MaritalStatusListTemp.splice(0, 0, obj);*/
                    $scope.MaritalStatusList = angular.copy($scope.MaritalStatusListTemp);
                    $scope.tab1 = $scope.tab1 + 1;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupListTemp = [];
                    $scope.EthnicGroupListTemp = data;
                    /* var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                     $scope.EthnicGroupListTemp.splice(0, 0, obj);*/
                    $scope.EthnicGroupList = angular.copy($scope.EthnicGroupListTemp);
                    $scope.tab1 = $scope.tab1 + 1;
                });
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    /*$scope.BloodGroupList = data;*/
                    $scope.BloodGroupListTemp = [];
                    $scope.BloodGroupListTemp = data;
                    /* var obj = { "Id": 0, "BloodGroup_Name": "Select", "IsActive": 1 };
                     $scope.BloodGroupListTemp.splice(0, 0, obj);*/
                    $scope.BloodGroupList = angular.copy($scope.BloodGroupListTemp);
                    $scope.tab1 = $scope.tab1 + 1;
                });
                $http.get(baseUrl + '/api/Common/ChronicConditionList/').success(function (data) {
                    $scope.ChronicConditionList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                });
            }

            if ($scope.tab1 == 7) {
                $http.get(baseUrl + '/api/Common/RelationshipList/').success(function (data) {
                    $scope.RelationshipList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                });
            }
            if ($scope.tab1 == 8) {
                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.ISact = 1;
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;

                    //$http.get(baseUrl + '/api/PayorMaster/PayorList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.SelectedInstitutionId + '&StartRowNumber=' + $scope.PageStart +
                    //    '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                    //        $scope.PayorMasterList = data;
                    //        $scope.tab1 = $scope.tab1 + 1;
                    //    });
                });
            }

            if ($scope.tab1 == 9) {
                $http.get(baseUrl + '/api/Common/OptionTypeList/').success(function (data) {
                    $scope.OptionTypeList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                });
                //$http.get(baseUrl + '/api/Common/RelationshipList/').success(function (data) {
                //    $scope.RelationshipList = data;
                //    $scope.tab1=$scope.tab1+1;
                //});
                $http.get(baseUrl + '/api/Common/DietTypeList/').success(function (data) {
                    $scope.DietTypeList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                });
                $http.get(baseUrl + '/api/Common/ScheduleList/').success(function (data) {
                    $scope.ScheduleList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                });

                $http.get(baseUrl + 'api/User/AllergyTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                    $scope.AlergySubstanceList = data;
                    $scope.tab1 = $scope.tab1 + 1;
                })
            }

        });


        //}   
        $scope.patientDropdownList = function () {
            if ($scope.LoginType == 3 && $scope.TabClick == false) {
                $scope.TabClick = true;
                //$http.get(baseUrl + '/api/Common/GenderList/').success(
                //    function (data) {
                //        $scope.GenderList = data;
                //    });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                //$http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                //    $scope.EthnicGroupList = data;
                //});
                //$http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                //    $scope.MaritalStatusList = data;
                //});
                //$http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                //    $scope.BloodGroupList = data;
                //});
                //$http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                //    $scope.GroupTypeList = data;
                //});

                //$http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                //    //$http.get(baseUrl + '/api/Common/Get_CountryStateLocation_List').success(function (data) {
                //    $scope.CountryNameList = data;
                //});
            }
        };
        /*$http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
            $scope.CountryList = data;
        });
        $http.get(baseUrl + '/api/Common/StateList/').success(function (data) {
            $scope.StateList = data;
        });
        $http.get(baseUrl + '/api/Common/GetLocationList/').success(function (data) {
            $scope.LocationList = data;
        });*/

        /*
        Calling api method for the dropdown list in the html page for the fields
        Country,State,Locaiton  
        */
        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];
        //$http.get(baseUrl + '/api/Common/Get_CountryStateLocation_List/').success(function (data) {
        //    //only active Country
        //    $scope.CountryNameList = $ff(data.CountryList, { IsActive: 1 });
        //    $scope.State_Template = data.StateList;
        //    $scope.City_Template = data.LocationList;
        //});
        $scope.InstitutionBased_CountryStateList = function () {
            if (typeof ($routeParams.Id) == "undefined") {
                $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                    //$http.get(baseUrl + '/api/Common/Get_CountryStateLocation_List').success(function (data) {
                    $scope.CountryNameList = data;
                    //only active Country
                    //$scope.CountryNameList = $ff(data.CountryList, { IsActive: 1 });
                    //$scope.State_Template = data.StateList;
                    //$scope.City_Template = data.LocationList;
                    $http.get(baseUrl + '/api/Institution/InstitutionDetails_View/?Id=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                        $scope.InsCountryId = data.CountryId.toString();
                        $scope.InsStateId = data.StateId.toString();
                        $scope.InsCityId = data.CityId.toString();
                        $scope.DefaultCountryState();
                        /*$scope.CountryBased_StateFunction();
                        //$scope.Country_onChange();
                        //  $scope.CityId = $scope.InsCityId;
                        $scope.StateBased_CityFunction();*/
                    });
                });
            }
        }
        $scope.PayorBased_PlanFunction = function (id) {
            if ($scope.SelectedPayor != "0") {
                $http.get(baseUrl + '/api/PlanMaster/PayorBasedPlan/?Id=' + $scope.SelectedPayor).success(function (data) {
                    $scope.PayorBasedPlanList = data;
                });
            } else {
                $scope.PayorBasedPlanList = [];
            }
        }

        $scope.CountryBased_StateFunction = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.CountryId).success(function (data) {
                    $scope.StateName_List = data;
                    $scope.LocationName_List = [];
                    $scope.CityId = "0";
                });
            }
        }
        $scope.StateBased_CityFunction = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.CountryId + '&StateId=' + $scope.StateId).success(function (data) {
                    $scope.LocationName_List = data;
                });
            }
        }

        $scope.Filter_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        }

        $scope.Filter_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }

        $scope.User_Admin_List = function (MenuType) {
            if ($window.localStorage['UserTypeId'] == 1 || $window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.MenuTypeId = MenuType;
                $scope.ActiveStatus = $scope.IsActive == true ? 1 : 0;
                $http.get(baseUrl + '/api/User/UserDetailsbyUserType_List/Id?=' + $scope.MenuTypeId + '&IsActive=' + $scope.ActiveStatus + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.emptydata = [];
                    $scope.UserDetailsList = [];
                    $scope.UserDetailsList = data;
                    $scope.rowCollectionFilter = angular.copy($scope.UserDetailsList);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                    $scope.SearchMsg = "No Data Available";
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        }

        $scope.BusinessUser_List = function (MenuType) {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.MenuTypeId = MenuType;
                $scope.ActiveStatus = $scope.IsActive == true ? 1 : 0;
                $http.get(baseUrl + '/api/User/UserDetailsbyUserType_List/Id?=' + $scope.MenuTypeId + '&IsActive=' + $scope.ActiveStatus + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {

                    $scope.BusineessUseremptydata = [];
                    $scope.BusinessUserList = [];
                    $scope.BusinessUserList = data;
                    $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionSubscriptionActiveDetails_View/?Id=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                        $scope.Remaining_No_Of_HealthCareProf = data.Remaining_No_Of_HealthCareProf;
                        $scope.Health_Care_Professionals = data.Health_Care_Professionals;
                    });
                    $scope.BusinessUserFilter = angular.copy($scope.BusinessUserList);
                    if ($scope.BusinessUserFilter.length > 0) {
                        $scope.BusinessUserflag = 1;
                    }
                    else {
                        $scope.BusinessUserflag = 0;
                    }
                    $("#chatLoaderPV").hide();
                    $scope.SearchMsg = "No Data Available";
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        }


        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            if ($scope.Patientsearchquery == "" && $scope.Filter_PatientNo == "" && $scope.filter_InsuranceId == "" && $scope.filter_NationalityId == "0" && $scope.filter_MOBILE_NO == "" && $scope.filter_Email == "" && $scope.Filter_FirstName == "" && $scope.Filter_LastName == "" && $scope.Filter_MRN == "") {
                $scope.Patient_List(3);
            }
            else {
                $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_page * $scope.page_size;
                getallpatientlist();
            }
        }

        $scope.Patient_List = function (MenuType) {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.MenuTypeId = MenuType;
                $scope.ActiveStatus = $scope.IsActive == true ? 1 : 0;
                $scope.CommaSeparated_Group = $scope.filter_GroupId.toString();

                $scope.PageCountArray = [];
                $scope.Patientemptydata = [];
                $scope.PatientList = [];
                $scope.ISact = 1;

                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;
                    $scope.Input_Type = 1;
                    $scope.SearchEncryptedQuery = $scope.searchquery;
                    $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionSubscriptionActiveDetails_View/?Id=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                        $scope.Remaining_No_Of_Patient = data.Remaining_No_Of_Patient;
                        $scope.Patients = data.No_Of_Patients;
                        //$scope.Created_No_Of_HealthCareProf = data.Created_No_Of_HealthCareProf;
                    });
                    var obj = {
                        InputType: $scope.Input_Type,
                        DecryptInput: $scope.SearchEncryptedQuery
                    };
                    $http.post(baseUrl + '/api/Common/EncryptDecrypt', obj).success(function (data) {
                        $scope.SearchEncryptedQuery = data;

                        allpatientlist();
                    });
                });
                $scope.loadCount = 0;
                if ($scope.LoginType == 3) {
                    $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                        $scope.GroupTypeList = data;
                        $scope.tab1 = $scope.tab1 + 1;
                    });
                }
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        }

        allpatientlist = function () {
            $http.get(baseUrl + '/api/User/Patient_List/Id?=' + $scope.Id + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId +
                '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' +
                $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus +
                '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId +
                '&Group_Id=' + $scope.filter_GroupId + '&IsActive=' + $scope.ActiveStatus + '&INSTITUTION_ID=' + $window.localStorage['InstitutionId'] + '&StartRowNumber=' + $scope.PageStart +
                '&EndRowNumber=' + $scope.PageEnd + '&SearchQuery=' + $scope.searchquery + '&SearchEncryptedQuery=' + $scope.SearchEncryptedQuery).success(function (data) {
                    $("#chatLoaderPV").hide();
                    if (data.length == 0) {
                        $scope.SearchMsg = "No Data Available";
                    }
                    $scope.Patientemptydata = [];
                    $scope.PatientList = [];
                    $scope.PatientList = data;
                    $scope.Patientemptydata = data;
                    $scope.PatientCount = $scope.PatientList[0].TotalRecord;
                    $scope.total_pages = Math.ceil(($scope.PatientCount) / ($scope.page_size));


                });
        }

        $scope.splitMobileNumber = function (string, nb) {
            var array = string.split('~');
            var cc = array[0];
            var number = array[1];
            var mNumber = typeof (number) == "undefined" ? string : number;
            //return array[nb];
            return mNumber;
        }

        /* Filter the master list function.*/
        $scope.filterInstitutionList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.UserDetailsList);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.UserDetailsList, function (value) {
                    return angular.lowercase(value.InstitutionName).match(searchstring) ||
                        angular.lowercase(value.FullName).match(searchstring) ||
                        angular.lowercase(value.Department_Name).match(searchstring) ||
                        angular.lowercase(value.EMAILID).match(searchstring) ||
                        angular.lowercase(value.EMPLOYEMENTNO).match(searchstring);
                });
                if ($scope.rowCollectionFilter.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                }
            }
        }

        $scope.filterBusinessList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.Business_Usersearchquery);
            if ($scope.Business_Usersearchquery == "") {
                $scope.BusinessUserFilter = angular.copy($scope.BusinessUserList);
            }
            else {
                $scope.BusinessUserFilter = $ff($scope.BusinessUserList, function (value) {
                    return angular.lowercase(value.FullName).match(searchstring) ||
                        angular.lowercase(value.EMAILID).match(searchstring) ||
                        angular.lowercase(value.Department_Name).match(searchstring) ||
                        angular.lowercase(value.EMPLOYEMENTNO).match(searchstring) ||
                        angular.lowercase(value.UserName).match(searchstring) ||
                        angular.lowercase(value.GroupName).match(searchstring);
                });
                if ($scope.BusinessUserFilter.length > 0) {
                    $scope.BusinessUserflag = 1;
                }
                else {
                    $scope.BusinessUserflag = 0;
                }
            }
        }


        $scope.PatientSearch = function () {
            if ($scope.Patientsearchquery == "") {
                allpatientlist();
            } else {
                getallpatientlist();
            }
        }

        $scope.PatientAdvanceSearch = function () {
            getallpatientlist();
        }

        getallpatientlist = function () {
            $scope.ActiveStatus = $scope.IsActive == true ? 1 : 0;
            $http.get(baseUrl + '/api/User/Search_Patient_List?IsActive=' + $scope.ActiveStatus + '&INSTITUTION_ID=' + $window.localStorage['InstitutionId'] + '&SearchQuery=' + $scope.Patientsearchquery + '&PATIENTNO=' + $scope.Filter_PatientNo
                + '&INSURANCEID=' + $scope.filter_InsuranceId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&MOBILE_NO=' +
                $scope.filter_MOBILE_NO + '&EMAILID=' + $scope.filter_Email + '&FIRSTNAME=' + $scope.Filter_FirstName + '&LASTNAME=' + $scope.Filter_LastName + '&MRNNO=' + $scope.Filter_MRN + '&StartRowNumber=' + $scope.PageStart +
                '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                    if (data.length == 0) {
                        $scope.SearchMsg = "No Data Available";
                    }
                    $scope.Patientemptydata = [];
                    $scope.PatientList = [];
                    $scope.PatientList = data;
                    $scope.Patientemptydata = data;
                    if ($scope.PatientList.length > 0) {
                        $scope.PatientCount = $scope.PatientList[0].TotalRecord;
                        $scope.total_pages = Math.ceil(($scope.PatientCount) / ($scope.page_size));
                    }
                });
        }

        //getallpatientlist();


        /* Filter the master list function.*/
        $scope.PatientFilterChange = function () {
            //$scope.ResultListFiltered = [];
            //var searchstring = angular.lowercase($scope.Patientsearchquery);
            //if ($scope.Patientsearchquery == "") {
            //    $scope.PatientListFilter = angular.copy($scope.PatientList);
            //}
            //else {
            //    $scope.PatientListFilter = $ff($scope.PatientList, function (value) {
            //        return angular.lowercase(value.MNR_NO).match(searchstring) ||
            //            angular.lowercase(value.FullName).match(searchstring) ||
            //            angular.lowercase(value.MOBILE_NO).match(searchstring) ||
            //            angular.lowercase(value.EMAILID).match(searchstring) ||
            //            angular.lowercase(value.GroupName == null ? "" : value.GroupName).match(searchstring);
            //    });
            //    if ($scope.PatientListFilter.length > 0) {
            //        $scope.Patientflag = 1;
            //    }
            //    else {
            //        $scope.Patientflag = 0;
            //    }
            //}
            $("#chatLoaderPV").show();
            $scope.Patientemptydata = [];
            $scope.Patient_List(3);
        }
        $scope.Adminimageclear = function () {
            $scope.Photo = "";
            $scope.FileName = "";
            $scope.uploadme = "";
            $('#UserLogo').val('');
            photoview = false;
            photoview1 = false;
            photoview2 = false;
            $scope.uploadview = false;
            $scope.UserPhotoValue = 0;
            $scope.AdmingetBase64Image();
        };


        $scope.imageclear = function () {
            $scope.Photo = "";
            $scope.FileName = "";
            $scope.uploadme = "";
            $('#UserLogo').val('');
            photoview = false;
            photoview1 = false;
            photoview2 = false;
            $scope.uploadview = false;
            $scope.UserPhotoValue = 0;
            $scope.getBase64Image();
        };

        $scope.imageclearPatient = function () {
            $scope.Photo = "";
            $scope.FileName = "";
            $scope.uploadme = "";
            $('#UserLogo').val('');
            photoview = false;
            photoview1 = false;
            photoview2 = false;
            $scope.uploadview = false;
            $scope.UserPhotoValue = 0;
            $scope.PatientgetBase64Image();
        };

        $scope.imageclearPatientNational = function () {
            $scope.NationalPhoto = "";
            $scope.NationalPhotoFilename = "";
            $scope.uploadme1 = "";
            $('#NationalLogo').val('');
            photoview = false;
            photoview1 = false;
            photoview2 = false;
            $scope.Nationaluploadview = false;
            $scope.NationalPhotoValue = 0;
            $scope.PatientgetBase64Image();
        };
        $scope.imageclearPatientInsurance = function () {
            $scope.InsurancePhoto = "";
            $scope.InsurancePhotoFilename = "";
            $scope.uploadme2 = "";
            $('#InsuranceLogo').val('');
            photoview = false;
            photoview1 = false;
            photoview2 = false;
            $scope.Insuranceuploadview = false;
            $scope.InsurancePhotoValue = 0;
            $scope.PatientgetBase64Image();
        };

        /* Read file name for the  Photo and file */
        /*$scope.Editfile=[]*/
        $scope.EditdocfileChange = function (e) {
            if ($('#EditDocument')[0].files[0] != undefined) {
                $scope.CertificateFileName = $('#EditDocument')[0].files[0]['name'];
            }
            //$scope.Editfile = []
            //$scope.Editfile.push(e.files[0])
        }

        /*This is for getting a file url for uploading the url into the database*/
        $scope.dataURItoBlob = function (dataURI) {
            var binary = atob(dataURI.split(',')[1]);
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            var array = [];
            for (var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {
                type: mimeString
            });
        }

        /* Read file name for the  National Photo and file */
        $scope.NationalphotoChange = function () {
            if ($('#NationalLogo')[0].files[0] != undefined) {
                $scope.NationalPhotoFilename = $('#NationalLogo')[0].files[0]['name'];
            }
        }
        /* Read file name for the  National Photo and file */
        $scope.InsurancephotoChange = function () {
            if ($('#InsuranceLogo')[0].files[0] != undefined) {
                $scope.InsurancePhotoFilename = $('#InsuranceLogo')[0].files[0]['name'];
            }
        }

        /* Read file name for the  Photo and file */
        $scope.photoChange = function () {
            if ($('#UserLogo')[0].files[0] != undefined) {
                $scope.FileName = $('#UserLogo')[0].files[0]['name'];
            }
        }

        //this is for image upload function//
        $scope.uploadImage = function (Photo) {
            var filename = "";
            //var fd = new FormData();
            if ($('#UserLogo')[0].files[0] != undefined) {
                FileName = $('#UserLogo')[0].files[0]['name'];
            }
        }


        $scope.User_Admin_AddEdit_Validations = function () {
            if ($scope.MenuTypeId == 1 || $scope.MenuTypeId == 2) {
                if (($scope.MenuTypeId == 1) && (($scope.InstitutionId) == "undefined" || $scope.InstitutionId == "0")) {
                    //alert("Please select Institution");
                    toastr.warning("Please select Institution", "Warning");
                    return false;
                }
                else if (typeof ($scope.FirstName) == "undefined" || $scope.FirstName == "") {
                    //alert("Please enter First Name");
                    toastr.warning("Please enter First Name", "Warning");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }
                else if (typeof ($scope.LastName) == "undefined" || $scope.LastName == "") {
                    //alert("Please enter Last Name");
                    toastr.warning("Please enter Last Name", "Warning");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }
                /*else if (typeof ($scope.Employee_No) == "undefined" || $scope.Employee_No == "") {
                    alert("Please enter Employment No.");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }
                else if (typeof ($scope.GenderId) == "undefined" || $scope.GenderId == "0") {
                    alert("Please select Gender");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }
                else if (typeof ($scope.DepartmentId) == "undefined" || $scope.DepartmentId == "0") {
                    alert("Please select Department");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }*/
                else if (typeof ($scope.EmailId) == "undefined" || $scope.EmailId == "") {
                    //alert("Please enter Email");
                    toastr.warning("Please enter Email", "Warning");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }
                else if (EmailFormate($scope.EmailId) == false) {
                    //alert("Invalid email format");
                    toastr.warning("Invalid email format", "Warning");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }
                else if (typeof ($scope.MobileNo) == "undefined" || $scope.MobileNo == "") {
                    //alert("Please enter Mobile No.");
                    toastr.warning("Please enter Mobile No.", "Warning");
                    if ($scope.MenuTypeId == 2) {
                        $scope.currentTab = 1;
                    }
                    return false;
                }

                if ($scope.uploadme != "" && $scope.uploadme != null) {
                    $scope.Image = filetype = $scope.uploadme.split(',')[0].split(':')[1].split(';')[0];
                    $scope.filetype = $scope.Image.split("/");
                    var fileval = 0;
                    var fileExtenstion = "";
                    if ($scope.filetype.length > 0) {
                        fileExtenstion = $scope.filetype[$scope.filetype.length - 1];
                    }
                    if (fileExtenstion.toLocaleLowerCase() == "jpeg" || fileExtenstion.toLocaleLowerCase() == "jpg" || fileExtenstion.toLocaleLowerCase() == "png"
                        || fileExtenstion.toLocaleLowerCase() == "bmp" || fileExtenstion.toLocaleLowerCase() == "gif" || fileExtenstion.toLocaleLowerCase() == "ico") {// check more condition with MIME type                      
                        fileval = 1;
                    }
                    else {
                        fileval = 2;
                    }
                    if (fileval == 2) {
                        //alert("Please choose files of type jpeg/jpg/png/bmp/gif/ico");
                        toastr.warning("Please choose files of type jpeg/jpg/png/bmp/gif/ico", "warning");
                        return false;
                    }
                }
            }
            if ($scope.MenuTypeId == 2) {
                if (typeof ($scope.UserTypeId) == "undefined" || $scope.UserTypeId == "0") {
                    //alert("Please select Type of User");
                    toastr.warning("Please select Type of User", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.Health_License) == "undefined" || $scope.Health_License == "") {
                    //alert("Please enter Health License under Additional Info");
                    toastr.warning("Please enter Health License under Additional Info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.NationalityId) == "undefined" || $scope.NationalityId == "0") {
                    //alert("Please select Nationality under Additional Info");
                    toastr.warning("Please select Nationality under Additional Info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.DOB) == "undefined" || $scope.DOB == "") {
                    //alert("Please select Date of Birth under Additional info");
                    toastr.warning("Please select Date of Birth under Additional info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                //else if (isDate($scope.DOB) == false) {
                //    alert("Date of Birth is in Invalid format, please enter dd-mm-yyyy");
                //    $scope.currentTab = 2;
                //    return false;
                //}
                else if ($scope.AgeRestrictioncalculation() == false) {
                    //alert("Age should be more than " + $scope.JAge + " years.Please enter a valid Date of Birth");
                    toastr.warning("Age should be more than " + $scope.JAge + " years.Please enter a valid Date of Birth", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.CountryId) == "undefined" || $scope.CountryId == "0") {
                    //alert("Please select Country under Address Info");
                    toastr.warning("Please select Country under Address Info", "warning");
                    $scope.currentTab = 3;
                    return false;
                }
                else if (typeof ($scope.StateId) == "undefined" || $scope.StateId == "0") {
                    //alert("Please select State under Address Info");
                    toastr.warning("Please select State under Address Info", "warning");
                    $scope.currentTab = 3;
                    return false;
                }
                else if (typeof ($scope.CityId) == "undefined" || $scope.CityId == "0") {
                    //alert("Please select City under Address Info");
                    toastr.warning("Please select City under Address Info", "warning");
                    $scope.currentTab = 3;
                    return false;
                }

                if ($scope.CertificateFileName != "") {
                    var fileval = 0;
                    $scope.filetype = $scope.CertificateFileName.split(".");
                    var fileExtenstion = "";
                    if ($scope.filetype.length > 0) {
                        fileExtenstion = $scope.filetype[$scope.filetype.length - 1];
                    }
                    if (fileExtenstion.toLocaleLowerCase() == "jpeg" || fileExtenstion.toLocaleLowerCase() == "jpg" || fileExtenstion.toLocaleLowerCase() == "png"
                        || fileExtenstion.toLocaleLowerCase() == "bmp" || fileExtenstion.toLocaleLowerCase() == "gif" || fileExtenstion.toLocaleLowerCase() == "ico"
                        || fileExtenstion.toLocaleLowerCase() == "pdf" || fileExtenstion.toLocaleLowerCase() == "xls" || fileExtenstion.toLocaleLowerCase() == "xlsx"
                        || fileExtenstion.toLocaleLowerCase() == "doc" || fileExtenstion.toLocaleLowerCase() == "docx" || fileExtenstion.toLocaleLowerCase() == "odt"
                        || fileExtenstion.toLocaleLowerCase() == "txt" || fileExtenstion.toLocaleLowerCase() == "pptx" || fileExtenstion.toLocaleLowerCase() == "ppt"
                        || fileExtenstion.toLocaleLowerCase() == "rtf" || fileExtenstion.toLocaleLowerCase() == "tex"
                    ) {// check more condition with MIME type                      
                        fileval = 1;
                    }
                    else {
                        fileval = 2;
                    }
                    if (fileval == 2) {
                        //alert("Please choose jpeg/jpg/png/bmp/gif/ico/pdf/xls/xlsx/doc/docx/odt/txt/pptx/ppt/rtf/tex file.");
                        toastr.warning("Please choose jpeg/jpg/png/bmp/gif/ico/pdf/xls/xlsx/doc/docx/odt/txt/pptx/ppt/rtf/tex file.", "warning");
                        return false;
                    }
                }
            }
            if ($scope.MenuTypeId == 3) {
                if (typeof ($scope.FirstName) == "undefined" || $scope.FirstName == "") {
                    //alert("Please enter First Name");
                    toastr.warning("Please enter First Name", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.LastName) == "undefined" || $scope.LastName == "") {
                    //alert("Please enter Last Name");
                    toastr.warning("Please enter Last Name", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.GenderId) == "undefined" || $scope.GenderId == "0") {
                    //alert("Please select Gender");
                    toastr.warning("Please select Gender", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                //else if (typeof ($scope.MNR_No) == "undefined" || $scope.MNR_No == "") {
                //    alert("Please enter MNR No.");
                //    $scope.currentTab = 1;
                //    return false;
                //}
                else if (typeof ($scope.NationalId) == "undefined" || $scope.NationalId == "") {
                    //alert("Please enter National ID");
                    toastr.warning("Please enter National ID", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.InsuranceId) == "undefined" || $scope.InsuranceId == "") {
                    //alert("Please enter Insurance ID");
                    toastr.warning("Please enter Insurance ID", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.EmailId) == "undefined" || $scope.EmailId == "") {
                    //alert("Please enter Email");
                    toastr.warning("Please enter Email", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (EmailFormate($scope.EmailId) == false) {
                    //alert("Invalid email format");
                    toastr.warning("Invalid email format", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (EmailFormate($scope.Google_EmailId) == false) {
                    //alert("Invalid Google Email format");
                    toastr.warning("Invalid Google Email format", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (EmailFormate($scope.FB_EmailId) == false) {
                    //alert("Invalid Facebook Email format");
                    toastr.warning("Invalid Facebook Email format", "warning");
                    $scope.currentTab = 1;
                    return false;
                } else if (EmailFormate($scope.appleUserID) == false) {
                    //alert("Invalid Apple Email format");
                    toastr.warning("Invalid Apple Email format", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.MobileNo) == "undefined" || $scope.MobileNo == "") {
                    //alert("Please enter Mobile No.");
                    toastr.warning("Please enter Mobile No.", "warning");
                    $scope.currentTab = 1;
                    return false;
                }
                else if (typeof ($scope.NationalityId) == "undefined" || $scope.NationalityId == "0") {
                    //alert("Please select Nationality under Additional Info");
                    toastr.warning("Please select Nationality under Additional Info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.MaritalStatusId) == "undefined" || $scope.MaritalStatusId == "0") {
                    //alert("Please select Marital Status under Additional Info");
                    toastr.warning("Please select Marital Status under Additional Info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.BloodGroupId) == "undefined" || $scope.BloodGroupId == "0") {
                    //alert("Please select Blood Group under Additional Info");
                    toastr.warning("Please select Blood Group under Additional Info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.EthnicGroupId) == "undefined" || $scope.EthnicGroupId == "0") {
                    //alert("Please select Ethnic Group under Additional Info");
                    toastr.warning("Please select Ethnic Group under Additional Info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.DOB) == "undefined" || $scope.DOB == "") {
                    //alert("Please select Date of Birth under Additional info");
                    toastr.warning("Please select Date of Birth under Additional info", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                //else if (isDate($scope.DOB) == false) {
                //    alert("Date of Birth is in Invalid format, please enter dd-mm-yyyy");
                //    $scope.currentTab = 2;
                //    return false;
                //}
                else if ($scope.AgeRestrictioncalculation() == false) {
                    //alert("Age should be more than " + $scope.JAge + " years.Please enter a valid Date of Birth");
                    toastr.warning("Age should be more than " + $scope.JAge + " years.Please enter a valid Date of Birth", "warning");
                    $scope.currentTab = 2;
                    return false;
                }
                else if (typeof ($scope.CountryId) == "undefined" || $scope.CountryId == "0") {
                    //alert("Please select Country under Address Info");
                    toastr.warning("Please select Country under Address Info", "warning");
                    $scope.currentTab = 3;
                    return false;
                }
                else if (typeof ($scope.StateId) == "undefined" || $scope.StateId == "0") {
                    //alert("Please select State under Address Info");
                    toastr.warning("Please select State under Address Info", "warning");
                    $scope.currentTab = 3;
                    return false;
                }
                else if (typeof ($scope.CityId) == "undefined" || $scope.CityId == "0") {
                    //alert("Please select City under Address Info");
                    toastr.warning("Please select City under Address Info", "warning");
                    $scope.currentTab = 3;
                    return false;
                }
                if ($scope.CURRENTLY_TAKEMEDICINE == 1) {
                    if (($ff($scope.AddMedicines, { Status: 1 }).length == 0)) {
                        //alert("Please add atleast one row for Currrently Take Medicine under Medical Info");
                        toastr.warning("Please add atleast one row for Currrently Take Medicine under Medical Info", "warning");
                        $scope.currentTab = 5;
                        return false;
                    }
                    else {
                        var AMitem = 0;
                        angular.forEach($scope.AddMedicines, function (value, index) {
                            if ((value.MedicineName == null) || (value.MedicineName == undefined) || (value.MedicineName == "")) {
                                AMitem = 1;
                            }
                        });
                        if ($scope.AddMedicines.length < 1 || AMitem == 1) {
                            //alert("Please enter Medicine Name under Medical Info");
                            toastr.warning("Please enter Medicine Name under Medical Info", "warning");
                            $scope.currentTab = 5;
                            return false;
                        }
                    }
                }
                if ($scope.PAST_MEDICALHISTORY == 1 && ($ff($scope.AddMedicalHistory, { Status: 1 }).length > 0)) {
                    var MHitem = 0;
                    angular.forEach($scope.AddMedicalHistory, function (value, index) {
                        if (value.Medical_History == null || value.Medical_History == undefined || value.Medical_History == "") {
                            MHitem = 1;
                        }
                    });
                    if ($scope.AddMedicalHistory.length < 1 || MHitem == 1) {
                        //alert("Please enter Medical History under Medical Info");
                        toastr.warning("Please enter Medical History under Medical Info", "warning");
                        $scope.currentTab = 5;
                        return false;
                    }
                }
                if ($scope.FAMILYHEALTH_PROBLEMHISTORY == 1) {
                    if (($ff($scope.AddHealthProblem, { Status: 1 }).length == 0)) {
                        //alert("Please add atleast one row for family Health Problem History under Medical Info");
                        toastr.warning("Please add atleast one row for family Health Problem History under Medical Info", "warning");
                        $scope.currentTab = 5;
                        return false;
                    }
                    else {
                        var Relation_Healthitem = 0;
                        var HealthProb_Item = 0;
                        angular.forEach($ff($scope.AddHealthProblem, { Status: 1 }), function (value, index) {
                            if (value.Relationship_Id == 0 || value.Relationship_Id == undefined || value.Relationship_Id == null) {
                                Relation_Healthitem = 1;
                            }
                            if (value.Health_Problem == null || value.Health_Problem == undefined || value.Health_Problem == "") {
                                HealthProb_Item = 1;
                            }
                        });
                        if ($scope.AddHealthProblem.length < 1 || Relation_Healthitem == 1) {
                            //alert("Please select Relationship under Medical Info");
                            toastr.warning("Please select Relationship under Medical Info", "warning");
                            $scope.currentTab = 5;
                            return false;
                        }
                        if ($scope.AddHealthProblem.length < 1 || HealthProb_Item == 1) {
                            //alert("Please enter Health Problem under Medical Info");
                            toastr.warning("Please enter Health Problem under Medical Info", "warning");
                            $scope.currentTab = 5;
                            return false;
                        }
                    }
                }
                if ($scope.uploadme != "" && $scope.uploadme != null) {
                    $scope.Image = filetype = $scope.uploadme.split(',')[0].split(':')[1].split(';')[0];
                    $scope.filetype = $scope.Image.split("/");
                    var fileval = 0;
                    var fileExtenstion = "";
                    if ($scope.filetype.length > 0) {
                        fileExtenstion = $scope.filetype[$scope.filetype.length - 1];
                    }
                    if (fileExtenstion.toLocaleLowerCase() == "jpeg" || fileExtenstion.toLocaleLowerCase() == "jpg" || fileExtenstion.toLocaleLowerCase() == "png"
                        || fileExtenstion.toLocaleLowerCase() == "bmp" || fileExtenstion.toLocaleLowerCase() == "gif" || fileExtenstion.toLocaleLowerCase() == "ico") {// check more condition with MIME type                      
                        fileval = 1;
                    }
                    else {
                        fileval = 2;
                    }
                    if (fileval == 2) {
                        //alert("Please choose files of type jpeg/jpg/png/bmp/gif/ico");
                        toastr.warning("Please choose files of type jpeg/jpg/png/bmp/gif/ico", "warning");
                        return false;
                    }
                }
            }
            if ($scope.uploadme != "" && $scope.uploadme != null) {
                if ($scope.dataURItoBlob($scope.uploadme).size > $scope.ProfileImageSize) {
                    var alertmsg = "Uploaded Photo size cannot be greater than " + ($scope.ProfileImageSize / 1024 / 1024).toString() + "MB";
                    if ($scope.ProfileImageSize <= 1045504) {
                        alertmsg = "Uploaded Photo size cannot be greater than " + ($scope.ProfileImageSize / 1024).toString() + "KB";
                    }
                    //alert(alertmsg);
                    toastr.warning(alertmsg, "warning");
                    $scope.currentTab = 1;
                    return false;
                }
            }
            if ($scope.Editresumedoc != null) {
                if ($scope.Editresumedoc != undefined && $scope.Editresumedoc != null && $scope.Editresumedoc != "") {
                    if ($scope.dataURItoBlob($scope.Editresumedoc).size > 1048576) {
                        //alert("Certificate file size cannot be greater than 1MB");
                        toastr.warning("Certificate file size cannot be greater than 1MB", "warning");
                        $scope.currentTab = 5;
                        return false;
                    }
                }
            }
            return true;
        }

        $scope.AgeRestictLimit = function () {
            $scope.JAge = 18;
            var deferred = $q.defer();

            if ($scope.MenuTypeId == 2)
                $scope.ConfigCode = "BUSINESS_USER_MIN_AGE";
            else if ($scope.MenuTypeId == 3)
                $scope.ConfigCode = "PATIENT_MIN_AGE";

            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
                if (data[0] != undefined) {
                    $scope.JAge = parseInt(data[0].ConfigValue);
                }
                deferred.resolve($scope.JAge);
            });
            return deferred.promise;
        };

        //$scope.AgeRestrictioncalculation = function () {
        //    $scope.Today_Date = $filter('date')(new Date(), 'DD-MMM-YYYY');
        //    $scope.Join_Day = moment(ParseDate($scope.Today_Date).subtract($scope.JAge, 'years')).format("DD-MMM-YYYY");
        //    if ((ParseDate($scope.DOB)) > (ParseDate($scope.Join_Day))) {
        //        return false;
        //    }
        //    return true;
        //};
        $scope.AgeRestrictioncalculation = function () {
            $scope.Today_Date = $filter('date')(new Date(), 'DD-MMM-YYYY');
            $scope.Join_Day = moment(ParseDate($scope.Today_Date).subtract($scope.JAge, 'years')).format("DD-MMM-YYYY");
            $scope.DOB = moment($scope.DOB).format('DD-MMM-YYYY');
            if ((ParseDate($scope.DOB)) > (ParseDate($scope.Join_Day))) {
                $scope.DOB = DateFormatEdit($scope.DOB, "dd-MMM-yyyy");
                return false;
            }
            $scope.DOB = DateFormatEdit($scope.DOB, "dd-MMM-yyyy");
            return true;
        };
        //$scope.Country_onChange = function () {
        //    $scope.StateNameList = [];            
        //    $scope.StateNameList = $ff($scope.StateList, { CountryId: $scope.CountryId });
        //};
        //$scope.StateClearFunction = function () {
        //    $scope.StateId = "0";
        //    $scope.CityId = "0";
        //};
        //$scope.State_onChange = function () {
        //    $scope.CityNameList = [];
        //    $scope.CityNameList = $ff($scope.LocationList, { StateId: $scope.StateId });
        //};
        //$scope.LocationClearFunction = function () {
        //    $scope.CityId = "0";
        //};
        $scope.PatientView = function () {
            $scope.PatientMenu = $scope.MenuTypeId;
            $scope.EditPatientChronicCondition = 0;
            $scope.EditPatientChronic = function () {
                $scope.EditPatientChronicCondition = 1;
            }
            $scope.EditPatientGroupId = 0;
            $scope.GroupTypeList = [];
            $scope.EditPatientGroup = function () {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $("#chatLoaderPV").hide();
                $scope.EditPatientGroupId = 1;
            }
            $scope.EditSavePatientgroup = function (SelectedGroup) {
                $("#chatLoaderPV").show();
                $scope.PatientGroupDetails_List = [];
                angular.forEach(SelectedGroup, function (value, index) {
                    var obj = {
                        Id: 0,
                        Group_Id: value
                    }
                    $scope.PatientGroupDetails_List.push(obj);
                });
                var obj1 = {
                    EditSelectedGroupList: $scope.PatientGroupDetails_List,
                    GroupTypeList: $scope.GroupTypeList,
                    UserId: $scope.Id,
                    CreatedBy: $window.localStorage['UserId']
                }
                $http.post(baseUrl + '/api/User/PatientGroupEdit/?Login_Session_Id=' + $scope.LoginSessionId, obj1).success(function (data) {
                    $("#chatLoaderPV").hide();
                    if (data == 1) {
                        $scope.EditPatientGroupId = 0;
                        $scope.Admin_View($scope.PatientMenu);
                    }
                    if (data == 0) {
                        alert("Nothing Happened")
                    }
                });
            }
            $scope.SelectedChronicConditionEdit = "0";
            $scope.EditSavePatientChronic = function (SelectedChronicConditionEdit) {
                $("#chatLoaderPV").show();
                $scope.PatientEditChronicCondition_List = [];
                $scope.PatientMenu = $scope.MenuTypeId;
                angular.forEach(SelectedChronicConditionEdit, function (value, index) {
                    var obj = {
                        Id: 0,
                        Chronic_Id: value
                    }
                    $scope.PatientEditChronicCondition_List.push(obj);
                });
                var obj1 = {
                    EditSelectedChronicCondition: $scope.PatientEditChronicCondition_List,
                    ChronicConditionList: $scope.ChronicConditionList,
                    UserId: $scope.Id,
                    CreatedBy: $window.localStorage['UserId']
                }
                $http.post(baseUrl + '/api/User/PatientChronicEdit/?Login_Session_Id=' + $scope.LoginSessionId, obj1).success(function (data) {
                    $("#chatLoaderPV").hide();
                    if (data == 1) {
                        $scope.EditPatientChronicCondition = 0;
                        $scope.Admin_View($scope.PatientMenu);
                    }
                });
            }
        }
        $scope.Admin_View = function (MenuType) {
            $scope.ChronicConditionList = [];
            $("#chatLoaderPV").show();
            if (($scope.LoginType == 3 || $scope.LoginType == 2) && $scope.EditParameter == 4) {
                $scope.DropDownListValue = 4;
            }
            $http.get(baseUrl + '/api/Common/ChronicConditionList/').success(function (data) {
                $scope.ChronicConditionList = data;
            });
            $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                $scope.GenderList = data;
            });

            $scope.loadCount = 3;
            $("#chatLoaderPV").show();
            photoview = true;
            photoview1 = true;
            photoview2 = true;
            var methodcnt = 2;
            var methodcnt1 = 2;
            var methodcnt2 = 2;
            $scope.MenuTypeId = MenuType;
            if (MenuType == 3) {
                if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                    $scope.Id = $routeParams.Id;
                    $scope.DuplicatesId = $routeParams.Id;
                }
            }
            $scope.EditSelectedGroup = [];
            $scope.EditPayorId = [];
            $scope.EditPlanId = [];
            $scope.SelectedGroup = [];
            $scope.EditSelectedInstitution = [];
            $scope.SelectedInstitution = [];
            $scope.EditSelectedLanguage = [];
            $scope.SelectedLanguage = [];
            $scope.EditSelectedChronicondition = [];
            $scope.SelectedChronicCondition = [];
            $scope.SelectedChronicConditionEdit = [];
            $scope.EditChronicOption = 0;
            if ($scope.Id > 0) {
                $http.get(baseUrl + '/api/User/UserDetails_GetPhoto/?Id=' + $scope.Id).success(function (data1) {
                    methodcnt = methodcnt - 1;
                    if (methodcnt == 0)
                        $scope.uploadview = true;
                    if (data1.PhotoBlob != null) {
                        $scope.uploadme = 'data:image/png;base64,' + data1.PhotoBlob;

                    }
                    else {
                        $scope.uploadme = null;
                    }
                });

                if ($scope.LoginType == 2) {
                    $http.get(baseUrl + '/api/User/UserDetails_GetCertificate/?Id=' + $scope.Id).success(function (data) {
                        if (data.CertificateBlob != null) {
                            $scope.Editresumedoc = 'data:image/png;base64,' + data.CertificateBlob;
                        }
                        else {
                            $scope.Editresumedoc = null;
                        }
                    })
                }

                $http.get(baseUrl + '/api/User/UserDetails_GetNationalPhoto/?Id=' + $scope.Id).success(function (data) {
                    methodcnt1 = methodcnt1 - 1;
                    if (methodcnt1 == 0)
                        $scope.Nationaluploadview = true;
                    if (data.NationalPhotoBlob != null) {
                        $scope.uploadme1 = 'data:image/png;base64,' + data.NationalPhotoBlob;

                    }
                    else {
                        $scope.uploadme1 = null;
                    }
                });
                $http.get(baseUrl + '/api/User/UserDetails_GetInsurancePhoto/?Id=' + $scope.Id).success(function (data) {
                    methodcnt2 = methodcnt2 - 1;
                    if (methodcnt2 == 0)
                        $scope.Insuranceuploadview = true;
                    if (data.InsurancePhotoBlob != null) {
                        $scope.uploadme2 = 'data:image/png;base64,' + data.InsurancePhotoBlob;

                    }
                    else {
                        $scope.uploadme2 = null;
                    }
                });
                $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionSubscriptionActiveDetails_View/?Id=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.Chroniccc = data.ChronicCc;
                    $scope.Chroniccg = data.ChronicCg;
                    $scope.Chroniccl = data.ChronicCl;
                    $scope.Chronicsc = data.ChronicSc;
                    if ($window.localStorage['UserTypeId'] == 6 & $scope.Chroniccc == true) {
                        $scope.EditChronicOption = 1;
                    }
                    if ($window.localStorage['UserTypeId'] == 5 & $scope.Chroniccg == true) {
                        $scope.EditChronicOption = 1;
                    }
                    if ($window.localStorage['UserTypeId'] == 4 & $scope.Chroniccl == true) {
                        $scope.EditChronicOption = 1;
                    }
                    if ($window.localStorage['UserTypeId'] == 7 & $scope.Chronicsc == true) {
                        $scope.EditChronicOption = 1;
                    }
                });

                $http.get(baseUrl + '/api/User/GETPATIENTINSTITUTION/?ID=' + $scope.Id).success(function (data) {
                    $("#chatLoaderPV").hide();
                    var PatientInstituteId = data[0].Institution_Id;

                    if ($window.localStorage['UserTypeId'] == 1 || PatientInstituteId == $window.localStorage['InstitutionId']) {
                        $http.get(baseUrl + '/api/User/UserDetails_View/Id?=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                            $scope.Id = data.Id;
                            $scope.rowId = data.Id;
                            $scope.InstitutionId = data.INSTITUTION_ID.toString();
                            $scope.DepartmentId = data.DEPARTMENT_ID.toString();
                            $scope.FirstName = data.FirstName;
                            $scope.MiddleName = data.MiddleName;
                            $scope.LastName = data.LastName;
                            $scope.Employee_No = data.EMPLOYEMENTNO;
                            $scope.EmailId = data.EMAILID;
                            var mobilenoFields = data.MOBILE_NO.split('~');
                            var countrycode = mobilenoFields[0];
                            var mNumber = mobilenoFields[1];
                            var mNumberCC = countrycode + mNumber;
                            //$scope.MobileNo = data.MOBILE_NO;
                            $scope.MobileNo = typeof (mNumber) == "undefined" ? data.MOBILE_NO : mNumber;
                            //inputPhoneNo.setNumber(mNumberCC);
                            $scope.ViewDepartmentName = data.Department_Name;
                            $scope.ViewInstitutionName = data.InstitutionName;
                            $scope.Photo = data.Photo;
                            $scope.UserLogo = data.Photo;
                            //$scope.uploadme = data.Photo;
                            $scope.FileName = data.FileName;
                            $scope.PhotoFullpath = data.Photo_Fullpath;
                            $scope.NationalPhotoFullpath = data.NationalPhotoFullpath;
                            $scope.InsurancePhotoFullpath = data.InsurancePhotoFullpath;
                            $scope.UserTypeId = data.UserType_Id.toString();
                            $scope.Health_License = data.HEALTH_LICENSE;
                            $scope.File_Name = data.FILE_NAME;
                            $scope.CertificateFileName = data.FILE_NAME;
                            $scope.Resume = data.FILE_NAME;
                            $scope.resumedoc = data.FILE_NAME;
                            $scope.File_FullPath = data.FILE_FULLPATH;
                            $scope.Upload_FileName = data.UPLOAD_FILENAME;
                            $scope.GenderId = data.GENDER_ID.toString();
                            $scope.NationalityId = data.NATIONALITY_ID.toString();
                            $scope.EthnicGroupId = data.ETHINICGROUP_ID.toString();
                            $scope.DOB = DateFormatEdit($filter('date')(data.DOB, "dd-MMM-yyyy"));
                            $scope.HomeAreaCode = data.HOME_AREACODE;
                            $scope.Home_PhoneNo = data.HOME_PHONENO;
                            $scope.MobileAreaCode = data.MOBIL_AREACODE;
                            $scope.PostalZipCode = data.POSTEL_ZIPCODE;
                            $scope.EMR_Avalability = data.EMR_AVAILABILITY;
                            $scope.Address1 = data.ADDRESS1;
                            $scope.Address2 = data.ADDRESS2;
                            $scope.Address3 = data.ADDRESS3;
                            $scope.CountryId = data.COUNTRY_ID.toString();
                            $scope.StateId = data.STATE_ID.toString();
                            $scope.CityId = data.CITY_ID.toString();

                            $scope.CountryDuplicateId = $scope.CountryId;
                            $scope.CountryFlag = true;
                            $scope.StateDuplicateId = $scope.StateId;
                            $scope.StateFlag = true;
                            $scope.LocationDuplicateId = $scope.CityId;
                            $scope.CityFlag = true;
                            if ($scope.DropDownListValue == 4) {

                                $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                                    $scope.CountryNameList = data;
                                    if ($scope.CountryFlag == true) {
                                        $scope.CountryId = $scope.CountryDuplicateId;
                                        $scope.CountryFlag = false;
                                        $scope.loadCount = $scope.loadCount - 1;
                                    }
                                });
                                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + data.COUNTRY_ID.toString()).success(function (data) {
                                    $scope.StateName_List = data;
                                    if ($scope.StateFlag == true) {
                                        $scope.StateId = $scope.StateDuplicateId;
                                        $scope.StateFlag = false;
                                        $scope.loadCount = $scope.loadCount - 1;
                                    }
                                });
                                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + data.COUNTRY_ID.toString() + '&StateId=' + data.STATE_ID.toString()).success(function (data) {
                                    //$scope.LocationName_List =data ;    
                                    $scope.LocationName_List = data;
                                    if ($scope.CityFlag == true) {
                                        $scope.CityId = $scope.LocationDuplicateId;
                                        $scope.CityFlag = false;
                                        $scope.loadCount = $scope.loadCount - 1;
                                    }
                                });
                            }
                            $scope.MaritalStatusId = data.MARITALSTATUS_ID.toString();
                            $scope.BloodGroupId = data.BLOODGROUP_ID.toString();
                            $scope.PatientNo = data.PATIENTNO;
                            $scope.Createdby_ShortName = data.Createdby_ShortName;
                            $scope.InsuranceId = data.INSURANCEID;
                            $scope.MNR_No = data.MNR_NO;
                            $scope.DropDownListValue = 3;
                            $scope.NationalId = data.NATIONALID;
                            $scope.EthnicGroup = data.EthnicGroup;
                            $scope.ViewGender = data.GENDER_NAME;
                            $scope.ViewNationality = data.Nationality;
                            $scope.ViewUserName = data.UserName;
                            $scope.ViewGroupName = data.GroupName;
                            $scope.ViewCountryName = data.COUNTRY_NAME;
                            $scope.ViewStateName = data.StateName;
                            $scope.ViewLocationName = data.LocationName;
                            $scope.Institution = data.Institution;
                            $scope.LanguageKnown = data.LanguageKnown;
                            $scope.MaritalStatus = data.MaritalStatus;
                            $scope.ViewBloodGroup = data.BLOODGROUP_NAME;
                            $scope.RelationShipName = data.RelationShipName;
                            $scope.DietDescribe = data.DietDescribe;
                            $scope.AlergySubstance = data.AlergySubstance;
                            $scope.ChronicCondition = data.ChronicCondition;
                            $scope.EXCERCISE_SCHEDULE = data.EXCERCISE_SCHEDULE;
                            $scope.SMOKESUBSTANCE = data.SMOKESUBSTANCE;
                            $scope.ALCOHALSUBSTANCE = data.ALCOHALSUBSTANCE;
                            $scope.CAFFEINATED_BEVERAGES = data.CAFFEINATED_BEVERAGES;
                            $scope.DIETDESCRIBE_ID = data.DIETDESCRIBE_ID.toString();
                            $scope.EXCERCISE_SCHEDULEID = data.EXCERCISE_SCHEDULEID.toString();
                            $scope.ALERGYSUBSTANCE_ID = data.ALERGYSUBSTANCE_ID.toString();
                            $scope.SMOKESUBSTANCE_ID = data.SMOKESUBSTANCE_ID.toString();
                            $scope.ALCOHALSUBSTANCE_ID = data.ALCOHALSUBSTANCE_ID.toString();
                            $scope.CAFFEINATED_BEVERAGESID = data.CAFFEINATED_BEVERAGESID.toString();
                            $scope.EMERG_CONT_RELATIONSHIP_ID = data.EMERG_CONT_RELATIONSHIP_ID.toString();
                            $scope.CURRENTLY_TAKEMEDICINE = data.CURRENTLY_TAKEMEDICINE;
                            $scope.PAST_MEDICALHISTORY = data.PAST_MEDICALHISTORY;
                            $scope.FAMILYHEALTH_PROBLEMHISTORY = data.FAMILYHEALTH_PROBLEMHISTORY;
                            $scope.VACCINATIONS = data.VACCINATIONS;
                            $scope.EXCERCISE_TEXT = data.EXCERCISE_TEXT;
                            $scope.ALERGYSUBSTANCE_TEXT = data.ALERGYSUBSTANCE_TEXT;
                            $scope.SMOKESUBSTANCE_TEXT = data.SMOKESUBSTANCE_TEXT;
                            $scope.ALCOHALSUBSTANCE_TEXT = data.ALCOHALSUBSTANCE_TEXT;
                            $scope.CAFFEINATEDBEVERAGES_TEXT = data.CAFFEINATEDBEVERAGES_TEXT;
                            $scope.EMERG_CONT_FIRSTNAME = data.EMERG_CONT_FIRSTNAME;
                            $scope.EMERG_CONT_MIDDLENAME = data.EMERG_CONT_MIDDLENAME;
                            $scope.EMERG_CONT_LASTNAME = data.EMERG_CONT_LASTNAME;
                            $scope.Emergency_MobileNo = data.Emergency_MobileNo;
                            $scope.Google_EmailId = data.GOOGLE_EMAILID;
                            $scope.FB_EmailId = data.FB_EMAILID;
                            $scope.appleUserID = data.appleUserID;
                            $scope.Patient_Type = data.Patient_Type;
                            $scope.PATIENT_ID = data.PatientId;
                            $scope.Diabetic = data.DIABETIC.toString();
                            $scope.HyperTension = data.HYPERTENSION.toString();
                            $scope.Cholestrol = data.CHOLESTEROL.toString();

                            $scope.ViewDiabetic = data.Diabetic_Option;
                            $scope.ViewCholestrol = data.Cholesterol_Option;
                            $scope.ViewHyperTension = data.HyperTension_Option;

                            $scope.AddMedicines = data.AddMedicines;
                            $scope.AddMedicalHistory = data.AddMedicalHistory;
                            $scope.AddHealthProblem = data.AddHealthProblem;
                            $scope.ApprovalFlag = data.Approval_flag;
                            $scope.PayorName = data.PayorName;
                            $scope.PlanName = data.PlanName;
                            $scope.Member_ID = data.Memberid;
                            $scope.Policy_Number = data.PolicyNumber;
                            $scope.Reference_ID = data.RefernceId;
                            $scope.ExpiryDate = DateFormatEdit($filter('date')(data.ExpiryDate, "dd-MMM-yyyy"));
                            $scope.ConfigCode = "PATIENTPAGE_COUNT";
                            $scope.ISact = 1;
                            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                            setTimeout(function () {
                                $scope.GenderId = data.GENDER_ID.toString();
                                $scope.NationalityId = data.NATIONALITY_ID.toString();
                                $scope.MaritalStatusId = data.MARITALSTATUS_ID.toString();
                                $scope.EthnicGroupId = data.ETHINICGROUP_ID.toString();
                                $scope.BloodGroupId = data.BLOODGROUP_ID.toString();
                                $scope.UserTypeId = data.UserType_Id.toString();
                                $scope.NationalityId = data.NATIONALITY_ID.toString();
                            }, 10000);

                            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                                if (data1.length != 0) {
                                    $scope.page_size = data1[0].ConfigValue;
                                }
                                //$scope.page_size = data1[0].ConfigValue;
                                $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                                $scope.PageEnd = $scope.current_page * $scope.page_size;
                                $http.get(baseUrl + '/api/PayorMaster/PayorList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.SelectedInstitutionId + '&StartRowNumber=' + $scope.PageStart +
                                    '&EndRowNumber=' + $scope.PageEnd).success(function (data1) {
                                        $scope.PayorMasterList = data1;
                                        //$scope.SelectedPayor = "";
                                        if (data.PayorId != null && data.PayorId != "") {
                                            $scope.EditPayorId = data.PayorId;
                                            //$scope.SelectedPayor.push($scope.EditPayorId);
                                            $http.get(baseUrl + '/api/PlanMaster/PayorBasedPlan/?Id=' + data.PayorId).success(function (data) {
                                                $scope.PayorBasedPlanList = data;
                                                if (data.length != 0) {
                                                    //$scope.SelectedPlan = "";
                                                    $scope.EditPlanId = "";
                                                    $scope.EditPlanId = data[0].Id.toString();
                                                    $scope.PlanName = data[0].PlanName;
                                                    //$scope.SelectedPlan.push($scope.EditPlanId);
                                                    setTimeout(function () {
                                                        $scope.SelectedPayor = $scope.EditPayorId;
                                                        $scope.SelectedPlan = $scope.EditPlanId;
                                                    }, 5000);
                                                }
                                            });
                                        }
                                    });
                            });

                            methodcnt = methodcnt - 1;
                            if (methodcnt == 0)
                                $scope.uploadview = true;

                            methodcnt1 = methodcnt1 - 1;
                            if (methodcnt1 == 0)
                                $scope.Nationaluploadview = true;

                            methodcnt2 = methodcnt2 - 1;
                            if (methodcnt2 == 0)
                                $scope.Insuranceuploadview = true;

                            if ($scope.UserTypeId == 2) {
                                if ($scope.AddMedicines.length > 0) {
                                    $scope.CurrentMedicineflag = 1;
                                }
                                else {
                                    $scope.CurrentMedicineflag = 0;
                                }
                                if ($scope.AddMedicalHistory.length > 0) {
                                    $scope.PastMedicineflag = 1;
                                }
                                else {
                                    $scope.PastMedicineflag = 0;
                                }

                                if ($scope.AddHealthProblem.length > 0) {
                                    $scope.MedicalHistoryflag = 1;
                                }
                                else {
                                    $scope.MedicalHistoryflag = 0;
                                }
                            }
                            angular.forEach(data.SelectedGroupList, function (value, index) {
                                $scope.EditSelectedGroup.push(value.Group_Id);
                                $scope.SelectedGroup = $scope.EditSelectedGroup;
                            });
                            angular.forEach(data.SelectedInstitutionList, function (value, index) {
                                $scope.EditSelectedInstitution.push(value.Institution_Id);
                                $scope.SelectedInstitution = $scope.EditSelectedInstitution;
                            });
                            angular.forEach(data.SelectedLanguageList, function (value, index) {
                                $scope.EditSelectedLanguage.push(value.Language_Id);
                                $scope.SelectedLanguage = $scope.EditSelectedLanguage;
                            });
                            angular.forEach(data.SelectedChronicConnditionList, function (value, index) {
                                $scope.EditSelectedChronicondition.push(value.Chronic_Id);
                                $scope.SelectedChronicCondition = $scope.EditSelectedChronicondition;
                                $scope.SelectedChronicConditionEdit = $scope.EditSelectedChronicondition;
                            });
                            //$scope.CountryBased_StateFunction();
                            //$scope.StateBased_CityFunction();
                            //$scope.Country_onChange();
                            //$scope.State_onChange();
                            $('#patientrowid').prop('disabled', true);
                            $("#chatLoaderPV").hide();
                            inputPhoneNo.setNumber(mNumberCC);
                        });
                    } else {
                        window.location.href = baseUrl + "/Home/LoginIndex";
                    }
                });
            }
            else {
                $("#chatLoaderPV").hide();
                photoview = false;
                photoview1 = false;
                photoview2 = false;
            }

        }

        $scope.PhotoUplaodSelected = function () {
            $scope.PhotoValue = 1;
            $scope.UserPhotoValue = 1;
        };
        $scope.NationalityPhotoUplaodSelected = function () {
            $scope.PhotoValue1 = 1;
            $scope.NationalPhotoValue = 1;
        };
        $scope.InsurancePhotoUplaodSelected = function () {
            $scope.PhotoValue2 = 1;
            $scope.InsurancePhotoValue = 1;
        };

        $scope.CertificateUplaodSelected = function () {
            $scope.CertificateValue = 1;
        };

        $scope.UserDetails_InActive = function (GetId) {
            var Usertype = parseInt(localStorage.getItem('UserTypeId'));
            for (var k = 0; k < $scope.UserDetailsList.length; k++) {
                if ($scope.UserDetailsList[k].Id === GetId && $scope.UserDetailsList[k].Is_Master === true && Usertype !== 1) {
                    //alert("Could not deactivate the selected User!");
                    toastr.info("Could not deactivate the selected User!", "info");
                    return false;
                }
            }

            $scope.Id = GetId;

            Swal.fire({
                title: 'Do you like to deactivate the selected User?',
                html:'',
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: 'Yes',
                denyButtonText: 'No',
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                        $http.get(baseUrl + '/api/User/UserDetails_InActive/?Id=' + $scope.Id).success(function (data) {
                        if (data.Status == "True") {
                            //alert(data.Message);
                            toastr.success(data.Message, "success");
                            if ($scope.MenuTypeId == 1)
                                $scope.User_Admin_List($scope.MenuTypeId);
                            else if ($scope.MenuTypeId == 2)
                                $scope.BusinessUser_List($scope.MenuTypeId);
                            else if ($scope.MenuTypeId == 3)
                                $scope.Patient_List($scope.MenuTypeId);
                        }
                        else {
                            //alert(data.Message);
                            toastr.info(data.Message, "info");
                        }
                    }).error(function (data) {
                        $scope.error = "An error has occurred while deleting User Details" + data;
                    });
                } else if (result.isDenied) {
                    //Swal.fire('Changes are not saved', '', 'info')
                }
            })

            //Swal.fire("Do you like to deactivate the selected User?", {
            //    className: 'alert-danger',
            //    buttons: {
            //        Ok: {
            //            text: "Ok",
            //            value: "Ok",
            //        },
            //        cancel: {
            //            text: "Cancel",
            //            value: "Cancel",
            //        },
            //    },
            //})
            //    .then((value) => {
            //        switch (value) {
            //            case "Ok":
            //                $http.get(baseUrl + '/api/User/UserDetails_InActive/?Id=' + $scope.Id).success(function (data) {
            //                    if (data.Status == "True") {
            //                        //alert(data.Message);
            //                        toastr.success(data.Message, "success");
            //                        if ($scope.MenuTypeId == 1)
            //                            $scope.User_Admin_List($scope.MenuTypeId);
            //                        else if ($scope.MenuTypeId == 2)
            //                            $scope.BusinessUser_List($scope.MenuTypeId);
            //                        else if ($scope.MenuTypeId == 3)
            //                            $scope.Patient_List($scope.MenuTypeId);
            //                    }
            //                    else {
            //                        //alert(data.Message);
            //                        toastr.info(data.Message, "info");
            //                    }
            //                }).error(function (data) {
            //                    $scope.error = "An error has occurred while deleting User Details" + data;
            //                });
            //                break;
            //            default:
            //                //swal("Got away safely!");
            //        }
            //    });

            //var del = confirm("Do you like to deactivate the selected User?");
            //if (del == true) {
            //    $http.get(baseUrl + '/api/User/UserDetails_InActive/?Id=' + $scope.Id).success(function (data) {
            //        if (data.Status == "True") {
            //            //alert(data.Message);
            //            toastr.success(data.Message, "success");
            //            if ($scope.MenuTypeId == 1)
            //                $scope.User_Admin_List($scope.MenuTypeId);
            //            else if ($scope.MenuTypeId == 2)
            //                $scope.BusinessUser_List($scope.MenuTypeId);
            //            else if ($scope.MenuTypeId == 3)
            //                $scope.Patient_List($scope.MenuTypeId);
            //        }
            //        else {
            //            //alert(data.Message);
            //            toastr.info(data.Message, "info");
            //        }
            //    }).error(function (data) {
            //        $scope.error = "An error has occurred while deleting User Details" + data;
            //    });
            //}
        };
        $scope.UserDetails_Active = function (GetId) {
            $scope.Id = GetId;


            Swal.fire({
                title: 'Do you like to activate the selected User?',
                html: '',
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: 'Yes',
                denyButtonText: 'No',
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                        $http.get(baseUrl + '/api/User/UserDetails_Active/?Id=' + $scope.Id).success(function (data) {
                        if (data.Status == "True") {
                            //alert("User Details has been activated Successfully");
                            toastr.success("User Details has been activated Successfully", "success");
                            if ($scope.MenuTypeId == 1)
                                $scope.User_Admin_List($scope.MenuTypeId);
                            else if ($scope.MenuTypeId == 2)
                                $scope.BusinessUser_List($scope.MenuTypeId);
                            else if ($scope.MenuTypeId == 3)
                                $scope.Patient_List($scope.MenuTypeId);
                        }
                        else {
                            //alert(data.Message);
                            toastr.info(data.Message, "info");
                        }
                    }).error(function (data) {
                        $scope.error = "An error has occurred while deleting User Details" + data;
                    });
                } else if (result.isDenied) {
                    //Swal.fire('Changes are not saved', '', 'info')
                }
            })

            //var del = confirm("Do you like to activate the selected User?");
            //if (del == true) {
            //    $http.get(baseUrl + '/api/User/UserDetails_Active/?Id=' + $scope.Id).success(function (data) {
            //        if (data.Status == "True") {
            //            //alert("User Details has been activated Successfully");
            //            toastr.success("User Details has been activated Successfully", "success");
            //            if ($scope.MenuTypeId == 1)
            //                $scope.User_Admin_List($scope.MenuTypeId);
            //            else if ($scope.MenuTypeId == 2)
            //                $scope.BusinessUser_List($scope.MenuTypeId);
            //            else if ($scope.MenuTypeId == 3)
            //                $scope.Patient_List($scope.MenuTypeId);
            //        }
            //        else {
            //            //alert(data.Message);
            //            toastr.info(data.Message, "info");
            //        }
            //    }).error(function (data) {
            //        $scope.error = "An error has occurred while deleting User Details" + data;
            //    });
            //}
        };
        // Add row concept
        $scope.AddMedicines = [{
            'Id': $scope.ChildId,
            'MedicineName': $scope.MedicineName,
            'Remarks': $scope.Remarks,
            'Status': 1
        }];
        /*This is a Addrow function to add new row and save Medicine details*/
        $scope.AddMedicine_Insert = function () {
            if ($scope.MedicineRow >= 0) {
                var obj = {
                    'Id': $scope.ChildId,
                    'MedicineName': $scope.MedicineName,
                    'Remarks': $scope.Remarks,
                    'Status': 1
                }
                $scope.AddMedicines[$scope.MedicineRow] = obj;
            }
            else {
                $scope.AddMedicines.push({
                    'Id': $scope.ChildId,
                    'MedicineName': $scope.MedicineName,
                    'Remarks': $scope.Remarks,
                    'Status': 1
                })
            }
        };
        $scope.AddHealthProblem = [{
            'Id': $scope.HealthProblem_Id,
            'Relationship_Id': $scope.Relationship_Id,
            'Health_Problem': $scope.Health_Problem,
            'Remarks': $scope.Remarks,
            'Status': 1
        }];
        //$scope.AddMedicalHistory = [{
        //    'Id': $scope.Medical_History_Id,
        //    'Medical_History': $scope.Medical_History,
        //    'Remarks': $scope.Remarks,
        //    'Status': 1
        //}];
        $scope.AddMedicalHistory = [];
        /*This is a Addrow function to add new row and save Medical History details*/
        $scope.AddMedicalHistory_Insert = function () {
            if ($scope.MedicalHistoryRow >= 0) {
                var obj = {
                    'Id': $scope.Medical_History_Id,
                    'Medical_History': $scope.Medical_History,
                    'Remarks': $scope.Remarks,
                    'Status': 1
                }
                $scope.AddMedicalHistory[$scope.MedicalHistoryRow] = obj;
            }
            else {
                $scope.AddMedicalHistory.push({
                    'Id': $scope.Medical_History_Id,
                    'Medical_History': $scope.Medical_History,
                    'Remarks': $scope.Remarks,
                    'Status': 1
                })
            }
        };
        $scope.AddHealthProblem = [{
            'Id': $scope.HealthProblem_Id,
            'Relationship_Id': $scope.Relationship_Id,
            'Health_Problem': $scope.Health_Problem,
            'Remarks': $scope.Remarks,
            'Status': 1
        }];
        /*This is a Addrow function to add new row and save Family Health Problem details*/
        $scope.AddHealthProblem_Insert = function () {
            if ($scope.HealthProblemRow >= 0) {
                var obj = {
                    'Id': $scope.HealthProblem_Id,
                    'Relationship_Id': $scope.Relationship_Id,
                    'Health_Problem': $scope.Health_Problem,
                    'Remarks': $scope.Remarks,
                    'Status': 1
                }
                $scope.AddHealthProblem[$scope.HealthProblemRow] = obj;
            }
            else {
                $scope.AddHealthProblem.push({
                    'Id': $scope.HealthProblem_Id,
                    'Relationship_Id': $scope.Relationship_Id,
                    'Health_Problem': $scope.Health_Problem,
                    'Remarks': $scope.Remarks,
                    'Status': 1
                })
            }
        };
        $scope.AdminDefaultConfiguration = 0;
        $scope.AdminInstitutionCreation = function () {
            $scope.AdminDefaultConfiguration = 1;
            $scope.User_InsertUpdate();
        }
        $scope.User_InsertUpdate = function () {
            $scope.MobileNo_CC = document.getElementById("txthdFullNumber").value;
            //$scope.ConfigCode = "MRN_PREFIX";
            //$scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            //$http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data2) {
            //    console.log(data2);
            //    $scope.PrefixMRN = data2[0].ConfigValue;
            //});

            $('#btnsave').attr("disabled", true);
            $('#btnsave1').attr("disabled", true);
            $('#btnsave2').attr("disabled", true);
            var myPromise = $scope.AgeRestictLimit();
            $scope.Is_Master = false;
            myPromise.then(function (resolve) {

                if (($scope.MenuTypeId == 2 || $scope.MenuTypeId == 3) || ($scope.MenuTypeId == 1 && $scope.LoginType == 3)) // for business users
                {
                    $scope.InstitutionId = $window.localStorage['InstitutionId'];
                }
                if ($scope.MenuTypeId == 1 && $scope.LoginType == 1) {
                    $scope.Is_Master = true;
                }
                if ($scope.User_Admin_AddEdit_Validations() == true) {
                    $("#chatLoaderPV").show();
                    $scope.PhotoFullpath = $('#item-img-output').attr('src');
                    $scope.NationalPhotoFullpath = $('#item-img-output1').attr('src');
                    $scope.InsurancePhotoFullpath = $('#item-img-output2').attr('src');
                    $scope.UserInstitutionDetails_List = [];
                    angular.forEach($scope.SelectedInstitution, function (value, index) {
                        var Institutionobj = {
                            Id: 0,
                            Institution_Id: value
                        }
                        $scope.UserInstitutionDetails_List.push(Institutionobj);
                    });
                    $scope.UserLanguageDetails_List = [];
                    angular.forEach($scope.SelectedLanguage, function (value, index) {
                        var Languageobj = {
                            Id: 0,
                            Language_Id: value
                        }
                        $scope.UserLanguageDetails_List.push(Languageobj);
                    });
                    $scope.UserGroupDetails_List = [];
                    angular.forEach($scope.SelectedGroup, function (value, index) {
                        var obj = {
                            Id: 0,
                            Group_Id: value
                        }
                        $scope.UserGroupDetails_List.push(obj);
                    });
                    $scope.PatientChronicCondition_List = [];
                    angular.forEach($scope.SelectedChronicCondition, function (value, index) {
                        var obj = {
                            Id: 0,
                            Chronic_Id: value
                        }
                        $scope.PatientChronicCondition_List.push(obj);
                    });
                    var FileName = "";
                    var CertificateFileName = "";
                    var Licensefilename = "";
                    var fd = new FormData();
                    var imgBlob;
                    var NationalimgBlob;
                    var InsuranceimgBlob;
                    var imgBlobfile;
                    var NationalitemIndexLogo = -1;
                    var InsuranceitemIndexLogo = -1;
                    var itemIndexLogo = -1;
                    var itemIndexfile = -1;
                    var fd = new FormData();
                    //if ($('#UserLogo')[0].files[0] != undefined) {
                    //    FileName = $('#UserLogo')[0].files[0]['name'];
                    //    imgBlob = $scope.dataURItoBlob($scope.uploadme);
                    //    itemIndexLogo = 0;
                    //}

                    //if (itemIndexLogo != -1) {
                    //    fd.append('file', imgBlob);
                    //}
                    /*
                    calling the api method for read the file path 
                    and saving the image uploaded in the local server. 
                    */
                    $scope.EmptyValueCheckingInsert();
                    if ($scope.DOB == "" || $scope.DOB == undefined || $scope.DOB == null) {
                        var obj = {
                            Id: $scope.Id,
                            INSTITUTION_ID: $scope.InstitutionId == 0 ? null : $scope.InstitutionId,
                            FirstName: $scope.FirstName,
                            MiddleName: $scope.MiddleName,
                            LastName: $scope.LastName,
                            EMPLOYEMENTNO: $scope.Employee_No,
                            DEPARTMENT_ID: $scope.DepartmentId == 0 ? null : $scope.DepartmentId,
                            EMAILID: $scope.EmailId,
                            MOBILE_NO: $scope.MobileNo_CC,
                            FileName: $scope.FileName,
                            Photo_Fullpath: $scope.PhotoFullpath,
                            NationalPhotoFullpath: $scope.NationalPhotoFullpath,
                            NationalPhotoFilename: $scope.NationalPhotoFilename,
                            InsurancePhotoFullpath: $scope.InsurancePhotoFullpath,
                            InsurancePhotoFilename: $scope.InsurancePhotoFilename,
                            Photo: $scope.UserLogo,
                            NationalPhoto: $scope.NationalPhoto,
                            InsurancePhoto: $scope.InsurancePhoto,
                            UserType_Id: $scope.MenuTypeId == 1 ? 3 : $scope.MenuTypeId == 3 ? 2 : $scope.UserTypeId,
                            TITLE_ID: $scope.Title_Id == 0 ? null : $scope.Title_Id,
                            HEALTH_LICENSE: $scope.Health_License,
                            FILE_NAME: $scope.CertificateFileName,
                            FILE_FULLPATH: "",
                            UPLOAD_FILENAME: $scope.Resume,
                            GENDER_ID: $scope.GenderId == 0 ? null : $scope.GenderId,
                            NATIONALITY_ID: $scope.NationalityId == 0 ? null : $scope.NationalityId,
                            ETHINICGROUP_ID: $scope.EthnicGroupId == 0 ? null : $scope.EthnicGroupId,
                            DOB: "",
                            HOME_AREACODE: $scope.HomeAreaCode,
                            HOME_PHONENO: $scope.Home_PhoneNo,
                            MOBIL_AREACODE: $scope.MobileAreaCode,
                            POSTEL_ZIPCODE: $scope.PostalZipCode,
                            EMR_AVAILABILITY: $scope.EMR_Avalability,
                            ADDRESS1: $scope.Address1,
                            ADDRESS2: $scope.Address2,
                            ADDRESS3: $scope.Address3,
                            COUNTRY_ID: $scope.CountryId == 0 ? null : $scope.CountryId,
                            STATE_ID: $scope.StateId == 0 ? null : $scope.StateId,
                            CITY_ID: $scope.CityId == 0 ? null : $scope.CityId,
                            MARITALSTATUS_ID: $scope.MaritalStatusId == 0 ? null : $scope.MaritalStatusId,
                            BLOODGROUP_ID: $scope.BloodGroupId == 0 ? null : $scope.BloodGroupId,
                            PATIENTNO: $scope.PatientNo,
                            INSURANCEID: $scope.InsuranceId,
                            //MNR_NO: $scope.MNR_No,
                            NATIONALID: $scope.NationalId,
                            SMOKER: $scope.Smoker == 0 ? null : $scope.Smoker,
                            DIABETIC: $scope.Diabetic == 0 ? null : $scope.Diabetic,
                            HYPERTENSION: $scope.HyperTension == 0 ? null : $scope.HyperTension,
                            CHOLESTEROL: $scope.Cholestrol == 0 ? null : $scope.Cholestrol,
                            SelectedGroupList: $scope.UserGroupDetails_List,
                            GroupTypeList: $scope.GroupTypeList,
                            SelectedInstitutionList: $scope.UserInstitutionDetails_List,
                            InstitutionList: $scope.DoctorInstitutionList,
                            SelectedLanguageList: $scope.UserLanguageDetails_List,
                            LanguageList: $scope.LanguageList,
                            CURRENTLY_TAKEMEDICINE: $scope.CURRENTLY_TAKEMEDICINE,
                            PAST_MEDICALHISTORY: $scope.PAST_MEDICALHISTORY,
                            FAMILYHEALTH_PROBLEMHISTORY: $scope.FAMILYHEALTH_PROBLEMHISTORY,
                            VACCINATIONS: $scope.VACCINATIONS,
                            DIETDESCRIBE_ID: $scope.DIETDESCRIBE_ID == 0 ? null : $scope.DIETDESCRIBE_ID,
                            EXCERCISE_SCHEDULEID: $scope.EXCERCISE_SCHEDULEID == 0 ? null : $scope.EXCERCISE_SCHEDULEID,
                            EXCERCISE_TEXT: $scope.EXCERCISE_TEXT,
                            ALERGYSUBSTANCE_ID: $scope.ALERGYSUBSTANCE_ID == 0 ? null : $scope.ALERGYSUBSTANCE_ID,
                            ALERGYSUBSTANCE_TEXT: $scope.ALERGYSUBSTANCE_TEXT,
                            SMOKESUBSTANCE_ID: $scope.SMOKESUBSTANCE_ID == 0 ? null : $scope.SMOKESUBSTANCE_ID,
                            SMOKESUBSTANCE_TEXT: $scope.SMOKESUBSTANCE_TEXT,
                            ALCOHALSUBSTANCE_ID: $scope.ALCOHALSUBSTANCE_ID == 0 ? null : $scope.ALCOHALSUBSTANCE_ID,
                            ALCOHALSUBSTANCE_TEXT: $scope.ALCOHALSUBSTANCE_TEXT,
                            CAFFEINATED_BEVERAGESID: $scope.CAFFEINATED_BEVERAGESID == 0 ? null : $scope.CAFFEINATED_BEVERAGESID,
                            CAFFEINATEDBEVERAGES_TEXT: $scope.CAFFEINATEDBEVERAGES_TEXT,
                            EMERG_CONT_FIRSTNAME: $scope.EMERG_CONT_FIRSTNAME,
                            EMERG_CONT_MIDDLENAME: $scope.EMERG_CONT_MIDDLENAME,
                            EMERG_CONT_LASTNAME: $scope.EMERG_CONT_LASTNAME,
                            EMERG_CONT_RELATIONSHIP_ID: $scope.EMERG_CONT_RELATIONSHIP_ID == 0 ? null : $scope.EMERG_CONT_RELATIONSHIP_ID,
                            SelectedChronicConnditionList: $scope.PatientChronicCondition_List,
                            ChronicConditionList: $scope.ChronicConditionList,
                            AddMedicines: $scope.AddMedicines,
                            AddMedicalHistory: $scope.AddMedicalHistory,
                            AddHealthProblem: $scope.AddHealthProblem,
                            MenuType: $scope.MenuTypeId,
                            GOOGLE_EMAILID: $scope.Google_EmailId,
                            FB_EMAILID: $scope.FB_EmailId,
                            CREATED_BY: $window.localStorage['UserId'],
                            ApprovalFlag: "1",      //  USER APPROVED WHEN IT IS CREATED BY HOSPITAL ADMIN OR SUPER ADMIN
                            Patient_Type: $scope.Patient_Type,
                            Emergency_MobileNo: $scope.Emergency_MobileNo,
                            IS_MASTER: $scope.Is_Master,
                            appleUserID: $scope.appleUserID,
                            PatientId: $scope.PATIENT_ID,
                            MrnPrefix: $scope.PrefixMRN,
                            User_Id: $window.localStorage['UserId'],
                            Memberid: $scope.Member_ID,
                            PolicyNumber: $scope.Policy_Number,
                            RefernceId: $scope.Reference_ID,
                            ExpiryDate: $scope.ExpiryDate,
                            PayorId: $scope.SelectedPayor,
                            PlanId: $scope.SelectedPlan,
                            InstitutionName: "",
                            Department_Name: "",
                            INSTITUTION_CODE: "",
                            FullName: "",
                            //Photo: "",
                            //FileName: "",
                            UserName: "",
                            //FILE_NAME: "",
                            //UPLOAD_FILENAME: "",
                            //MOBIL_AREACODE: "",
                            PayorName: "",
                            PlanName: "",
                            MNR_NO: "",
                            GroupName: "",
                            GENDER_NAME: "",
                            Nationality: "",
                            COUNTRY_NAME: "",
                            EthnicGroup: "",
                            StateName: "",
                            LocationName: "",
                            Institution: "",
                            LanguageKnown: "",
                            Createdby_ShortName: "",
                            MaritalStatus: "",
                            BLOODGROUP_NAME: "",
                            RelationShipName: "",
                            DietDescribe: "",
                            AlergySubstance: "",
                            EXCERCISE_SCHEDULE: "",
                            SMOKESUBSTANCE: "",
                            ALCOHALSUBSTANCE: "",
                            CAFFEINATED_BEVERAGES: "",
                            ChronicCondition: "",
                            PASSWORD: "",
                            Diabetic_Option: "",
                            HyperTension_Option: "",
                            Cholesterol_Option: "",
                            DOB_Encrypt: "",
                            ProtocolName: "",
                            PHOTOBLOB_LOW: "",
                            PHOTOBLOB_THUMB: "",
                            TAB_PIN: "",
                            TAB_PHOTO: "",
                            TAB_FINGERPRINT: "",
                            Approval_flag: "0",
                            flag: "0",
                            CREATED_DT: "",
                            TimeZone_Id: "0",
                            LoginTime: "",
                            ISACTIVE: "1",  //Default 1 
                            IsActive: "1",
                            Appointment_Module_Id: "0",
                            Group_Id: "0",
                            Protocol_Id: "0",
                            Unitgroup_preference: "0",
                            Language_preference: "0",
                            Payment_preference: "0",
                            Insurance_Preference: "0",
                            Modified_By: "0",
                            //FullNameFormula: $scope.FullNameFormula,
                            //InstitutionList: [{ "InstitutionName": "" }],
                            //LanguageList: [{ "Name": "" }]
                        }
                    } else {
                        var obj = {
                            Id: $scope.Id,
                            INSTITUTION_ID: $scope.InstitutionId == 0 ? null : $scope.InstitutionId,
                            FirstName: $scope.FirstName,
                            MiddleName: $scope.MiddleName,
                            LastName: $scope.LastName,
                            EMPLOYEMENTNO: $scope.Employee_No,
                            DEPARTMENT_ID: $scope.DepartmentId == 0 ? null : $scope.DepartmentId,
                            EMAILID: $scope.EmailId,
                            MOBILE_NO: $scope.MobileNo_CC,
                            FileName: $scope.FileName,
                            Photo_Fullpath: $scope.PhotoFullpath,
                            NationalPhotoFullpath: $scope.NationalPhotoFullpath,
                            NationalPhotoFilename: $scope.NationalPhotoFilename,
                            InsurancePhotoFullpath: $scope.InsurancePhotoFullpath,
                            InsurancePhotoFilename: $scope.InsurancePhotoFilename,
                            Photo: $scope.UserLogo,
                            NationalPhoto: $scope.NationalPhoto,
                            InsurancePhoto: $scope.InsurancePhoto,
                            UserType_Id: $scope.MenuTypeId == 1 ? 3 : $scope.MenuTypeId == 3 ? 2 : $scope.UserTypeId,
                            TITLE_ID: $scope.Title_Id == 0 ? null : $scope.Title_Id,
                            HEALTH_LICENSE: $scope.Health_License,
                            FILE_NAME: $scope.CertificateFileName,
                            FILE_FULLPATH: "",
                            UPLOAD_FILENAME: $scope.Resume,
                            GENDER_ID: $scope.GenderId == 0 ? null : $scope.GenderId,
                            NATIONALITY_ID: $scope.NationalityId == 0 ? null : $scope.NationalityId,
                            ETHINICGROUP_ID: $scope.EthnicGroupId == 0 ? null : $scope.EthnicGroupId,
                            DOB: moment($scope.DOB).format('DD-MMM-YYYY'),
                            HOME_AREACODE: $scope.HomeAreaCode,
                            HOME_PHONENO: $scope.Home_PhoneNo,
                            MOBIL_AREACODE: $scope.MobileAreaCode,
                            POSTEL_ZIPCODE: $scope.PostalZipCode,
                            EMR_AVAILABILITY: $scope.EMR_Avalability,
                            ADDRESS1: $scope.Address1,
                            ADDRESS2: $scope.Address2,
                            ADDRESS3: $scope.Address3,
                            COUNTRY_ID: $scope.CountryId == 0 ? null : $scope.CountryId,
                            STATE_ID: $scope.StateId == 0 ? null : $scope.StateId,
                            CITY_ID: $scope.CityId == 0 ? null : $scope.CityId,
                            MARITALSTATUS_ID: $scope.MaritalStatusId == 0 ? null : $scope.MaritalStatusId,
                            BLOODGROUP_ID: $scope.BloodGroupId == 0 ? null : $scope.BloodGroupId,
                            PATIENTNO: $scope.PatientNo,
                            INSURANCEID: $scope.InsuranceId,
                            //MNR_NO: $scope.MNR_No,
                            NATIONALID: $scope.NationalId,
                            SMOKER: $scope.Smoker == 0 ? null : $scope.Smoker,
                            DIABETIC: $scope.Diabetic == 0 ? null : $scope.Diabetic,
                            HYPERTENSION: $scope.HyperTension == 0 ? null : $scope.HyperTension,
                            CHOLESTEROL: $scope.Cholestrol == 0 ? null : $scope.Cholestrol,
                            SelectedGroupList: $scope.UserGroupDetails_List,
                            GroupTypeList: $scope.GroupTypeList,
                            SelectedInstitutionList: $scope.UserInstitutionDetails_List,
                            InstitutionList: $scope.DoctorInstitutionList,
                            SelectedLanguageList: $scope.UserLanguageDetails_List,
                            LanguageList: $scope.LanguageList,
                            CURRENTLY_TAKEMEDICINE: $scope.CURRENTLY_TAKEMEDICINE,
                            PAST_MEDICALHISTORY: $scope.PAST_MEDICALHISTORY,
                            FAMILYHEALTH_PROBLEMHISTORY: $scope.FAMILYHEALTH_PROBLEMHISTORY,
                            VACCINATIONS: $scope.VACCINATIONS,
                            DIETDESCRIBE_ID: $scope.DIETDESCRIBE_ID == 0 ? null : $scope.DIETDESCRIBE_ID,
                            EXCERCISE_SCHEDULEID: $scope.EXCERCISE_SCHEDULEID == 0 ? null : $scope.EXCERCISE_SCHEDULEID,
                            EXCERCISE_TEXT: $scope.EXCERCISE_TEXT,
                            ALERGYSUBSTANCE_ID: $scope.ALERGYSUBSTANCE_ID == 0 ? null : $scope.ALERGYSUBSTANCE_ID,
                            ALERGYSUBSTANCE_TEXT: $scope.ALERGYSUBSTANCE_TEXT,
                            SMOKESUBSTANCE_ID: $scope.SMOKESUBSTANCE_ID == 0 ? null : $scope.SMOKESUBSTANCE_ID,
                            SMOKESUBSTANCE_TEXT: $scope.SMOKESUBSTANCE_TEXT,
                            ALCOHALSUBSTANCE_ID: $scope.ALCOHALSUBSTANCE_ID == 0 ? null : $scope.ALCOHALSUBSTANCE_ID,
                            ALCOHALSUBSTANCE_TEXT: $scope.ALCOHALSUBSTANCE_TEXT,
                            CAFFEINATED_BEVERAGESID: $scope.CAFFEINATED_BEVERAGESID == 0 ? null : $scope.CAFFEINATED_BEVERAGESID,
                            CAFFEINATEDBEVERAGES_TEXT: $scope.CAFFEINATEDBEVERAGES_TEXT,
                            EMERG_CONT_FIRSTNAME: $scope.EMERG_CONT_FIRSTNAME,
                            EMERG_CONT_MIDDLENAME: $scope.EMERG_CONT_MIDDLENAME,
                            EMERG_CONT_LASTNAME: $scope.EMERG_CONT_LASTNAME,
                            EMERG_CONT_RELATIONSHIP_ID: $scope.EMERG_CONT_RELATIONSHIP_ID == 0 ? null : $scope.EMERG_CONT_RELATIONSHIP_ID,
                            SelectedChronicConnditionList: $scope.PatientChronicCondition_List,
                            ChronicConditionList: $scope.ChronicConditionList,
                            AddMedicines: $scope.AddMedicines,
                            AddMedicalHistory: $scope.AddMedicalHistory,
                            AddHealthProblem: $scope.AddHealthProblem,
                            MenuType: $scope.MenuTypeId,
                            GOOGLE_EMAILID: $scope.Google_EmailId,
                            FB_EMAILID: $scope.FB_EmailId,
                            CREATED_BY: $window.localStorage['UserId'],
                            ApprovalFlag: "1",      //  USER APPROVED WHEN IT IS CREATED BY HOSPITAL ADMIN OR SUPER ADMIN
                            Patient_Type: $scope.Patient_Type,
                            Emergency_MobileNo: $scope.Emergency_MobileNo,
                            IS_MASTER: $scope.Is_Master,
                            appleUserID: $scope.appleUserID,
                            PatientId: $scope.PATIENT_ID,
                            MrnPrefix: $scope.PrefixMRN,
                            User_Id: $window.localStorage['UserId'],
                            Memberid: $scope.Member_ID,
                            PolicyNumber: $scope.Policy_Number,
                            RefernceId: $scope.Reference_ID,
                            ExpiryDate: $scope.ExpiryDate,
                            PayorId: $scope.SelectedPayor,
                            PlanId: $scope.SelectedPlan,
                            InstitutionName: "",
                            Department_Name: "",
                            INSTITUTION_CODE: "",
                            FullName: "",
                            //Photo: "",
                            //FileName: "",
                            UserName: "",
                            //FILE_NAME: "",
                            //UPLOAD_FILENAME: "",
                            //MOBIL_AREACODE: "",
                            PayorName: "",
                            PlanName: "",
                            MNR_NO: "",
                            GroupName: "",
                            GENDER_NAME: "",
                            Nationality: "",
                            COUNTRY_NAME: "",
                            EthnicGroup: "",
                            StateName: "",
                            LocationName: "",
                            Institution: "",
                            LanguageKnown: "",
                            Createdby_ShortName: "",
                            MaritalStatus: "",
                            BLOODGROUP_NAME: "",
                            RelationShipName: "",
                            DietDescribe: "",
                            AlergySubstance: "",
                            EXCERCISE_SCHEDULE: "",
                            SMOKESUBSTANCE: "",
                            ALCOHALSUBSTANCE: "",
                            CAFFEINATED_BEVERAGES: "",
                            ChronicCondition: "",
                            PASSWORD: "",
                            Diabetic_Option: "",
                            HyperTension_Option: "",
                            Cholesterol_Option: "",
                            DOB_Encrypt: "",
                            ProtocolName: "",
                            PHOTOBLOB_LOW: "",
                            PHOTOBLOB_THUMB: "",
                            TAB_PIN: "",
                            TAB_PHOTO: "",
                            TAB_FINGERPRINT: "",
                            Approval_flag: "0",
                            flag: "0",
                            CREATED_DT: "",
                            TimeZone_Id: "0",
                            LoginTime: "",
                            ISACTIVE: "1",  //Default 1 
                            IsActive: "1",
                            Appointment_Module_Id: "0",
                            Group_Id: "0",
                            Protocol_Id: "0",
                            Unitgroup_preference: "0",
                            Language_preference: "0",
                            Payment_preference: "0",
                            Insurance_Preference: "0",
                            Modified_By: "0",
                            //FullNameFormula: $scope.FullNameFormula,
                            //InstitutionList: [{ "InstitutionName": "" }],
                            //LanguageList: [{ "Name": "" }]
                        }
                    }
                    $http.post(baseUrl + '/api/User/User_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                        /*alert(data.Message);*/
                        if (data.ReturnFlag == 0) {
                            toastr.info(data.Message, "info");
                        }
                        else if (data.ReturnFlag == 1) {
                            toastr.success(data.Message, "success");
                        }
                        $('#btnsave').attr("disabled", false);
                        $('#btnsave1').attr("disabled", false);
                        $('#btnsave2').attr("disabled", false);
                        $scope.InstitutionCreatedID = data.UserDetails.INSTITUTION_ID;
                        /*if (data.Message == "Email already exists cannot be Duplicated") {
                            alert("Email already exists, cannot be Duplicate");
                            return false;
                        }
                        else if (data.Message == "User created successfully") {
                            alert("User created successfully");
                        }
                        else if (data.Message == "User updated successfully") {
                            alert("User updated successfully");
                        }*/
                        var userid = data.UserDetails.Id;

                        $scope.UserImageAttach(userid);
                        if (data.ReturnFlag == "1") {
                            if ($scope.AdminDefaultConfiguration == 1) {
                                $scope.InstitueDefaultConfiguration();
                            }
                            $scope.UserTypeId = $window.localStorage['UserTypeId'];
                            if ($scope.MenuTypeId == 1) {
                                $scope.User_Admin_List($scope.MenuTypeId);
                            }
                            if ($scope.MenuTypeId == 2) {
                                $scope.BusinessUser_List($scope.MenuTypeId);
                            }
                            if ($scope.MenuTypeId == 3) {
                                if ($scope.UserTypeId != 2) {
                                    $scope.ListRedirect();
                                }
                            }
                            $scope.CancelPopup();
                            if ($scope.PageParameter == 1) {
                                $scope.Cancel_PatientData_Edit();
                            }
                            if ($scope.PageParameter == 0) {
                                $scope.Cancel_PatientAppproval_Edit();
                            }
                            $("#UserLogo").val('');
                            $("#NationalLogo").val('');
                            $("#InsuranceLogo").val('');
                            $('#btnsave').attr("disabled", false);
                        }

                        $("#chatLoaderPV").hide();
                    });
                }
                else {
                    $('#btnsave').attr("disabled", false);
                    $('#btnsave1').attr("disabled", false);
                    $('#btnsave2').attr("disabled", false);
                }
            });
        }

        $scope.InstitueDefaultConfiguration = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=1', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration2();
            }).error(function (data) {
                //alert("Error In Step 1");
                toastr.error("Error In Step 1", "warning");
                $scope.InstitueDefaultConfiguration2();
            });
        };

        $scope.InstitueDefaultConfiguration2 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=2', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration3();
            }).error(function (data) {
                //alert("Error In Step 2");
                toastr.error("Error In Step 2", "warning");
                $scope.InstitueDefaultConfiguration3();
            });
        };

        $scope.InstitueDefaultConfiguration3 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=3', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration4();
            }).error(function (data) {
                //alert("Error In Step 3");
                toastr.error("Error In Step 3", "warning");
                $scope.InstitueDefaultConfiguration4();
            });
        };

        $scope.InstitueDefaultConfiguration4 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=4', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration5();
            }).error(function (data) {
                //alert("Error In Step 4");
                toastr.error("Error In Step 4", "warning");
                $scope.InstitueDefaultConfiguration5();
            });
        };

        $scope.InstitueDefaultConfiguration5 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=5', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration6();
            }).error(function (data) {
                //alert("Error In Step 5");
                toastr.error("Error In Step 5", "warning");
                $scope.InstitueDefaultConfiguration6();
            });
        };

        $scope.InstitueDefaultConfiguration6 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=6', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration7();
            }).error(function (data) {
                //alert("Error In Step 6");
                toastr.error("Error In Step 6", "warning");
                $scope.InstitueDefaultConfiguration7();
            });
        };

        $scope.InstitueDefaultConfiguration7 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=7', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration8();
            }).error(function (data) {
                //alert("Error In Step 7");
                toastr.error("Error In Step 7", "warning");
                $scope.InstitueDefaultConfiguration8();
            });
        };

        $scope.InstitueDefaultConfiguration8 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=8', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration9();
            }).error(function (data) {
                //alert("Error In Step 8");
                toastr.error("Error In Step 8", "warning");
                $scope.InstitueDefaultConfiguration9();
            });
        };

        $scope.InstitueDefaultConfiguration9 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=9', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration10();
            }).error(function (data) {
                //alert("Error In Step 9");
                toastr.error("Error In Step 9", "warning");
                $scope.InstitueDefaultConfiguration10();
            });
        };

        $scope.InstitueDefaultConfiguration10 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=10', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration11();
            }).error(function (data) {
                //alert("Error In Step 10");
                toastr.error("Error In Step 10", "warning");
                $scope.InstitueDefaultConfiguration11();
            });
        };

        $scope.InstitueDefaultConfiguration11 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=11', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration12();
            }).error(function (data) {
                //alert("Error In Step 11");
                toastr.error("Error In Step 11", "warning");
                $scope.InstitueDefaultConfiguration12();
            });
        };

        $scope.InstitueDefaultConfiguration12 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=12', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration13();
            }).error(function (data) {
                //alert("Error In Step 12");
                toastr.error("Error In Step 12", "warning");
                $scope.InstitueDefaultConfiguration13();
            });
        };

        $scope.InstitueDefaultConfiguration13 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=13', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration14();
            }).error(function (data) {
                //alert("Error In Step 13");
                toastr.error("Error In Step 13", "warning");
                $scope.InstitueDefaultConfiguration14();
            });
        };

        $scope.InstitueDefaultConfiguration14 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=14', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration15();
            }).error(function (data) {
                //alert("Error In Step 14");
                toastr.error("Error In Step 14", "warning");
                $scope.InstitueDefaultConfiguration15();
            });
        };

        $scope.InstitueDefaultConfiguration15 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=15', $scope.InstitutionCreatedID).success(function (data) {
                $scope.InstitueDefaultConfiguration16();
            }).error(function (data) {
                //alert("Error In Step 15");
                toastr.error("Error In Step 15", "warning");
                $scope.InstitueDefaultConfiguration16();
            });
        };

        $scope.InstitueDefaultConfiguration16 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=16', $scope.InstitutionCreatedID).success(function (data) {
            }).error(function (data) {
                //alert("Error In Step 16");
                toastr.error("Error In Step 16", "warning");
            });
        };


        $scope.UserImageAttach = function (userid) {
            var userid = userid;
            var FileName = "";
            var CertificateFileName = "";
            var Licensefilename = "";
            var fd = new FormData();
            var imgBlob;
            var NationalimgBlob;
            var InsuranceimgBlob;
            var imgBlobfile;
            var itemIndexLogo = -1;
            var NationalitemIndexLogo = -1;
            var InsuranceitemIndexLogo = -1;
            var itemIndexfile = -1;
            var fd1 = new FormData();
            var fd2 = new FormData();

            if (photoview == false) {
                photoview = true;

                if ($scope.PhotoFullpath != undefined && $scope.PhotoFullpath !== "" && $scope.PhotoFullpath != null) {
                    imgBlob = $scope.dataURItoBlob($scope.PhotoFullpath);
                    itemIndexLogo = 0;

                    if (itemIndexLogo != -1) {
                        fd.append('file', imgBlob);
                    }
                    /*
                    calling the api method for read the file path 
                    and saving the image uploaded in the local server. 
                    */

                    $http.post(baseUrl + '/api/User/AttachPhoto/?Id=' + userid + '&Photo=1' + '&Certificate=' + $scope.CertificateValue + '&CREATED_BY=' + $window.localStorage['UserId'],
                        fd,
                        {
                            transformRequest: angular.identity,
                            headers: {
                                'Content-Type': undefined
                            }
                        }
                    )
                        .success(function (response) {
                            if ($scope.FileName == "") {
                                $scope.UserLogo = "";
                            }
                            else if (itemIndexLogo > -1) {
                                if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                                    $scope.UserLogo = response[itemIndexLogo];
                                }
                            }
                        });
                }
            }

            if (photoview1 == false) {
                photoview1 = true;

                if ($scope.NationalPhotoFullpath != undefined && $scope.NationalPhotoFullpath != "" && $scope.NationalPhotoFullpath != null) {
                    NationalimgBlob = $scope.dataURItoBlob($scope.NationalPhotoFullpath);
                    NationalitemIndexLogo = 0;

                    if (NationalitemIndexLogo != -1) {
                        fd1.append('file', NationalimgBlob);
                    }
                    /*
                    calling the api method for read the file path 
                    and saving the image uploaded in the local server. 
                    */

                    $http.post(baseUrl + '/api/User/AttachNationalPhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue1 + '&CREATED_BY=' + $window.localStorage['UserId'],
                        fd1,
                        {
                            transformRequest: angular.identity,
                            headers: {
                                'Content-Type': undefined
                            }
                        }
                    )
                        .success(function (response) {
                            if ($scope.NationalPhotoFilename == "") {
                                $scope.NationalLogo = "";
                            }
                            else if (NationalitemIndexLogo > -1) {
                                if ($scope.NationalPhotoFilename != "" && response[NationalitemIndexLogo] != "") {
                                    $scope.NationalLogo = response[NationalitemIndexLogo];
                                }
                            }
                        });
                }
            }

            if (photoview2 == false) {
                photoview2 = true;
                if ($scope.InsurancePhotoFullpath != undefined && $scope.InsurancePhotoFullpath != "" && $scope.InsurancePhotoFullpath != null) {
                    InsuranceimgBlob = $scope.dataURItoBlob($scope.InsurancePhotoFullpath);
                    InsuranceitemIndexLogo = 0;

                    if (InsuranceitemIndexLogo != -1) {
                        fd2.append('file', InsuranceimgBlob);
                    }
                    /*
                    calling the api method for read the file path 
                    and saving the image uploaded in the local server. 
                    */

                    $http.post(baseUrl + '/api/User/AttachInsurancePhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue2 + '&CREATED_BY=' + $window.localStorage['UserId'],
                        fd2,
                        {
                            transformRequest: angular.identity,
                            headers: {
                                'Content-Type': undefined
                            }
                        }
                    )
                        .success(function (response) {
                            if ($scope.InsurancePhotoFilename == "") {
                                $scope.InsuranceLogo = "";
                            }
                            else if (InsuranceitemIndexLogo > -1) {
                                if ($scope.InsurancePhotoFilename != "" && response[InsuranceitemIndexLogo] != "") {
                                    $scope.InsuranceLogo = response[InsuranceitemIndexLogo];
                                }
                            }
                        });
                }
            }

            if ($scope.PhotoValue == 1 && photoview == false && $scope.Id == 0) {
                if ($scope.PhotoFullpath != undefined && $scope.PhotoFullpath != "" && $scope.PhotoFullpath != null) {
                    if ($('#UserLogo')[0].files[0] != undefined) {
                        FileName = $('#UserLogo')[0].files[0]['name'];
                        imgBlob = $scope.dataURItoBlob($scope.PhotoFullpath);
                        itemIndexLogo = 0;
                    }
                    if (itemIndexLogo != -1) {
                        fd.append('file', imgBlob);
                        /*	
                        calling the api method for read the file path 	
                        and saving the image uploaded in the local server. 	
                        */
                        $http.post(baseUrl + '/api/User/AttachPhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue + '&Certificate=' + $scope.CertificateValue + '&CREATED_BY=' + $window.localStorage['UserId'],
                            fd,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.FileName == "") {
                                    $scope.UserLogo = "";
                                }
                                else if (itemIndexLogo > -1) {
                                    if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                                        $scope.UserLogo = response[itemIndexLogo];
                                    }
                                }
                            });
                    }
                }
            }

            if ($scope.PhotoValue1 == 1 && photoview1 == false && $scope.Id == 0) {
                if ($scope.NationalPhotoFullpath != undefined && NationalPhotoFullpath != "" && NationalPhotoFullpath != null) {
                    if ($('#NationalLogo')[0].files[0] != undefined) {
                        NationalPhotoFilename = $('#NationalLogo')[0].files[0]['name'];
                        NationalimgBlob = $scope.dataURItoBlob($scope.NationalPhotoFullpath);
                        NationalitemIndexLogo = 0;
                    }
                    if (NationalitemIndexLogo != -1) {
                        fd1.append('file', NationalimgBlob);

                        /*	
                        calling the api method for read the file path 	
                        and saving the image uploaded in the local server. 	
                        */
                        $http.post(baseUrl + '/api/User/AttachNationalPhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue1 + '&CREATED_BY=' + $window.localStorage['UserId'],
                            fd1,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.NationalPhotoFilename == "") {
                                    $scope.NationalLogo = "";
                                }
                                else if (NationalitemIndexLogo > -1) {
                                    if ($scope.NationalPhotoFilename != "" && response[NationalitemIndexLogo] != "") {
                                        $scope.NationalLogo = response[NationalitemIndexLogo];
                                    }
                                }
                            });
                    }
                }
            }

            if ($scope.PhotoValue2 == 1 && photoview2 == false && $scope.Id == 0) {
                if ($scope.InsurancePhotoFullpath != undefined && $scope.InsurancePhotoFullpath != "" && $scope.InsurancePhotoFullpath != null) {
                    if ($('#InsuranceLogo')[0].files[0] != undefined) {
                        InsurancePhotoFilename = $('#InsuranceLogo')[0].files[0]['name'];
                        InsuranceimgBlob = $scope.dataURItoBlob($scope.InsurancePhotoFullpath);
                        InsuranceitemIndexLogo = 0;
                    }
                    if (InsuranceitemIndexLogo != -1) {
                        fd2.append('file', InsuranceimgBlob);

                        /*	
                        calling the api method for read the file path 	
                        and saving the image uploaded in the local server. 	
                        */
                        $http.post(baseUrl + '/api/User/AttachInsurancePhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue2 + '&CREATED_BY=' + $window.localStorage['UserId'],
                            fd2,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.InsurancePhotoFilename == "") {
                                    $scope.InsuranceLogo = "";
                                }
                                else if (InsuranceitemIndexLogo > -1) {
                                    if ($scope.InsurancePhotoFilename != "" && response[InsuranceitemIndexLogo] != "") {
                                        $scope.InsuranceLogo = response[InsuranceitemIndexLogo];
                                    }
                                }
                            });
                    }
                }
            }

            if ($scope.PhotoValue == 1 && photoview == true && $scope.Id > 0) {
                if ($scope.PhotoFullpath != undefined && $scope.PhotoFullpath != "" && $scope.PhotoFullpath != null) {
                    if ($('#UserLogo')[0].files[0] != undefined) {
                        FileName = $('#UserLogo')[0].files[0]['name'];
                        imgBlob = $scope.dataURItoBlob($scope.PhotoFullpath);
                        itemIndexLogo = 0;

                        if ($scope.MenuTypeId == 1) {
                            document.getElementById("profileIcon").src = $scope.PhotoFullpath;
                        }
                    }
                    if (itemIndexLogo != -1) {
                        fd.append('file', imgBlob);

                        /*
                        calling the api method for read the file path 
                        and saving the image uploaded in the local server. 
                        */

                        $http.post(baseUrl + '/api/User/AttachPhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue + '&Certificate=' + $scope.CertificateValue + '&CREATED_BY=' + $window.localStorage['UserId'],
                            fd,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.FileName == "") {
                                    $scope.UserLogo = "";
                                }
                                else if (itemIndexLogo > -1) {
                                    if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                                        $scope.UserLogo = response[itemIndexLogo];
                                    }
                                }
                            });
                    }
                }
            }

            if ($scope.PhotoValue1 == 1 && photoview1 == true && $scope.Id > 0) {
                if ($scope.NationalPhotoFullpath != undefined && $scope.NationalPhotoFullpath != "" && $scope.NationalPhotoFullpath != null) {
                    if ($('#NationalLogo')[0].files[0] != undefined) {
                        NationalPhotoFilename = $('#NationalLogo')[0].files[0]['name'];
                        NationalimgBlob = $scope.dataURItoBlob($scope.NationalPhotoFullpath);
                        NationalitemIndexLogo = 0;

                        // if ($scope.MenuTypeId == 1) {
                        // document.getElementById("profileIcon").src = $scope.PhotoFullpath;
                        // }
                    }
                    if (NationalitemIndexLogo != -1) {
                        fd1.append('file', NationalimgBlob);

                        /*
                        calling the api method for read the file path 
                        and saving the image uploaded in the local server. 
                        */

                        $http.post(baseUrl + '/api/User/AttachNationalPhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue1 + '&CREATED_BY=' + $window.localStorage['UserId'],
                            fd1,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.NationalPhotoFilename == "") {
                                    $scope.NationalLogo = "";
                                }
                                else if (NationalitemIndexLogo > -1) {
                                    if ($scope.NationalPhotoFilename != "" && response[NationalitemIndexLogo] != "") {
                                        $scope.NationalLogo = response[NationalitemIndexLogo];
                                    }
                                }
                            });
                    }
                }
            }

            if ($scope.PhotoValue2 == 1 && photoview2 == true && $scope.Id > 0) {
                if ($scope.InsurancePhotoFullpath != undefined && $scope.InsurancePhotoFullpath != "" && $scope.InsurancePhotoFullpath != null) {
                    if ($('#InsuranceLogo')[0].files[0] != undefined) {
                        InsurancePhotoFilename = $('#InsuranceLogo')[0].files[0]['name'];
                        InsuranceimgBlob = $scope.dataURItoBlob($scope.InsurancePhotoFullpath);
                        InsuranceitemIndexLogo = 0;

                        // if ($scope.MenuTypeId == 1) {
                        // document.getElementById("profileIcon").src = $scope.PhotoFullpath;
                        // }
                    }
                    if (InsuranceitemIndexLogo != -1) {
                        fd2.append('file', InsuranceimgBlob);
                        /*
                        calling the api method for read the file path 
                        and saving the image uploaded in the local server. 
                        */

                        $http.post(baseUrl + '/api/User/AttachInsurancePhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue2 + '&CREATED_BY=' + $window.localStorage['UserId'],
                            fd2,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.InsurancePhotoFilename == "") {
                                    $scope.InsuranceLogo = "";
                                }
                                else if (InsuranceitemIndexLogo > -1) {
                                    if ($scope.InsurancePhotoFilename != "" && response[InsuranceitemIndexLogo] != "") {
                                        $scope.InsuranceLogo = response[InsuranceitemIndexLogo];
                                    }
                                }
                            });
                    }
                }
            }

            if ($scope.CertificateValue == 1) {
                if ($scope.MenuTypeId == 2) {
                    if ($('#EditDocument')[0].files[0] != undefined) {
                        $scope.CertificateFileName = $('#EditDocument')[0].files[0]['name'];
                        imgBlobfile = $scope.dataURItoBlob($scope.Editresumedoc);
                        if (itemIndexLogo == -1) {
                            itemIndexfile = 0;
                        }
                        else {
                            itemIndexfile = 1;
                        }
                    }
                    if (itemIndexfile != -1) {
                        fd.append('file1', imgBlobfile);
                    }
                }
                $http.post(baseUrl + '/api/User/AttachPhoto/?Id=' + userid + '&Photo=' + $scope.PhotoValue + '&Certificate=' + $scope.CertificateValue + '&CREATED_BY=' + $window.localStorage['UserId'],
                    fd,
                    {
                        transformRequest: angular.identity,
                        headers: {
                            'Content-Type': undefined
                        }
                    }
                )
                    .success(function (response) {
                        if ($scope.Resume == "") {
                            $scope.EditDocument = "";
                        }
                        //else if (itemIndexLogo > -1) {
                        //    if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                        //        $scope.UserLogo = response[itemIndexLogo];
                        //    }
                        //}
                        if ($scope.MenuTypeId === 2) {
                            if ($scope.EditDocument == "") {
                                $scope.Resume = "";
                            }

                            else if (itemIndexfile > -1) {
                                if ($scope.CertificateFileName != "" && response[itemIndexfile] != "") {
                                    $scope.Resume = response[itemIndexfile];
                                }
                            }
                        }
                    })
            }
        }

        $scope.EmptyValueCheckingInsert = function () {
            if ($scope.AddMedicines == null) {
                $scope.AddMedicines = [];
            }
            if ($scope.AddMedicalHistory == null) {
                $scope.AddMedicalHistory = [];
            }
            if ($scope.AddHealthProblem == null) {
                $scope.AddHealthProblem = [];
            }
            if ($scope.LanguageList == null) {
                $scope.LanguageList = [];
            }
            if ($scope.UserGroupDetails_List == "" || $scope.UserGroupDetails_List.length == 0) {
                var ch = [];
                ch = [{
                    "UserName": "",
                    "GroupName": "",
                    "DeptName": "",
                    "GenderName": ""
                }]
                $scope.UserGroupDetails_List = ch;
            }
            if ($scope.GroupTypeList == "" || $scope.GroupTypeList.length == 0) {
                var ch1 = [];
                ch1 = [{
                    "Id": "",
                    "GROUP_NAME": "",
                    "IsActive": ""
                }]
                $scope.GroupTypeList = ch1;
            }
            if ($scope.UserInstitutionDetails_List == "" || $scope.UserInstitutionDetails_List.length == 0) {
                var ch2 = [];
                ch2 = [{ "Institution": "" }]
                $scope.UserInstitutionDetails_List = ch2;
            }
            if ($scope.UserLanguageDetails_List == "" || $scope.UserLanguageDetails_List.length == 0) {
                var ch2 = [];
                ch2 = [{ "Language": "" }]
                $scope.UserLanguageDetails_List = ch2;
            }
            if ($scope.PatientChronicCondition_List == "" || $scope.PatientChronicCondition_List.length == 0) {
                var ch3 = [];
                ch3 = [{ "ChronicGroup": "", "ChronicCondition": "" }]
                $scope.PatientChronicCondition_List = ch3;
            }
            if ($scope.ChronicConditionList == "" || $scope.ChronicConditionList.length == 0) {
                var ch4 = [];
                ch4 = [{
                    "Id": "",
                    "Name": "",
                    "IsActive": ""
                }]
                $scope.ChronicConditionList = ch4;
            }
            if ($scope.AddMedicines != null || $scope.AddMedicines == "" || $scope.AddMedicines.length == 0) {
                var ch5 = [];
                ch5 = [{
                    "Id": "",
                    "Status": "", "MedicineName": "", "Remarks": ""
                }]
                $scope.AddMedicines = ch5;
            }
            if ($scope.AddMedicalHistory != null || $scope.AddMedicalHistory == "" || $scope.AddMedicalHistory.length == 0) {
                var ch6 = [];
                ch6 = [{ "Medical_History": "", "Remarks": "" }]
                $scope.AddMedicalHistory = ch6;
            }
            if ($scope.AddHealthProblem != null || $scope.AddHealthProblem[0].Id == 0) {
                var ch7 = [];
                $scope.AddHealthProblem = [];
                ch7 = [{
                    "Id": "",
                    "Status": "",
                    "Health_Problem": "",
                    "Remarks": "",
                    "Relationship_Name": ""
                }]
                $scope.AddHealthProblem = ch7;
            }
            if ($scope.DoctorInstitutionList == "" || $scope.DoctorInstitutionList == undefined || $scope.DoctorInstitutionList.length == 0) {
                var ch8 = [];
                ch8 = [{ "InstitutionName": "" }]
                $scope.DoctorInstitutionList = ch8;
            }
            if ($scope.LanguageList == "" || $scope.LanguageList == undefined || $scope.LanguageList.length == 0) {
                var ch9 = [];
                ch9 = [{ "Name": "" }]
                $scope.LanguageList = ch9;
            }
            //if ($scope.SelectedPayor.length == 1) {
            //    $scope.SelectedPayor = "";
            //    $scope.SelectedPayor = $scope.SelectedPayor[0];
            //} else {
            //    $scope.SelectPayor = "";
            //}
            //if ($scope.SelectedPlan.length == 1) {
            //    $scope.SelectedPlan = "";
            //    $scope.SelectedPlan = $scope.SelectedPlan[0];
            //} else {
            //    $scope.SelectedPlan = "";
            //}
        }

        $scope.ResetPatientFilter = function () {
            $scope.Filter_FirstName = "";
            $scope.Filter_LastName = "";
            $scope.Filter_MRN = "";
            $scope.Filter_PatientNo = "";
            $scope.filter_InsuranceId = "";
            $scope.Filter_GenderId = "0";
            $scope.filter_NationalityId = "0";
            $scope.filter_EthinicGroupId = "0";
            $scope.filter_MOBILE_NO = "";
            $scope.filter_HomePhoneNo = "";
            $scope.filter_Email = "";
            $scope.filter_MaritalStatus = "0";
            $scope.filter_CountryId = "0";
            $scope.filter_StataId = "0";
            $scope.filter_CityId = "0";
            $scope.filter_BloodGroupId = "0";
            $scope.filter_GroupId = "0";
            $scope.Patient_List($scope.MenuTypeId);
        }
        $scope.ListRedirect = function () {
            $scope.Patient_List($scope.MenuTypeId);
            $location.path("/PatientList/3");
        };
        $scope.fileclear = function () {
            $scope.Editresumedoc = "";
            $('#EditDocument').val('');
            $scope.CertificateFileName = "";
        };
        $scope.RemoveMedicine_Item = function (Delete_Id, rowIndex) {
            var del = confirm("Do you like to delete this Current Medical Details?");
            if (del == true) {
                var Previous_Item = [];
                if ($scope.Id == 0) {
                    angular.forEach($scope.AddMedicines, function (selectedPre, index) {
                        if (index != rowIndex)
                            Previous_Item.push(selectedPre);
                    });
                    $scope.AddMedicines = Previous_Item;
                }
                else if ($scope.Id > 0) {
                    angular.forEach($scope.AddMedicines, function (selectedPre, index) {
                        if (selectedPre.Id == Delete_Id) {
                            selectedPre.Status = 0;
                        }
                    });
                    if ($ff($scope.AddMedicines, { StatusId: 1 }).length > 0) {
                        $scope.CurrentMedicineflag = 1;
                    }
                    else {
                        $scope.CurrentMedicineflag = 0;
                    }
                }
            }
        };
        $scope.RemoveMedicalHistory_Item = function (Delete_Id, rowIndex) {
            var del = confirm("Do you like to delete this Past Medical Details?");
            if (del == true) {
                var Previous_MedicalHistoryItem = [];
                if ($scope.Id == 0) {
                    angular.forEach($scope.AddMedicalHistory, function (selectedPre, index) {
                        if (index != rowIndex)
                            Previous_MedicalHistoryItem.push(selectedPre);
                    });
                    $scope.AddMedicalHistory = Previous_MedicalHistoryItem;
                } else if ($scope.Id > 0) {
                    angular.forEach($scope.AddMedicalHistory, function (selectedPre, index) {
                        if (selectedPre.Id == Delete_Id) {
                            selectedPre.Status = 0;
                        }
                    });
                    if ($ff($scope.AddMedicalHistory, { StatusId: 1 }).length > 0) {
                        $scope.PastMedicineflag = 1;
                    }
                    else {
                        $scope.PastMedicineflag = 0;
                    }
                }
            }
        };
        $scope.RemoveHealthProblem_Item = function (Delete_Id, rowIndex) {
            var del = confirm("Do you like to delete this Family Health Problem Details?");
            if (del == true) {
                var Previous_HealthProblemItem = [];
                if ($scope.Id == 0) {
                    angular.forEach($scope.AddHealthProblem, function (selectedPre, index) {
                        if (index != rowIndex)
                            Previous_HealthProblemItem.push(selectedPre);
                    });
                    $scope.AddHealthProblem = Previous_HealthProblemItem;
                } else if ($scope.Id > 0) {
                    angular.forEach($scope.AddHealthProblem, function (selectedPre, index) {
                        if (selectedPre.Id == Delete_Id) {
                            selectedPre.Status = 0;
                        }
                    });
                    if ($ff($scope.AddHealthProblem, { StatusId: 1 }).length > 0) {
                        $scope.MedicalHistoryflag = 1;
                    }
                    else {
                        $scope.MedicalHistoryflag = 0;
                    }
                }
            }
        };

        $scope.ClearHealthProblem = function () {
            $scope.AddHealthProblem = [{
                'Id': 0,
                'Relationship_Id': 0,
                'Health_Problem': "",
                'Remarks': "",
                'Status': 1
            }];

        };
        $scope.ClearMedicalHistory = function () {
            angular.forEach($scope.AddMedicalHistory, function (value, index) {
                value.Id = 0;
                value.Medical_History = "";
                value.Remarks = "";
                value.Status = 1;
            });
        };
        $scope.ClearMedicine_Item = function () {
            $scope.AddMedicines = [{
                'Id': 0,
                'MedicineName': "",
                'Remarks': "",
                'Status': 1,
            }];
        };
        $scope.Url = baseUrl;
        $scope.AssignedGroupList = [];
        $scope.AssignedGroup = "0";
        $scope.AssignedGroup_Id = "0";
        $scope.CreateGroupName = "";
        $scope.Create_GroupId = "0";
        $scope.checkAll = function () {
            if ($scope.SelectedAllPatient == true) {
                $scope.SelectedAllPatient = true;
            } else {
                $scope.SelectedAllPatient = false;
            }
            angular.forEach($scope.Patientemptydata, function (row) {
                row.SelectedPatient = $scope.SelectedAllPatient;
            });
        };
        $scope.AssignGroup = function () {
            var cnt = ($filter('filter')($scope.Patientemptydata, 'true')).length;
            if (cnt == 0) {
                //alert("Please select atleast one Patient to Assign Group");
                toastr.info("Please select atleast one Patient to Assign Group", "info");
            }
            else if (typeof ($scope.AssignedGroup) == "undefined" || $scope.AssignedGroup == "0") {
                alert("Please select Group");
                toastr.warning("Please select Group", "warning");
                return false;
            }
            else {
                $scope.AssignedGroupList = [];
                angular.forEach($scope.Patientemptydata, function (SelectedPatient, index) {
                    if (SelectedPatient.SelectedPatient == true) {
                        var AssignGroupobj = {
                            Id: $scope.AssignedGroup_Id,
                            Group_Id: $scope.AssignedGroup.toString(),
                            User_Id: SelectedPatient.Id
                        };
                        $scope.AssignedGroupList.push(AssignGroupobj);
                    }
                });
                $http.post(baseUrl + '/api/User/AssignedGroup_Insert/', $scope.AssignedGroupList).success(function (data) {
                    if (data == 1) {
                        //alert("Group updated successfully");
                        toastr.success("Group updated successfully", "success");
                        $scope.ClearPatientGroupPopup();
                        $scope.Patient_List(3);
                    }
                });
            }
        }
        $scope.ClearPatientGroupPopup = function () {
            $scope.AssignedGroup = "0";
            $scope.SelectedAllPatient = false;
            angular.forEach($scope.PatientListFilter, function (SelectedPatient, index) {
                SelectedPatient.SelectedPatient = false;
            });
        }
        $scope.AddGroupPopup = function () {
            angular.element('#GroupCreateModal').modal('show');
        }
        $scope.CancelGroupPopup = function () {
            angular.element('#GroupCreateModal').modal('hide');
            $scope.GroupClearPopUp();
        }
        $scope.GroupClearPopUp = function () {
            $scope.CreateGroupName = "";
            $scope.Create_GroupId = "0";
        };
        $scope.AddGroup_Insert = function () {
            if (typeof ($scope.CreateGroupName) == "undefined" || $scope.CreateGroupName == "") {
                //alert("Please enter Group Name");
                toastr.warning("Please enter Group Name", "warning");
                return false;
            }
            else {
                var Groupobj = {
                    Id: $scope.Create_GroupId,
                    CreateGroupName: $scope.CreateGroupName,
                    Institution_Id: $window.localStorage['InstitutionId'],

                }
                $http.post(baseUrl + '/api/User/GroupMaster_Insert/', Groupobj).success(function (data) {
                    //alert(data.returnMessage);
                    toastr.success(data.returnMessage, "success");
                    if (data.flag == "2") // clear only if group is valid and record updated
                    {
                        $scope.CancelGroupPopup();
                        $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                            $scope.GroupTypeList = data;
                        });
                    }
                })
            }
        }
        $scope.Cancel_PatientEdit = function () {
            if ($scope.PageParameter == 2) {
                $scope.currentTab = "1";
                $location.path("/PatientList/3");
                $scope.ClearPopUp();
            }
            else if ($scope.PageParameter == 1) {
                $scope.Id = $routeParams.Id;
                $window.localStorage['CurrentTabId'] = $scope.currentTab;
                //$scope.Admin_View($scope.MenuTypeId);
                $location.path("/PatientView/" + $scope.Id + "/1" + "/3");
            }
            else if ($scope.PageParameter == 0) {
                $window.localStorage['CurrentTabId'] = $scope.currentTab;
                $scope.Id = $routeParams.Id;
                $location.path("/PatientView/" + $scope.Id + "/0" + "/3");
            }
        }
        $scope.Cancel_PatientData_Edit = function () {
            $scope.Id = $routeParams.Id;
            $window.localStorage['CurrentTabId'] = $scope.currentTab;
            $location.path("/PatientView/" + $scope.Id + "/1" + "/3");
        }
        $scope.Cancel_PatientAppproval_Edit = function () {
            $scope.Id = $routeParams.Id;
            $window.localStorage['CurrentTabId'] = $scope.currentTab;
            $location.path("/PatientView/" + $scope.Id + "/0" + "/3");
        }
        $scope.EditPatientData = function () {
            //$scope.Admin_View($scope.MenuTypeId);
            $window.localStorage['CurrentTabId'] = $scope.currentTab;
            $scope.Id = $routeParams.Id;
            $location.path("/PatientEdit/" + $scope.Id + "/1" + "/3/4");
        }
        $scope.EditCurrentTab = '1';
        if ($scope.PageParameter == 1) {
            $scope.EditCurrentTab = $window.localStorage['CurrentTabId'];
        }
        else {
            $window.localStorage['CurrentTabId'] = 1;
        }

        //$scope.Active_PatientApproval = function () {
        //    var msg = confirm("Do you like to Approve the Patient?");
        //    if (msg == true) {
        //        $http.get(baseUrl + '/api/PatientApproval/PatientApproval_Active/?Id=' + $routeParams.Id).success(function (data) {
        //            alert(data.Message);
        //            $location.path("/PatientApproval");
        //        }).error(function (data) {
        //            $scope.error = "AN error has occured while deleting patient approval records" + data;
        //        });
        //    }
        //};

        $scope.EditPatientData_Approval = function () {
            //$scope.Admin_View($scope.MenuTypeId);
            $window.localStorage['CurrentTabId'] = $scope.currentTab;
            $scope.Id = $routeParams.Id;
            $location.path("/PatientEdit/" + $scope.Id + "/0" + "/3/4");
        }


        $scope.MoreInfoPopup = function () {
            $scope.Remarks = "";
            angular.element('#MoreInfoModal').modal('show');
        }
        $scope.Cancel_MoreInfoPopup = function () {
            $scope.Remarks = "";
            angular.element('#MoreInfoModal').modal('hide');
        }
        $scope.Patient_Approval_Id = "0";
        $scope.PatientApproval_History_Insert = function () {
            if (typeof ($scope.Remarks) == "undefined" || $scope.Remarks == "") {
                //alert("Please enter Remarks");
                toastr.warning("Please enter Remarks", "warning");
                return false;
            }
            else {
                var obj = {
                    Id: $scope.Patient_Approval_Id,
                    Patient_Id: $routeParams.Id,
                    Remarks: $scope.Remarks,
                    Created_By: $window.localStorage['UserId']
                };
                $http.post(baseUrl + '/api/PatientApproval/PatientApproval_History_Insert/', obj).success(function (data) {
                    if (data == 1) {
                        //alert("Patient Approval History Inserted Successfully");
                        //location.href = 'mailto:' + $scope.EmailId;
                        $scope.Cancel_MoreInfoPopup();
                        $location.path("/PatientApproval");
                    }
                });
            }
        }

        /** Check All Functions for Businner users Group **/
        $scope.BuisnessUsercheckAll = function () {
            if ($scope.SelectedAllBuisnessUser == true) {
                $scope.SelectedAllBuisnessUser = true;
            } else {
                $scope.SelectedAllBuisnessUser = false;
            }
            angular.forEach($scope.BusinessUserFilter, function (row) {
                if (row.UserType_Id != 7)
                    row.SelectedBuisnessuser = $scope.SelectedAllBuisnessUser;
            });
        };

        /**Buisness User Update Assigned Group**/
        $scope.SelectedBuisnessuser = $window.localStorage['UserId'];
        $scope.BuisnessuserAssignGroup = function () {
            var cnt = ($filter('filter')($scope.BusinessUserFilter, 'true')).length;
            if (cnt == 0) {
                //alert("Please select atleast one Clinical User to Assign Group");
                toastr.info("Please select atleast one Clinical User to Assign Group", "info");
            }
            else if (typeof ($scope.AssignedGroup) == "undefined" || $scope.AssignedGroup == "0") {
                //alert("Please select Group");
                toastr.warning("Please select Group", "warning");
                return false;
            }
            else {
                $scope.AssignedGroupList = [];
                angular.forEach($scope.BusinessUserFilter, function (SelectedBuisnessuser, index) {
                    if (SelectedBuisnessuser.SelectedBuisnessuser == true) {
                        var AssignGroupobj = {
                            Id: $scope.AssignedGroup_Id,
                            Group_Id: $scope.AssignedGroup.toString(),
                            User_Id: SelectedBuisnessuser.Id
                        };
                        $scope.AssignedGroupList.push(AssignGroupobj);
                    }
                });
                $http.post(baseUrl + '/api/User/AssignedGroup_Insert/', $scope.AssignedGroupList).success(function (data) {
                    $scope.AssignedGroup = "";
                    if (data == 1) {
                        //alert("Group updated successfully");
                        toastr.success("Group updated successfully", "success");
                        $scope.ClearUserGroupPopup();
                        //$scope.AssignedGroup="0";
                        $scope.BusinessUser_List(2);
                    }
                });
            }
        }

        $scope.ClearUserGroupPopup = function () {
            $scope.AssignedGroup = "0";
            $scope.SelectedAllBuisnessUser = false;
            angular.forEach($scope.BusinessUserFilter, function (SelectedBuisnessuser, index) {
                SelectedBuisnessuser.SelectedBuisnessuser = false;
            });
        }
        $scope.Active_PatientApproval = function () {
            $scope.ApprovedPatientList = [];
            var msg = confirm("Do you like to Approve the Patient?");
            if (msg == true) {
                var ApprovePatientobj = {
                    Patient_Id: $routeParams.Id
                };
                $scope.ApprovedPatientList.push(ApprovePatientobj);
                $http.post(baseUrl + '/api/PatientApproval/Multiple_PatientApproval_Active/', $scope.ApprovedPatientList).success(function (data) {
                    //alert(data.Message);
                    toastr.success(data.Message, "success");
                    if (data.ReturnFlag == 1) {
                        $location.path("/PatientApproval");
                    }
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting patient approval records" + data;
                });
            }
        };
        if ($scope.AdminFlowdata > 0) {
            $scope.AddUserPopUP();
        }
    }
]);


/* THIS IS FOR INSTITUTION SUBSCRIPTION HOSPITAL ADMIN FUNCTION*/
MyCortexControllers.controller("InstitutionHospitalAdminController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {
        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        //Declaration and initialization of Scope Variables.
        $scope.CountryFlag = false;
        $scope.StateFlag = false;
        $scope.CityFlag = false;
        $scope.CountryDuplicateId = "0";
        $scope.StateDuplicateId = "0";
        $scope.LocationDuplicateId = "0";

        $scope.listdata = [];
        $scope.Institution_Name = "";
        $scope.INSTITUTION_SHORTNAME = "";
        $scope.Address1 = "";
        $scope.Address2 = "";
        $scope.Address3 = "";
        $scope.ZipCode = "";
        $scope.Email = "";
        //   $scope.CountryId = "0";
        //  $scope.StateNameId = "0";
        $scope.LocationNameId = "0";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.IsActive = true;
        $scope.rowCollection = [];
        $scope.rowCollectionFilter = [];
        $scope.Id = 0;
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.PhotoValue = 0;

        $scope.loadCount = 3;
        /*THIS IS FOR View FUNCTION*/
        $scope.InstitutionDetails_View = function (DropDownListValue) {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/Institution/Institution_GetPhoto/?Id=' + $scope.InstituteId).success(function (data) {
                if (data.PhotoBlob != null) {
                    $scope.uploadme = 'data:image/png;base64,' + data.PhotoBlob;
                }
                else {
                    $scope.uploadme = '';
                }
            })
            $http.get(baseUrl + '/api/Institution/InstitutionDetails_View/?Id=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.DuplicatesId = data.Id;
                $scope.Institution_Name = data.Institution_Name;
                $scope.INSTITUTION_SHORTNAME = data.INSTITUTION_SHORTNAME;
                $scope.Address1 = data.Institution_Address1;
                $scope.Address2 = data.Institution_Address2;
                $scope.Address3 = data.Institution_Address3;
                $scope.ZipCode = data.ZipCode;
                $scope.Email = data.Email;
                $scope.CountryId = data.CountryId.toString();
                $scope.CountryDuplicateId = $scope.CountryId;
                $scope.CountryFlag = true;
                //$scope.Country_onChange();           
                $scope.ViewCountryName = data.CountryName;
                //   $scope.CountryBased_StateFunction();
                $scope.StateNameId = data.StateId.toString();
                $scope.StateDuplicateId = $scope.StateNameId;
                $scope.StateFlag = true;

                //$scope.State_onChange();
                //  $scope.StateBased_CityFunction();
                $scope.ViewStateName = data.StateName;
                $scope.LocationNameId = data.CityId.toString();
                $scope.LocationDuplicateId = $scope.LocationNameId;
                $scope.CityFlag = true;
                if (DropDownListValue == 1) {
                    $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                        $scope.CountryNameList = data;
                        if ($scope.CountryFlag == true) {
                            $scope.CountryId = $scope.CountryDuplicateId;
                            $scope.CountryFlag = false;
                            $scope.loadCount = $scope.loadCount - 1;
                        }
                    });
                    $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + data.CountryId.toString()).success(function (data) {
                        $scope.StateName_List = data;
                        if ($scope.StateFlag == true) {
                            $scope.StateNameId = $scope.StateDuplicateId;
                            $scope.StateFlag = false;
                            $scope.loadCount = $scope.loadCount - 1;
                        }
                    });
                    $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + data.CountryId.toString() + '&StateId=' + data.StateId.toString()).success(function (data) {
                        //$scope.LocationName_List =data ;    
                        $scope.LocationName_List = data;
                        if ($scope.CityFlag == true) {
                            $scope.LocationNameId = $scope.LocationDuplicateId;
                            $scope.CityFlag = false;
                            $scope.loadCount = $scope.loadCount - 1;
                        }
                    });
                }
                $scope.ViewCityName = data.CityName;
                $scope.Photo = data.Photo;
                $scope.InstitutionLogo = data.Photo;
                //$scope.uploadme = data.Photo;
                $scope.FileName = data.FileName;
                $scope.PhotoFullpath = data.Photo_Fullpath;
                $("#chatLoaderPV").hide();
            });
        }


        $scope.EditInstitutionHospitalAdmin = function () {
            //$scope.InstitutionDetails_View();
            $scope.DropDownListValue = 1;
            $location.path("/EditInstitutionHospitalAdmin");
        };


        $scope.CountryBased_StateFunction = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.CountryId).success(function (data) {
                    $scope.StateName_List = data;
                    $scope.LocationName_List = [];
                    $scope.LocationNameId = "0";
                    if ($scope.StateFlag == true) {
                        $scope.StateNameId = $scope.StateDuplicateId
                    }

                });
            }
        }
        $scope.StateClearFunction = function () {
            $scope.StateNameId = "0";
        };

        $scope.StateBased_CityFunction = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.CountryId + '&StateId=' + $scope.StateNameId).success(function (data) {
                    $scope.LocationName_List = data;
                    if ($scope.CityFlag == true) {
                        $scope.LocationNameId = $scope.LocationDuplicateId
                    }
                });
            }
        }

        $scope.LocationClearFunction = function () {
            $scope.LocationNameId = "0";
        };
        /* Validating the create page mandatory fields
            checking mandatory for the follwing fields
            InstituionName,InstitutionPrintName,Email,CountryName,StateName,LocationName,Registrationdate
            and showing alert message when it is null.
            */
        $scope.InstitutionAddEdit_Validations = function () {
            if (typeof ($scope.Institution_Name) == "undefined" || $scope.Institution_Name == "") {
                //alert("Please enter Institution Name");
                toastr.warning("Please enter Institution Name", "warning");
                return false;
            }
            else if (typeof ($scope.INSTITUTION_SHORTNAME) == "undefined" || $scope.INSTITUTION_SHORTNAME == "") {
                //alert("Please enter Short Name");
                toastr.warning("Please enter Short Name", "warning");
                return false;
            }
            else if (typeof ($scope.Email) == "undefined" || $scope.Email == "") {
                //alert("Please enter Email");
                toastr.warning("Please enter Email", "warning");
                return false;
            }
            else if (EmailFormate($scope.Email) == false) {
                //alert("Invalid email format");
                toastr.warning("Invalid email format", "warning");
                return false;
            }
            else if (typeof ($scope.CountryId) == "undefined" || $scope.CountryId == "0") {
                //alert("Please select Country");
                toastr.warning("Please select Country", "warning");
                return false;
            }
            else if (typeof ($scope.StateNameId) == "undefined" || $scope.StateNameId == "0") {
                //alert("Please select State");
                toastr.warning("Please select State", "warning");
                return false;
            }
            else if (typeof ($scope.LocationNameId) == "undefined" || $scope.LocationNameId == "0") {
                //alert("Please select City");
                toastr.warning("Please select City", "warning");
                return false;
            }
            if ($scope.uploadme != "" && $scope.uploadme != null) {
                $scope.Image = filetype = $scope.uploadme.split(',')[0].split(':')[1].split(';')[0];
                $scope.filetype = $scope.Image.split("/");
                var fileval = 0;
                var fileExtenstion = "";
                if ($scope.filetype.length > 0) {
                    fileExtenstion = $scope.filetype[$scope.filetype.length - 1];
                }
                if (fileExtenstion.toLocaleLowerCase() == "jpeg" || fileExtenstion.toLocaleLowerCase() == "jpg" || fileExtenstion.toLocaleLowerCase() == "png"
                    || fileExtenstion.toLocaleLowerCase() == "bmp" || fileExtenstion.toLocaleLowerCase() == "gif" || fileExtenstion.toLocaleLowerCase() == "ico") {// check more condition with MIME type                      
                    fileval = 1;
                }
                else {
                    fileval = 2;
                }
                if (fileval == 2) {
                    //alert("Please choose files of type jpeg/jpg/png/bmp/gif/ico");
                    toastr.warning("Please choose files of type jpeg/jpg/png/bmp/gif/ico", "warning");
                    return false;
                }
            }
            return true;
        }

        /*This is for getting a file url for uploading the url into the database*/
        $scope.dataURItoBlob = function (dataURI) {
            var binary = atob(dataURI.split(',')[1]);
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            var array = [];
            for (var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {
                type: mimeString
            });
        }

        /* Read file name for the  Photo and file */
        $scope.photoChange = function () {
            if ($('#InstitutionLogo')[0].files[0] != undefined) {
                $scope.FileName = $('#InstitutionLogo')[0].files[0]['name'];
            }
        }

        //this is for image upload function//
        $scope.uploadImage = function (Photo) {
            var filename = "";
            //var fd = new FormData();
            if ($('#InstitutionLogo')[0].files[0] != undefined) {
                FileName = $('#InstitutionLogo')[0].files[0]['name'];
            }
        }

        /*on click Save calling the insert update function for Institution
             and check the Institution Name already exist,if exist it display alert message or its 
             calling the insert update function*/
        $scope.BlobFileName = "";
        $scope.Institution_AddEdit = function () {
            if ($scope.InstitutionAddEdit_Validations() == true) {
                $scope.PhotoFullpath = $('#item-img-output').attr('src');
                var obj = {
                    Id: $scope.InstituteId,
                    Institution_Name: $scope.Institution_Name,
                    INSTITUTION_SHORTNAME: $scope.INSTITUTION_SHORTNAME,
                    Institution_Address1: $scope.Address1,
                    Institution_Address2: $scope.Address2,
                    Institution_Address3: $scope.Address3,
                    ZipCode: $scope.ZipCode == 0 ? null : $scope.ZipCode,
                    Email: $scope.Email,
                    CountryId: $scope.CountryId,
                    StateId: $scope.StateNameId,
                    CityId: $scope.LocationNameId,
                    FileName: $scope.FileName,
                    Photo_Fullpath: $scope.PhotoFullpath,
                    Photo: $scope.InstitutionLogo,
                };
                $("#btnsave").attr("disabled", true);
                $http.post(baseUrl + '/api/Institution/Institution_AddEdit/', obj).success(function (data) {
                    var insId = data.Institute[0].Id;

                    if ($scope.PhotoValue == 1) {
                        var FileName = "";
                        var Licensefilename = "";
                        var fd = new FormData();
                        var imgBlob;
                        var imgBlobfile;
                        var itemIndexLogo = -1;
                        var itemIndexdoc = -1;
                        var fd = new FormData();
                        if ($('#InstitutionLogo')[0].files[0] != undefined) {
                            FileName = $('#InstitutionLogo')[0].files[0]['name'];
                            imgBlob = $scope.dataURItoBlob($scope.PhotoFullpath);
                            itemIndexLogo = 0;
                        }
                        if (itemIndexLogo != -1) {
                            fd.append('file', imgBlob);
                        }
                        /*
                        calling the api method for read the file path 
                        and saving the image uploaded in the local server. 
                        */

                        $http.post(baseUrl + '/api/Institution/AttachPhoto?Id=' + insId,
                            fd,
                            {
                                transformRequest: angular.identity,
                                headers: {
                                    'Content-Type': undefined
                                }
                            }
                        )
                            .success(function (response) {
                                if ($scope.FileName == "") {
                                    $scope.InstitutionLogo = "";
                                }
                                else if (itemIndexLogo > -1) {
                                    if ($scope.FileName != "" && response[itemIndexLogo] != "") {
                                        $scope.InstitutionLogo = response[itemIndexLogo];
                                    }
                                }
                                $http.get(baseUrl + '/Home/LoginLogoDetails/').success(function (resImage) {
                                    document.getElementById("InstLogo").src = resImage[0];
                                    alert(data.Message);
                                    $("#btnsave").attr("disabled", false);
                                    $scope.CancelInstitutionHospitalAdmin();
                                }).error(function (response) {
                                    $scope.Photo = "";
                                });
                            })
                            .error(function (response) {
                                $scope.Photo = "";
                            });
                    }
                    else {
                        //alert(data.Message);
                        toastr.success(data.Message, "success");
                        $("#btnsave").attr("disabled", false);
                        $scope.CancelInstitutionHospitalAdmin();
                    }
                    $("#InstitutionLogo").val('');
                    $("#btnsave").attr("disabled", false);
                })
            }
        }
        $scope.PhotoUplaodSelected = function () {
            $scope.PhotoValue = 1;
        };
        $scope.InstitutionClear = function () {
            $scope.Institution_Name = "";
            $scope.INSTITUTION_SHORTNAME = "";
            $scope.Address1 = "";
            $scope.Address2 = "";
            $scope.Address3 = "";
            $scope.ZipCode = "";
            $scope.Email = "";
            $scope.CountryId = "0";
            $scope.StateNameId = "0";
            $scope.LocationNameId = "0";
            $scope.FileName = "";
            $scope.Photo_Fullpath = "";
            $scope.InstitutionLogo = "";
            $scope.uploadme = "";
            $('#InstitutionLogo').val('');
            $scope.PhotoValue = 0;
        }

        /* Clear the uploaded image */
        $scope.imageclear = function () {
            $scope.InstitutionLogo = "";
            $scope.FileName = "";
            $scope.uploadme = "";
            $('#InstitutionLogo').val('');

        };

        /* THIS IS FUNCTION FOR CLOSE Page  */
        $scope.CancelInstitutionHospitalAdmin = function () {
            $location.path("/InstitutionHospitalAdmin_view/");
            //$scope.ClearInstitutionPopup();
        };

        $scope.DeleteCometChatUsers = function () {
            if (confirm("Are you sure you want to Run this Settings?")) {
                $("#runCometchat").text('Processing(0%)....');
                $("#runCometchat").addClass('disabled');
                let isComplete = false;
                $http.get(baseUrl + 'api/User/GetCometChatUserList?InstitutionId=' + $scope.InstituteId).success(function (data) {
                    if (data.length > 0) {
                        var usercount = data.length;
                        angular.forEach(data, function (item, modIndex) {
                            $http.get(baseUrl + 'api/User/DeleteCometchat_User?Id=' + item.Id + '&Institution=' + $scope.InstituteId).success(function (data) {
                                var obj = {
                                    Id: item.Id,
                                    FullName: item.FullName,
                                    EMAILID: item.EmailId
                                };
                                $http.post(baseUrl + 'api/User/CreateCometchat_User?Institution=' + $scope.InstituteId, obj).success(function (data) {
                                    if (parseInt(usercount) - 1 === modIndex) {
                                        isComplete = true;
                                        $("#runCometchat").text('CometChat User Configuration');
                                        $("#runCometchat").removeClass('disabled');
                                    }
                                    else {
                                        if (!isComplete) {
                                            var percentage = (modIndex / usercount) * 100;
                                            $("#runCometchat").text('Processing(' + percentage + '%)....');
                                        }
                                    }
                                }).error(function (data) {

                                });
                            }).error(function (data) {
                            });
                        });
                    }
                }).error(function (data) {
                });
            }
        };

        $scope.InstitueConfiguration = function () {
            if (confirm("Are you sure you want to Run this Configuration Settings?")) {
                $("#runConfig").text('Processing(0%)....');
                $("#runConfig").addClass('disabled');
                $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=1', $scope.InstituteId).success(function (data) {
                    $("#runConfig").text('Processing(5%)....');
                    $scope.InstitueConfigurationStep2();
                }).error(function (data) {
                    alert("Error In Step 1");
                    $("#runConfig").text('Processing(5%)....');
                    $scope.InstitueConfigurationStep2();
                });
            }
        };

        $scope.InstitueConfigurationStep2 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=2', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(10%)....');
                $scope.InstitueConfigurationStep3();
            }).error(function (data) {
                alert("Error In Step 2");
                $("#runConfig").text('Processing(10%)....');
                $scope.InstitueConfigurationStep3();
            });
        };

        $scope.InstitueConfigurationStep3 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=3', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(15%)....');
                $scope.InstitueConfigurationStep4();
            }).error(function (data) {
                alert("Error In Step 3");
                $("#runConfig").text('Processing(15%)....');
                $scope.InstitueConfigurationStep4();
            });
        };

        $scope.InstitueConfigurationStep4 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=4', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(20%)....');
                $scope.InstitueConfigurationStep5();
            }).error(function (data) {
                alert("Error In Step 4");
                $("#runConfig").text('Processing(20%)....');
                $scope.InstitueConfigurationStep5();
            });
        };

        $scope.InstitueConfigurationStep5 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=5', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(25%)....');
                $scope.InstitueConfigurationStep6();
            }).error(function (data) {
                alert("Error In Step 5");
                $("#runConfig").text('Processing(25%)....');
                $scope.InstitueConfigurationStep6();
            });
        };

        $scope.InstitueConfigurationStep6 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=6', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(30%)....');
                $scope.InstitueConfigurationStep7();
            }).error(function (data) {
                alert("Error In Step 6");
                $("#runConfig").text('Processing(30%)....');
                $scope.InstitueConfigurationStep7();
            });
        };

        $scope.InstitueConfigurationStep7 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=7', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(35%)....');
                $scope.InstitueConfigurationStep8();
            }).error(function (data) {
                alert("Error In Step 7");
                $("#runConfig").text('Processing(35%)....');
                $scope.InstitueConfigurationStep8();
            });
        };

        $scope.InstitueConfigurationStep8 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=8', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(40%)....');
                $scope.InstitueConfigurationStep9();
            }).error(function (data) {
                alert("Error In Step 8");
                $("#runConfig").text('Processing(40%)....');
                $scope.InstitueConfigurationStep9();
            });
        };

        $scope.InstitueConfigurationStep9 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=9', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(50%)....');
                $scope.InstitueConfigurationStep10();
            }).error(function (data) {
                alert("Error In Step 9");
                $("#runConfig").text('Processing(50%)....');
                $scope.InstitueConfigurationStep10();
            });
        };

        $scope.InstitueConfigurationStep10 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=10', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(55%)....');
                $scope.InstitueConfigurationStep11();
            }).error(function (data) {
                alert("Error In Step 10");
                $("#runConfig").text('Processing(55%)....');
                $scope.InstitueConfigurationStep11();
            });
        };

        $scope.InstitueConfigurationStep11 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=11', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(60%)....');
                $scope.InstitueConfigurationStep12();
            }).error(function (data) {
                alert("Error In Step 11");
                $("#runConfig").text('Processing(60%)....');
                $scope.InstitueConfigurationStep12();
            });
        };

        $scope.InstitueConfigurationStep12 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=12', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(70%)....');
                $scope.InstitueConfigurationStep13();
            }).error(function (data) {
                alert("Error In Step 12");
                $("#runConfig").text('Processing(70%)....');
                $scope.InstitueConfigurationStep13();
            });
        };

        $scope.InstitueConfigurationStep13 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=13', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(80%)....');
                $scope.InstitueConfigurationStep14();
            }).error(function (data) {
                alert("Error In Step 13");
                $("#runConfig").text('Processing(80%)....');
                $scope.InstitueConfigurationStep14();
            });
        };

        $scope.InstitueConfigurationStep14 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=14', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(90%)....');
                $scope.InstitueConfigurationStep15();
            }).error(function (data) {
                alert("Error In Step 14");
                $("#runConfig").text('Processing(90%)....');
                $scope.InstitueConfigurationStep15();
            });
        };

        $scope.InstitueConfigurationStep15 = function () {
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=15', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(95%)....');
                $scope.InstitueConfigurationStep16();
            }).error(function (data) {
                alert("Error In Step 15");
                $("#runConfig").text('Processing(95%)....');
                $scope.InstitueConfigurationStep16();
            });
        };

        $scope.InstitueConfigurationStep16 = function () {
            $("#runConfig").text('Processing(100%)....');
            $http.post(baseUrl + 'api/Common/DefaultConfig_InsertUpdate/?Step=16', $scope.InstituteId).success(function (data) {
                $("#runConfig").text('Processing(100%)....');
                setTimeout(function () {
                    alert("Configuration Steps Completed!");
                }, 5000);

                $("#runConfig").text('Re-run configuration');
                $("#runConfig").removeClass('disabled');
            }).error(function (data) {
                $("#runConfig").text('Processing(100%)....');
                alert("Error In Step 16");
                $("#runConfig").text('Re-run configuration');
                $("#runConfig").removeClass('disabled');
            });
        };

    }

]);

/* THIS IS FOR INSTITUTION SUBSCRIPTION HOSPITAL ADMIN CONTROLLER FUNCTION */
MyCortexControllers.controller("InstitutionSubscriptionHospitalAdminController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff) {

        //Declaration and initialization of Scope Variables.
        $scope.ChildId = 0;
        $scope.Institution_Id = "0";
        $scope.Health_Care_Professionals = "";
        $scope.Patients = "";
        $scope.Contract_Period_From = "";
        $scope.Contract_Period_To = "";
        $scope.Subscription_Type = "1";
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.Chroniccc = false;
        $scope.Chroniccg = false;
        $scope.Chroniccl = false;
        $scope.Chronicsc = false;

        $scope.InstitutionViewList = [];
        $scope.IsActive = true;

        /* on click view, view popup opened*/
        $scope.ViewInstitution = function () {
            $scope.InstitutionDetails_View();
            alert("test");
            $location.path("/InstitutionHospitalAdmin_view/" + $scope.InstituteId);
        };

        // This is for to get Institution Modiule List 
        //$http.get(baseUrl + '/api/InstitutionSubscription/ModuleNameList/').success(function (data) {
        //    // only active Country    
        //    $scope.InstitutiontypeList = data;
        //});

        /*on click Save calling the insert update function for Institution Subscription */
        $scope.InstitutionAddList = [];
        $scope.InstitutionAddLanguageList = [];
        $scope.InstitutionModule_List = [];
        $scope.InstitutionLanguage_List = [];
        $scope.InstitutionInsurance_List = [];
        $scope.InstitutionPayment_List = [];
        $scope.InstitutionChildList = [];
        $scope.InstitutionAddInsuranceList = [];
        $scope.InstitutionAddPaymentList = [];
        /*THIS IS FOR View FUNCTION*/
        $scope.InstitutionSubscriptionDetails_View = function () {
            $scope.TimeZoneIDName = "";
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            if ($window.localStorage['UserTypeId'] == 3) {

                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/InstitutionSubscription/InstitutionSubscriptionActiveDetails_View/?Id=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.DuplicatesId = data.Id;
                    $scope.InstitutiontypeList = data.Module_List;
                    $scope.InstitutionChildList = data.ChildModuleList;
                    $scope.LanguageList = data.Language_List;
                    $scope.InstitutionLanguageList = data.ChildLanguageList;
                    $scope.PaymentList = data.Payment_List;
                    $scope.InstitutionInsurnceList = data.ChildInsuranceList;
                    $scope.InstitutionPaymentList = data.ChildPaymentList;
                    $scope.InstitutionLanguageList = data.ChildLanguageList;
                    $scope.Institution_Id = data.Institution_Id.toString();
                    $scope.ViewInstitution_Name = data.Institution.Institution_Name;
                    $scope.Email = data.Institution.Email;
                    $scope.Address1 = data.Institution.Institution_Address1;
                    $scope.Address2 = data.Institution.Institution_Address2;
                    $scope.Address3 = data.Institution.Institution_Address3;
                    $scope.ZipCode = data.Institution.ZipCode;
                    $scope.Country = data.Institution.CountryName;
                    $scope.State = data.Institution.StateName;
                    $scope.City = data.Institution.CityName;
                    $scope.Contract_Period_From = $filter('date')(data.Contract_PeriodFrom, "dd-MMM-yyyy");
                    $scope.Health_Care_Professionals = data.Health_Care_Professionals;
                    $scope.Patients = data.No_Of_Patients;
                    $scope.Contract_Period_To = $filter('date')(data.Contract_PeriodTo, "dd-MMM-yyyy");
                    $scope.Subscription_Type = data.Subscription_Type;
                    $scope.InsSub_Id = data.SubscriptionId;
                    $scope.TimeZoneId = data.TimeZone_ID;
                    $scope.AppointmentModuleId = data.Appointment_Module_Id;
                    $scope.TimeZoneIDName = "";
                    $scope.Chroniccc = data.ChronicCc;
                    $scope.Chroniccg = data.ChronicCg;
                    $scope.Chroniccl = data.ChronicCl;
                    $scope.Chronicsc = data.ChronicSc;
                    $scope.Created_No_Of_Patient = data.Created_No_Of_Patient;
                    $scope.Created_No_Of_HealthCareProf = data.Created_No_Of_HealthCareProf;
                    $scope.Remaining_No_Of_Patient = data.Remaining_No_Of_Patient;
                    $scope.Remaining_No_Of_HealthCareProf = data.Remaining_No_Of_HealthCareProf;
                    $http.get(baseUrl + '/api/DoctorShift/TimeZoneList/?Login_Session_Id=' + $scope.LoginSessionId).success(function (data2) {
                        $scope.TimeZoneList = data2;
                        for (i in data2) {
                            if ($scope.TimeZoneList[i].TimeZoneId == $scope.TimeZoneId) {
                                var TimeZoneRevealID = i;
                                $scope.TimeZoneIDName = data2[TimeZoneRevealID].TimeZoneDisplayName;
                                break;
                            }
                        }
                    });
                    $http.get(baseUrl + '/api/DoctorShift/AppointmentModuleList/').success(function (data) {
                        // only active Language    
                        $scope.AppointmentModuleName = data[$scope.AppointmentModuleId - 1];
                    });
                    $http.get(baseUrl + '/api/Common/InstitutionInsurance/').success(function (data) {
                        $scope.InstitutionInsuranceName = data;
                        angular.forEach($scope.InstitutionInsuranceName, function (item, modIndex) {

                            if ($ff($scope.InstitutionInsurnceList, function (value) {
                                return value.Id == item.Id;
                            }).length > 0) {
                                $scope.InstitutionAddInsuranceList[modIndex] = true;
                            }
                            else {
                                $scope.InstitutionAddInsuranceList[modIndex] = false;
                            }
                        })
                    });

                    $http.get(baseUrl + '/api/Common/InstitutionPayment/').success(function (data) {
                        $scope.InstitutionPaymentMethod = data;

                        angular.forEach($scope.InstitutionPaymentMethod, function (item, modIndex) {

                            if ($ff($scope.InstitutionPaymentList, function (value) {
                                return value.Id == item.Id;
                            }).length > 0) {
                                $scope.InstitutionAddPaymentList[modIndex] = true;
                            }
                            else {
                                $scope.InstitutionAddPaymentList[modIndex] = false;
                            }
                        })
                    });
                    angular.forEach($scope.InstitutiontypeList, function (item, modIndex) {
                        if ($ff($scope.InstitutionChildList, function (value) {
                            return value.ModuleId == item.Id;
                        }).length > 0) {
                            $scope.InstitutionAddList[modIndex] = true;
                        }
                        else {
                            $scope.InstitutionAddList[modIndex] = false;
                        }
                    })

                    angular.forEach($scope.LanguageList, function (item, modIndex) {

                        if ($ff($scope.InstitutionLanguageList, function (value) {
                            return value.LanguageId == item.Id;
                        }).length > 0) {
                            $scope.InstitutionAddLanguageList[modIndex] = true;
                        }
                        else {
                            $scope.InstitutionAddLanguageList[modIndex] = false;
                        }
                    })
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

    }
]);

MyCortexControllers.controller("AllergyMasterList", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        $scope.AllergyMasterflag = 0;
        $scope.IsActive = true;
        //$scope.AllergyMasterIsActive = true;

        $scope.AllergyMasteremptydata = [];
        $scope.AllergyMasterListData = [];

        $scope.Institution_Id = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']

        // THIS IS FOR VALIDATION CONTROL /
        $scope.Validationcontrols = function () {
            if (typeof ($scope.AllergyTypeId) == "" || $scope.AllergyTypeId == "0") {
                //alert("Please select Allergy Type Name ");
                toastr.warning("Please select Allergy Type Name ", "warning");
                return false;
            }
            else if (typeof ($scope.AllergenName) == "" || $scope.AllergenName == undefined) {
                //alert("Please select Allergen Name");
                toastr.warning("Please select Allergen Name", "warning");
                return false;
            }
            return true;
        };
        // THIS IS FOR ADD/EDIT PROCEDURE 
        $scope.AllergyAddEdit = function () {
            if ($scope.Validationcontrols() == true) {
                $("#chatLoaderPV").show();
                $scope.Patient_Id = $window.localStorage['UserId'];
                var obj = {
                    Id: $scope.Id,
                    AllergyTypeId: $scope.AllergyTypeId == 0 ? null : $scope.AllergyTypeId,
                    AllergenId: $scope.AllergenId,
                    AllergenName: $scope.AllergenName,
                    InstitutionId: $scope.Institution_Id,
                    Created_By: $scope.Patient_Id
                }
                $("#btnsave").attr("disabled", true);
                $http.post(baseUrl + '/api/MasterAllergy/MasterAllergy_AddEdit/', obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $("#btnsave").attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.ClearPopup();
                        $scope.AllergyMasterList_Details();
                    }
                    //$scope.AddId = data;
                    angular.element('#AllergyModal').modal('hide');
                })
            }

        }


        //List Page Pagination.
        $scope.current_page = 1;
        $scope.Allergt_pages = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.allergyActive = true;
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            $scope.AllergyMasterList_Details();
        }

        $scope.AllergyMasterList_Details = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;
                    $http.get(baseUrl + '/api/User/AllergtMaster_List/?IsActive=' + $scope.ISact + '&Institution_Id=' + $scope.Institution_Id + '&StartRowNumber=' + $scope.PageStart +
                        '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                            $("#chatLoaderPV").hide();
                            if (data.length != 0 && data != null && data !== undefined) {
                                $scope.AllergyMasteremptydata = [];
                                $scope.AllergyMasterListData = [];
                                $scope.AllergyMasterListData = data;
                                $scope.AllergyCount = $scope.AllergyMasterListData[0].TotalRecord;
                                $scope.AllergyMasterListFilterData = data;
                                $scope.AllergyMasterList = angular.copy($scope.AllergyMasterListData);
                                if ($scope.AllergyMasterList.length > 0) {
                                    $scope.flag = 1;
                                }
                                else {
                                    $scope.flag = 0;
                                }
                            } else {
                                $scope.AllergyMasterList = [];
                                $scope.AllergyCount = 0;
                            }

                            $scope.AllergyTypeList = [];
                            $http.get(baseUrl + 'api/MasterAllergy/MasterAllergyTypeList/?institution_id=' + $scope.Institution_Id).success(function (data) {
                                $("#chatloaderpv").hide();
                                $scope.AllergyTypeListTemp = [];
                                $scope.AllergyTypeListTemp = data;
                                var obj = { "Id": 0, "AllergyTypeName": "Select", "IsActive": 1 };
                                $scope.AllergyTypeListTemp.splice(0, 0, obj);
                                $scope.AllergyTypeList = angular.copy($scope.AllergyTypeListTemp);
                            })
                            //$scope.AllergenListfilter = [];
                            //$scope.AllegenBasedType = function (AllergyTypeId) {
                            //    var id = "0"
                            //    id = $scope.AllergenId;
                            //    $http.get(baseUrl + 'api/MasterAllergy/MasterAllergenList/?ALLERGYTYPE_ID=' + AllergyTypeId + '&Institution_Id=' + $scope.Institution_Id).success(function (data) {
                            //        $scope.AllergenListTemp = [];
                            //        $scope.AllergenListTemp = data;
                            //        var obj = { "Id": 0, "AllergenName": "Select", "IsActive": 1 };
                            //        $scope.AllergenListTemp.splice(0, 0, obj);
                            //        $scope.AllergenListfilter = angular.copy($scope.AllergenListTemp);
                            //        $scope.AllergenId = id;

                            //    })
                            //}

                            $scope.Allergt_pages = Math.ceil(($scope.AllergyCount) / ($scope.page_size));

                        })
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        /*  This is for Allergy searchquery*/
        $scope.filterAllergyMasterList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.AllergyMastersearchquery);
            if ($scope.AllergyMastersearchquery == "") {
                $scope.AllergyMasterList = angular.copy($scope.AllergyMasterListFilterData);
            }
            else {
                var val;
                $scope.AllergyMasterList = $ff($scope.AllergyMasterListFilterData, function (value) {
                    return angular.lowercase(value.AllergyTypeName).match(searchstring) ||
                        angular.lowercase(value.AllergenName).match(searchstring);
                });
                if ($scope.AllergyMasterList.length > 0) {
                    $scope.AllergyMasterflag = 1;
                }
                else {
                    $scope.AllergyMasterflag = 0;
                }
            }
        }

        // THIS IS FOR VIEW PROCEDURE 
        $scope.AllergyTypeDuplicateId = "0";
        $scope.AllergenDuplicateId = "0";
        $scope.ViewICD10 = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + 'api/MasterAllergy/MasterAllergyView/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.AllergyTypeId = data.AllergyTypeId.toString();
                $scope.AllergyTypeDuplicateId = $scope.AllergyTypeId;
                $scope.AllergenId = data.AllergenId.toString();
                $scope.AllergenDuplicateId = $scope.AllergenId;
                /* if ($scope.AllergyDropDown == 2) {
                     $scope.AllegenBasedType($scope.AllergyTypeId);
                 }*/
                $scope.ViewAllergyType = data.AllergyTypeName;
                $scope.AllergenName = data.AllergenName;
                $scope.ViewAllegenName = data.AllergenName;
            }).error(function (data) {
                //alert('Error Occurred');
                toastr.error("Error Occurred", "warning");

            });
        }

        // THIS IS OPENING POP WINDOW FORM LIST FOR ADD 
        $scope.AddMasterAllergyPopUP = function () {
            angular.element('#AllergyModal').modal('show');
            $("#btnsave").attr("disabled", false);
            $scope.ClearPopup();
        }
        // THIS IS CLEAR POPUP FUNCTION 
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.AllergyTypeId = "0";
            $scope.AllergenId = "0";
            $scope.AllergenName = "";
        }
        $scope.CancelPopUP = function () {
            angular.element('#AllergyViewModal').modal('hide');
            angular.element('#AllergyModal').modal('hide')
        }
        $scope.ViewAllergyPopUP = function (value) {
            $scope.ClearPopup();
            angular.element('#AllergyViewModal').modal('show');
            $scope.AllergyDropDown = 2;
            $scope.Id = value;
            $scope.ViewICD10();
        }
        $scope.EditAllergyPopUP = function (value) {
            angular.element('#AllergyModal').modal('show');
            $("#btnsave").attr("disabled", false);
            $scope.AllergyDropDown = 2;
            $scope.Id = value;
            $scope.ViewICD10();
        }
        /*THIS IS FOR DELETE FUNCTION */
        $scope.AllergyMaster_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Allergies details?");
            if (del == true) {
                $http.get(baseUrl + '/api/MasterAllergy/AllergyMaster_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert(" Allergy detail has been deactivated Successfully");
                    toastr.success(" Allergy detail has been deactivated Successfully", "success");
                    $scope.AllergyMasterList_Details();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Allergy details" + data;
                });
            }
        }

        $scope.DeleteAllergy = function (AId) {
            $scope.Id = AId;
            $scope.AllergyMaster_Delete();
        }

        /*'Active the Allergy*/
        $scope.AllergyActive = function (comId) {
            $scope.Id = comId;
            $scope.Allergy_Active();
        }

        /* Calling the api method to inactived the details of the Allergy for the  Allergy Id, and redirected to the list page.*/
        $scope.Allergy_Active = function () {
            var Ins = confirm("Do you like to activate the selected Allergy?");
            if (Ins == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/MasterAllergy/AllergyMaster_Active/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.AllergyMasterList_Details();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Allergies" + data;
                });
            };
        }


    }
]);

MyCortexControllers.controller("PatientAppointmentListController", ['$scope', '$sce', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', '$interval',
    function ($scope, $sce, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, $interval) {
        $scope.UpComingAppointmentDetails = [];
        $scope.PreviousAppointmentDetails = [];
        $scope.UpComingWaitingAppointmentDetails = [];
        $scope.UpComingAppointmentCount = 0;
        $scope.PreviousAppointmentCount = 0;
        $scope.UpComingWaitingAppointmentCount = 0;
        $scope.calcNewYear;
        intial_loading();
        function intial_loading() {
            patientAppointmentList();
            getPreviousAppointmentList();
            if ($scope.$parent.userTypeId == 5) {
                CG_PatientAppointment_List();
            }
        }
        function patientAppointmentList() {
            $http.get(baseUrl + '/api/User/PatientAppointmentList/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.UpComingAppointmentDetails = [];
                $scope.UpComingAppointmentDetails = data.PatientAppointmentList;
                compareAppointmentDates();
            });
        }
        function compareAppointmentDates() {
            $scope.calcNewYear = setInterval(checkdates(), 1000);
        }
        function checkdates() {
            var AppoinList = $scope.UpComingAppointmentDetails;
            for (i = 0; i < AppoinList.length; i++) {
                var startdate1 = moment(new Date($scope.UpComingAppointmentDetails[i].Appointment_FromTime));
                var enddate1 = moment(new Date());
                var diff1 = Math.abs(enddate1 - startdate1);
                //var days1 = Math.floor(diff1 / (60 * 60 * 24 * 1000));
                //var hours1 = Math.floor(diff1 / (60 * 60 * 1000)) - (days1 * 24);
                //var minutes1 = Math.floor(diff1 / (60 * 1000)) - ((days1 * 24 * 60) + (hours1 * 60));
                //var seconds1 = Math.floor(diff1 / 1000) - ((days1 * 24 * 60 * 60) + (hours1 * 60 * 60) + (minutes1 * 60));
                var CallRemain1 = Math.floor(diff1 / (60 * 1000));
                $scope.CallButton1 = CallRemain1;
                var date_future = new Date($scope.UpComingAppointmentDetails[i].Appointment_FromTime);
                var date_now = new Date();

                var seconds = Math.floor((date_future - (date_now)) / 1000);
                var minutes = Math.floor(seconds / 60);
                var hours = Math.floor(minutes / 60);
                var days = Math.floor(hours / 24);
                if (days <= 0 && hours <= 0 && minutes <= 0 && seconds <= 0) {

                }
                hours = hours - (days * 24);
                minutes = minutes - (days * 24 * 60) - (hours * 60);
                seconds = seconds - (days * 24 * 60 * 60) - (hours * 60 * 60) - (minutes * 60);
                var timeDiffString1 = "";
                if (days != 0) {
                    timeDiffString1 = timeDiffString1 + days + ' day ';
                }
                if (hours != 0) {
                    timeDiffString1 = timeDiffString1 + hours + ' hr ';
                }
                if (minutes != 0) {
                    timeDiffString1 = timeDiffString1 + minutes + ' min ';
                }
                if (seconds != 0) {
                    timeDiffString1 = timeDiffString1 + seconds + ' sec';
                }
                AppoinList[i].TimeDifference = timeDiffString1;
                AppoinList[i]['RemainingTimeInMinutes'] = CallRemain1;
            }
            if ($scope.UpComingAppointmentDetails != null) {
                $scope.UpComingAppointmentCount = $scope.UpComingAppointmentDetails.length;
            }
            $scope.UpComingAppointmentDetails = AppoinList;
            //$scope.$apply();
        }
        function CG_PatientAppointment_List() {
            $http.get(baseUrl + '/api/User/CG_PatientAppointmentList/?Institution_Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId + '&UserId=' + $window.localStorage['UserId']).success(function (data) {
                $scope.UpComingWaitingAppointmentDetails = data.PatientAppointmentList;
                if ($scope.UpComingWaitingAppointmentDetails != null) {
                    $scope.UpComingWaitingAppointmentCount = $scope.UpComingWaitingAppointmentDetails.length;
                }
            });
        }
        function getPreviousAppointmentList() {
            $http.get(baseUrl + '/api/User/PatientPreviousAppointmentList/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.PreviousAppointmentDetails = data.PatientAppointmentList;
                $scope.PreviousAppointmentCount = $scope.PreviousAppointmentDetails.length;
            });
        }
        $scope.$on("appointment_list", intial_loading);
    }
]);

MyCortexControllers.controller("UserHealthDataDetailsController", ['$scope', '$sce', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', '$interval', 'toastr',
    function ($scope, $sce, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, $interval, toastr) {
        if (chatService.checkCall($routeParams.Id)) {
            //alert('You cannot switch patient during call.')
            toastr.info("You cannot switch patient during call.", "info");
            $window.history.back();
            return false;
        }
        $scope.NewAppointmentDuration = 0;
        $scope.FollowUpDuration = 0;
        $scope.SearchMsg = "No Data Available";
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.LiveDataCurrentTime = "";
        $scope.PatientLiveDataList = [];
        $scope.PatientType = 1;
        $scope.LiveTabClick = function () {
            $('.chartTabs').addClass('charTabsNone');
            $("#chatLoaderPV").show();
            var ConfigCode = "LIVEDATA_STARTFROM";
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.date_size = data1[0].ConfigValue;
                var tempp = new Date(new Date().setDate(new Date().getDate() - ($scope.date_size - 1)));
                $scope.tempdate = $filter('date')(tempp, "dd-MMM-yyyy");
            });
            $scope.LiveDataPromise = $interval(function () {
                $http.get(baseUrl + '/api/User/PatientLiveData_List/?Patient_Id=' + $scope.SelectedPatientId + '&DataTime=' + $scope.tempdate + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.PatientLiveDataList = angular.copy(data.PatientHealthDataList);
                })
                $("#chatLoaderPV").hide();
            }, 10000) // 10000 ms execution

        }
        $scope.CancelLiveData = function () {
            if (angular.isDefined($scope.LiveDataPromise)) {
                $interval.cancel($scope.LiveDataPromise);
            }
        }
        $scope.LiveData_IsImage = function (FileName) {
            var file = FileName;
            var fileType = file.substr((file.lastIndexOf('.') + 1));
            var validImageTypes = ["gif", "jpeg", "png", "jpg", "ico", "gif"];
            if ($.inArray(fileType, validImageTypes) >= 0) {
                return true;
            }
            else { return false; }
        }
        $scope.AppointmoduleID = 1;
        $scope.AppointmoduleID1 = 1;
        $scope.Tick = false;
        //$scope.UpComingAppointmentDetails = [];
        //$scope.UpComingWaitingAppointmentDetails = [];
        $scope.userTypeId = $window.localStorage['UserTypeId'];
        //$scope.PreviousAppointmentDetails = [];
        $scope.flag = 0;
        $scope.MNR_No = "";
        $scope.Type_Id = 0;
        $scope.LSType_Id = 0;
        $scope.VitalsType_Id = 0;
        $scope.VitalChart = '1';
        $scope.PatientHealthDataTableList = [];
        // $scope.Mode = $routeParams.Id;
        $scope.AppointmentFromTime = new Date();
        $scope.AppointmentToTime = new Date();
        $scope.Doctor_Id = "";
        //List Page Pagination.
        $scope.current_page = 1;
        $scope.current_pageNote = 1;
        $scope.current_pageICD = 1;
        $scope.current_pagePillBox = 1;
        $scope.current_PatientAllergyPages = 1;
        $scope.current_others = 1;
        $scope.patientvitals_pages = 1;
        $scope.PatientNotes_pages = 1;
        $scope.PatientPillBoxPages = 1;
        $scope.PatientIcdPages = 1;
        $scope.PatientAllergyPages = 1;
        $scope.Patientothers = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.allergyActive = true;
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
            $scope.current_pageNote = p;
            $scope.current_pagePillBox = p;
            $scope.current_PatientAllergyPages = p;
            $scope.current_others = p;
        }

        $scope.showMainBox = true;
        // $scope.ParamGroup_Id=2;    
        $scope.GroupParameterNameList = [];
        $scope.VitalsParameterList_Data = [];
        $scope.ParameterMappingList = [];
        $scope.LabParameterList_Data = [];
        $scope.ParameterId = "0";
        $scope.BookNewSettings = false;
        $scope.getParameterList = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/User/GroupParameterNameList/?Patient_Id=' + $scope.SelectedPatientId + '&UnitGroupType_Id=' + $scope.unitgrouptype).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.Tick = true;
                $scope.GroupParameterNameList = data;

            });
        }

        $scope.getParameterMappingList = function (row) {
            $scope.ParameterId = row.ParameterId;
            $scope.UnitGroupType = row.UnitGroupType;
            $http.get(baseUrl + '/api/ParameterSettings/ParameterMappingList/?Parameter_Id=' + $scope.ParameterId + '&Institution_Id=' + $window.localStorage['InstitutionId'] + '&Unitgroup_Type=' + $scope.UnitGroupType).success(function (data) {
                $scope.ParameterMappingList = data;
            });
        }

        // editable time value from app settings
        $scope.PATIENTDATA_EDITTIME = 0;
        $scope.ConfigCode = "PATIENTDATA_EDITTIME";
        $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data) {
            if (data[0] != undefined) {
                $scope.PATIENTDATA_EDITTIME = parseInt(data[0].ConfigValue);
            }
        });
        // is editale check based on allowed editable time configuration
        $scope.IsEditableCheck = function (itemDate) {
            var diffminutes = moment().diff(moment(itemDate), 'minutes');
            if ($scope.PATIENTDATA_EDITTIME < diffminutes) {
                return false;
            }
            else {
                return true;
            }
        }

        $scope.PageParameter = $routeParams.PageParameter;
        if ($routeParams.PageParameter == "1") {
            $scope.SelectedPatientId = $window.localStorage['UserId'];
        }
        else {
            $scope.SelectedPatientId = $routeParams.Id;
        }
        $window.localStorage['SelectedPatientId'] = $scope.SelectedPatientId;

        $scope.PatientToTrans_CancelPopup = function () {
            //For Today Appointment Page
            $location.path("/TodaysAppoint_ments/");
        }

        $scope.CGAddPatientPopup = function () {
            $location.path("/Carecoordinatorpatient/1");
        }

        $scope.AddPatientPopup = function () {
            $location.path("/Carecoordinatorpatient/2");
        }

        $scope.AddPatientHomePopup = function () {
            $location.path("/Carecoordinatorpatient/4");
        }


        $scope.searchDoctor = function () {
            angular.element('#searchDoctor').modal('show');
        }
        $scope.ParameterSettingslist = [];
        /*ARRAY LIST FOR THE CHILD TABLE CUSTOMER DETAILS */
        $scope.ParameterSettingslist = [{
            'Id': 0,
            'Protocol_Id': 0,
            'ProtocolName': '',
            'Institution_Id': 0,
            'Institution_Name': '',
            'Parameter_Id': 0,
            'ParameterName': '',
            'Units_Id': 0,
            'UnitsName': '',
            'Com_DurationType': 0,
            'DurationName': '',
            'Diag_HighMax_One': '',
            'Diag_HighMin_One': '',
            'Diag_MediumMax_One': '',
            'Diag_MediumMin_One': '',
            'Diag_LowMax_One': '',
            'Diag_LowMin_One': '',
            'Diag_HighMax_Two': '',
            'Diag_HighMin_Two': '',
            'Diag_MediumMax_Two': '',
            'Diag_MediumMin_Two': '',
            'Diag_LowMax_Two': '',
            'Diag_LowMin_Two': '',
            'Comp_Duration': '',
            'Comp_High': '',
            'Comp_Medium': '',
            'Comp_Low': '',
            'Isactive': 1,
            'Created_By': '',
            'NormalRange_High': '',
            'NormalRange_Low': ''
        }];

        $scope.ViewParamList = [];
        $scope.ViewParamList1 = [];
        $scope.ParameterSettingslist1 = [];
        $http.get(baseUrl + 'api/ParameterSettings/ViewEditProtocolParameters/?Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            $scope.ViewParamList = data;
        });
        $scope.ParameterSettings_ViewEdit = function () {

            angular.forEach($scope.ParameterSettingslist, function (masterVal, masterInd) {
                $scope.ViewParamList1 = $ff($scope.ViewParamList, { Parameter_ID: masterVal.Parameter_Id }, true);

                if ($scope.ViewParamList1.length > 0) {
                    angular.forEach($scope.ViewParamList1, function (masterVal1, masterInd1) {

                        masterVal.NormalRange_High = masterVal1.NormalRange_High;
                        masterVal.NormalRange_Low = masterVal1.NormalRange_low;
                    })
                }

                else {
                    masterVal.NormalRange_High = "";
                    masterVal.NormalRange_Low = "";

                };

            });
        };


        $scope.ProtocolDetails_View = function () {
            if ($scope.assignedProtocolId == "" || typeof ($scope.assignedProtocolId) == undefined) {
                //alert("Monitoring Protocol is not assigned");
                toastr.warning("Monitoring Protocol is not assigned", "warning");
            }
            else {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/User/ProtocolMonitoringProtocolView/?Id=' + $scope.assignedProtocolId).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.PROTOCOLNAME = data.Protocol_Name;
                    $scope.ParameterSettingslist = data.ChildModuleList;

                    if ($scope.ParameterSettingslist.length > 0) {
                        angular.element('#MonitoringProtocolCreateModal').modal('show');
                    }
                    else {
                        //alert("Monitoring protocol is not assigned");
                        toastr.warning("Monitoring protocol is not assigned", "warning");
                    }
                });
            }
        }
        /*Open the monitoring protocol */
        $scope.openProtocol = function () {

            $scope.ProtocolDetails_View();
        }
        /*Cancel the monitoring protocol */
        $scope.CancelProtocol = function () {
            angular.element('#MonitoringProtocolCreateModal').modal('hide');
        }

        $scope.PatientAppointmentpopup = function () {
            angular.element('#PatientAppointmentCreateModal').modal('show');
        }

        $scope.CancelPatientAppointment = function () {
            angular.element('#PatientAppointmentCreateModal').modal('show');
        }

        $scope.PatientDetailsView = function () {
            if ($scope.PageParameter == 1) {
                //Patient data page to Patient View profile
                $location.path("/PatientView/" + $scope.Id + "/1/3");
            }
            else if ($scope.PageParameter == 2) {
                //Doctor Pages -> Patient Data pages -> Patient View page
                $location.path("/PatientView/" + $scope.Id + "/3/3");
            }
            else if ($scope.PageParameter == 3) {
                $location.path("/PatientView/" + $scope.Id + "/4/3");
            }
            else if ($scope.PageParameter == 4) {
                //Doctor Pages -> All Patients -> Patient View page
                $location.path("/PatientView/" + $scope.Id + "/5/3");
            }
            else if ($scope.PageParameter == 5) {
                //Care Coordinator ->Diagostic Alert -> Patient View page
                $location.path("/PatientView/" + $scope.Id + "/6/3");
            }
            else if ($scope.PageParameter == 6) {
                //Care Coordinator ->Compliance Alert -> Patient View page
                $location.path("/PatientView/" + $scope.Id + "/7/3");
            }
            else if ($scope.PageParameter == 7) {
                //Care Giver ->Assigned Patient -> Patient View page
                $location.path("/PatientView/" + $scope.Id + "/8/3");
            }
        }

        $scope.EditPatientDetails = function () {
            $location.path("/PatientEdit/" + $scope.Id + "/1/3");
        }

        $scope.PatientGroupList = function () {
            $scope.PatientGroupNameList();
            angular.element('#PatientGroupListModal').modal('show');
        }
        $scope.PatientGroupflag = 0;
        $scope.GroupName_List = [];
        /*This function is for List the Group Name based on UserId*/
        $scope.PatientGroupNameList = function () {
            $http.get(baseUrl + '/api/User/PatientGroupNameList/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                $scope.GroupName_List = data;
                $scope.SearchMsg = "No Data Available";

            })
        };

        $scope.PatientAllergiesList = function (row) {
            $scope.data = row;
            if ($scope.data.length == 0) {
                angular.element('#PatientAllergyListModal').modal('hide');
            }
            else {
                $scope.PatientAllergiesNameList();
                angular.element('#PatientAllergyListModal').modal('show');
            }
        }

        //$scope.PatientAllergiesNameList = function () {
        //    $scope.PatientId = $window.localStorage['UserId'];
        //    $http.get(baseUrl + '/api/User/PatientAllergiesNameList/?PatientId=' + $scope.PatientId).success(function (data) {
        //        $scope.AllergiesName_List = data;
        //    })
        //};

        $scope.CancelPatientGroupNamePopup = function () {
            angular.element('#PatientGroupListModal').modal('hide');

        };
        $scope.CancelPatientMonitoringProtocolModal = function () {
            angular.element('#PatientMonitoringProtocolModal').modal('hide');
        }
        $scope.CancelPatientAllergyNamePopup = function () {
            angular.element('#PatientAllergyListModal').modal('hide');
        }

        $scope.PatientEditProfileCancel = function () {
            $location.path("/Carecoordinatorpatient/Id");
        }
        $scope.MonitoringProtocolId = "";
        $scope.Monitoring_ProtocolId = "";
        $scope.assignedProtocolId = "";
        $scope.MonitoringProtocolName = [];

        var photoview = false;
        var photoview1 = false;
        var photoview2 = false;
        $scope.uploadview = false;
        $scope.unitgrouptype = 1;
        $scope.UnitGroupTypeList = [];
        $scope.MyAppoinmentdata = [];
        $scope.MyAppointment = [];

        $scope.getUnitGroupType_List = function () {
            $http.get(baseUrl + '/api/Common/getUnitGroupType/').success(function (data) {
                $scope.UnitGroupTypeList = data;
            });

        }
        $scope.appdocfile = ''
        $scope.appdocfilename = ''
        $scope.fileexceed = ""
        $scope.filetype = ''
        $scope.files = [];
        $scope.appdocfileChange = function (e, index) {
            let maxSize = (5 * 1024) * 1024;
            let fileSize = e.files[0].size;
            if (fileSize >= maxSize) {
                $scope.fileexceed = "File size exceeds 5 MB";
            }
            else {
                $scope.appdocfilename = e.files[0]['name'];
                $scope.filetype = e.files[0].type;
                $scope.files.push(e.files[0])
            }

        }

        $scope.UnitGroupPreference = function () {
            //$http.get(baseUrl + '/api/ParameterSettings/UnitGroupPreferenceGet/?institutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
            //    $scope.unitgrouptype = data.PreferenceType;
            //})

        }

        $scope.MyAppointments = function () {
            $("#chatLoaderPV").show();
            $scope.ChronicDetails();
            $http.get(baseUrl + '/api/User/DoctorAppoinmentsList/?PatientId=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.getMyAppointments();
                //var Patient = parseInt(window.localStorage['SelectedPatientId']);
                $scope.MyAppoinmentdata = data;
                //angular.forEach($scope.MyAppoinmentdata, function (value, index) {
                //    if (Patient === value.Patient_Id) {
                //        $scope.MyAppointment.push(value);
                //    }
                //});
            });
        }

        $scope.DefaultChronic = function () {
            var Brain = document.getElementById('Brain');
            Brain.innerHTML = '<img src="images/image004.png">';

            var detail = document.getElementById('Alzheimer');
            detail.innerHTML = "";
            var detail = document.getElementById('Arthritis');
            detail.innerHTML = "";
            var detail = document.getElementById('Epilepsy');
            detail.innerHTML = "";
            var detail = document.getElementById('Parkinson_Disease');
            detail.innerHTML = "";
            var detail = document.getElementById('Sclerosis');
            detail.innerHTML = "";
            var detail = document.getElementById('Stroke');
            detail.innerHTML = "";

            var Lungs = document.getElementById('Lungs');
            Lungs.innerHTML = '<img src="images/image006.png">';

            var detail = document.getElementById('Pulmonary_Disease');
            detail.innerHTML = "";
            var detail = document.getElementById('Lung_Disease');
            detail.innerHTML = "";
            var detail = document.getElementById('Asthma');
            detail.innerHTML = "";
            var detail = document.getElementById('Cancer');
            detail.innerHTML = "";
            var detail = document.getElementById('Diabetes');
            detail.innerHTML = "";

            var Heart = document.getElementById('Heart');
            Heart.innerHTML = '<img src="images/image009.png">';
            var detail = document.getElementById('Heart_Disease');
            detail.innerHTML = "";
            var detail = document.getElementById('Hypertension');
            detail.innerHTML = "";
            var detail = document.getElementById('Kidney_Disease');
            detail.innerHTML = "";
        }

        $scope.ChronicDetails = function () {
            $http.get(baseUrl + '/api/User/Chronic_Conditions/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                if (data.length !== 0 && data != null && data != undefined) {
                    $scope.DefaultChronic();
                    for (let i = 0; i < data.length; i++) {
                        if (data[i].ChronicGroup == 1) {
                            var Brain = document.getElementById('Brain');
                            Brain.innerHTML = '<img src="images/image004Active.png">';

                            if (data[i].ChronicCondition === "Alzheimer") {
                                var detail = document.getElementById('Alzheimer');
                                detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Alzheimer</label>";
                            }
                            else if (data[i].ChronicCondition === "Arthritis") {
                                var Arthritis = document.getElementById('Bone');
                                Arthritis.innerHTML = '<img src="images/image005Active.png">';

                                var detail = document.getElementById('Arthritis');
                                detail.innerHTML = "<img src='images/image005Active.png' /> <label class='LetFont1'>Arthritis</label>";
                            }
                            else if (data[i].ChronicCondition === "Epilepsy") {
                                var detail = document.getElementById('Epilepsy');
                                detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Epilepsy</label>";
                            }
                            else if (data[i].ChronicCondition === "Parkinson Disease") {
                                var detail = document.getElementById('Parkinson_Disease');
                                detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Parkinson Disease</label>";
                            }
                            else if (data[i].ChronicCondition === "Sclerosis") {
                                var detail = document.getElementById('Sclerosis');
                                detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Sclerosis</label>";
                            }
                            else if (data[i].ChronicCondition === "Stroke") {
                                var detail = document.getElementById('Stroke');
                                detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Stroke</label>";
                            }
                        }

                        if (data[i].ChronicGroup == 2) {
                            if (data[i].ChronicCondition === "Pulmonary Disease") {
                                var Lungs = document.getElementById('Lungs');
                                Lungs.innerHTML = '<img src="images/image006Active.png">';

                                var detail = document.getElementById('Pulmonary_Disease');
                                detail.innerHTML = "<img src='images/image006Active.png' /> <label class='LetFont1'>Pulmonary Disease</label>";
                            }
                            else if (data[i].ChronicCondition === "Lung Disease") {
                                var Lungs = document.getElementById('Lungs');
                                Lungs.innerHTML = '<img src="images/image006Active.png">';

                                var detail = document.getElementById('Lung_Disease');
                                detail.innerHTML = "<img src='images/image006Active.png' /> <label class='LetFont1'>Lung Disease</label>";
                            }
                            else if (data[i].ChronicCondition === "Asthma") {
                                var Lungs = document.getElementById('Lungs');
                                Lungs.innerHTML = '<img src="images/image006Active.png">';

                                var detail = document.getElementById('Asthma');
                                detail.innerHTML = "<img src='images/image006Active.png' /> <label class='LetFont1'>Asthma</label>";
                            }
                            else if (data[i].ChronicCondition === "Cancer") {
                                var Cancer = document.getElementById('Ribbon');
                                Cancer.innerHTML = '<img src="images/image007Active.png">';

                                var detail = document.getElementById('Cancer');
                                detail.innerHTML = "<img src='images/image007Active.png' /> <label class='LetFont1'>Cancer</label>";
                            }
                            else if (data[i].ChronicCondition === "Diabetes") {
                                var Diabetes = document.getElementById('Diabetes');
                                Diabetes.innerHTML = '<img src="images/image008Active.png">';

                                var detail = document.getElementById('sugarblood');
                                detail.innerHTML = "<img src='images/image008Active.png' /> <label class='LetFont1'>Diabetes</label>";
                            }
                        }

                        if (data[i].ChronicGroup == 3) {
                            var Heart = document.getElementById('Heart');
                            Heart.innerHTML = '<img src="images/image009Active.png">';

                            if (data[i].ChronicCondition === "Heart Disease") {
                                var detail = document.getElementById('Heart_Disease');
                                detail.innerHTML = "<img src='images/image009Active.png' /> <label class='LetFont1'>Heart Disease</label>";
                            }
                            else if (data[i].ChronicCondition === "Hypertension") {
                                var detail = document.getElementById('Hypertension');
                                detail.innerHTML = "<img src='images/image009Active.png' /> <label class='LetFont1'>Hypertension</label>";
                            }
                            else if (data[i].ChronicCondition === "Kidney Disease") {
                                var Diabetes = document.getElementById('Kidney');
                                Diabetes.innerHTML = '<img src="images/image0010Active.png">';

                                var detail = document.getElementById('Kidney_Disease');
                                detail.innerHTML = "<img src='images/image0010Active.png' /> <label class='LetFont1'>Kidney Disease</label>";
                            }
                        }
                    }
                }
            });
        }
        $http.get(baseUrl + '/api/SendEmail/User_get_NotificationList/?User_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {

            var NotificationCount = document.getElementById('notificationCount');
            NotificationCount.textContent = data.NotificationUnread;
        });
        $scope.PatientBasicDetails_List = function () {
            if ($window.localStorage['UserTypeId'] == 2 || $window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 5 || $window.localStorage['UserTypeId'] == 6 || $window.localStorage['UserTypeId'] == 7) {
                $("#chatLoaderPV").show();
                photoview = true;
                //$scope.UpComingAppointmentCount = 0;
                //$scope.PreviousAppointmentCount = 0;
                var methodcnt = 2;
                $http.get(baseUrl + '/api/User/UserDetails_GetPhoto/?Id=' + $scope.SelectedPatientId).success(function (data) {
                    methodcnt = methodcnt - 1;
                    if (methodcnt == 0)
                        $scope.uploadview = true;
                    if (data.PhotoBlob != null) {
                        $scope.uploadme = 'data:image/png;base64,' + data.PhotoBlob;
                    }
                    else {
                        $scope.uploadme = null;
                    }
                })
                $http.get(baseUrl + '/api/User/PatientBasicDetailsList/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.Id = data.PatientId;
                    $scope.FullName = data.FullName;
                    $scope.MobileNo = data.MOBILE_NO;
                    $scope.Photo = data.Photo;
                    $scope.FileName = data.FileName;
                    $scope.DOB = $filter('date')(data.DOB, "dd-MMM-yyyy");
                    $scope.MNR_No = data.MNR_NO;
                    $scope.NationalId = data.NATIONALID;
                    $scope.GenderId = data.GenderId;
                    $scope.ViewGenderName = data.GENDER_NAME;
                    $scope.PatientType = data.Patient_Type;
                    $scope.showUserType = data.UserType;
                    $scope.PhotoBlobs = data.PhotoBlobs;
                    methodcnt = methodcnt - 1;
                    $('#User_id').show();
                    $('#patient_profile').show();
                    $('#BrainGroup').show();
                    $('#KnownGroup').show();
                    var imgSrc = document.getElementById('imgSrc');
                    imgSrc.src = $scope.PhotoBlobs;
                    var NATIONALITY_ID = document.getElementById('NATIONALITY_ID');
                    NATIONALITY_ID.textContent = $scope.NationalId;

                    var USERTYPE_ID = document.getElementById('USERTYPE_ID');
                    USERTYPE_ID.textContent = $scope.showUserType;
                    var MOBILE_NO = document.getElementById('MOBILE_NO');
                    MOBILE_NO.textContent = $scope.MobileNo;

                    var DOB = document.getElementById('DOB');
                    $scope.DOB = moment($scope.DOB).format('DD-MMM-YYYY')
                    DOB.textContent = $scope.DOB;

                    var fullname = document.getElementById('fullname');
                    fullname.textContent = $scope.FullName;

                    var Gender = document.getElementById('Gender');
                    Gender.textContent = $scope.ViewGenderName;

                    var dob = $scope.DOB;
                    var gt = DateFormat(dob);
                    dob = gt.replace(/-/gi, '');
                    var year = dob.substr(4, 9);
                    var month = dob.substr(2, 2);
                    var day = dob.substr(0, 2);
                    var today = new Date();
                    var age = today.getFullYear() - year;

                    Age = document.getElementById('Age');
                    Age.textContent = age.toString();
                    if (methodcnt == 0)
                        $scope.uploadview = true;
                    if ($scope.PatientType == 2) {
                        $('#divPatientType').attr('style', 'display : none');
                    }
                    else
                        $('#divPatientType').attr('style', 'display : none');
                    if (data.Protocol_Id != null) {
                        $scope.MonitoringProtocolId = data.Protocol_Id.toString();
                        $scope.ViewProtocolName = data.ProtocolName;
                        $scope.MonitoringProtocolName = data.ProtocolName;
                        $scope.assignedProtocolId = $scope.MonitoringProtocolId;
                        $scope.Monitoring_ProtocolId = $scope.MonitoringProtocolId;
                    }
                    if ($scope.UserTypeId != 2) {
                        $scope.chattingWith = data.FullName;
                    }
                    //patientAppointmentList();
                    //function patientAppointmentList() {
                    //    $http.get(baseUrl + '/api/User/PatientAppointmentList/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    //        $scope.UpComingAppointmentDetails = [];
                    //        $scope.UpComingAppointmentDetails = data.PatientAppointmentList;
                    //        compareAppointmentDates();
                    //    });
                    //}
                    //$scope.calcNewYear;
                    //function compareAppointmentDates() {
                    //    $scope.calcNewYear = setInterval(checkdates(), 1000);
                    //}
                    //function checkdates() {
                    //    var AppoinList = $scope.UpComingAppointmentDetails;
                    //    for (i = 0; i < AppoinList.length; i++) {
                    //        var startdate1 = moment(new Date($scope.UpComingAppointmentDetails[i].Appointment_FromTime));
                    //        var enddate1 = moment(new Date());
                    //        var diff1 = Math.abs(enddate1 - startdate1);
                    //        //var days1 = Math.floor(diff1 / (60 * 60 * 24 * 1000));
                    //        //var hours1 = Math.floor(diff1 / (60 * 60 * 1000)) - (days1 * 24);
                    //        //var minutes1 = Math.floor(diff1 / (60 * 1000)) - ((days1 * 24 * 60) + (hours1 * 60));
                    //        //var seconds1 = Math.floor(diff1 / 1000) - ((days1 * 24 * 60 * 60) + (hours1 * 60 * 60) + (minutes1 * 60));
                    //        var CallRemain1 = Math.floor(diff1 / (60 * 1000));
                    //        $scope.CallButton1 = CallRemain1;
                    //        var date_future = new Date($scope.UpComingAppointmentDetails[i].Appointment_FromTime);
                    //        var date_now = new Date();

                    //        var seconds = Math.floor((date_future - (date_now)) / 1000);
                    //        var minutes = Math.floor(seconds / 60);
                    //        var hours = Math.floor(minutes / 60);
                    //        var days = Math.floor(hours / 24);
                    //        if (days <= 0 && hours <= 0 && minutes <= 0 && seconds <= 0) {

                    //        }
                    //        hours = hours - (days * 24);
                    //        minutes = minutes - (days * 24 * 60) - (hours * 60);
                    //        seconds = seconds - (days * 24 * 60 * 60) - (hours * 60 * 60) - (minutes * 60);
                    //        var timeDiffString1 = "";
                    //        if (days != 0) {
                    //            timeDiffString1 = timeDiffString1 + days + ' day ';
                    //        }
                    //        if (hours != 0) {
                    //            timeDiffString1 = timeDiffString1 + hours + ' hr ';
                    //        }
                    //        if (minutes != 0) {
                    //            timeDiffString1 = timeDiffString1 + minutes + ' min ';
                    //        }
                    //        if (seconds != 0) {
                    //            timeDiffString1 = timeDiffString1 + seconds + ' sec';
                    //        }
                    //        AppoinList[i].TimeDifference = timeDiffString1;
                    //        AppoinList[i]['RemainingTimeInMinutes'] = CallRemain1;
                    //    }
                    //    if ($scope.UpComingAppointmentDetails != null) {
                    //        $scope.UpComingAppointmentCount = $scope.UpComingAppointmentDetails.length;
                    //    }
                    //    $scope.UpComingAppointmentDetails = AppoinList;
                    //    $scope.$apply();
                    //}
                    //if ($scope.userTypeId == 5) {
                    //    CG_PatientAppointment_List();
                    //}
                    //function CG_PatientAppointment_List() {
                    //    $http.get(baseUrl + '/api/User/CG_PatientAppointmentList/?Institution_Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    //        $scope.UpComingWaitingAppointmentDetails = data.PatientAppointmentList;
                    //        if ($scope.UpComingWaitingAppointmentDetails != null) {
                    //            $scope.UpComingWaitingAppointmentCount = $scope.UpComingWaitingAppointmentDetails.length;
                    //        }
                    //    });
                    //}
                    //$http.get(baseUrl + '/api/User/PatientPreviousAppointmentList/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    //    $scope.PreviousAppointmentDetails = data.PatientAppointmentList;
                    //    $scope.PreviousAppointmentCount = $scope.PreviousAppointmentDetails.length;
                    //});
                    $http.get(baseUrl + '/api/User/DepartmentList/').success(function (data) {
                        $scope.DepartmentList = data;
                    });
                    $http.get(baseUrl + '/api/DoctorShift/TimeZoneList/?Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                        $scope.TimeZoneList = data;
                    });
                    $scope.bookcc = 0;
                    $scope.bookCg = 0;
                    $scope.bookCl = 0;
                    $scope.bookSc = 0;
                    $scope.bookpa = 0;
                    var current_date = new Date().getFullYear() + '-' + (((new Date().getMonth() + 1).toString().length > 1) ? ((new Date().getMonth() + 1).toString()) : '0' + (new Date().getMonth() + 1).toString()) + '-' + (((new Date().getDate()).toString().length > 1) ? ((new Date().getDate()).toString()) : '0' + (new Date().getDate()).toString());
                    angular.element(document.getElementById('datee')).attr('min', current_date);
                    $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingView/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $window.localStorage['Login_Session_Id']).success(function (data) {
                        if (data != null) {
                            if (data.IsCc) { $scope.bookcc = 6; }
                            if (data.IsCg) { $scope.bookCg = 5; }
                            if (data.IsCl) { $scope.bookCl = 4; }
                            if (data.IsSc) { $scope.bookSc = 7; }
                            if (data.IsPatient) { $scope.bookpa = 2; }
                            $scope.NewAppointmentDuration = data.NewAppointmentDuration;
                            $scope.FollowUpDuration = data.FollowUpDuration;
                            if (data.MaxScheduleDays) {
                                var futu_date = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate() + data.MaxScheduleDays);
                                var futureDate = futu_date.getFullYear() + '-' + (((futu_date.getMonth() + 1).toString().length > 1) ? ((futu_date.getMonth() + 1).toString()) : '0' + (futu_date.getMonth() + 1).toString()) + '-' + (((futu_date.getDate()).toString().length > 1) ? ((futu_date.getDate()).toString()) : '0' + (futu_date.getDate()).toString());
                                angular.element(document.getElementById('datee')).attr('max', futureDate);
                            }
                            $scope.UserTypeId = $window.localStorage['UserTypeId'];
                            if ($scope.bookcc == $scope.UserTypeId || $scope.bookCg == $scope.UserTypeId || $scope.bookCl == $scope.UserTypeId || $scope.bookSc == $scope.UserTypeId || $scope.bookpa == $scope.UserTypeId) {
                                document.getElementById("BookNew").disabled = false;
                                $scope.BookNewSettings = true;
                            } else {
                                document.getElementById("BookNew").disabled = true;
                                $scope.BookNewSettings = false;
                            }
                        }
                        if (data == null) {
                            //alert('Please Check OrgSettings, Appointment User Is Empty!');
                            toastr.info("Please Check OrgSettings, Appointment User Is Empty!", "info");
                            return false;
                        }
                    });
                    $scope.SearchAvailibleDoctorsList = function () {
                        $scope.DoctorListWithTimeZone = [];
                        document.getElementById("show").disabled = true;
                        if ($scope.SelectedSpeciality == undefined || $scope.SelectedSpeciality == null || $scope.SelectedSpeciality == "") {
                            //alert('Please select Speciality')
                            toastr.warning("Please select Speciality", "warning");
                        } else if ($scope.AppoimDate == undefined || $scope.AppoimDate == null || $scope.AppoimDate == "") {
                            //alert('Please select Date')
                            toastr.warning("Please select Date", "warning");
                        }/* else if ($scope.TimeZoneID == undefined || $scope.TimeZoneID == null || $scope.TimeZoneID == "") {
                    alert('Please select TimeZone')
                }*/ else {
                            $("#appoint_waveLoader").show();
                            var DeptID = $scope.DeptIDAsSTR;
                            var AppDate = $scope.AppoimDate;
                            var res = convert(AppDate);
                            $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                            $http.get(baseUrl + '/api/PatientAppointments/DepartmentwiseDoctorList/?DepartmentIds=' + DeptID + '&InstitutionId=' + $scope.SelectedInstitutionId + '&Date=' + res + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                                $("#appoint_waveLoader").hide();
                                $scope.DoctorListWithTimeZone = data;
                            }).error(function (data) { $("#appoint_waveLoader").hide(); });
                        }

                    }
                    $scope.DeptIDStr = function () {
                        $scope.DeptIDAsSTR = [];
                        angular.forEach($scope.SelectedSpeciality, function (value, key) {
                            var obj = value.toString();
                            $scope.DeptIDAsSTR.push(obj);
                        });
                    }
                    $scope.ViewDoctorBio = function (Doctor_Id) {
                        angular.element('#DoctorBioModal').modal('show');
                        $scope.DoctorID = Doctor_Id;
                        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                        $http.get(baseUrl + '/api/User/UserDetails_View?Id=' + $scope.DoctorID + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                            $scope.DoctorDetailList = data;
                        })
                    }
                    $scope.DoctorDetailList = [];
                    $scope.idSelectedVote = null;
                    $scope.GetDoctorDetails = function (list) {
                        $("#chatLoaderPV").show();
                        $scope.DoctorID = [];
                        document.getElementById("DocDetails").hidden = false;
                        document.getElementById("show").disabled = false;
                        $scope.idSelectedVote = list;
                        $scope.DoctorID = list.Doctor_Id;
                        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                        $http.get(baseUrl + '/api/User/UserDetails_View?Id=' + $scope.DoctorID + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                            $scope.DoctorDetailList = data;
                            $("#chatLoaderPV").hide();
                            $scope.AppointmoduleID = data.Appointment_Module_Id;
                            $scope.AppointmoduleID1 = data.Appointment_Module_Id;
                            $scope.paymentdepartmentId = data.DEPARTMENT_ID;
                            $scope.paymentInstitutionId = data.INSTITUTION_ID;
                            $scope.TimeZoneID = data.TimeZone_Id.toString();
                            if (data.Appointment_Module_Id == 2) {
                                setTimeout(function () { document.getElementById('Radio1').click(); }, 5000);
                            }
                            else if (data.Appointment_Module_Id == 3) {
                                setTimeout(function () { document.getElementById('Radio2').click(); }, 5000);
                            }
                        })
                    }
                    function convert(str) {
                        var date = new Date(str),
                            mnth = ("0" + (date.getMonth() + 1)).slice(-2),
                            day = ("0" + date.getDate()).slice(-2);
                        return [date.getFullYear(), mnth, day].join("-");
                    }
                    $scope.newAppoinmentDates = function () {
                        if ($scope.DoctorID == undefined || $scope.DoctorID.length == 0 || $scope.DoctorID == null) {
                            //alert('Please select Doctor')
                            toastr.warning("Please select Doctor", "warning");
                        } else {
                            //alert(Intl.DateTimeFormat().resolvedOptions().timeZone);
                            //var timezone = new Date().toLocaleDateString(undefined, { day: '2-digit', timeZoneName: 'long' }).substring(4);
                            //for (i = 0; i <= $scope.TimeZoneList.length - 1; i++) {
                            //    if ($scope.TimeZoneList[i].TimeZoneName == timezone) {
                            //        $scope.TimeZoneID = $scope.TimeZoneList[i].TimeZoneId.toString();
                            //    }
                            //}
                            $scope.newScheduledDates = [];
                            $scope.DataNotAvailible = 0;
                            $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                            //document.getElementById("main-box").style = "display:none";
                            //document.getElementById("box").style = "";
                            $scope.showMainBox = false;
                            TimeSlot();
                            $http.get(baseUrl + '/api/PatientAppointments/GetScheduledDates/?&Login_Session_Id=' + $scope.LoginSessionId + '&InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                                $scope.newScheduledDates = data;
                                var dattas = data.ScheduledDaysList;
                                var AppDate = $scope.AppoimDate;
                                var ApppDate = AppDate.getTime();
                                for (i = 0; i <= dattas.length - 1; i++) {
                                    var today = dattas[i].Date;
                                    var toToday = new Date(today);
                                    var ApppoDate = toToday.getTime();
                                    if (ApppDate == ApppoDate) {
                                        $scope.a = i - 2;
                                        $scope.b = i + 3;
                                        if ($scope.a == -1 || $scope.a == -2) {
                                            $scope.a = 0;
                                            $scope.b = 5;
                                        } else if ($scope.b >= dattas.length - 1) {
                                            $scope.a = dattas.length - 5;
                                            $scope.b = dattas.length;
                                        } else {
                                            $scope.a = i - 2;
                                            $scope.b = i + 3;
                                        }
                                        workingDate();
                                        $scope.idSelectedSchedule = dattas[i];
                                        var list = dattas[i];
                                        var day = list.Day;
                                        var month = list.Month;
                                        var Datee = new Date(list.Date);
                                        var year = Datee.getFullYear();
                                        var AppoiDate = (day + "-" + month + "-" + year)
                                        $scope.AppoiDate = AppoiDate;
                                        break;
                                    } else {
                                        $scope.a = 0;
                                        $scope.b = 5;
                                        workingDate();
                                    }
                                }

                            })
                        }
                    }
                    $scope.IsNew = 1;
                    function TimeSlotChange(AppoiDate) {
                        $scope.AppoimDate = AppoiDate;
                        TimeSlot();
                    }
                    $scope.IsNew = 1;
                    function TimeSlot() {
                        $("#appoint_waveLoader").show();
                        //$scope.AppoiDate = [];
                        $scope.AppoiFromTime = [];
                        $scope.AppoiToTime = [];
                        $scope.newAppoiTimeSlot = [];
                        var DoctorIDs = $scope.DoctorID;
                        var AppoDate = $scope.AppoimDate;
                        var res1 = convert(AppoDate);
                        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                        $http.get(baseUrl + '/api/PatientAppointments/GetDoctorAppointmentTimeSlot/?DoctorId=' + DoctorIDs + '&Date=' + res1 + '&IsNew=' + $scope.IsNew + '&Login_Session_Id=' + $scope.LoginSessionId + '&TimeZoneId=' + $scope.TimeZoneID + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data1) {
                            $("#appoint_waveLoader").hide();
                            $scope.newAppoiTimeSlot = data1.DoctorAppointmentTimeSlotList;
                            if ($scope.newAppoiTimeSlot.length == 0) {
                                $scope.DataNotAvailible = 1;
                            } else {
                                $scope.DataNotAvailible = 0;
                            }
                        }).error(function (data) { $("#appoint_waveLoader").hide(); });
                    }
                    $scope.ddltimezonechange = function () { TimeSlot(); }
                    $scope.clickNewBooking = function () {
                        $scope.IsNew = 1;
                        TimeSlot();
                    }
                    $scope.clickFollowUp = function () {
                        $scope.IsNew = 0;
                        TimeSlot();
                    }
                    $scope.a = 0;
                    $scope.b = 5;
                    function workingDate() {
                        $scope.newScheduledDatesSplit = [];
                        var a = $scope.a;
                        var b = $scope.b;
                        data = $scope.newScheduledDates;
                        var datas = data.ScheduledDaysList;
                        $scope.newScheduledDatesSplit = datas.slice(a, b);
                    }
                    $scope.DateMInus = function () {
                        if ($scope.a != 0) {
                            $scope.a = $scope.a - 1;
                            $scope.b = $scope.b - 1;
                        }
                        workingDate();
                    }
                    $scope.DatePlus = function () {
                        data = $scope.newScheduledDates.ScheduledDaysList.length;
                        if ($scope.b != data) {
                            $scope.a = $scope.a + 1;
                            $scope.b = $scope.b + 1;
                        }
                        workingDate();
                    }
                    $scope.idSelectedSchedule = null;
                    $scope.clickSchedule = function (list) {
                        $scope.AppoiDate = [];
                        $scope.idSelectedSchedule = list;
                        var day = list.Day;
                        var month = list.Month;
                        var Datee = new Date(list.Date);
                        var year = Datee.getFullYear();
                        var AppoiDate = (day + "-" + month + "-" + year)
                        $scope.AppoiDate = AppoiDate;
                        TimeSlotChange(AppoiDate);
                    }
                    $scope.idSelectedAppoi = null;
                    $scope.AppoiFromTime = [];
                    $scope.AppoiToTime = [];
                    $scope.ClickAppointment = function (list) {
                        $scope.idSelectedAppoi = list;
                        //var AppointmentFrom = list.AppointmentFromDateTime;
                        //var AppointmentTo = list.AppointmentToDateTime;
                        //var From = AppointmentFrom.split('T')[1];
                        //var To = AppointmentTo.split('T')[1];
                        //$scope.AppoiFromTime = From.slice(0, 5);
                        //$scope.AppoiToTime = To.slice(0, 5);
                        $scope.AppoiFromTime = list.AppointmentFromDateTime;
                        $scope.AppoiToTime = list.AppointmentToDateTime;

                    }
                    $scope.setappoint_type = function (type) {
                        $scope.AppointmoduleID1 = type;
                    }
                    $scope.BackToDoc = function () {
                        $scope.showMainBox = true;
                    }
                    $http.get(baseUrl + '/api/User/DocumentTypeList/').success(function (data) {
                        $scope.DocumentTypeList = data;
                    })
                    $scope.SavePatientAppointment = function () {
                        if ($scope.AppoiDate == undefined || $scope.AppoiDate == null || $scope.AppoiDate == "") {
                            //alert('Please select Appointment Date')
                            toastr.warning("Please select Appointment Date", "warning");
                        } else if ($scope.AppoiFromTime == undefined || $scope.AppoiFromTime == null || $scope.AppoiFromTime == "") {
                            //alert('Please select Appointment Time')
                            toastr.warning("Please select Appointment Time", "warning");
                        } else if ($scope.AppoiToTime == undefined || $scope.AppoiToTime == null || $scope.AppoiToTime == "") {
                            //alert('Please select Appointment Time')
                            toastr.warning("Please select Appointment Time", "warning");
                        }/* else if ($scope.TimeZoneID == undefined || $scope.TimeZoneID == null || $scope.TimeZoneID == "") {
                    alert('Please select TimeZone')
                } */else {
                            var Appointment_Module = 1;
                            if ($scope.AppointmoduleID1 === 2) {
                                Appointment_Module = 2;
                            }
                            if ($scope.AppointmoduleID1 === 3) {
                                Appointment_Module = 3;
                            }
                            $("#appoint_waveLoader").show();


                            if ($scope.OldAppointmentID == null) {
                                var objectSave = {
                                    "Institution_Id": $scope.SelectedInstitutionId,
                                    "Doctor_Id": $scope.DoctorID,
                                    "Patient_Id": $scope.SelectedPatientId,
                                    "Appointment_Date": $scope.AppoiDate,
                                    "AppointmentFromTime": $scope.AppoiFromTime,
                                    "AppointmentToTime": $scope.AppoiToTime,
                                    "TimeZone_Id": $scope.TimeZoneID,
                                    "Appointment_Type": "1",
                                    "ReasonForVisit": document.getElementById("TextArea1").value,
                                    "Status": 1,
                                    "Created_By": $window.localStorage['UserId'],
                                    "Page_Type": 0,
                                    "Appointment_Module_Id": Appointment_Module
                                }
                                $('#shown').attr("disabled", true);
                                $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

                                $http.post(baseUrl + '/api/PatientAppointments/PatientAppointment_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, objectSave).success(function (data) {
                                    //alert(data.Message);
                                    if (data.ReturnFlag == 1) {
                                        toastr.success(data.Message, "success");
                                    }
                                    else if (data.ReturnFlag == 0) {
                                        toastr.info(data.Message, "info");
                                    }
                                    $('#shown').attr("disabled", false);
                                    if (data.ReturnFlag == 1) {
                                        $scope.Id = "0";
                                        var fd = new FormData();
                                        var imgBlob;
                                        var imgBlobfile;
                                        var itemIndexLogo = -1;
                                        var itemIndexdoc = -1;
                                        if ($scope.appdocfilename !== "") {
                                            console.log($scope.appdocfile)
                                            imgBlob = $scope.dataURItoBlob($scope.appdocfile);
                                            fd.append('file', imgBlob);
                                            var fddata = new FormData();

                                            fddata.append("Value", "value1");

                                            for (i = 0; i < $scope.files.length; i++) {
                                                fddata.append('files' + i, $scope.files[i]);
                                            }


                                            //var url = baseUrl + '/api/User/Patient_OtherData_InsertUpdate/?Patient_Id=' + $scope.SelectedPatientId + '&Id=' + $scope.Id + '&FileName=' + $scope.appdocfilename + '&DocumentName=' + $scope.appdocfilename + '&Remarks="Appointment"' + '&Created_By=' + $window.localStorage['UserId'] + '&Is_Appointment=1';

                                            $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                                            $http.post(baseUrl + '/api/User/Patient_OtherData_InsertUpdate/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId + '&Appointment_Id=' + data.PatientAppointmentList[0].Id + '&Id=' + $scope.Id + '&FileName=' + '&DocumentName=""' + '&Remarks=Appointment' + '&Created_By=' + $window.localStorage['UserId'] + '&Is_Appointment=1&Filetype=' + $scope.filetype.toString(),
                                                fddata,
                                                {
                                                    transformRequest: angular.identity,
                                                    headers: {
                                                        'Content-Type': undefined
                                                    }
                                                }
                                            )
                                                .success(function (response) {
                                                    $("#appoint_waveLoader").hide();
                                                    $scope.files = [];
                                                    angular.element('#BookAppointmentModal').modal('hide');
                                                    document.getElementById("TextArea1").value = "";
                                                    //document.getElementById("main-box").style = "";
                                                    //document.getElementById("box").style = "display:none";
                                                    $scope.showMainBox = true;
                                                    document.getElementById("show").disabled = true;
                                                    document.getElementById("DocDetails").hidden = true;
                                                    $scope.SelectedSpeciality = "";
                                                    $scope.AppoimDate = "";
                                                    $scope.TimeZoneID = "";
                                                    $scope.DoctorID = [];
                                                    $scope.DoctorListWithTimeZone = [];
                                                    $scope.DeptIDAsSTR = [];
                                                    $scope.DoctorDetailList = [];
                                                    $scope.newScheduledDates = [];
                                                    $scope.newAppoiTimeSlot = [];
                                                    $scope.newScheduledDatesSplit = [];
                                                    //$scope.AppoiDate = [];
                                                    $scope.AppoiFromTime = [];
                                                    $scope.AppoiToTime = [];
                                                    $scope.IsNew = 1;
                                                    $scope.OldAppointmentID = null;
                                                    if ($scope.AppointmoduleID1 == 2) {
                                                        $scope.paymentappointmentId = data.PatientAppointmentList[0].Id;
                                                        //var post = $http({
                                                        //    method: "POST",
                                                        //    url: baseUrl + "/Home/CreatePayByCheckoutSession/",
                                                        //    dataType: 'json',
                                                        //    data: { appointmentId: $scope.paymentappointmentId },
                                                        //    headers: { "Content-Type": "application/json" }
                                                        //});
                                                        //post.success(function (data, status) {
                                                        //    alert("Hello: " + data.Name + " .\nCurrent Date and Time: " + data.DateTime);
                                                        //});

                                                        //post.error(function (data, status) {
                                                        //    alert(data.Message);
                                                        //});
                                                        //$http.post(baseUrl + '/Home/CreatePayByCheckoutSession?appointmentId=' + data.PatientAppointmentList[0].Id).success(function (data) {

                                                        //});
                                                        setTimeout(function () { document.getElementById('but_payby').click(); }, 100);
                                                    } else {
                                                        $scope.$broadcast("appointment_list");
                                                    }
                                                    $scope.appdocfilename = "";
                                                }).error(function (response) {
                                                    $scope.appdocfilename = "";


                                                });
                                        }
                                        else {
                                            $("#appoint_waveLoader").hide();
                                            $scope.files = [];
                                            angular.element('#BookAppointmentModal').modal('hide');
                                            //document.getElementById("main-box").style = "";
                                            //document.getElementById("box").style = "display:none";
                                            $scope.showMainBox = true;
                                            document.getElementById("show").disabled = true;
                                            document.getElementById("DocDetails").hidden = true;
                                            $scope.SelectedSpeciality = "";
                                            $scope.AppoimDate = "";
                                            $scope.TimeZoneID = "";
                                            $scope.DoctorID = [];
                                            $scope.DoctorListWithTimeZone = [];
                                            $scope.DeptIDAsSTR = [];
                                            $scope.DoctorDetailList = [];
                                            $scope.newScheduledDates = [];
                                            $scope.newAppoiTimeSlot = [];
                                            $scope.newScheduledDatesSplit = [];
                                            //$scope.AppoiDate = [];
                                            $scope.AppoiFromTime = [];
                                            $scope.AppoiToTime = [];
                                            $scope.IsNew = 1;
                                            $scope.OldAppointmentID = null;
                                            if ($scope.AppointmoduleID1 == 2) {
                                                $scope.paymentappointmentId = data.PatientAppointmentList[0].Id;
                                                //var post = $http({
                                                //    method: "POST",
                                                //    url: baseUrl + "/Home/CreatePayByCheckoutSession/",
                                                //    dataType: 'json',
                                                //    data: { appointmentId: $scope.paymentappointmentId },
                                                //    headers: { "Content-Type": "application/json" }
                                                //});
                                                //post.success(function (data, status) {
                                                //    alert("Hello: " + data.Name + " .\nCurrent Date and Time: " + data.DateTime);
                                                //});

                                                //post.error(function (data, status) {
                                                //    alert(data.Message);
                                                //});
                                                //$http.post(baseUrl + '/Home/CreatePayByCheckoutSession?appointmentId=' + data.PatientAppointmentList[0].Id).success(function (data) {

                                                //});
                                                setTimeout(function () { document.getElementById('but_payby').click(); }, 100);
                                            } else {
                                                $scope.$broadcast("appointment_list");
                                            }
                                            $scope.appdocfilename = "";
                                        }
                                    }

                                }).error(function (data) { $("#appoint_waveLoader").hide(); });;
                            } else {
                                var objectReshedule = {
                                    "Id": $scope.OldAppointmentID,
                                    "CancelledBy_Id": $window.localStorage['UserId'],
                                    "Cancelled_Remarks": "Reschedule",
                                    "ReasonTypeId": 76,
                                    "Institution_Id": $scope.SelectedInstitutionId,
                                    "Doctor_Id": $scope.DoctorID,
                                    "Patient_Id": $scope.SelectedPatientId,
                                    "Appointment_Date": $scope.AppoiDate,
                                    "AppointmentFromTime": $scope.AppoiFromTime,
                                    "AppointmentToTime": $scope.AppoiToTime,
                                    "Appointment_Type": "1",
                                    "ReasonForVisit": "Test",
                                    "Status": "1",
                                    "Created_By": $window.localStorage['UserId'],
                                    "Page_Type": "0",
                                    "TimeZone_Id": $scope.TimeZoneID,
                                    "Appointment_Module_Id": Appointment_Module
                                }
                                $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                                $http.post(baseUrl + '/api/PatientAppointments/AppointmentReSchedule_InsertUpdate?Login_Session_Id=' + $scope.LoginSessionId, objectReshedule).success(function (data) {
                                    //alert(data.Message);
                                    if (data.ReturnFlag == 1) {
                                        toastr.success(data.Message, "success");
                                    }
                                    else if (data.ReturnFlag == 0) {
                                        toastr.info(data.Message, "info");
                                    }
                                    if (data.ReturnFlag == 1) {
                                        $scope.Id = "0";
                                        var fd = new FormData();
                                        var imgBlob;
                                        var imgBlobfile;
                                        var itemIndexLogo = -1;
                                        var itemIndexdoc = -1;
                                        $scope.paymentappointmentId = data.PatientAppointmentList[0].NewAppointmentId;
                                        if ($scope.appdocfilename !== "") {
                                            console.log($scope.appdocfile)
                                            imgBlob = $scope.dataURItoBlob($scope.appdocfile);
                                            fd.append('file', imgBlob);
                                            var fddata = new FormData();

                                            fddata.append("Value", "value1");

                                            for (i = 0; i < $scope.files.length; i++) {
                                                fddata.append('files' + i, $scope.files[i]);
                                            }

                                            //var url = baseUrl + '/api/User/Patient_OtherData_InsertUpdate/?Patient_Id=' + $scope.SelectedPatientId + '&Id=' + $scope.Id + '&FileName=' + $scope.appdocfilename + '&DocumentName=' + $scope.appdocfilename + '&Remarks="Appointment"' + '&Created_By=' + $window.localStorage['UserId'] + '&Is_Appointment=1';

                                            $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                                            $http.post(baseUrl + '/api/User/Patient_OtherData_InsertUpdate/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId + '&Appointment_Id=' + data.PatientAppointmentList[0].Id + '&Id=' + $scope.Id + '&FileName=' + '&DocumentName=""' + '&Remarks=Appointment' + '&Created_By=' + $window.localStorage['UserId'] + '&Is_Appointment=1&Filetype=' + $scope.filetype.toString(),
                                                fddata,
                                                {
                                                    transformRequest: angular.identity,
                                                    headers: {
                                                        'Content-Type': undefined
                                                    }
                                                }
                                            )
                                                .success(function (response) {
                                                    $scope.appdocfilename = "";
                                                    $scope.files = [];
                                                }).error(function (response) {
                                                    $scope.appdocfilename = "";


                                                });
                                        }
                                        $("#appoint_waveLoader").hide();
                                        angular.element('#BookAppointmentModal').modal('hide');
                                        //document.getElementById("main-box").style = "";
                                        //document.getElementById("box").style = "display:none";
                                        $scope.showMainBox = true;
                                        document.getElementById("show").disabled = true;
                                        document.getElementById("DocDetails").hidden = true;
                                        $scope.SelectedSpeciality = "";
                                        $scope.AppoimDate = "";
                                        $scope.TimeZoneID = "";
                                        $scope.DoctorID = [];
                                        $scope.DoctorListWithTimeZone = [];
                                        $scope.DeptIDAsSTR = [];
                                        $scope.DoctorDetailList = [];
                                        $scope.newScheduledDates = [];
                                        $scope.newAppoiTimeSlot = [];
                                        $scope.newScheduledDatesSplit = [];
                                        //$scope.AppoiDate = [];
                                        $scope.AppoiFromTime = [];
                                        $scope.AppoiToTime = [];
                                        $scope.IsNew = 1;
                                        var objectCancel = {
                                            "Id": $scope.OldAppointmentID,
                                            "CancelledBy_Id": $window.localStorage['UserId'],
                                            "Cancel_Remarks": "Test",
                                            "ReasonTypeId": "1",
                                            "SESSION_ID": $scope.LoginSessionId
                                        }
                                        $http.post(baseUrl + '/api/PatientAppointments/CancelPatient_Appointment/?Login_Session_Id=' + $scope.LoginSessionId, objectCancel).success(function (data) {
                                            //alert(data.Message);
                                            if (data.ReturnFlag == 1) {
                                                toastr.success(data.Message, "success");
                                            }
                                            else if (data.ReturnFlag == 0) {
                                                toastr.info(data.Message, "info");
                                            }
                                            if (data.AppointmentDetails.PaymentStatusId == 3) {
                                                $scope.refundAppointmentId = data.AppointmentDetails.Id;
                                                $scope.refundMerchantOrderNo = data.AppointmentDetails.MerchantOrderNo;
                                                $scope.refundAmount = data.AppointmentDetails.Amount;
                                                $scope.refundOrderNo = data.AppointmentDetails.OrderNo;
                                                $scope.refundInstitutionId = data.AppointmentDetails.Institution_Id;

                                                //setTimeout(function () { document.getElementById('but_paybyrefund').click(); }, 100);

                                                var obj = {
                                                    refundAppointmentId: data.AppointmentDetails.Id,
                                                    refundMerchantOrderNo: data.AppointmentDetails.MerchantOrderNo,
                                                    refundAmount: data.AppointmentDetails.Amount,
                                                    refundOrderNo: data.AppointmentDetails.OrderNo,
                                                    refundInstitutionId: data.AppointmentDetails.Institution_Id
                                                };

                                                $http.post(baseUrl + '/api/PayBy/RefundPayByCheckoutSession/', obj).success(function (data) {
                                                    console.log(data);
                                                    $scope.$broadcast("appointment_list");
                                                }).error(function (data) { console.log(data); });

                                            }
                                            //if (data.ReturnFlag == 1) {
                                            //    $scope.$broadcast("appointment_list");
                                            //}
                                            if ($scope.AppointmoduleID1 == 2) {
                                                $scope.OldAppointmentID = null;
                                                setTimeout(function () { document.getElementById('but_payby').click(); }, 100);
                                            } else {
                                                $scope.$broadcast("appointment_list");
                                            }
                                        });
                                    }

                                }).error(function (data) { $("#appoint_waveLoader").hide(); });;
                            }




                        }
                    }
                    $scope.CancelMyAppointment = function () {
                        angular.element('#BookAppointmentModal').modal('hide');
                        //document.getElementById("main-box").style = "";
                        //document.getElementById("box").style = "display:none";
                        $scope.showMainBox = true;
                        document.getElementById("show").disabled = true;
                        document.getElementById("DocDetails").hidden = true;
                        $scope.SelectedSpeciality = "";
                        $scope.AppoimDate = "";
                        $scope.TimeZoneID = "";
                        $scope.DoctorID = [];
                        $scope.DoctorListWithTimeZone = [];
                        $scope.DeptIDAsSTR = [];
                        $scope.DoctorDetailList = [];
                        $scope.newScheduledDates = [];
                        $scope.newAppoiTimeSlot = [];
                        $scope.newScheduledDatesSplit = [];
                        $scope.AppoiDate = [];
                        $scope.AppoiFromTime = [];
                        $scope.AppoiToTime = [];
                        $scope.IsNew = 1;
                    }
                    $scope.OldAppointmentID = null;
                    $scope.RescheduleDocAppointment = function (Row) {
                        $scope.OldAppointmentID = Row.Id;
                        angular.element('#BookAppointmentModal').modal('show');
                    }
                    $scope.CancelDocAppointment = function (Row) {
                        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                        $("#chatLoaderPV").show();
                        //console.log(Row);
                        var objectCancel = {
                            "Id": Row.Id,
                            "CancelledBy_Id": $window.localStorage['UserId'],
                            "Cancel_Remarks": "Test",
                            "ReasonTypeId": "1",
                            "SESSION_ID": $scope.LoginSessionId
                        }
                        if (confirm("Confirm to cancel appointment")) {
                            $http.post(baseUrl + '/api/PatientAppointments/CancelPatient_Appointment/?Login_Session_Id=' + $scope.LoginSessionId, objectCancel).success(function (data) {
                                //alert(data.Message);
                                if (data.ReturnFlag == 1) {
                                    toastr.success(data.Message, "success");
                                }
                                else if (data.ReturnFlag == 0) {
                                    toastr.info(data.Message, "info");
                                }
                                if (data.AppointmentDetails.PaymentStatusId == 3) {
                                    $scope.refundAppointmentId = data.AppointmentDetails.Id;
                                    $scope.refundMerchantOrderNo = data.AppointmentDetails.MerchantOrderNo;
                                    $scope.refundAmount = data.AppointmentDetails.Amount;
                                    $scope.refundOrderNo = data.AppointmentDetails.OrderNo;
                                    $scope.refundInstitutionId = data.AppointmentDetails.Institution_Id;

                                    //setTimeout(function () { document.getElementById('but_paybyrefund').click(); }, 100);

                                    var obj = {
                                        refundAppointmentId: data.AppointmentDetails.Id,
                                        refundMerchantOrderNo: data.AppointmentDetails.MerchantOrderNo,
                                        refundAmount: data.AppointmentDetails.Amount,
                                        refundOrderNo: data.AppointmentDetails.OrderNo,
                                        refundInstitutionId: data.AppointmentDetails.Institution_Id
                                    };

                                    $http.post(baseUrl + '/api/PayBy/RefundPayByCheckoutSession/', obj).success(function (data) {
                                        console.log(data);
                                        $scope.$broadcast("appointment_list");
                                    }).error(function (data) { console.log(data); });

                                }
                                if (data.ReturnFlag == 1) {
                                    $scope.$broadcast("appointment_list");
                                }
                            });
                        }
                        $("#chatLoaderPV").hide();
                    }
                    $scope.ConfirmAppointment = function (Row) {
                        if (confirm("Confirm to appointment")) {
                            $("#chatLoaderPV").show();
                            var obj = {
                                "Id": Row.Id,
                                "SESSION_ID": $window.localStorage['Login_Session_Id'],
                                "Institution_Id": $window.localStorage['InstitutionId'],
                                "user_id": $window.localStorage['UserId']
                            }
                            $http.post(baseUrl + '/api/User/CG_Confirm_PatientAppointments/', obj).success(function (data) {
                                $("#chatLoaderPV").hide();
                                if (data.ReturnFlag == 1) {
                                    CG_PatientAppointment_List();
                                    alert(data.Message);
                                } else {
                                    alert(data.Message);
                                }
                            });
                        }
                    }
                    $scope.AppointmentPayment = function (Row) {
                        $scope.paymentappointmentId = Row.Id;
                        $scope.paymentdepartmentId = Row.DoctorDepartmentId;
                        $scope.paymentInstitutionId = Row.Institution_Id;
                        setTimeout(function () { document.getElementById('but_payby').click(); }, 100);
                    }
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        }



        $scope.myMeetingURL = '';
        $scope.myMeeting = function (meetingdomain) {
            var key = "";

            var obj =
            {
                name: "conference38",
                username: "appsAdmin",
                key: "ab3049da9a0cd8d6e8b7c62586752472"
            }

            $http.post('https://mymeeting.mycortex.ca/apps/apiservice/api/getconferencedetails', obj).success(function (data) {
                if (data == "Conference not available") {
                    var objAdd =
                    {
                        "action": "Add",
                        "username": "appsAdmin",
                        "key": "ab3049da9a0cd8d6e8b7c62586752472",
                        "name": "conference38",
                        "audio": "on",
                        "video": "off",
                        "chat": "off",
                    }
                    $http.post('https://mymeeting.mycortex.ca/apps/apiservice/api/videoConfSettings', objAdd).success(function (data) {
                        if (data.status == "Added") {
                            var objAdd =
                            {
                                "action": "changeConferenceMode",
                                "username": "appsAdmin",
                                "key": "ab3049da9a0cd8d6e8b7c62586752472",
                                "name": "conference38",
                                "conferenceMode": "on"
                            }
                            $http.post('https://mymeeting.mycortex.ca/apps/apiservice/api/videoConfSettings', objAdd).success(function (data) {
                                if (data.status != "") {
                                    key = data.hashKey;
                                    if (meetingdomain == 1) {
                                        url = 'https://mymeeting.mycortex.ca/meeting/?key=' + key;
                                    } else if (meetingdomain == 2) {
                                        url = 'https://mycortex.livebox.co.in/meeting/?key=' + key;
                                    }
                                    $scope.myMeetingURL = $sce.trustAsResourceUrl(url);
                                    angular.element('#ViewMyMeetingModal').modal('show');
                                    //window.open(url);
                                }
                            });
                        }
                    });
                }
                else {
                    key = data.Hashkey;
                    if (meetingdomain == 1) {
                        url = 'https://mymeeting.mycortex.ca/meeting/?key=' + key;
                    } else if (meetingdomain == 2) {
                        url = 'https://mycortex.livebox.co.in/meeting/?key=' + key;
                    }
                    $scope.myMeetingURL = $sce.trustAsResourceUrl(url);
                    angular.element('#ViewMyMeetingModal').modal('show');
                    // window.open(url);
                }

            }).error(function (data) {
                $scope.error = "Error: " + data;
            });
        }

        $scope.CancelMyMeeting = function () {
            $scope.myMeetingURL = '';
            angular.element('#ViewMyMeetingModal').modal('hide');
        }

        $scope.HelathDataList = [];

        $scope.DayDetailsList = function (TabClicked) {
            $scope.Type_Id = 1;
            $scope.ActivitiesDaysClick(TabClicked, 1);

        }
        $scope.WeeKDetailsList = function (TabClicked) {
            $scope.Type_Id = 2;
            $scope.ActivitiesDaysClick(TabClicked, 1);
        }
        $scope.OneWeekDetailsList = function (TabClicked) {
            $scope.Type_Id = 3;
            $scope.ActivitiesDaysClick(TabClicked, 1);
        }

        $scope.ThreeMonthDetailsList = function (TabClicked) {
            $scope.Type_Id = 4;
            $scope.ActivitiesDaysClick(TabClicked, 1);
        }
        $scope.OneYearKDetailsList = function (TabClicked) {
            $scope.Type_Id = 5;
            $scope.ActivitiesDaysClick(TabClicked, 1);
        }

        $scope.FromYearDetailsList = function (TabClicked) {
            $scope.Type_Id = 6;
            $scope.ActivitiesDaysClick(TabClicked, 1);
        }
        $scope.AllDetailsList = function (TabClicked, ChartORData) {
            $scope.Type_Id = 7;
            $scope.ActivitiesDaysClick(TabClicked, ChartORData);
        }
        $scope.ActivitiesDaysClick = function (TabClicked, ChartORData) {
            if (TabClicked == "1") {
                $scope.LSType_Id = $scope.Type_Id;
                $scope.ParamGroup_Id = 1;
            }
            else if (TabClicked == "2") {
                $scope.VitalsType_Id = $scope.Type_Id;
                $scope.ParamGroup_Id = 2;
            }
            else if (TabClicked == "3") {
                $scope.VitalsType_Id = $scope.Type_Id;
                $scope.ParamGroup_Id = 3;
            }
            $scope.GeneralFunction($scope.ParamGroup_Id, ChartORData);
        }


        $scope.setPage = function (PageNo) {
            if (PageNo > $scope.patientvitals_pages) {
                return false;
            } else if (PageNo == 0) {
                return false;
            }
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else {
                $scope.inputPageNo = PageNo;
            }

            $scope.current_page = PageNo;
            $scope.GeneralFunction($scope.ParamGroup_Id, 2);
        }
        $scope.GeneralFunction = function (ParamGroup_Id, ChartORData) {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/User/GETPATIENTINSTITUTION/?ID=' + $scope.SelectedPatientId).success(function (data) {
                $("#chatLoaderPV").hide();
                var PatientInstituteId = data[0].Institution_Id;
                $scope.ParameterList = [];
                $scope.PatientHealthDataChartList = [];
                $scope.ParamGroup_Id = ParamGroup_Id;
                $("#chatLoaderPV").show();
                $scope.getParameterList();
                if (PatientInstituteId == $window.localStorage['InstitutionId']) {
                    $scope.ConfigCode = "PATIENTPAGE_COUNT";
                    $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                    $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                        $scope.page_size = data1[0].ConfigValue;
                        $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                        $scope.PageEnd = $scope.current_page * $scope.page_size;
                        $scope.Active = 1;       // default active
                        if ($scope.VitalsIsActive == true) {
                            $scope.Active = 1  //active
                        }
                        else if ($scope.VitalsIsActive == false) {
                            $scope.Active = -1 //all
                        }

                        if (ChartORData == 1) {
                            $scope.PageStart = 0;
                            $scope.PageEnd = 0;
                        }
                        $http.get(baseUrl + '/api/User/PatientHealthDataDetails_List/?Patient_Id=' + $scope.SelectedPatientId + '&OptionType_Id=' + $scope.Type_Id + '&Group_Id=' + $scope.ParamGroup_Id + '&Login_Session_Id=' + $scope.LoginSessionId + '&UnitsGroupType=' + $scope.unitgrouptype + '&StartRowNumber=' + $scope.PageStart +
                            '&EndRowNumber=' + $scope.PageEnd + '&Active=' + $scope.Active).success(function (data) {
                                $("#chatLoaderPV").hide();
                                $scope.SearchMsg = "No Data Available";
                                // only active items for Chart
                                if (ChartORData == 1) {
                                    $scope.PatientHealthDataChartList = $ff(data.PatientHealthDataList, { IsActive: 1 }, true);
                                    $scope.Parameter_List = [];
                                    $scope.ParameterChild_List = [];

                                    if ($scope.GroupParameterNameList.length != '0') {
                                        angular.forEach($ff($scope.GroupParameterNameList, { Group_Id: $scope.ParamGroup_Id }, true), function (valueparam, indexparam) {
                                            if (valueparam.ParameterParent_Id == "0") {
                                                var currentParam = {
                                                    Id: valueparam.ParameterId,
                                                    Name: 'Chart' + valueparam.ParameterId,
                                                    hadChild: valueparam.ParameterHas_Child,
                                                    ParamName: valueparam.ParameterName,
                                                    GroupId: valueparam.Group_Id
                                                };
                                                $scope.Parameter_List.push(currentParam);
                                            }
                                            else {
                                                var currentParamChild = {
                                                    Id: valueparam.ParameterId,
                                                    Parent_Id: valueparam.ParameterParent_Id,
                                                    Name: 'Chart' + valueparam.ParameterId,
                                                    GroupId: valueparam.Group_Id,
                                                    ParamName: valueparam.ParameterName,
                                                };
                                                $scope.ParameterChild_List.push(currentParamChild);
                                            }


                                        });
                                    } else if ($scope.Tick == false) {
                                        //5356
                                        $scope.getParameterList();
                                        $scope.GeneralFunction(ParamGroup_Id, ChartORData);
                                    }
                                    if ($scope.Tick == true) {
                                        $scope.PatientHealthRecordDetailsList($ff($scope.Parameter_List, { GroupId: ParamGroup_Id }, true), $scope.PatientHealthDataChartList, $scope.ParameterChild_List);
                                    }
                                }
                                // all active&inactive items for tableview/detail view
                                else if (ChartORData == 2) {
                                    //$scope.PatientHealthDataChartList = data.PatientHealthDataList;

                                    $scope.PatientHealthDataChartList = data.PatientHealthDataList;
                                    //$scope.vitalsFilterAllItem();
                                    $scope.emptydataVitalLab = [];
                                    $scope.emptydataVitalLab = $scope.PatientHealthDataChartList;
                                    $scope.PatientHealthCount = $scope.emptydataVitalLab[0].TotalRecord;
                                    if ($scope.VitalsIsActive == true) {
                                        $scope.PatientHealthDataTableList = $scope.filterExcludeBMI(($filter('orderBy')(angular.copy($ff($scope.emptydataVitalLab, { IsActive: 1 }, true)), 'Id', true)));
                                        $scope.PatientHealthActiveCount = $scope.PatientHealthDataTableList;

                                        if ($scope.PatientHealthActiveCount.length > 0) {
                                            $scope.flag = 1;
                                        }
                                        else {
                                            $scope.flag = 0;
                                        }
                                    } else {
                                        $scope.PatientHealthDataTableList = $scope.filterExcludeBMI(($scope.filterExcludeBMI($filter('orderBy')(angular.copy($scope.emptydataVitalLab), 'Id', true))));
                                        $scope.PatientHealthActiveCount = $scope.PatientHealthDataTableList;

                                        if ($scope.PatientHealthActiveCount.length > 0) {
                                            $scope.flag = 1;
                                        }
                                        else {
                                            $scope.flag = 0;
                                        }
                                    }
                                    $scope.patientvitals_pages = Math.ceil(($scope.PatientHealthCount) / ($scope.page_size));
                                }
                            })
                    }).error(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.error = "AN error has occured while Listing the records!" + data;
                    })
                } else {
                    window.location.href = baseUrl + "/Home/LoginIndex";
                }
            });
        };
        $scope.VitalsIsActive = true;
        $scope.vitalsFilterAllItem = function () {
            $("#chatLoaderPV").show();
            if ($scope.VitalsIsActive == true) {
                $scope.Active = 1
                $scope.GeneralFunction($scope.ParamGroup_Id, 2);
                // if active   - filter only active        
                //$scope.PatientHealthDataTableList = $filter('orderBy')(angular.copy($ff($scope.PatientHealthDataChartList, {IsActive :1}, true)), 'Id', true);
                //$scope.emptydataVitalLab = [];
                //$scope.emptydataVitalLab = $scope.PatientHealthDataChartList;
                //$scope.PatientHealthCount = $scope.emptydataVitalLab[0].TotalRecord;
                //$scope.PatientHealthDataTableList = $scope.filterExcludeBMI(($filter('orderBy')(angular.copy($ff($scope.emptydataVitalLab, { IsActive: 1 }, true)), 'Id', true)));
                ////$scope.patientvitals_pages = Math.ceil(($scope.PatientHealthDataTableList) / ($scope.page_size));
                //$scope.PatientHealthActiveCount = $scope.PatientHealthDataTableList;

                //if ($scope.PatientHealthActiveCount.length > 0) {
                //    $scope.flag = 1;
                //}
                //else {
                //    $scope.flag = 0;
                //}
                //$scope.patientvitals_pages = Math.ceil(($scope.PatientHealthCount) / ($scope.page_size));

            }
            else {
                // if inactive - filter all
                $scope.Active = -1 //all  
                //$scope.GeneralFunction($scope.ParamGroup_Id, 2);
                $scope.GeneralFunction($scope.ParamGroup_Id, 2);
                //$scope.emptydataVitalLab = [];
                //$scope.emptydataVitalLab = $scope.PatientHealthDataChartList;
                //$scope.PatientHealthCount = $scope.emptydataVitalLab[0].TotalRecord;
                //$scope.PatientHealthDataTableList = $scope.filterExcludeBMI(($scope.filterExcludeBMI($filter('orderBy')(angular.copy($scope.emptydataVitalLab), 'Id', true))));
                //$scope.PatientHealthActiveCount = $scope.PatientHealthDataTableList;

                //if ($scope.PatientHealthActiveCount.length > 0) {
                //    $scope.flag = 1;
                //}
                //else {
                //    $scope.flag = 0;
                //}
                //$scope.patientvitals_pages = Math.ceil(($scope.PatientHealthCount) / ($scope.page_size));
            }
            // to refresh sorting
            //setTimeout(function () {
            //    $scope.$apply(function () {
            //        $scope.PatientHealthDataTableList = angular.copy($scope.PatientHealthDataTableList);
            //    });
            //}, 100);
            angular.forEach($scope.PatientHealthDataTableList, function (value2, index2) {
                $scope.EditVitalRow_EditFlag[index2] = 1;
            });
            $("#chatLoaderPV").hide();
        }
        $scope.filterExcludeBMI = function (rowSet) {
            $scope.localfilterSet = [];
            angular.forEach(rowSet, function (row, rowIndex) {
                if (row.ParameterId != "13")
                    $scope.localfilterSet.push(row);
            });
            return $scope.localfilterSet;
        }


        /* Filter the master list function.*/
        $scope.filterParameterList = function () {
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.PatientHealthDataTableList = [];
                $scope.vitalsFilterAllItem();
            }
            else {
                $scope.PatientHealthDataTableList = $scope.filterExcludeBMI(($filter('orderBy')($ff($scope.PatientHealthDataTableList, function (value) {
                    return angular.lowercase(value.ParameterName).match(searchstring) ||
                        angular.lowercase(value.UOM_Name).match(searchstring) ||
                        angular.lowercase(value.ParameterValue.toString()).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Activity_DateTime, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(value.Createdby_FullName).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Created_Dt, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);
                }), 'Id', true)));
                // to refresh sorting
                setTimeout(function () {
                    $scope.$apply(function () {
                        $scope.PatientHealthDataTableList = angular.copy($scope.PatientHealthDataTableList);
                        if ($scope.PatientHealthDataTableList.length > 0) {
                            $scope.flag = 1;
                        } else {
                            $scope.flag = 0;
                        }
                        $scope.patientvitals_pages = Math.ceil(($scope.PatientHealthDataTableList.length) / ($scope.page_size));
                    });
                }, 100);
            }

        }

        // are Tabs clicked once    -- 0 not clicked , 1 - clicked
        $scope.LifestyleTab_Clicked = "0";
        $scope.VitalTab_Clicked = "0";
        $scope.LabTab_Clicked = "0";
        $scope.TabClickDataLoad = function (TabClicked) {
            var callFunction = true;
            $('.chartTabs').removeClass('charTabsNone');
            $scope.ParamGroup_Id = 0;
            if (TabClicked == "1" && $scope.LifestyleTab_Clicked == "0") {
                callFunction = false
                $scope.LSType_Id = 2;
                $scope.Type_Id = 2;
                $scope.ParamGroup_Id = 1;
            }
            else if (TabClicked == "2" && $scope.VitalTab_Clicked == "0") {
                callFunction = false;
                $scope.VitalsType_Id = 2;
                $scope.Type_Id = 2;
                $scope.ParamGroup_Id = 2;
                //$scope.getParameterList();
                $scope.VitalsParameterList_Data = $ff($scope.GroupParameterNameList, { Group_Id: $scope.ParamGroup_Id }, true);
                //console.log($scope.VitalsParameterList_Data);
            }
            else if (TabClicked == "2" && $scope.VitalTab_Clicked == "1") {
                callFunction = false;
                $scope.ParamGroup_Id = 2;
                //$scope.getParameterList();
                $scope.VitalsParameterList_Data = $ff($scope.GroupParameterNameList, { Group_Id: $scope.ParamGroup_Id }, true);
                //console.log($scope.VitalsParameterList_Data);
            }
            else if (TabClicked == "3" && $scope.LabTab_Clicked == "0") {
                callFunction = false;
                $scope.VitalsType_Id = 2;
                $scope.Type_Id = 2;
                $scope.ParamGroup_Id = 3;
                //$scope.getParameterList();

                $scope.VitalsParameterList_Data = $ff($scope.GroupParameterNameList, { Group_Id: $scope.ParamGroup_Id }, true);
            }
            else if (TabClicked == "3" && $scope.LabTab_Clicked == "1") {
                callFunction = false;
                $scope.ParamGroup_Id = 3;
                //$scope.getParameterList();

                $scope.VitalsParameterList_Data = $ff($scope.GroupParameterNameList, { Group_Id: $scope.ParamGroup_Id }, true);
            }

            if (callFunction == true) {
                if (TabClicked == "1") {
                    $scope.Type_Id = $scope.LSType_Id;
                }
                else if (TabClicked == "2") {
                    $scope.Type_Id = $scope.VitalsType_Id;
                }
                else if (TabClicked == "3") {
                    $scope.Type_Id = $scope.VitalsType_Id;
                }
            }
            if (callFunction == false) {
                $scope.GeneralFunction($scope.ParamGroup_Id, 1);
                if (TabClicked == "1") {
                    $scope.LifestyleTab_Clicked = "1";
                }
                else if (TabClicked == "2") {
                    $scope.VitalTab_Clicked = "1";
                }
                else if (TabClicked == "3") {
                    $scope.LabTab_Clicked = "1";
                }
            }
        }

        // $scope.getParameterList();
        setTimeout(function () {
        }, 1000);
        setTimeout(function () {
            $scope.$apply(function () {
                // default tab is LifeStyle, and load data for Lifestyle
                $scope.TabClickDataLoad("1");
            });
        }, 1000);

        $scope.PatientHealthRecordDetailsList = function (ParameterList, PatientHealthDataChartList, ParameterChild_List) {
            $scope.XAxisHealthDataSummary = [];
            $scope.HelathDataChartSummary = [];
            $scope.yName = [];
            $scope.SChartTitle = [];
            $scope.ParameterList = [];
            $scope.PatientHealthDataChartList = [];
            $scope.ParameterList = ParameterList;
            $scope.PatientHealthDataChartList = PatientHealthDataChartList;
            $scope.ParameterChild_List = ParameterChild_List;
            $scope.parameterItemsList = [];
            var chartxvalue;
            chartxvalue = 'Days';
            angular.forEach($scope.ParameterList, function (value2, index2) {
                $scope.HelathDataChartSummary = [];
                $scope.HelathDataChartSummaryCollection = [];
                $scope.XAxisHealthDataSummary = [];
                $scope.HelathDataChartSummaryArray = [];
                $scope.HelathDataChartSummaryArrayCollection = [];
                $scope.yName = [];
                $scope.SChartTitle = [];
                $scope.parameterItemsList = [];
                if (value2.hadChild == 1) {
                    $scope.parameterItemsList = $ff($scope.ParameterChild_List, { Parent_Id: value2.Id }, true);
                }
                else {
                    var paramItem = {
                        Id: value2.Id,
                        Parent_Id: 0,
                        Name: value2.Name,
                    };
                    $scope.parameterItemsList.push(paramItem)
                }
                $scope.HelathDataChartSummary = [];
                $scope.HelathDataChartSummaryArray = [];
                $scope.HelathDataChartSummaryCollection = [];
                $scope.XAxisHealthDataSummary = [];
                $scope.XAxisHealthDataSummaryCollection = [];

                $scope.HelathDataChartSummaryArrayCollection = [];
                var minval = 0;
                var maxval = 0;
                var normalRangeTitle = "";
                angular.forEach($scope.parameterItemsList, function (value4, index4) {
                    $scope.HelathDataChartSummary = [];
                    //$scope.XAxisHealthDataSummary = [];
                    angular.forEach($ff($scope.PatientHealthDataChartList, { ParameterId: value4.Id }, true), function (value1, index1) {

                        $scope.HelathDataChartSummary.push(
                            {
                                "name": value4.XAxis,
                                "y": value1.ParameterValue,
                                "ActivityDate": $filter('date')(value1.Activity_DateTime, "dd-MMM-yyyy hh:mm:ss a"),
                                "UOM": value1.UOM_Name,
                                "DeviceType": value1.DeviceType,
                                "DeviceNo": value1.DeviceNo,
                                "TypeName": value1.TypeName,
                                "Createdby_ShortName": value1.Createdby_ShortName,
                            }
                        )
                        $scope.XAxisHealthDataSummary.push(value1.XAxis);

                        if ((value1.ParameterValue < minval && value1.ParameterValue != 0) || minval == 0) {
                            minval = value1.ParameterValue;
                        }
                        if (value1.ParameterValue > maxval && value1.ParameterValue != 0) {
                            maxval = value1.ParameterValue;
                        }
                    })

                    if ($scope.parameterItemsList.length > 1) {
                        $scope.HelathDataChartSummaryCollection.push({
                            name: value4.ParamName,//$ff($scope.GroupParameterNameList, { ParameterId: value4.Id }, true)[0].ParameterName,
                            data: $scope.HelathDataChartSummary,
                        });
                        //lineWidth: 5,
                    }
                    else {
                        $scope.HelathDataChartSummaryCollection = [{
                            name: value2.ParamName,//$ff($scope.GroupParameterNameList, { ParameterId: value4.Id }, true)[0].ParameterName,
                            data: $scope.HelathDataChartSummary
                        }];
                        //lineWidth: 5,
                    }

                })
                // 
                var normalRangeBandMin = 0;
                var normalRangeBandMax = 0;
                $scope.Max_Possible = "";
                $scope.Min_Possible = "";
                $scope.yName = "";
                $scope.SChartTitle = "";
                var bandcolor = "rgba(68, 170, 213, 0.1)";
                var objfil = $ff($scope.GroupParameterNameList, { ParameterId: value2.Id }, true)
                if (objfil.length > 0) {
                    if (objfil[0].ParameterHas_Child == "1") {
                        var currentItem = 0;
                        angular.forEach($ff($scope.GroupParameterNameList, { ParameterParent_Id: value2.Id }, true), function (valchild, indexchild) {
                            if (currentItem != 0 && currentItem < valchild.Average) {
                                normalRangeBandMin = currentItem;
                                normalRangeBandMax = valchild.Average;
                            }
                            else if (currentItem != 0 && currentItem > valchild.Average) {
                                normalRangeBandMin = valchild.Average;
                                normalRangeBandMax = currentItem;
                            }
                            currentItem = valchild.Average;
                        });
                        normalRangeTitle = normalRangeBandMin + "-" + normalRangeBandMax;

                    }
                    else {
                        normalRangeBandMin = objfil[0].Average;
                        normalRangeBandMax = objfil[0].Average;
                        bandcolor = "#292a4d";
                        normalRangeTitle = normalRangeBandMin;
                    }
                }
                if (objfil.length > 0) {
                    $scope.yName = objfil[0].UOM_Name;
                    $scope.SChartTitle = objfil[0].ParameterName;

                    $scope.Max_Possible = objfil[0].Max_Possible;
                    $scope.Min_Possible = objfil[0].Min_Possible;
                }
                if ($scope.Max_Possible == 0) $scope.Max_Possible = maxval;
                if ($scope.Max_Possible == 0) $scope.Min_Possible = minval;

                var tickInterval = 1;
                if ($scope.Max_Possible < tickInterval)
                    tickInterval = $scope.Max_Possible;
                Highcharts.chart(value2.Name, {
                    chart:
                    {
                        zoomType: 'x'
                    },
                    title: {
                        text: $scope.SChartTitle
                    },
                    subtitle: {
                        text: 'Normal Value : ' + normalRangeTitle,
                        align: 'right'
                    },
                    credits: {
                        enabled: false
                    },
                    yAxis: {
                        allowDecimals: false,
                        tickInterval: tickInterval,
                        //startOnTick: true,
                        max: $scope.Max_Possible,
                        min: $scope.Min_Possible,
                        title: {
                            text: $scope.yName
                        },
                        labels: {
                            formatter: function () {
                                return '' + this.value;
                            }
                        },
                        plotBands: [{
                            color: bandcolor, // Color value
                            thickness: '50%',
                            from: normalRangeBandMin, // Start of the plot band
                            to: normalRangeBandMax// End of the plot band
                        }]
                    },
                    xAxis: {
                        type: 'datetime',
                        categories: $scope.XAxisHealthDataSummary,
                    },
                    tooltip: {
                        split: false,
                        //useHtml: true,
                        shared: false,
                        //pointFormat: '<b>{point.ActivityDate}</b> <b>{point.y} {point.UOM}</b>' 

                        formatter: function () {
                            return '<b>' + this.point.ActivityDate + '</b><br/>' +
                                '<b>' + this.point.y + '</b> ' + this.point.UOM + '<br/>' + this.point.DeviceType + ' ' + this.point.DeviceNo
                                + '<br>' + this.point.TypeName + ':' + this.point.Createdby_ShortName;
                        },

                    },
                    series: $scope.HelathDataChartSummaryCollection
                })

            })
        };

        /**
                     * In the chart render event, add icons on top of the circular shapes
                     */
        function renderIcons() {

            // Move icon
            if (!this.series[0].icon) {
                this.series[0].icon = this.renderer.path(['M', -8, 0, 'L', 8, 0, 'M', 0, -8, 'L', 8, 0, 0, 8])
                    .attr({
                        stroke: '#303030',
                        'stroke-linecap': 'round',
                        'stroke-linejoin': 'round',
                        'stroke-width': 2,
                        zIndex: 10
                    })
                    .add(this.series[2].group);
            }
            this.series[0].icon.translate(
                this.chartWidth / 2 - 10,
                this.plotHeight / 2 - this.series[0].points[0].shapeArgs.innerR -
                (this.series[0].points[0].shapeArgs.r - this.series[0].points[0].shapeArgs.innerR) / 2
            );

            // Exercise icon
            if (!this.series[1].icon) {
                this.series[1].icon = this.renderer.path(
                    ['M', -8, 0, 'L', 8, 0, 'M', 0, -8, 'L', 8, 0, 0, 8]
                )
                    .attr({
                        stroke: '#ffffff',
                        'stroke-linecap': 'round',
                        'stroke-linejoin': 'round',
                        'stroke-width': 2,
                        zIndex: 10
                    })
                    .add(this.series[2].group);
            }
            this.series[1].icon.translate(
                this.chartWidth / 2 - 10,
                this.plotHeight / 2 - this.series[1].points[0].shapeArgs.innerR -
                (this.series[1].points[0].shapeArgs.r - this.series[1].points[0].shapeArgs.innerR) / 2
            );

            // Stand icon
            if (!this.series[2].icon) {
                this.series[2].icon = this.renderer.path(['M', 0, 8, 'L', 0, -8, 'M', -8, 0, 'L', 0, -8, 8, 0])
                    .attr({
                        stroke: '#303030',
                        'stroke-linecap': 'round',
                        'stroke-linejoin': 'round',
                        'stroke-width': 2,
                        zIndex: 10
                    })
                    .add(this.series[2].group);
            }

            this.series[2].icon.translate(
                this.chartWidth / 2 - 10,
                this.plotHeight / 2 - this.series[2].points[0].shapeArgs.innerR -
                (this.series[2].points[0].shapeArgs.r - this.series[2].points[0].shapeArgs.innerR) / 2
            );
            /*sleep icon*/
            if (!this.series[3].icon) {
                this.series[3].icon = this.renderer.path(['M', 0, 8, 'L', 0, -8, 'M', -8, 0, 'L', 0, -8, 8, 0])
                    .attr({
                        stroke: '#303030',
                        'stroke-linecap': 'round',
                        'stroke-linejoin': 'round',
                        'stroke-width': 2,
                        zIndex: 10
                    })
                    .add(this.series[3].group);
            }

            this.series[3].icon.translate(
                this.chartWidth / 2 - 10,
                this.plotHeight / 2 - this.series[3].points[0].shapeArgs.innerR -
                (this.series[3].points[0].shapeArgs.r - this.series[3].points[0].shapeArgs.innerR) / 2
            );
        }

        $scope.GoalDataDateBasedDeatailsList = [];
        $scope.HealthDataDateBasedDeatailsList = [];

        $scope.StepCountDateBased = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/User/PatientDailyGoalData_List/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.GoalDataDateBasedDeatailsList = data.PatientHealthDataList;
                $scope.StepCount_List = $ff($scope.GoalDataDateBasedDeatailsList, {
                    ParameterId: 1
                }, true)
                $scope.CaloriesExpanded_List = $ff($scope.GoalDataDateBasedDeatailsList, {
                    ParameterId: 2
                }, true)
                $scope.DistanceCovered_List = $ff($scope.GoalDataDateBasedDeatailsList, {
                    ParameterId: 3
                }, true)
                $scope.Sleeping_List = $ff($scope.GoalDataDateBasedDeatailsList, {
                    ParameterId: 4
                }, true)
                $scope.ActualStepCountList = [];
                $scope.ActualStepCountRadius = [];
                $scope.ActualDistanceCoveredList = [];
                $scope.ActualDistanceCoveredRadius = [];
                $scope.ActualCaloriesExpandedList = [];
                $scope.ActualCaloriesExpandedRadius = [];
                $scope.ActualHeartRateList = [];
                $scope.ActualHeartRateRadius = [];
                $scope.ActualSleepingList = [];
                $scope.ActualSleepingRadius = [];
                var radiusMaster = 80;
                var radius = radiusMaster;
                var colorIndex = 1;
                var GoalStepCounts;
                var GoalCaloriesExpended;
                var GoalDistanceCovered;
                var GoalHeartRate;
                var GoalSleeping;
                var incValue = 40;
                //angular.forEach($scope.GoalDataDateBasedDeatailsList, function (value, index) {
                angular.forEach($scope.StepCount_List, function (value, index) {
                    var PercentageStepCount = Math.round((value.ParameterValue / value.ParameterTarget) * 100)

                    var objStepCount = {
                        name: 'Steps',
                        data: [{
                            color: "#fd950c",
                            radius: radius + incValue + '%',
                            innerRadius: radius + 1 + '%',
                            y: PercentageStepCount,     // convert to percentage for Target
                            yPercent: value.ParameterValue,
                        }]
                    }
                    $scope.ActualStepCountList.push(objStepCount);


                    var objStepCountRadius = { // Track for Stand
                        outerRadius: radius + incValue + '%',
                        innerRadius: radius + 1 + '%',
                        backgroundColor: Highcharts.color("#333")
                            .setOpacity(0.3)
                            .get(),
                        borderWidth: 0
                    }
                    $scope.ActualStepCountRadius.push(objStepCountRadius);
                    GoalStepCounts = value.ParameterTarget;
                    radius = radius + incValue;

                    colorIndex = colorIndex + 1;
                    if (colorIndex == 4)
                        colorIndex = 1;

                })
                radius = radiusMaster;
                angular.forEach($scope.CaloriesExpanded_List, function (value, index) {
                    var PercentageCaloriesExpanded = Math.round((value.ParameterValue / value.ParameterTarget) * 100)

                    var objCaloriesExpanded = {
                        name: 'Calories',
                        data: [{
                            color: "#4aa64e",
                            radius: radius + incValue + '%',
                            innerRadius: radius + 1 + '%',
                            y: PercentageCaloriesExpanded,     // convert to percentage for Target
                            yPercent: value.ParameterValue,
                        }]
                    }
                    $scope.ActualCaloriesExpandedList.push(objCaloriesExpanded);


                    var objCaloriesExpandedRadius = { // Track for Stand
                        outerRadius: radius + incValue + '%',
                        innerRadius: radius + 1 + '%',
                        backgroundColor: Highcharts.color("#333")
                            .setOpacity(0.3)
                            .get(),
                        borderWidth: 0
                    }
                    $scope.ActualCaloriesExpandedRadius.push(objCaloriesExpandedRadius);
                    GoalCaloriesExpanded = value.ParameterTarget;
                    radius = radius + incValue;

                    colorIndex = colorIndex + 1;
                    if (colorIndex == 4)
                        colorIndex = 1;

                })
                radius = radiusMaster;
                angular.forEach($scope.DistanceCovered_List, function (value, index) {
                    var PercentageDistanceCovered = Math.round((value.ParameterValue / value.ParameterTarget) * 100)

                    var objDistanceCovered = {
                        name: 'Distance',
                        data: [{
                            color: "#e63d39",
                            radius: radius + incValue + '%',
                            innerRadius: radius + 1 + '%',
                            y: PercentageDistanceCovered,     // convert to percentage for Target
                            yPercent: value.ParameterValue,
                        }]
                    }
                    $scope.ActualDistanceCoveredList.push(objDistanceCovered);

                    var objDistanceCoveredRadius = { // Track for Stand
                        outerRadius: radius + incValue + '%',
                        innerRadius: radius + 1 + '%',
                        backgroundColor: Highcharts.color("#333")
                            .setOpacity(0.3)
                            .get(),
                        borderWidth: 0
                    }
                    $scope.ActualDistanceCoveredRadius.push(objDistanceCoveredRadius);
                    GoalDistanceCovered = value.ParameterTarget;
                    radius = radius + incValue;

                    colorIndex = colorIndex + 1;
                    if (colorIndex == 4)
                        colorIndex = 1;

                })
                radius = radiusMaster;
                angular.forEach($scope.Sleeping_List, function (value, index) {
                    var PercentageSleeping = Math.round((value.ParameterValue / value.ParameterTarget) * 100)

                    var objSleeping = {
                        name: 'Sleeping',
                        data: [{
                            color: "#04afc4",
                            radius: radius + incValue + '%',
                            innerRadius: radius + 1 + '%',
                            y: PercentageSleeping,     // convert to percentage for Target
                            yPercent: value.ParameterValue,
                        }]
                    }
                    $scope.ActualSleepingList.push(objSleeping);


                    var objSleepingRadius = { // Track for Stand
                        outerRadius: radius + incValue + '%',
                        innerRadius: radius + 1 + '%',
                        backgroundColor: Highcharts.color("#333")
                            .setOpacity(0.3)
                            .get(),
                        borderWidth: 0
                    }
                    $scope.ActualSleepingRadius.push(objSleepingRadius);
                    GoalSleeping = value.ParameterTarget;
                    radius = radius + incValue;

                    colorIndex = colorIndex + 1;
                    if (colorIndex == 4)
                        colorIndex = 1;
                })



                $('#DemoChart').highcharts({
                    chart: {
                        type: 'solidgauge',
                        height: '110%',
                        events: {
                            render: renderIcons
                        }
                    },
                    title: {
                        text: 'Activity',
                        style: {
                            fontSize: '24px'
                        }
                    },

                    tooltip: {
                        borderWidth: 0,
                        backgroundColor: 'none',
                        shadow: false,
                        style: {
                            fontSize: '16px'
                        },
                        valueSuffix: '%',
                        pointFormat: '{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}</span>',
                        positioner: function (labelWidth) {
                            return {
                                x: (this.chart.chartWidth - labelWidth) / 2,
                                y: (this.chart.plotHeight / 2) + 15
                            };
                        }
                    },

                    pane: {
                        startAngle: 0,
                        endAngle: 360,
                        background: [{ // Track for Move --steps
                            outerRadius: '112%',
                            innerRadius: '88%',
                            backgroundColor: Highcharts.color(Highcharts.getOptions().colors[0])
                                .setOpacity(0.3)
                                .get(),
                            borderWidth: 0
                        }, { // Track for Exercise--calories
                            outerRadius: '87%',
                            innerRadius: '63%',
                            backgroundColor: Highcharts.color(Highcharts.getOptions().colors[1])
                                .setOpacity(0.3)
                                .get(),
                            borderWidth: 0
                        }, { // Track for Stand -- workout
                            outerRadius: '62%',
                            innerRadius: '38%',
                            backgroundColor: Highcharts.color(Highcharts.getOptions().colors[2])
                                .setOpacity(0.3)
                                .get(),
                            borderWidth: 0
                        },
                        {// Track for sleep
                            outerRadius: '37%',
                            innerRadius: '13%',
                            backgroundColor: Highcharts.color(Highcharts.getOptions().colors[3])
                                .setOpacity(0.3)
                                .get(),
                            borderWidth: 0
                        }]
                    },

                    yAxis: {
                        min: 0,
                        max: 100,
                        lineWidth: 0,
                        tickPositions: []
                    },

                    plotOptions: {
                        solidgauge: {
                            dataLabels: {
                                enabled: false
                            },
                            linecap: 'round',
                            stickyTracking: false,
                            rounded: true
                        }
                    },

                    series: [{
                        name: 'Steps',
                        data: [{
                            color: Highcharts.getOptions().colors[0],
                            radius: '112%',
                            innerRadius: '88%',
                            y: $scope.ActualStepCountList[0]["data"][0].y
                        }]
                    },
                    {
                        name: 'Calories',
                        data: [{
                            color: Highcharts.getOptions().colors[1],
                            radius: '87%',
                            innerRadius: '63%',
                            y: $scope.ActualCaloriesExpandedList[0]["data"][0].y
                        }]
                    }, {
                        name: 'Workout',
                        data: [{
                            color: Highcharts.getOptions().colors[2],
                            radius: '62%',
                            innerRadius: '38%',
                            y: $scope.ActualDistanceCoveredList[0]["data"][0].y
                        }]
                    },
                    {
                        name: 'Sleep',
                        data: [{
                            color: Highcharts.getOptions().colors[3],
                            radius: '37%',
                            innerRadius: '13%',
                            y: $scope.ActualSleepingList[0]["data"][0].y
                        }]
                    }]
                });
                $('#Step_Count').highcharts({
                    chart: {
                        type: 'solidgauge',
                        height: "110%"
                    },

                    title: {
                        //text: 'StepCount:' + GoalStepCounts,
                        text: "",
                        style: {
                            fontSize: '12px'
                        }
                    },
                    credits: {
                        enabled: false
                    },

                    tooltip: {
                        enabled: false,
                        borderWidth: 0,
                        backgroundColor: 'none',
                        shadow: false,
                        style: {
                            fontSize: '8px'
                        },
                        //valueSuffix: '%',
                        //pointFormat: '{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}</span>',
                        pointFormat: '<br><span style="font-size:2em; color: blue; font-weight: bold">{point.yPercent}</span>',
                        positioner: function (labelWidth) {
                            return {
                                x: (this.chart.chartWidth - labelWidth) / 2,
                                y: (this.chart.plotHeight / 2) + 15 + 16
                            };
                        }
                    },
                    pane: {
                        startAngle: 0,
                        endAngle: 360,
                        background: $scope.ActualStepCountRadius
                    },
                    yAxis: {
                        min: 0,
                        max: 100,
                        lineWidth: 0,
                        tickPositions: [],
                    },
                    plotOptions: {
                        solidgauge: {
                            dataLabels: {
                                borderWidth: 0,
                                enabled: true,
                                useHTML: true,
                                formatter: function () {
                                    return (`<div class='datalabel'><p class="datalabelh"><i class="fas fa-shoe-prints"></i></p>
                                <p class="datalabeld">${this.point.yPercent}</p><p class="datalabelt">${GoalStepCounts}</p></div>`);
                                },
                            },


                        }
                    },
                    series: $scope.ActualStepCountList

                })
                //${45}/${GoalStepCounts}
                $('#Calories_Expended').highcharts({
                    chart: {
                        type: 'solidgauge',
                        height: '110%',
                    },
                    credits: {
                        enabled: false
                    },
                    title: {
                        //text: 'Calories:' + GoalCaloriesExpanded,
                        text: "",
                        style: {
                            fontSize: '12px'
                        }
                    },

                    tooltip: {
                        enabled: false,
                        borderWidth: 0,
                        backgroundColor: 'none',
                        shadow: false,
                        style: {
                            fontSize: '8px'
                        },
                        //valueSuffix: '%',
                        //pointFormat: '{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}</span>',
                        pointFormat: '<br><span style="font-size:2em; color: blue; font-weight: bold">{point.yPercent}</span>',
                        positioner: function (labelWidth) {
                            return {
                                x: (this.chart.chartWidth - labelWidth) / 2,
                                y: (this.chart.plotHeight / 2) + 15 + 16
                            };
                        }
                    },
                    pane: {
                        startAngle: 0,
                        endAngle: 360,
                        background: $scope.ActualCaloriesExpandedRadius
                    },
                    yAxis: {
                        min: 0,
                        max: 100,
                        lineWidth: 0,
                        tickPositions: [],
                    },
                    plotOptions: {
                        solidgauge: {
                            dataLabels: {
                                borderWidth: 0,
                                enabled: true,
                                useHTML: true,
                                formatter: function () {

                                    return (`<div class='datalabel'><p class="datalabelh_rot"><i class="fas fa-dumbbell"></i></p>
                                <p class="datalabeld">${this.point.yPercent}</p><p class="datalabelt">${GoalCaloriesExpanded}</p></div>`);
                                },
                            },


                        }
                    },
                    series:
                        $scope.ActualCaloriesExpandedList
                })

                $('#Distance_Covered').highcharts({
                    chart: {
                        type: 'solidgauge',
                        height: '110%',
                    },
                    title: {
                        //text: 'StepCount:' + GoalStepCounts,
                        text: "",
                        style: {
                            fontSize: '12px'
                        }
                    },
                    credits: {
                        enabled: false
                    },

                    tooltip: {
                        enabled: false,
                        borderWidth: 0,
                        backgroundColor: 'none',
                        shadow: false,
                        style: {
                            fontSize: '8px'
                        },
                        //valueSuffix: '%',
                        //pointFormat: '{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}</span>',
                        pointFormat: '<br><span style="font-size:2em; color: blue; font-weight: bold">{point.yPercent}</span>',
                        positioner: function (labelWidth) {
                            return {
                                x: (this.chart.chartWidth - labelWidth) / 2,
                                y: (this.chart.plotHeight / 2) + 15 + 16
                            };
                        }
                    },
                    pane: {
                        startAngle: 0,
                        endAngle: 360,
                        background: $scope.ActualDistanceCoveredRadius
                    },
                    yAxis: {
                        min: 0,
                        max: 100,
                        lineWidth: 0,
                        tickPositions: [],
                    },
                    plotOptions: {
                        solidgauge: {
                            dataLabels: {
                                borderWidth: 0,
                                enabled: true,
                                useHTML: true,
                                formatter: function () {

                                    return (`<div class='datalabel'><p class="datalabelh_rot"><i class="fas fa-burn"></i></p>
                                <p class="datalabeld">${this.point.yPercent}</p><p class="datalabelt">${GoalDistanceCovered}</p></div>`);
                                },
                            },


                        }
                    },
                    series:
                        $scope.ActualDistanceCoveredList
                })
                $('#SleepingChart').highcharts({
                    chart: {
                        type: 'solidgauge',
                        height: '110%',
                    },
                    title: {
                        //text: 'StepCount:' + GoalStepCounts,
                        text: "",
                        style: {
                            fontSize: '12px'
                        }
                    },
                    credits: {
                        enabled: false
                    },

                    tooltip: {
                        enabled: false,
                        borderWidth: 0,
                        backgroundColor: 'none',
                        shadow: false,
                        style: {
                            fontSize: '8px'
                        },
                        //valueSuffix: '%',
                        //pointFormat: '{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}</span>',GoalDistanceCovered
                        pointFormat: '<br><span style="font-size:2em; color: blue; font-weight: bold">{point.yPercent}</span>',
                        positioner: function (labelWidth) {
                            return {
                                x: (this.chart.chartWidth - labelWidth) / 2,
                                y: (this.chart.plotHeight / 2) + 15 + 16
                            };
                        }
                    },
                    pane: {
                        startAngle: 0,
                        endAngle: 360,
                        background: $scope.ActualSleepingRadius
                    },
                    yAxis: {
                        min: 0,
                        max: 100,
                        lineWidth: 0,
                        tickPositions: [],
                    },
                    plotOptions: {
                        solidgauge: {
                            dataLabels: {
                                borderWidth: 0,
                                enabled: true,
                                useHTML: true,
                                formatter: function () {

                                    return (`<div class='datalabel'><p class="datalabelh_rot"><i class="fas fa-bed"></i></p>
                                <p class="datalabeld">${this.point.yPercent}</p><p class="datalabelt">${GoalSleeping}</p></div>`);
                                },
                            },


                        }
                    },
                    series:
                        $scope.ActualSleepingList
                })

            })
        };

        $scope.PatientListData = [];
        $scope.PatientData = [];
        $scope.PatientAppointmentCount = 0;
        $scope.appointmentDoctorId = 0;
        $scope.getMyAppointments = function () {
            $http.get(baseUrl + '/api/User/PatientAppointmentList/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (Patientdata) {
                $scope.PatientListData = Patientdata.PatientAppointmentList;
                if ($scope.PatientListData != null) {
                    $scope.PatientAppointmentCount = $scope.PatientListData.length;
                }
                // to show first appointment
                if ($scope.PatientAppointmentCount > 0) {
                    $scope.PatientData = $scope.PatientListData[0];
                    $scope.DoctorName = $scope.PatientData.DoctorName;
                    $scope.appointmentDoctorId = $scope.PatientData.Doctor_Id;
                    $scope.AppointmentTime = $scope.PatientData.Appointment_FromTime;
                    $scope.Appointmentdate = DateFormatEdit(moment($scope.PatientData.Appointment_Date).format('DD-MMM-YYYY'));
                    //$scope.AppointmentDate = DateFormatEdit(Declare);
                    $scope.PhotoBlob = $scope.PatientData.PhotoBlob;
                    $scope.ViewGenderName = $scope.PatientData.ViewGenderName;
                    $window.localStorage['selectedDoctor'] = $scope.appointmentDoctorId;
                    //  $scope.TimeDifference = $scope.PatientData.TimeDifference;
                    if ($scope.AppointmentTime != null) {
                        var startdate = moment(new Date($scope.AppointmentTime));
                        var enddate = moment(new Date());
                        var diff = Math.abs(enddate - startdate);
                        var days = Math.floor(diff / (60 * 60 * 24 * 1000));
                        var hours = Math.floor(diff / (60 * 60 * 1000)) - (days * 24);
                        var minutes = Math.floor(diff / (60 * 1000)) - ((days * 24 * 60) + (hours * 60));
                        var seconds = Math.floor(diff / 1000) - ((days * 24 * 60 * 60) + (hours * 60 * 60) + (minutes * 60));

                        var timeDiffString = "";
                        if (days != 0) {
                            timeDiffString = timeDiffString + days + ' day ';
                        }
                        else if (hours != 0) {
                            timeDiffString = timeDiffString + hours + ' hr ';
                        }
                        else if (minutes != 0) {
                            timeDiffString = timeDiffString + minutes + ' min ';
                        }
                        else if (seconds != 0) {
                            timeDiffString = timeDiffString + seconds + ' sec';
                        }
                        $scope.TimeDifference = timeDiffString;
                    }
                    $scope.Appointment_Id = $scope.PatientData.Id;
                    if ($scope.UserTypeId == 4 || $scope.UserTypeId == 7) {
                        $scope.chattingWith = $scope.DoctorName;
                    }
                }
            });
        }
        // call my appointments only in patient login
        if ($routeParams.PageParameter == "1") {
            $scope.getMyAppointments();
        }


        $scope.index = 0;
        $scope.Next_PatientAppointment = function (Type) {
            if (Type == 1) {
                $scope.index = $scope.index + 1;
                $scope.disable_Next = ($scope.PatientAppointmentCount) - 1;
            }
            if (Type == 2) {
                $scope.index = $scope.index - 1;
            }
            $scope.PatientData = $scope.PatientListData[$scope.index];
            if ($scope.PatientData !== undefined && $scope.PatientData !== null) {
                $scope.appointmentDoctorId = $scope.PatientData.Doctor_Id;
                $scope.DoctorName = $scope.PatientData.DoctorName;
                $scope.AppointmentTime = $scope.PatientData.Appointment_FromTime;
                $scope.Appointmentdate = DateFormatEdit(moment($scope.PatientData.Appointment_Date).format('DD-MMM-YYYY'));
                $window.localStorage['selectedDoctor'] = $scope.appointmentDoctorId;
                //$scope.TimeDifference = $scope.PatientData.TimeDifference;

                if ($scope.AppointmentTime != null) {
                    var startdate = moment(new Date($scope.AppointmentTime));
                    var enddate = moment(new Date());
                    var diff = Math.abs(enddate - startdate);
                    var days = Math.floor(diff / (60 * 60 * 24 * 1000));
                    var hours = Math.floor(diff / (60 * 60 * 1000)) - (days * 24);
                    var minutes = Math.floor(diff / (60 * 1000)) - ((days * 24 * 60) + (hours * 60));
                    var seconds = Math.floor(diff / 1000) - ((days * 24 * 60 * 60) + (hours * 60 * 60) + (minutes * 60));

                    var timeDiffString = "";
                    if (days != 0) {
                        timeDiffString = timeDiffString + days + ' day ';
                    }
                    else if (hours != 0) {
                        timeDiffString = timeDiffString + hours + ' hr ';
                    }
                    else if (minutes != 0) {
                        timeDiffString = timeDiffString + minutes + ' min ';
                    }
                    else if (seconds != 0) {
                        timeDiffString = timeDiffString + seconds + ' sec';
                    }
                    $scope.TimeDifference = timeDiffString;
                }
                $scope.PhotoBlob = $scope.PatientData.PhotoBlob;
                $scope.ViewGenderName = $scope.PatientData.ViewGenderName;
                $scope.Appointment_Id = $scope.PatientData.Id;
            }
            if ($scope.UserTypeId == 4 || $scope.UserTypeId == 7) {
                $scope.chattingWith = $scope.DoctorName;
            }
        }

        $scope.AddVitalsPopUp = function () {
            angular.element('#PatientVitalsCreateModal').modal('show');
        }

        $scope.smsResponse = [];
        $scope.smsUrl = "";
        $scope.smsUserName = "";
        $scope.smsApiId = "";
        $scope.smsDestination = "";
        $scope.smsSource = "";
        $scope.smsText = "";
        $scope.SendSMS = function () {
            $scope.smsUrl = "https://txt.speroinfotech.ae/API/SendSMS?";
            $scope.smsUserName = "MyHealth";
            $scope.smsApiId = "Kv2n09u8";
            //$scope.smsDestination = "971552433557"; //Mobile Number
            $scope.smsDestination = $window.localStorage['User_Mobile_No']; //Mobile Number
            $scope.smsSource = "Medspero"; // AD-Medspero // Header Text
            $scope.smsText = "Test";
            $http.get($scope.smsUrl + 'username=' + $scope.smsUserName + '&apiId=' + $scope.smsApiId + '&json=True&destination=' + $scope.smsDestination + '&source=' + $scope.smsSource + '&text=' + $scope.smsText).success(function (data) {
                $scope.smsResponse = data;
            });
        }

        $scope.ShowAppointmentBookingPopUp = function () {
            //document.getElementById("main-box").style = "";
            //document.getElementById("box").style = "display:none";
            //$scope.SendSMS();
            $scope.showMainBox = true;
            $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingView/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $window.localStorage['Login_Session_Id']).success(function (data) {
                //$scope.NewAppointment = data.NewAppointmentDuration;
                if (data == null || data.length == 0 || data.DefautTimeZone == "" || data.DefautTimeZone == 0) {
                    //alert('Please Check Organisation Settings!');
                    toastr.info("Please Check Organisation Settings!", "info");
                    angular.element('#BookAppointmentModal').modal('hide');
                    document.getElementById("BookNew").disabled = true;
                    document.getElementById("BookNew").title = 'Set Organisation Settings TimeZone Value!';
                }
                else {
                    angular.element('#BookAppointmentModal').modal('show');
                }
                $scope.AppoimDate = new Date(DatetimepickermaxDate);
            });
        }
        $scope.ShowStripePopup = function () {
            angular.element('#StripePayOptions').modal('show');
        }

        // Add row concept for Patient Vital Parameters
        $scope.AddVitalParameters = [{
            'Id': 0,
            'ParameterId': 0,
            'Units_ID': 0,
            'UOM_Name': '',
            'ParameterValue': '',
            'IsActive': 1
        }];

        /*This is a Addrow function to add new row and save Family Health Problem details*/
        $scope.AddParameterVitals_Insert = function () {
            if ($scope.AddVitalParameters.length > 0) {
                var obj = {
                    'Id': 0,
                    'ParameterId': 0,
                    'Units_ID': 0,
                    'UOM_Name': '',
                    'ParameterValue': '',
                    'IsActive': 1
                }
                $scope.AddVitalParameters.push(obj);
            }
            else {
                $scope.AddVitalParameters = [{
                    'Id': 0,
                    'ParameterId': 0,
                    'Units_ID': 0,
                    'UOM_Name': '',
                    'ParameterValue': '',
                    'IsActive': 1
                }];
            }
        };

        $scope.VitalParameterDelete = function (itemIndex) {
            var del = confirm("Do you like to delete the selected Parameter?");
            if (del == true) {
                $scope.AddVitalParameters.splice(itemIndex, 1);
                if ($scope.AddVitalParameters.length == 0) {
                    $scope.AddVitalParameters = [{
                        'Id': 0,
                        'ParameterId': 0,
                        'Units_ID': 0,
                        'UOM_Name': '',
                        'ParameterValue': '',
                        'IsActive': 1
                    }];
                }
            }
        };

        $scope.ParameterInsert_UpdateValidations = function () {
            var TSDuplicate = 0;
            var varlidationCheck = 0;
            var paramExist = 0;
            var DuplicateParam = '';
            //angular.forEach($scope.VitalsParameterList_Data, function (value, index) {
            angular.forEach($scope.AddVitalParameters, function (value1, index1) {
                if (value1.ParameterId != '' || value1.ParameterId > 0) {
                    paramExist = 1;
                }
                if (value1.Units_Id != '' || value1.Units_Id > 0) {
                    unitIdExist = 1;
                }
                var checkobj = $ff($scope.GroupParameterNameList, { ParameterId: value1.ParameterId }, true)[0]
                if (checkobj != null) {
                    angular.forEach($scope.AddVitalParameters, function (value2, index2) {
                        if (index1 > index2 && value1.ParameterId == value2.ParameterId) {
                            TSDuplicate = 1;
                            if (DuplicateParam != '')
                                DuplicateParam = DuplicateParam + ',';
                            DuplicateParam = DuplicateParam + checkobj.ParameterName;
                        };
                    });
                    if (value1.ParameterValue == '' || value1.ParameterValue <= 0) {
                        varlidationCheck = 1;
                        //alert("Please enter value for " + checkobj.ParameterName);
                        toastr.warning("Please enter value for" + checkobj.ParameterName, "warning");
                        return false;
                    }
                    else if (checkobj.Min_Possible > parseFloat(value1.ParameterValue) && checkobj.Min_Possible > 0) {
                        varlidationCheck = 1;
                        //alert(checkobj.ParameterName + " value cannot be less than " + checkobj.Min_Possible);
                        toastr.warning(checkobj.ParameterName + " value cannot be less than " + checkobj.Min_Possible, "warning");
                        return false;
                    }
                    else if (checkobj.Max_Possible < parseFloat(value1.ParameterValue) && checkobj.Max_Possible > 0) {
                        varlidationCheck = 1;
                        //alert(checkobj.ParameterName + " value cannot be greater than " + checkobj.Max_Possible);
                        toastr.warning(checkobj.ParameterName + " value cannot be greater than " + checkobj.Max_Possible, "warning");
                        return false;
                    }
                }
            });
            if (TSDuplicate == 1) {
                //alert('Parameters ' + DuplicateParam + 'already exist, cannot be Duplicated');
                toastr.error('Parameters ' + DuplicateParam + 'already exist, cannot be Duplicated', "warning");
                return false;
            }
            else if (varlidationCheck == 1) {
                return false;
            }
            else if (paramExist == 0) {
                //alert('Please enter Parameter details to Save');
                toastr.warning("Please enter Parameter details to Save", "warning");
                return false;
            }
            else if (unitIdExist == 0) {
                //alert('Please enter Unit details to Save');
                toastr.warning("Please enter Unit details to Save", "warning");
                return false;
            }
            return true;

        };
        $scope.ParameterInsert_Update = function (itemIndex) {
            if ($scope.ParameterInsert_UpdateValidations() == true) {
                $("#chatLoaderPV").show();
                var filteredObj = $ff($scope.AddVitalParameters, function (value) {
                    return value.ParameterId != '';
                });
                var obj = {
                    Id: $scope.Id,
                    ActivityDate: $filter('date')(new Date(), 'dd-MMM-yyyy HH:mm:ss'),
                    Created_By: $window.localStorage['UserId'],
                    Patient_Id: $scope.SelectedPatientId,
                    DeviceType: 'MANUAL',
                    Device_No: 'MANUAL',
                    PatientHealthDataModel: filteredObj,
                    Modified_By: $window.localStorage['UserId'],
                }
                $('#btnsave').attr("disabled", true);
                $http.post(baseUrl + '/api/User/PatientHealthDataBulk_Insert_Update/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    var alemsg = "";
                    if ($scope.currentTab == '2') {
                        alemsg = "Vitals data inserted Successfully"
                        $('#btnsave').attr("disabled", false);
                    }
                    else {
                        alemsg = "Lab data inserted Successfully"
                        $('#btnsave').attr("disabled", false);
                    }
                    if (data == '1') {
                        //alert(alemsg);
                        toastr.success(alemsg, "success");
                        $scope.ParameterCancelPopup();
                        $scope.HistoryDetails($scope.currentTab);      // vitals grid view refresh

                    }
                    else {
                        //alert("Error in creating Vitals!");
                        toastr.warning("Error in creating Vitals!", "warning");
                    }
                });
            }

        };
        $scope.ParameterClickEdit = function (rowData, rowIndex) {
            var checkobj = $ff($scope.GroupParameterNameList, { ParameterId: rowData.ParameterId }, true)[0];
            if (checkobj.IsFormulaParam == "1") {
                //alert(checkobj.ParameterName + " cannot be edited");
                toastr.warning(checkobj.ParameterName + " cannot be edited", "warning");
            }
            else {
                if ($scope.IsEditableCheck(rowData.Activity_Date) == false) {
                    //alert("Parameter value cannot be edited");
                    toastr.info("Parameter value cannot be edited", "info");
                }
                else {
                    $scope.EditVitalRow_EditFlag[rowIndex] = 2;
                }
            }
        }
        $scope.ParameterEdit_Update = function (rowData, rowIndex) {
            if (rowData.newParameterValue == '') {
                //alert("Please enter value");
                toastr.warning("Please enter value", "warning");
                return false;
            }
            var checkobj = $ff($scope.GroupParameterNameList, { ParameterId: rowData.ParameterId }, true)[0];
            if (checkobj.Min_Possible > parseFloat(rowData.newParameterValue) && checkobj.Min_Possible > 0) {
                //alert(checkobj.ParameterName + " value cannot be less than " + checkobj.Min_Possible);
                toastr.warning(checkobj.ParameterName + " value cannot be less than " + checkobj.Min_Possible, "warning");
                return false;
            }
            else if (checkobj.Max_Possible < parseFloat(rowData.newParameterValue) && checkobj.Max_Possible > 0) {
                //alert(checkobj.ParameterName + " value cannot be greater than " + checkobj.Max_Possible);
                toastr.warning(checkobj.ParameterName + " value cannot be greater than " + checkobj.Max_Possible, "warning");
                return false;
            }


            if (rowData.Id == 0) {
                rowData.Modified_By == null;
            }
            else {
                rowData.Modified_By = $window.localStorage['UserId'];
            }
            rowData.ParameterValue = rowData.newParameterValue;
            $("#chatLoaderPV").show();
            $http.post(baseUrl + '/api/User/PatientHealthData_Insert_Update/?Login_Session_Id=' + $scope.LoginSessionId, rowData).success(function (data) {
                $("#chatLoaderPV").hide();
                if (data.ReturnFlag == "1") {
                    $scope.EditVitalRow_EditFlag[rowIndex] = 1;
                    //alert("Vitals data updated Successfully");
                    toastr.success("Vitals data updated Successfully", "success");
                }
                else {
                    $("#chatLoaderPV").hide();
                    //alert("Error in creating Vitals!");
                    toastr.warning("Error in creating Vitals!", "warning");
                }

            });

        };
        $scope.ChartActive = function () {
            $scope.VitalChart = 1;
        }
        $scope.EditVitalRow_EditFlag = [];
        $scope.HistoryDetails = function (current_Tab) {
            $scope.TabClicked = current_Tab;
            if ($scope.VitalChart == '1') {
                var ChartORData = '1';
            } else if ($scope.VitalChart == '2') {
                var ChartORData = 2;
            }
            //var ChartORData = 2;
            $scope.AllDetailsList($scope.TabClicked, ChartORData);
        };

        $scope.VitalParametersDetailsHistory = function () {
            angular.element('#PatientVitalsParameterHistoryCreateModal').modal('show');
        }


        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.CancelEdit = function (row, rownum) {
            var del = confirm("Do you like to cancel the Edit?");
            if (del == true) {
                $scope.EditVitalRow_EditFlag[rownum] = 1;
                row.newParameterValue = row.ParameterValue;
            }
        };
        $scope.DeleteParameters = function (comId, paramId) {
            var checkobj = $ff($scope.GroupParameterNameList, { ParameterId: paramId }, true)[0]
            if (checkobj.IsFormulaParam == "1") {
                //alert(checkobj.ParameterName + " cannot be deactivated");
                toastr.warning(checkobj.ParameterName + " cannot be deactivated", "warning");
            }
            else {
                $scope.Id = comId;
                $scope.Parameter_Delete();
            }
        };
        $scope.Parameter_Delete = function () {
            var del = confirm("Do you like to deactivate the selected Parameter?");
            if (del == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }
                $http.post(baseUrl + '/api/User/ParametersDetails_Delete/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.error(data.Message, "warning");
                    }
                    $scope.HistoryDetails();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Parameter" + data;
                });

            };
        };

        /*'Active' the Institution*/
        $scope.ReInsertParameters = function (comId) {
            $scope.Id = comId;
            $scope.ReInsertParametersDetails();

        };

        /* 
        Calling the api method to inactived the details of the company 
        for the  company Id,
        and redirected to the list page.
        */
        $scope.ReInsertParametersDetails = function () {
            var Ins = confirm("Do you like to activate the selected Parameter?");
            if (Ins == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }
                $http.post(baseUrl + '/api/User/ParametersDetails_Active/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.HistoryDetails();
                }).error(function (data) {
                    $scope.error = "An error has occurred while ReInsertParameterDetails" + data;
                });
            };
        }

        $scope.EditVitalParameters = function (CatId, activeFlag) {
            if (activeFlag == 1) {
                // $scope.InstitutionClear();
                $scope.Id = CatId;
                //$scope.VitalParametersView();

            }
            else {
                //alert("Inactive record cannot be edited");
                toastr.info("Inactive record cannot be edited", "info");
            }
        };

        $scope.ParameterCancelPopup = function () {
            angular.element('#PatientVitalsCreateModal').modal('hide');
            $scope.ClearParameterPopup();
        }
        $scope.ClearParameterPopup = function () {
            $scope.AddVitalParameters = [{
                'Id': 0,
                'ParameterId': 0,
                'UOM_Name': '',
                'ParameterValue': '',
                'IsActive': 1
            }];
            $scope.UOMName = "";
        }
        $scope.PatientTo30days_CancelPopup = function () {
            //For Today Appointment Page	
            $location.path("/Thirtydays_appointments/");
        }

        $scope.CancelAppointmentModal = function (AppointmentId) {
            var msg = confirm("Do you like to Cancel the Patient Appointment?");
            if (msg == true) {
                $scope.Cancelled_Remarks = "";
                $scope.Appointment_Id = AppointmentId;
                angular.element('#PatientAppointmentModal').modal('show');
                $scope.ReasonTypeDropList();
            }
        }
        $scope.ReasonTypeDropList = function () {
            // if($window.localStorage['UserTypeId']==2 || $window.localStorage['UserTypeId']==4  ||$window.localStorage['UserTypeId']==7 ){

            $http.get(baseUrl + '/api/PatientAppointments/AppointmentReasonType_List/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                $scope.AppointmentReasonTypeListTemp = [];
                $scope.AppointmentReasonTypeListTemp = data;
                var obj = { "ReasonTypeId": 0, "ReasonType": "Select", "IsActive": 1 };
                $scope.AppointmentReasonTypeListTemp.splice(0, 0, obj);
                $scope.AppointmentReasonTypeList = angular.copy($scope.AppointmentReasonTypeListTemp);
            });
            //  }
        }
        $scope.Cancel_CancelledAppointment = function (AppointmentId) {
            angular.element('#PatientAppointmentModal').modal('hide');
            $scope.Cancelled_Remarks = "";
            $scope.ReasonTypeId = '0';
        }

        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.Update_CancelledAppointment = function (Appointment_Id) {
            if (typeof ($scope.ReasonTypeId) == "undefined" || $scope.ReasonTypeId == "0") {
                //alert("Please select Reason Type");
                toastr.warning("Please select Reason Type", "warning");
                return false;
            }
            else {
                var obj = {
                    CancelledBy_Id: $scope.SelectedPatientId,
                    Id: $scope.Appointment_Id,
                    Cancelled_Remarks: $scope.Cancelled_Remarks,
                    ReasonTypeId: $scope.ReasonTypeId
                }
                $("#chatLoaderPV").show();
                $http.post(baseUrl + '/api/PatientAppointments/CancelPatient_Appointment/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    angular.element('#PatientAppointmentModal').modal('hide');
                    $scope.Cancelled_Remarks = "";
                    $scope.ReasonTypeId = '0';
                    $scope.getMyAppointments();
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while Updating Appointment Details" + data;
                });
            }
        }
        $scope.DiagosticAlert_CancelPopup = function () {
            //Diagostic Alert
            $location.path("/Carecoordinator/1");
        }
        $scope.ComplianceAlert_CancelPopup = function () {
            //Compliaance Alert
            $location.path("/CarecoordinatorCompliance/2");
        }
        $scope.CareGiver_CancelPopup = function () {
            //Care Giver Assigned Patient
            $location.path("/CareGiverAssignedPatients");
        }
        $scope.UserTypeId = $window.localStorage['UserTypeId'];
        $scope.UserId = $window.localStorage['UserId'];
        $scope.CareGiverAssign_Function = function () {
            if ($scope.UserTypeId == "6") {
                //Assign care Giver only in Coordinator Login
                //$scope.ParameterValueList = [];
                //$http.get(baseUrl + '/api/CareCoordinnator/Get_ParameterValue/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                //    $scope.ParameterValueList = data;
                //});

                $scope.CareGiverList = [];
                $http.post(baseUrl + '/api/CareCoordinnator/CareGiver_List/?Id=' + $scope.SelectedPatientId).success(function (data) {
                    $scope.CareGiverList = data;
                });
            }
        }
        var HighCountVital;

        if ($scope.UserTypeId != "3" || $scope.UserTypeId != "1") {
            //Assign care Giver only in Coordinator Login
            $scope.ParameterValueList = [];
            $http.get(baseUrl + '/api/CareCoordinnator/Get_ParameterValue/?PatientId=' + $scope.SelectedPatientId + '&UserTypeId=' + $scope.UserTypeId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.ParameterValueList = data;
                //angular.forEach($scope.ParameterValueList, function (value, index) {
                //    console.log(value);
                //    if(value.HighCount!= 0 ) 
                //    {
                //        HighCountVital= (value.HighCount).length;
                //        console.log(HighCountVital);
                //    }
                //});


            });
        }

        $scope.yellowcount = 1;
        $scope.AlertCountDisplay = function () {
            $scope.redcount = 1;
            $scope.greencount = 1;
            $('.jinglebelllow').removeClass('active');
            $('#Highcount').addClass('fa fa-bell-o myhighBell');
            $('.jinglebellhigh').removeClass('active');
            $('#Lowcount').addClass('fa fa-bell-o mylowBell');
            $('.jinglebellmedium').addClass('active');
            $('#Medcount').removeClass('fa fa-bell-o mymediumBell');
            $('#Medcount').addClass('fas fa-bell mymediumBell');
            var x = document.getElementById("tableid");
            var i = document.getElementById("tableid_img");
            i.src = "../../Images/expand.gif"
            x.style.display = "none";
            document.getElementById('tableid_img').title = 'Click to Expand';
            $('#tableid').hide();
            $('#tableid1').hide();
            $('#tableid2').hide();
            $scope.yellowcount++;

            var MediumCountVital;
            $scope.MediumCountVitalList = [];
            if ($scope.yellowcount == 2) {
                angular.forEach($scope.ParameterValueList, function (value, index) {
                    console.log(value);
                    if (value.MediumCount != 0) {
                        MediumCountVital = value.MediumCount;
                        console.log(MediumCountVital);
                        $scope.MediumCountVitalList.push(value);
                    }
                });
                if ($scope.MediumCountVitalList.length > 0) {
                    $('#tableid1').show();
                    $('#tableid3').hide();
                    $('#tableid2').hide();
                    $('#tableid4').hide();
                    $('#tableid5').hide();
                    $('#tableid6').hide();
                    return true;
                } else {
                    $('#tableid1').hide();
                    $('#tableid3').hide();
                    $('#tableid2').hide();
                    $('#tableid4').hide();
                    $('#tableid5').hide();
                    $('#tableid6').hide();
                    return true;
                }

            } else if ($scope.yellowcount == 3) {
                $('#tableid3').hide();
                $('#tableid5').hide();
                $('#tableid1').hide();
                $('#tableid2').show();
                $('#tableid4').hide();
                $('#tableid6').hide();

            } else {

                //i.src = "../../Images/expand.gif"
                $('#tableid1').hide();
                $('#tableid2').hide();
                $('.jinglebellmedium').removeClass('active');
                $('.jinglebellmedium i').removeClass('fas fa-bell mymediumBell');
                $('.jinglebellmedium i').addClass('fa fa-bell-o mymediumBell');
                $scope.yellowcount = 1;
                //document.getElementById(tableid + '_img').title = 'Click to Expand';
                //count = $scope.yellowcount - 3;

            }
            return true;
        };

        $scope.redcount = 1;
        $scope.AlertCountredDisplay = function () {
            $scope.yellowcount = 1;
            $scope.greencount = 1;
            $('.jinglebellmedium').removeClass('active');
            $('#Medcount').addClass('fa fa-bell-o mymediumBell');
            $('.jinglebellhigh').removeClass('active');
            $('#Lowcount').addClass('fa fa-bell-o mylowBell');
            $('.jinglebelllow').addClass('active');
            $('#Highcount').removeClass('fa fa-bell-o myhighBell');
            $('#Highcount').addClass('fas fa-bell myhighBell');
            var x = document.getElementById("tableid");
            var i = document.getElementById("tableid_img");
            i.src = "../../Images/expand.gif"
            x.style.display = "none";
            document.getElementById('tableid_img').title = 'Click to Expand';
            $('#tableid').hide();
            $('#tableid3').hide();
            $('#tableid4').hide();
            $scope.redcount++;

            var HighCountVital;
            $scope.HighCountVitalList = [];
            if ($scope.redcount == 2) {
                angular.forEach($scope.ParameterValueList, function (value, index) {
                    console.log(value);
                    if (value.HighCount != 0) {
                        HighCountVital = value.HighCount;
                        console.log(HighCountVital);
                        $scope.HighCountVitalList.push(value);
                    }
                });
                if ($scope.HighCountVitalList.length > 0) {
                    $('#tableid3').show();
                    $('#tableid1').hide();
                    $('#tableid2').hide();
                    $('#tableid5').hide();
                    $('#tableid6').hide();
                    return true;
                } else {
                    $('#tableid3').hide();
                    $('#tableid1').hide();
                    $('#tableid2').hide();
                    $('#tableid5').hide();
                    $('#tableid6').hide();

                    return true;
                }

            } else if ($scope.redcount == 3) {
                $('#tableid1').hide();
                $('#tableid5').hide();
                $('#tableid3').hide();
                $('#tableid4').show();
                $('#tableid2').hide();
                $('#tableid6').hide();

            } else {

                //i.src = "../../Images/expand.gif"

                $('#tableid3').hide();
                $('#tableid4').hide();
                $('.jinglebelllow').removeClass('active');
                $('.jinglebelllow i').removeClass('fas fa-bell myhighBell');
                $('.jinglebelllow i').addClass('fa fa-bell-o myhighBell');
                $scope.redcount = 1;
                //document.getElementById(tableid + '_img').title = 'Click to Expand';
                //count = $scope.yellowcount - 3;

            }
            return true;
        };

        $scope.greencount = 1;
        $scope.AlertCountgreenDisplay = function () {
            $scope.redcount = 1;
            $scope.yellowcount = 1;
            $('.jinglebelllow').removeClass('active');
            $('#Highcount').addClass('fa fa-bell-o myhighBell');
            $('.jinglebellmedium').removeClass('active');
            $('#Medcount').addClass('fa fa-bell-o mymediumBell');
            $('.jinglebellhigh').addClass('active');
            $('#Lowcount').removeClass('fa fa-bell-o mylowBell');
            $('#Lowcount').addClass('fas fa-bell mylowBell');
            var x = document.getElementById("tableid");
            var i = document.getElementById("tableid_img");
            i.src = "../../Images/expand.gif"
            x.style.display = "none";
            document.getElementById('tableid_img').title = 'Click to Expand';
            $('#tableid').hide();
            $('#tableid5').hide();
            $('#tableid6').hide();
            $scope.greencount++;

            var LowCountVital;
            $scope.LowCountVitalList = [];
            if ($scope.greencount == 2) {
                angular.forEach($scope.ParameterValueList, function (value, index) {
                    console.log(value);
                    if (value.LowCount != 0) {
                        LowCountVital = value.LowCount;
                        console.log(LowCountVital);
                        $scope.LowCountVitalList.push(value);
                    }
                });
                if ($scope.LowCountVitalList.length > 0) {
                    $('#tableid5').show();
                    $('#tableid1').hide();
                    $('#tableid4').hide();
                    $('#tableid3').hide();
                    $('#tableid2').hide();
                    $('#tableid6').hide();
                    return true;
                } else {
                    $('#tableid5').hide();
                    $('#tableid1').hide();
                    $('#tableid4').hide();
                    $('#tableid3').hide();
                    $('#tableid2').hide();
                    $('#tableid6').hide();
                    return true;
                }

            } else if ($scope.greencount == 3) {
                $('#tableid1').hide();
                $('#tableid4').hide();
                $('#tableid5').hide();
                $('#tableid6').show();
                $('#tableid2').hide();
                $('#tableid4').hide();
                $('#tableid3').hide();

            } else {

                //i.src = "../../Images/expand.gif"

                $('#tableid5').hide();
                $('#tableid6').hide();
                $('.jinglebellhigh').removeClass('active');
                $('.jinglebellhigh i').removeClass('fas fa-bell mylowBell');
                $('.jinglebellhigh i').addClass('fa fa-bell-o mylowBell');
                $scope.greencount = 1;
                //document.getElementById(tableid + '_img').title = 'Click to Expand';
                //count = $scope.yellowcount - 3;

            }
            return true;
        };


        $scope.Assign_CareGiver_Id = "0";
        $scope.CC_Remarks = "";
        $scope.CareGiver_Id = "0";
        $scope.ReasonTypeId = '0';
        $scope.AllPatient_CancelPopup = function () {
            //All Patients
            $location.path("/PatientAppointments");
        }
        $scope.Assign_CareGiver = function () {
            if (typeof ($scope.CareGiver_Id) == "undefined" || $scope.CareGiver_Id == "0") {
                //alert("Please select Care Giver");
                toastr.warning("Please select Care Giver", "warning");
                return false;
            }
            else {
                var obj = {
                    Id: $scope.Assign_CareGiver_Id,
                    Coordinator_Id: $scope.UserId,
                    Patient_Id: $scope.SelectedPatientId,
                    CareGiver_Id: $scope.CareGiver_Id.toString(),
                    CC_Remarks: $scope.CC_Remarks,
                    Created_By: $scope.UserId,
                    CC_Date: moment($window.localStorage['CC_Date']).format('YYYY-MM-DD HH:mm:ss'),
                    Page_Type: $scope.PageParameter == 5 ? 0 : 1,
                    Institution_Id: $window.localStorage['InstitutionId'],
                }
                $("#chatLoaderPV").show();
                $('#msg').attr("disabled", true);
                $http.post(baseUrl + '/api/CareCoordinnator/Assign_CareGiver/', obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 0) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 1) {
                        toastr.info(data.Message, "info");
                    }
                    $('#msg').attr("disabled", false);
                    $scope.CareGiver_Id = "0";
                    $scope.CC_Remarks = "";
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while Assigning CareGiver" + data;
                });
            }
        }
        //Care Giver Login
        $scope.CG_Remarks = "";
        $scope.CG_Update_ClearAlerts = function () {

            if (typeof ($scope.CG_Remarks) == "undefined" || $scope.CG_Remarks == "") {
                //alert("Please enter Notes / Remarks to clear alert");
                toastr.warning("Please enter Notes / Remarks to clear alert", "warning");
                return false;
            }
            else {
                var obj = {
                    Patient_Id: $scope.SelectedPatientId,
                    CareGiver_Id: $scope.UserId,
                    CG_Remarks: $scope.CG_Remarks,
                    Page_Type: $scope.PageParameter == 7 ? 0 : 1
                }
                $("#chatLoaderPV").show();
                $('#clear').attr("disabled", true);
                $http.post(baseUrl + '/api/CareGiver/CG_Update_ClearAlerts/', obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    if ((data == 1) || (data == 3)) {
                        //alert("Clear Alerts updated successfully");
                        toastr.success("Clear Alerts updated successfully", "success");
                        $('#clear').attr("disabled", false);
                        $scope.CG_Remarks = "";
                        $scope.ParameterValueList = [];
                        $http.get(baseUrl + '/api/CareCoordinnator/Get_ParameterValue/?PatientId=' + $scope.SelectedPatientId + '&UserTypeId=2&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                            $scope.ParameterValueList = data;
                        });
                    }
                    else if (data == 2) {
                        //alert("Alert already cleared by Caregiver, cannot be cleared");
                        toastr.warning("Alert already cleared by Caregiver, cannot be cleared", "warning");
                    }
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while Update Clear Alerts" + data;
                });
            }
        }

        $scope.appointmentClear = function () {
            $scope.searchquery = '';
            $scope.Doctor_Id = '';
            $scope.AppointmentFromTime = '';
            $scope.AppointmentToTime = '';
            $scope.AppointmentDate = '';
            $scope.ReasonForVisit = '';
            $scope.ReasonTypeId = '0';
        }
        $scope.DoctorSeachPopup = function () {
            $scope.DoctorListforAppointments();
            $scope.filterDoctorList();
            angular.element('#DoctorSelectionModal').modal('show');

        }

        /* Patient Based Group Based PatientBasedGroupBasedClinicianList*/
        $scope.searchquery = '';
        $scope.DoctorsDetailsList = [];
        $scope.DoctorListforAppointments = function () {
            $http.get(baseUrl + '/api/PatientAppointments/PatientBasedGroupBasedClinicianList/?Patient_Id=' + $scope.SelectedPatientId).success(function (data) {
                $scope.DoctorsDetailsList = data;
                $scope.filterDoctorListforAppointmentCreation();
            });
        }
        $scope.Convert24to12Timeformat = function (inputTime) {
            var outputTime = null;
            if (inputTime != '' && inputTime != null) {
                inputTime = inputTime.toString(); //value to string for splitting
                var splitTime = inputTime.split(':');
                splitTime.splice(2, 1);
                var ampm = (splitTime[0] >= 12 ? ' PM' : ' AM'); //determine AM or PM
                splitTime[0] = splitTime[0] % 12;
                splitTime[0] = (splitTime[0] == 0 ? 12 : splitTime[0]); //adjust for 0 = 12
                outputTime = splitTime.join(':') + ampm;
            }
            return outputTime;
        };
        $scope.Convert12To24Timeformat = function (timeval) {
            var outputTime = null;
            if (timeval != '' && timeval != null) {
                var time = timeval;
                var hours = Number(time.match(/^(\d+)/)[1]);
                var minutes = Number(time.match(/:(\d+)/)[1]);
                var AMPM = time.match(/\s(.*)$/)[1];
                if (AMPM == "PM" && hours < 12) hours = hours + 12;
                if (AMPM == "AM" && hours == 12) hours = hours - 12;
                var sHours = hours.toString();
                var sMinutes = minutes.toString();
                if (hours < 10) sHours = "0" + sHours;
                if (minutes < 10) sMinutes = "0" + sMinutes;
                outputTime = sHours + ":" + sMinutes;
            }
            return outputTime;
        };
        /* Validating the create page Appointment From Time Should not be greater than Appointment to time
       */
        $scope.PatientAppointment_InsertUpdateValidations = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.AppointmentDate = moment($scope.AppointmentDate).format('DD-MMM-YYYY');

            if ($scope.Doctor_Id == "") {
                //alert("Please select Doctor");
                toastr.warning("Please select Doctor", "warning");
                return false;
            }
            else if ($scope.AppointmentDate == "") {
                //alert("Please select Appointment Date");
                toastr.warning("Please select Appointment Date", "warning");
                return false;
            }
            else if ($scope.AppointmentFromTime == "") {
                //alert("Please select Appointment From time");
                toastr.warning("Please select Appointment From time", "warning");
                return false;
            }
            else if ($scope.AppointmentToTime == "") {
                //alert("Please select Appointment To time");
                toastr.warning("Please select Appointment To time", "warning");
                return false;
            }
            else if ($scope.ReasonForVisit == "" || $scope.ReasonForVisit == undefined) {
                //alert("Please enter Reason for Visit");
                toastr.warning("Please enter Reason for Visit", "warning");
                return false;
            }
            /*else if (($scope.AppointmentToTime) < ($scope.AppointmentFromTime)) {
                alert("Appointment From Time should not be greater than Appointment To Time");
                return false;
            }*/
            else if ((ParseDate($scope.AppointmentDate) < ParseDate(today))) {
                //alert("Appointment Date Can Be Booked Only For Future");
                toastr.warning("Appointment Date Can Be Booked Only For Future", "warning");
                return false;
            }
            else if ($scope.AppointmentDate != "") {
                if (moment($scope.AppointmentDate + " " + $scope.AppointmentFromTime) > moment($scope.AppointmentDate + " " + $scope.AppointmentToTime)) {
                    //alert("Appointment From Time should not be greater than Appointment To Time");
                    toastr.warning("Appointment From Time should not be greater than Appointment To Time", "warning");
                    $scope.AppointmentDate = DateFormatEdit($scope.AppointmentDate);
                    return false;
                }
            }
            else if (moment().diff(moment($scope.AppointmentDate + " " + $scope.AppointmentFromTime), 'minute') > 0) {
                //alert("Appointment can be booked only for future");
                toastr.warning("Appointment can be booked only for future", "warning");
                return false;
            }
            $scope.AppointmentDate = DateFormatEdit($scope.AppointmentDate);
            return true;
        };
        $scope.Institution_Id = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.PatientAppointment_InsertUpdate = function (SelectedDoctor_Id) {

            if ($scope.PatientAppointment_InsertUpdateValidations() == true) {
                var obj = {
                    Institution_Id: $scope.Institution_Id,
                    Doctor_Id: $scope.Doctor_Id,
                    Patient_Id: $scope.SelectedPatientId,
                    Appointment_Date: moment($scope.AppointmentDate).format('DD-MMM-YYYY'),
                    AppointmentFromTime: $scope.AppointmentFromTime == '' ? null : $scope.Convert12To24Timeformat($scope.AppointmentFromTime),
                    AppointmentToTime: $scope.AppointmentToTime == '' ? null : $scope.Convert12To24Timeformat($scope.AppointmentToTime),
                    Appointment_Type: 1,
                    ReasonForVisit: $scope.ReasonForVisit == null ? '' : $scope.ReasonForVisit,
                    //Remarks:'Heavy Headache',
                    Status: 1,
                    Created_By: $window.localStorage['UserId'],
                    Page_Type: $scope.PageParameter == 7 ? 0 : 1
                }
                $("#chatLoaderPV").show();
                $http.post(baseUrl + '/api/PatientAppointments/PatientAppointment_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.getMyAppointments();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $scope.appointmentClear();
                    $scope.MyAppointments();
                })
            }
        }

        $scope.DoctorCollectionFilter = [];
        $scope.searchquery = "";
        $scope.filterDoctorListforAppointmentCreation = function () {
            $scope.DoctorCollectionFilter = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == '') {
                if ($scope.DoctorsDetailsList.length > 0) {
                    $scope.DoctorCollectionFilter = angular.copy($scope.DoctorsDetailsList);
                }
            }
            else {
                $scope.DoctorCollectionFilter = $ff($scope.DoctorsDetailsList, function (value) {
                    return angular.lowercase(value.DoctorName).match(searchstring) ||
                        angular.lowercase(value.Doctor_DepartmentName).match(searchstring)
                });
            }
        }

        $scope.DoctorSelection = function (rowDoctor) {
            $scope.searchquery = rowDoctor.DoctorName;
            $scope.Doctor_Id = rowDoctor.Doctor_Id
            angular.element('#DoctorSelectionModal').modal('hide');
        }

        $scope.CancelDoctorSelectionModalPopup = function () {
            angular.element('#DoctorSelectionModal').modal('hide');
        }
        /* Open doctor appointment history popup*/
        $scope.DoctorAppoinmentModal = function () {
            $scope.DoctorAppoinmentList();
            angular.element('#DoctorAppoinmentModal').modal('show');
        }
        /* Cancel doctor appointment history popup*/
        $scope.CancelDoctorAppoinmentModal = function () {
            angular.element('#DoctorAppoinmentModal').modal('hide');
        }

        $scope.DoctorAppointmentsearchquery = "";
        $scope.filterDoctorList = function () {
            $scope.DoctorAppoinmentFilter = [];
            // $scope.DoctorAppoinmentFilter = [];
            var searchstring = angular.lowercase($scope.DoctorAppointmentsearchquery);
            if ($scope.searchstring == "") {
                $scope.DoctorAppoinmentFilter = [];
                $scope.DoctorAppoinmentFilter = angular.copy($scope.DoctorAppoinmentdata);
            }
            else {
                $scope.DoctorAppoinmentFilter = $ff($scope.DoctorAppoinmentdata, function (value) {
                    return angular.lowercase(($filter('date')(value.Appointment_Date, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(value.DoctorName).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Appointment_FromTime, "hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Appointment_ToTime, "hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(value.Created_By_Name).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Created_Dt, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(value.ReasonForVisit).match(searchstring) ||
                        angular.lowercase(value.ReasonType).match(searchstring) ||
                        angular.lowercase(value.PatientName).match(searchstring);
                });
            }
        }

        /* doctor appoinment list function.*/
        $scope.DoctorAppoinmentdata = [];
        $scope.DoctorAppoinmentemptydata = [];
        $scope.DoctorAppoinmentFilter = [];
        $scope.Appointmentflag = 0;

        $scope.DoctorAppoinmentList = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/User/DoctorAppoinmentHistoryList/?PatientId=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.SearchMsg = "No Data Available";
                $scope.DoctorAppoinmentemptydata = data;
                $scope.DoctorAppoinmentdata = data;
                $scope.DoctorAppoinmentFilter = angular.copy($scope.DoctorAppoinmentdata);
                if ($scope.DoctorAppoinmentFilter.length > 0) {
                    $scope.Appointmentflag = 1;
                }
                else {
                    $scope.Appointmentflag = 0;
                }
            });

        }


        /* Care Co-ordinator popup function*/
        $scope.CareCoordinatorModal = function () {
            $scope.CareCoordinatorList();
            angular.element('#CareCoordinatorModal').modal('show');
        }

        $scope.CancelCareCoordinatorModal = function () {
            angular.element('#CareCoordinatorModal').modal('hide');
        }

        /* FILTER THE MASTER LIST FUNCTION.*/

        $scope.CareCoordinatorsearchquery = "";
        $scope.filterCareCoordinatorList = function () {
            $scope.CareCoordinatorFilter = [];
            var searchstring = angular.lowercase($scope.CareCoordinatorsearchquery);
            if ($scope.searchstring == "") {
                $scope.CareCoordinatorFilter = angular.copy($scope.CareCoordinatordata);
            }
            else {
                $scope.CareCoordinatorFilter = $ff($scope.CareCoordinatordata, function (value) {
                    return angular.lowercase(value.Coordinator).match(searchstring) ||
                        angular.lowercase(value.CareGiver).match(searchstring) ||
                        angular.lowercase(value.CC_Remarks).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Created_dt, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);
                });
            }
        }


        /* Filter the Co-ordinator list function.*/
        $scope.CareCoordinatordata = [];
        $scope.CareCoordinatoremptydata = [];
        $scope.CareCoordinatorFilter = [];
        $scope.flag = 0;

        $scope.CareCoordinatorList = function () {
            $http.get(baseUrl + '/api/CareCoordinnator/Care_Coordinatorhistory/?CareGiverId=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.CareCoordinatoremptydata = data;
                $scope.CareCoordinatordata = data;
                $scope.CareCoordinatorFilter = angular.copy($scope.CareCoordinatordata);
                if ($scope.CareCoordinatorFilter.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                }
                $scope.SearchMsg = "No Data Available";
            });

        }

        $scope.CancelAlertHistorypopup = function () {
            angular.element('#ViewClearAlertsHistoryModal').modal('hide');
        }

        // cancel function in pop up menu
        $scope.CancelPopup = function () {
            angular.element('#ViewClearAlertsHistoryModal').modal('hide')
        }


        $scope.ViewClearAlertHistoryPopup = function (ViewAlert) {
            $scope.AlertsClear();
            $scope.SelectedPatientIdvalue = ViewAlert;
            $scope.ViewAlertHistory();
            $scope.FilterViewData = [];

            angular.element('#ViewClearAlertsHistoryModal').modal('show');
        };

        $scope.SelectedPatientIdvalue = [];
        $scope.ViewData = [];

        $scope.FilterViewData = [];

        //View for Clear alerts history

        $scope.ViewAlertHistory = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/CareGiver/AlertHistory_View/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.SearchMsg = "No Data Available";
                $scope.FilterView = [];
                $scope.FilterView = data
                $scope.ViewData = data;
                //$scope.FilterView=data;


            }).error(function (data) {

                $scope.error = "An error has occcurred " + data.ExceptionMessage;
            });
        }

        $scope.AlertsClear = function () {
            $scope.CareGiverIdvalue = "";
            $scope.SelectedPatientIdvalue = "";
            $scope.alerts = "";
            $scope.createddate = "";
        }

        //Search filter for clear alert history view
        $scope.searchqueryval = "";
        $scope.filterViewAlertHistory = function () {
            $scope.ResultViewFiltered = [];
            var searchstring = angular.lowercase($scope.searchqueryval);
            if ($scope.searchqueryval == "") {
                $scope.FilterViewData = angular.copy($scope.ViewData);

            }
            else {
                $scope.FilterViewData = $ff($scope.ViewData, function (value) {
                    return angular.lowercase(value.CaregiverName).match(searchstring) ||
                        angular.lowercase(value.CC_Remarks).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Created_Dt, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);

                });
            }
        }

        /***Monitoring Protocol Search dropdown list based Institution_Id***/
        $scope.MonitoringProtocolList = function () {
            //UserTypeId ==4||UserTypeId==7
            $scope.MonitoringProtocol_List = [];
            if ($scope.UserTypeId == "4" || $scope.UserTypeId == "7") {
                $http.get(baseUrl + '/api/Protocol/StandardProtocol_List/?IsActive=1&InstitutionId=' + $scope.Institution_Id).success(function (data) {
                    $scope.MonitoringProtocolListTemp = [];
                    $scope.MonitoringProtocolListTemp = data;
                    var obj = { "Id": "", "ProtocolName": "No protocol assigned", "IsActive": 1 };
                    $scope.MonitoringProtocolListTemp.splice(0, 0, obj);
                    $scope.MonitoringProtocol_List = angular.copy($scope.MonitoringProtocolListTemp);
                    if ($scope.assignedProtocolId != "") {
                        $scope.Monitoring_ProtocolId = $scope.assignedProtocolId;
                    }
                });
            }

        }

        /** Insert and Update Patient Assigned monitoring protocol controller functions */
        $scope.AssignedProtocol_InsertUpdate = function (Monitoring_ProtocolId) {
            if ($scope.assignedProtocolId == $scope.Monitoring_ProtocolId) {
                //alert('This protocol is already assigned to this patient');
                toastr.info("This protocol is already assigned to this patient");
                return false;
            }
            var del = true;
            if ($scope.Monitoring_ProtocolId == 0) {
                del = confirm('Are you sure to Remove Protocol to this patient?');
            }
            if (del == true) {
                $("#chatLoaderPV").show();
                var prtobj = {
                    PatientId: $scope.SelectedPatientId,
                    Protocol_Id: $scope.Monitoring_ProtocolId == 0 ? '' : $scope.Monitoring_ProtocolId,
                    Created_By: $window.localStorage['UserId']
                };
                $('#save').attr("disabled", true);
                $http.post(baseUrl + '/api/User/PatientAssignedProtocol_InsertUpdate', prtobj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.assignedProtocolId = $scope.Monitoring_ProtocolId;
                    //alert('Protocol updated successfully')
                    toastr.success('Protocol updated successfully', "success");
                    $('#save').attr("disabled", false);
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while assigning Protocol " + data;
                    alert($scope.error);
                });
            }
        }


        /* This is for MonitoringHistoryListPopUP */
        $scope.MonitoringHistoryListPopUP = function () {
            $scope.MonitoringProtocolHistoryList();
            angular.element('#MonitoringProtocolHistoryPopup').modal('show');
        }


        /* This is for MonitoringProtocolHistoryListData */
        $scope.PatientAssignedProtocolDataList = [];
        $scope.MonitoringProtocolHistoryListData = [];
        $scope.MonitoringProtocolHistoryList = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + 'api/User/ProtocolHistorylist/?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.SearchMsg = "No Data Available";
                $scope.MonitoringProtocolEmptyData = [];
                $scope.MonitoringProtocolHistoryListData = [];
                $scope.MonitoringProtocolHistoryListData = data;
                $scope.PatientAssignedProtocolDataList = angular.copy($scope.MonitoringProtocolHistoryListData);
                if ($scope.PatientAssignedProtocolDataList.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                }

            })
        }

        $scope.searchquery = "";
        $scope.filterassignedProtocolList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.PatientAssignedProtocolDataList = [];
                $scope.PatientAssignedProtocolDataList = angular.copy($scope.MonitoringProtocolHistoryListData);
            }
            else {
                var val;
                $scope.PatientAssignedProtocolDataList = $ff($scope.MonitoringProtocolHistoryListData, function (value) {
                    if (value.ProtocolName == null) {
                        val = "";
                    }
                    else {
                        val = value.ProtocolName;
                    }
                    return angular.lowercase(val).match(searchstring) ||
                        angular.lowercase(value.Doctor_Name).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Protocol_Assigned_On, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);
                });
            }
        }

        /* This is for MonitoringProtocolHistoryListCancelPopUp */
        $scope.MonitoringProtocolHistoryListCancelPopUp = function () {
            angular.element('#MonitoringProtocolHistoryPopup').modal('hide');
        }

        //For ICD10
        $scope.ICDTabCount = 1;
        /* This is for AddNewpopup function from List  window page */
        $scope.AddPatientICD10Popup = function () {
            $scope.Id = 0;
            $scope.Icd10AddnewClear();
            $('#buttonsave').attr("disabled", false);
            //$scope.ICD10CategoryClearFunction();
            $scope.Icd10Clear();
            angular.element('#CreateICDModal').modal('show');

            setTimeout(function () {
                $scope.calenderSet($scope.AddICD10List.length);
            }, 1000);

        }

        /* This is for Cancel  function from View Popup window page */
        $scope.CancelViewICD10Popup = function () {
            angular.element('#ViewICD10modal').modal('hide');
        }

        /* This is for Cancel  function for  edit Popup window page */
        $scope.CancelEditICD10Popup = function () {
            angular.element('#EditICD10Modal').modal('hide');
        }

        /* This is for Cancel function from Addnew Popup window page */
        $scope.CancelAddICD10Popup = function () {
            angular.element('#CreateICDModal').modal('hide');
        }

        /* This is for View Popup function from List  window page */
        $scope.ViewPatientICD10 = function (CatId, editval) {

            if (editval == 2) {
                $scope.Id = CatId;
                $scope.PatientICD10Details_View();
                angular.element('#ViewICD10modal').modal('show');
            }
        };

        /* This is for Edit Popup function from List  window page */
        $scope.EditPatientICD10 = function (CatId, createdDt, editval) {
            $('#buttonsave1').attr("disabled", false);
            if ($scope.IsEditableCheck(createdDt) == false) {
                //alert("ICD10 Cannot be edited");
                toastr.info("ICD10 Cannot be edited", "info");
            }
            else {
                $scope.Icd10AddnewClear();
                $scope.Icd10Clear();
                $scope.Id = CatId;
                $scope.PatientICD10Details_View();
                angular.element('#EditICD10Modal').modal('show');
            }
        };

        /* This is for Patient ICD10 Details Delete function*/
        $scope.DeletePatientICD10 = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewICD10_Delete();
        };
        $scope.Category_ID = "0";
        $scope.AddICD10List = [];
        $scope.CategoryIDList = [];
        $scope.ICDCodeList = [];
        $scope.rowcollectionfiltericd10 = [];

        /* This is for intilize Addrow Columns scope values */
        $scope.AddICD10List = [{
            'Id': 0,
            'Category_ID': 0,
            'Category_Name': '',
            'Code_ID': '0',
            'ICDCode': '',
            'ICD_Description': '',
            'ICD_Remarks': '',
            'Active_From': '',
            'Active_To': ''

        }];


        $scope.Icd10AddnewClear = function () {
            $scope.AddICD10List = [{
                'Id': 0,
                'Category_ID': 0,
                'Category_Name': '',
                'Code_ID': '0',
                'ICDCode': '',
                'ICD_Description': '',
                'ICD_Remarks': '',
                'Active_From': '',
                'Active_To': ''

            }];

        }



        /**ICD10_CATEGORY_LIST function**/

        //$http.get(baseUrl + '/api/User/ICD10_CategoryList/').success(function (data) {        
        //});

        /* This is for to add new Add row  function  */
        $scope.PatientICD10Insert = function () {
            if ($scope.AddICD10List.length > 0) {
                var obj = {
                    'Id': 0,
                    'Category_ID': "0",
                    'Category_Name': '',
                    'Code_ID': '0',
                    'ICDCode': '',
                    'ICD_Description': '',
                    'ICD_Remarks': '',
                    'Active_From': '',
                    'Active_To': ''
                }
                $scope.AddICD10List.push(obj);
            }
            else {
                $scope.AddICD10List = [{
                    'Id': 0,
                    'Category_ID': '0',
                    'Category_Name': '',
                    'Code_ID': '0',
                    'ICDCode': '',
                    'ICD_Description': '',
                    'ICD_Remarks': '',
                    'Active_From': '',
                    'Active_To': ''
                }];
            }
            $scope.ICD10codeSearchPopup($scope.AddICD10List.length - 1);

            setTimeout(function () {
                $scope.calenderSet($scope.AddICD10List.length);
            }, 1000);

        }
        $scope.calenderSet = function (idxval) {


            $("#DivICDFrom" + idxval).bootstrapDP({
                format: "dd-M-yyyy",
                forceParse: false,
                //endDate: '+0d',
                startDate: new Date(),
                autoclose: true,
                todayHighlight: true,
                toggleActive: true,
                todayBtn: true
            });

            $("#DivICDTo" + idxval).bootstrapDP({
                format: "dd-M-yyyy",
                forceParse: false,
                //endDate: '+0d',
                startDate: new Date(),
                autoclose: true,
                todayHighlight: true,
                toggleActive: true,
                todayBtn: true
            });
        }

        /* This is for delete row  function  */
        $scope.ICD10Delete = function (itemIndex) {
            var del = confirm("Do you like to delete the selected ICD10 Details?");
            if (del == true) {

                $scope.AddICD10List.splice(itemIndex, 1);
                if ($scope.AddICD10List.length == 0) {
                    $scope.AddICD10List = [{
                        'Id': 0,
                        'Category_ID': 0,
                        'Category_Name': '',
                        'Code_ID': '0',
                        'ICDCode': '',
                        'ICD_Description': '',
                        'ICD_Remarks': '',
                        'Active_From': '',
                        'Active_To': ''
                    }];

                }
            }
        }

        /* This is for PatientICD10 Insert and update Validations */
        $scope.PatientICD10_InsertUpdateValidations = function () {

            var validateflag = true;
            var validationMsg = "";
            var Active_From = "";
            var Active_To = "";

            if (value.Active_From != false && value.Active_From != null && value.Active_To != false && value.Active_To != null) {
                value.Active_From = moment(value.Active_From).format('DD-MMM-YYYY');
                Active_From = moment(value.Active_From).format('DD-MMM-YYYY');
                value.Active_To = moment(value.Active_To).format('DD-MMM-YYYY');
                Active_To = moment(value.Active_To).format('DD-MMM-YYYY');
                value.Active_From = DateFormatEdit(value.Active_From);
                value.Active_To = DateFormatEdit(value.Active_To);
            }
            if (value.Active_To == false || value.Active_To == null || value.Active_To == undefined) {
                value.Active_To = "";
            }
            if (value.Active_From == false || value.Active_From == null || value.Active_From == undefined) {
                value.Active_From = "";
            }
                //if ((value.Active_From) == "") {
                //    validationMsg = validationMsg + "Please select Active From Date";
                //    validateflag = false;
                //    return false;
                //}
                /*if ((value.Active_To) == "") {
                    validationMsg = validationMsg + "Please select Active To Date";
                    validateflag = false;
                    return false;
                }*/
                //if ((value.Active_From !== null) && (value.Active_To !== null)) {
                //    if ((ParseDate(value.Active_To) < ParseDate(value.Active_From))) {
                //        validationMsg = validationMsg + "Active From Date should not be greater than Active To Date";
                //        value.Active_From = DateFormatEdit(value.Active_From);
                //        value.Active_To = DateFormatEdit(value.Active_To);
                //        validateflag = false;
                //        return false;
                //    }
                //}

                //value.Active_From = DateFormatEdit(value.Active_From);
                //value.Active_To = DateFormatEdit(value.Active_To);

            //});

            var TSDuplicate = 0;
            var Duplicateparameter = '';
            angular.forEach($scope.AddICD10List, function (value1, index1) {
                angular.forEach($scope.AddICD10List, function (value2, index2) {
                    if (index1 > index2 && value1.Category_ID == value2.Category_ID && value1.Code_ID == value2.Code_ID) {
                        TSDuplicate = 1;
                        Duplicateparameter = Duplicateparameter + value2.Category_Name + ',';
                    };
                });
            });
            if (TSDuplicate == 1) {
                //alert('Category Name' + Duplicateparameter + ' already exist, cannot be Duplicated');
                toastr.error('Category Name' + Duplicateparameter + ' already exist, cannot be Duplicated', "warning");
                return false;
            }

            if (validateflag == false) {
                //alert(validationMsg);
                toastr.warning(validationMsg, "warning");
                return false;
            }

            return true;
        }


        /* This is for Patient ICD10 Insert and Update function  */
        $scope.AddICD10List = [];
        $scope.Id = 0;
        $scope.PatientICD10_InsertUpdate = function () {
            if ($scope.PatientICD10_InsertUpdateValidations() == true) {
                $('#buttonsave').attr("disabled", true);
                $('#buttonsave1').attr("disabled", true);
                $scope.insertcount = 0;
                $scope.ICD10GroupList = [];
                $("#chatLoaderPV").show();
                angular.forEach($scope.AddICD10List, function (value, index) {
                    var obj = {
                        Id: $scope.Id,
                        Code_ID: value.Code_ID,
                        Remarks: value.ICD_Remarks,
                        Patient_Id: $scope.SelectedPatientId,
                        Active_From: $filter('date')(value.Active_From, "dd-MMM-yyyy"),
                        Active_To: $filter('date')(value.Active_To, "dd-MMM-yyyy"),
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                        InstitutionId: $window.localStorage['InstitutionId']
                    }
                    $scope.ICD10GroupList.push(obj);
                })

                $http.post(baseUrl + '/api/User/Patient_ICD10Details_AddEdit/?Login_Session_Id=' + $scope.LoginSessionId, $scope.ICD10GroupList).success(function (data) {
                    //$scope.insertcount = $scope.insertcount+1;                
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 1) {
                        toastr.warning(data.Message, "warning");
                    }
                    $('#buttonsave').attr("disabled", false);
                    $('#buttonsave1').attr("disabled", false);
                    if (data.ReturnFlag == "2") {
                        $scope.CancelAddICD10Popup();
                        $scope.CancelEditICD10Popup();
                        $scope.PatientICD10List();
                    }
                });
            }
        }


        $scope.ActiveStatus = 1;
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.ICDListpageTabCount = 1;
        $scope.ICD10TabLoadList = function () {
            $('.chartTabs').addClass('charTabsNone');
            if ($scope.ICDListpageTabCount == 1) {
                $scope.PatientICD10List();
            }
            $scope.ICDListpageTabCount = $scope.ICDListpageTabCount + 1;
        }

        $scope.setPage2 = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageICD;
            }
            else {
                $scope.inputPageICD = PageNo;
            }
            $scope.current_pageICD = PageNo;
            $scope.PatientICD10List();

        }

        /* Patient ICD10 Details list function*/
        $scope.ICDListTabCount = 1;
        $scope.PatientICD10List = function () {
            $scope.ICD10_flag = 0;
            $scope.DiagnosisICD10List = [];
            $scope.rowcollectionfiltericd10 = [];
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_pageICD - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_pageICD * $scope.page_size;
                $scope.ISact = 1;
                if ($scope.allergyActive == true) {
                    $scope.ISact = 1
                }
                else if ($scope.allergyActive == false) {
                    $scope.ISact = -1
                }
                $("#chatLoaderPV").show();
                $scope.SearchMsg = "No Data Available"
                $http.get(baseUrl + 'api/User/PatientICD10_Details_List/?Patient_Id=' + $scope.SelectedPatientId + '&Isactive=' + $scope.ISact + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart +
                    '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.DiagnosisICD10List = [];
                        $scope.DiagnosisICD10List = data.MasterICD;
                        if ($scope.DiagnosisICD10List.length > 0) {
                            $scope.ICD10Count = $scope.DiagnosisICD10List[0].TotalRecord;
                        } else {
                            $scope.ICD10Count = 0
                        }
                        $scope.rowcollectionfiltericd10 = angular.copy($scope.DiagnosisICD10List);
                        if ($scope.rowcollectionfiltericd10.length > 0) {
                            $scope.flag = 1;
                        }
                        else {
                            $scope.flag = 0;
                        }
                        $scope.PatientIcdPages = Math.ceil(($scope.ICD10Count) / ($scope.page_size));
                    }).error(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.error = "the error occured! " + data;
                    })
            }).error(function (data) {
                $("#chatLoaderPV").hide();
                $scope.error = "AN error has occured while Listing the records!" + data;
            })
            $scope.SearchMsg = "No Data Available";
        }


        /* FILTER THE  LIST FUNCTION.*/
        $scope.searchquerydata = "";
        $scope.rowcollectionfiltericd10emptyData = [];
        $scope.filterICD10List = function () {
            $scope.ResultListFiltered = [];
            $scope.rowcollectionfiltericd10emptyData = [];
            var searchstring = angular.lowercase($scope.searchquerydata);
            if ($scope.searchquerydata == "") {
                $scope.rowcollectionfiltericd10 = [];
                $scope.rowcollectionfiltericd10 = angular.copy($scope.DiagnosisICD10List);
            }
            else {
                $scope.rowcollectionfiltericd10 = $ff($scope.DiagnosisICD10List, function (value) {
                    return angular.lowercase(value.CategoryName).match(searchstring) ||
                        angular.lowercase(value.ICD_Code).match(searchstring) ||
                        angular.lowercase(value.Description).match(searchstring) ||
                        angular.lowercase(value.Doctor_Name).match(searchstring) ||
                        angular.lowercase($filter('date')(value.Active_From, "dd-MMM-yyyy")).match(searchstring) ||
                        angular.lowercase($filter('date')(value.Active_To, "dd-MMM-yyyy")).match(searchstring);
                });
                $scope.PatientIcdPages = Math.ceil(($scope.rowcollectionfiltericd10) / ($scope.page_size));
            }
        }


        /* Patient ICD10 Details View function*/
        $scope.PatientICD10Details_View = function () {
            $scope.AddICD10List = [];
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/User/PatientICD10_Details_View/?ID=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.AddICD10List = [{
                    'Id': data.Id,
                    'Category_ID': data.Category_ID == null ? 0 : data.Category_ID.toString(),
                    'Category_Name': data.CategoryName,
                    'Code_ID': data.Code_ID.toString(),
                    'ICD_Code': data.ICD_Code,
                    'ICD_Description': data.Description,
                    'Created_By': data.Doctor_Name,
                    'Active_From': DateFormatEdit(moment(data.Active_From).format('DD-MMM-YYYY')),
                    'Active_To': DateFormatEdit(moment(data.Active_To).format('DD-MMM-YYYY')),
                    'ICD_Remarks': data.Remarks
                }];

                $scope.Id = data.Id;
                $scope.Category_ID = data.Category_ID;
                $scope.Code_ID = data.Code_ID;
                $scope.CategoryName = data.CategoryName;
                $scope.ICD_Code = data.ICD_Code;
                $scope.ICD_Description = data.Description;
                $scope.Created_By = data.Doctor_Name;
                $scope.Active_From = DateFormatEdit(moment(data.Active_From).format('DD-MMM-YYYY'));
                $scope.Active_To = DateFormatEdit(moment(data.Active_To).format('DD-MMM-YYYY'));
                $scope.ICD_Remarks = data.Remarks;
                //$scope.Icd10Clear();
                // $scope.ICD10CodeByCategory($scope.Category_ID);
            });
        }


        $scope.Defaultcategory = function () {
            $scope.Category_ID = $scope.Category_ID;
        }

        $scope.Icd10Clear = function () {
            $scope.Id = 0,
                $scope.Category_ID = 0,
                $scope.ICD_Description = "",
                $scope.ICDCode = "",
                $scope.Category_Name = "",
                $scope.Active_From = "",
                $scope.Active_To = "",
                $scope.Code_ID = "",
                $scope.ICD10CodeList = [];
            $scope.ICD10CodeListsFilter = [];
            $scope.selectedICD10Row = "";

            $scope.Active_From = new Date(DatetimepickermaxDate);
            $scope.Active_To = new Date(DatetimepickermaxDate);
        }

        /*THIS IS FOR DELETE FUNCTION */
        $scope.ViewICD10_Delete = function () {

            var del = confirm("Do you like to deactivate the selected ICD 10 details?");
            if (del == true) {
                $http.get(baseUrl + '/api/User/PatientICD10_Details_InActive/?ID=' + $scope.Id).success(function (data) {
                    //alert(" ICD10 details has been deactivated Successfully");
                    toastr.success("ICD10 details has been deactivated Successfully", "success");
                    $scope.PatientICD10List();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  ICD 10 details" + data;
                });
            }
        };

        /* Patient ICD10 Details Active function*/
        $scope.ActiveICD10 = function (PId) {
            $scope.Id = PId;
            $scope.ICDMaster_Active();
        };

        $scope.PatientICD10_Active = function () {

            var Ins = confirm("Do you like to activate the selected ICD10 details?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/User/PatientICD10_Details_Active/?ID=' + $scope.Id).success(function (data) {
                    //alert("Selected ICD 10 details has been activated successfully");
                    toastr.success("Selected ICD 10 details has been activated successfully", "success");
                    $scope.PatientICD10List();
                }).error(function (data) {
                    $scope.error = "An error has occured while deleting ICD1O records" + data;
                });
            }
        };
        /***To get ICD10Code Search filter List Function**/
        $scope.ICD10CodeSearch = "";
        $scope.ICD10CodeList = [];
        $scope.ICD10CodeListsFilter = [];
        $scope.SelectedIcdRow = 0;

        $scope.ICD10codesearchkey = function (Selectedrow) {
            var SearchICD10Code = angular.lowercase($scope.ICD10CodeSearch);

            if (SearchICD10Code.length >= 3) {
                $http.get(baseUrl + 'api/User/ICD10Code_List/?ICD10CodeSearch=' + SearchICD10Code + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
                    $scope.ICD10CodeList = [];
                    $scope.ICD10CodeListsFilter = [];
                    $scope.ICD10CodeList = data;
                    $scope.ICD10CodeListsFilter = angular.copy($scope.ICD10CodeList);
                    if ($scope.ICD10CodeListsFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $scope.SearchMsg = "No Data Available";
                });
            }

        }

        /**ICD10 Code Search button Click Popup window**/
        $scope.ICD10codeSearchPopup = function (SelectedRow) {
            $scope.ICD10CodeSearch = "";
            $scope.selectedICD10Row = SelectedRow;
            angular.element('#ICD10CodeListModal').modal('show');
            $("#txtICD10CodeSearch").focus();
        }
        /**ICD10 Code Select button Click Popup window**/
        $scope.ICD10CodeSelect = function (ICD10codeItem) {
            angular.forEach($scope.AddICD10List, function (value, index) {

                if (index == $scope.selectedICD10Row) {
                    value.Code_ID = ICD10codeItem.Id;
                    value.ICD_Code = ICD10codeItem.ICD_Code;
                    value.CategoryName = ICD10codeItem.CategoryName;
                    value.Description = ICD10codeItem.Description;
                }
            });
            angular.element('#ICD10CodeListModal').modal('hide');
        }

        /**ICD10 Code Cancel Popup window**/
        $scope.ICD10codeSearchCancelPopup = function () {
            angular.element('#ICD10CodeListModal').modal('hide');
        }

        $scope.InActiveICDPatient = function (comId) {
            $scope.Id = comId;
            $scope.ICD10Details_Delete();
        };
        $scope.ICD10Details_Delete = function () {
            var del = confirm("Do you like to deactivate the selected ICD10 Details?");
            if (del == true) {
                $http.get(baseUrl + '/api/User/PatientICD10Details_InActive/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected ICD10 Details has been deactivated Successfully");
                    toastr.success("Selected ICD10 Details has been deactivated Successfully", "success");
                    $scope.PatientICD10List();
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting ICD10 Details!" + data;
                });
            };
        };

        /*'Active' the ICD10Details*/
        $scope.ActiveICDPatient = function (comId) {
            $scope.Id = comId;
            $scope.ICD10Details();

        };

        /* 
        Calling the api method to inactived the details of the ICD10Details 
        for the  ICD10Details Id,
        and redirected to the list page.
        */
        $scope.ICD10Details = function () {
            var Ins = confirm("Do you like to activate the selected ICD10 Details?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/User/PatientICD10Details_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected ICD10 Details has been activated successfully");
                    toastr.success("Selected ICD10 Details has been activated successfully", "success");
                    $scope.PatientICD10List();
                }).error(function (data) {
                    $scope.error = "An error has occurred while ICD10 Details" + data;
                });
            };
        }

        //  This is for  Patient Medication function	
        // This is for AddPopup	
        $scope.MedicationTabCount = 1;
        $scope.AddMedicationPopUp = function () {
            $scope.PatientMedicationCreateModalClear();
            if ($scope.MedicationTabCount == 1) {
                $scope.DropLoadMedication();
                $scope.MedicationTabCount = $scope.MedicationTabCount + 1;
            }
            $('#save1').attr("disabled", false);
            angular.element('#PatientMedicationCreateModal').modal('show');
            setTimeout(function () {
                $scope.calenderSet1($scope.AddMedicationDetails.length);
            }, 1000);

        }
        $scope.CancelMedicationPopUp = function () {
            angular.element('#PatientMedicationCreateModal').modal('hide');
        }
        $scope.DrugDropDown = 2;
        //This is for viewpopup	
        $scope.MedicationViewPopup = function (MedicationViewId, editval) {
            if (editval == 2) {
                $scope.Id = MedicationViewId;
                $scope.PatientMedicationView();
                $scope.DrugDropDown = 1;
                $scope.PatientMedicationCreateModalClear();
                angular.element('#ViewMedicationPopModal').modal('show');
            }
        }
        $scope.CancelViewPopup = function () {
            $scope.PatientMedicationCreateModalClear();
            angular.element('#ViewMedicationPopModal').modal('hide');
        }
        //This is for Editpopup	
        $scope.EditMedication = function (MedicationViewId, createdDt, editval) {
            $('#save1').attr("disabled", false);
            if ($scope.IsEditableCheck(createdDt) == false) {
                //alert("Medication Cannot be edited");
                toastr.info("Medication Cannot be edited", "info");
            }
            else {
                if (editval == 3) {
                    if ($scope.MedicationTabCount == 1) {
                        $scope.DropLoadMedication();
                        $scope.MedicationTabCount = $scope.MedicationTabCount + 1;
                    }
                    // $scope.medId=MedicationViewId;	
                    $scope.Id = MedicationViewId;
                    $scope.PatientMedicationView();
                    $scope.DrugDropDown = 2;
                    $scope.PatientMedicationCreateModalClear();
                    angular.element('#PatientMedicationEditModal').modal('show');
                }
            }
        }
        $scope.CancelEditPopUp = function () {
            $scope.PatientMedicationCreateModalClear();
            angular.element('#PatientMedicationEditModal').modal('hide');
        }

        $scope.MedicationListTabCount = 1;
        $scope.MedicationTabLoadList = function () {
            $('.chartTabs').addClass('charTabsNone');
            if ($scope.MedicationListTabCount == 1) {
                $scope.PatientMedicationList();
            }
            $scope.MedicationListTabCount = $scope.MedicationListTabCount + 1;
        }
        $scope.FrequencyDuplicateId = "0";
        $scope.RouteDuplicateId = "0";
        $scope.DropLoadMedication = function () {
            if ($scope.UserTypeId == 4 || $scope.UserTypeId == 5 || $scope.UserTypeId == 7) {
                // This is for DropDown list	
                $scope.DrugIds = "0";
                $scope.DrugId = "0";
                $scope.RouteId = "0";
                FrequencyId = "0";
                $scope.DrugbasedDetails = function (DrugId, $index) {
                    $scope.DrugId = DrugId;
                    $http.get(baseUrl + '/api/User/DrugCodeBased_DrugDetails/?DrugCodeId=' + $scope.DrugId + '&Institution_Id=' + $scope.Institution_Id).success(function (data) {
                        angular.forEach($scope.AddMedicationDetails, function (value1, index1) {
                            angular.forEach(data, function (value, index) {
                                if (value1.DrugId == value.DrugId) {
                                    value1.GenericName = value.Generic_name;
                                    value1.StrengthName = value.StrengthName;
                                    value1.Dosage_FromName = value.Dosage_FromName;
                                    value1.Item_Code = value.Item_Code;
                                }
                            });
                        });
                    });
                }
                $scope.DrugbasedDetailsClearFunction = function () {
                    $scope.DrugCodeId = "0";
                }
                $scope.RouteList = [];
                $http.get(baseUrl + 'api/User/RouteList/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                    $scope.RouteListTemp = [];
                    $scope.RouteListTemp = data;
                    var obj = { "Id": 0, "RouteName": "Select", "IsActive": 1 };
                    $scope.RouteListTemp.splice(0, 0, obj);
                    $scope.RouteList = angular.copy($scope.RouteListTemp);
                })
                $scope.FrequencyList = [];
                $http.get(baseUrl + 'api/User/FrequencyList/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                    $scope.FrequencyListTemp = [];
                    $scope.FrequencyListTemp = data;
                    var obj = { "Id": 0, "FrequencyName": "Select", "IsActive": 1 };
                    $scope.FrequencyListTemp.splice(0, 0, obj);
                    $scope.FrequencyList = angular.copy($scope.FrequencyListTemp);
                })
                $scope.FrequencybasedDetailslist = function (row) {
                    $scope.FrequencyId = row.FrequencyId;
                    $http.get(baseUrl + '/api/User/FrequencybasedDetails/?FrequencyId=' + $scope.FrequencyId).success(function (data) {
                        row.NoOfDays = data.NoOfDays;
                        $scope.NoOfDays = data.NoOfDays;
                    });
                }
            }
        }
        // Add row concept  for Patient MedicationDetails
        $scope.AddMedicationDetails = [{
            'Id': 0,
            'PatientId': 0,
            'DrugId': "",
            'FrequencyId': 0,
            'RouteId': 0,
            'NoOfDays': "",
            ' StartDate': "",
            'EndDate': "",
            ' Created_By': 0

        }];
        // Add row function for Patient MedicationDetails
        $scope.AddMedicationDetailsInsert = function () {
            if ($scope.AddMedicationDetails.length > 0) {
                var obj = {
                    'Id': 0,
                    'PatientId': 0,
                    'DrugId': "",
                    'FrequencyId': 0,
                    'RouteId': 0,
                    'NoOfDays': "",
                    'StartDate': new Date(DatetimepickermaxDate),
                    'EndDate': new Date(DatetimepickermaxDate),
                    ' Created_By': 0
                }
                $scope.AddMedicationDetails.push(obj);
            }
            else {
                $scope.AddMedicationDetails = [{
                    'Id': 0,
                    'PatientId': 0,
                    'DrugId': "",
                    'FrequencyId': 0,
                    'RouteId': 0,
                    'NoOfDays': "",
                    'StartDate': new Date(DatetimepickermaxDate),
                    'EndDate': new Date(DatetimepickermaxDate),
                    ' Created_By': 0
                }];
            }
            $scope.DrugcodeSearchPopup($scope.AddMedicationDetails.length - 1);
            setTimeout(function () {
                $scope.calenderSet1($scope.AddMedicationDetails.length);
            }, 1000);

        };
        $scope.calenderSet1 = function (idxval) {
            $("#DivMedicationFrom" + idxval).bootstrapDP({
                format: "dd-M-yyyy",
                forceParse: false,
                //endDate: '+0d',
                startDate: new Date(),
                autoclose: true,
                todayHighlight: true,
                toggleActive: true,
                todayBtn: true
            });

            $("#DivMedicationTo" + idxval).bootstrapDP({
                format: "dd-M-yyyy",
                forceParse: false,
                //endDate: '+0d',
                startDate: new Date(),
                autoclose: true,
                todayHighlight: true,
                toggleActive: true,
                todayBtn: true
            });
        }
        //This is for MedicationDetailsDelete
        $scope.MedicationDetailsDelete = function (itemIndex) {
            var del = confirm("Do you like to delete the selected Details?");
            if (del == true) {
                $scope.AddMedicationDetails.splice(itemIndex, 1);
                if ($scope.AddMedicationDetails.length == 0) {
                    $scope.AddMedicationDetails = [{
                        'Id': 0,
                        'PatientId': 0,
                        'DrugId': "",
                        'FrequencyId': 0,
                        'RouteId': 0,
                        'NoOfDays': "",
                        'StartDate': new Date(DatetimepickermaxDate),
                        'EndDate': new Date(DatetimepickermaxDate),
                        ' Created_By': 0
                    }];
                }
            }
        };
        ///* This is for PatientMedication Insert and update Validations */
        $scope.PatientMedication_InsertUpdate_Validationcontrols = function () {
            var Drugflag = 0;
            var Frequency = 0;
            var Route = 0;
            var Startdate = 0;
            var Enddate = 0;
            var dateval = 0;
            var validateflag = true;
            var validationMsg = "";
            angular.forEach($scope.AddMedicationDetails, function (value, index) {

                if (value.DrugCodeId == null) {
                    Drugflag = 1;
                }
                if (value.FrequencyId == "") {
                    Frequency = 1;
                }
                if (value.RouteId == "") {
                    Route = 1;
                }
                if (value.StartDate == null || value.StartDate == "") {
                    Startdate = 1;
                }
                if (value.EndDate == null || value.EndDate == "") {
                    Enddate = 1;
                }
                if ((value.StartDate !== null) && (value.EndDate !== null)) {
                    value.StartDate = moment(value.StartDate).format('DD-MMM-YYYY');
                    value.EndDate = moment(value.EndDate).format('DD-MMM-YYYY');

                    if ((ParseDate(value.EndDate) < ParseDate(value.StartDate))) {
                        dateval = 1;
                    }
                    value.StartDate = DateFormatEdit(value.StartDate);
                    value.EndDate = DateFormatEdit(value.EndDate);
                }
            });
            if (Drugflag == 1) {
                //alert("Please select Drug Code");
                toastr.warning("Please select Drug Code", "warning");
                return false;
            }
            if (Frequency == 1) {
                //alert("Please select Frequency");
                toastr.warning("Please select Frequency", "warning");
                return false;
            }
            if (Route == 1) {
                //alert("Please select Route");
                toastr.warning("Please select Route", "warning");
                return false;
            }
            if (Startdate == 1) {
                //alert("Please select Start date");
                toastr.warning("Please select Start date", "warning");
                return false;
            }
            if (Enddate == 1) {
                //alert("Please select End date");
                toastr.warning("Please select End date", "warning");
                return false;
            }
            if (dateval == 1) {
                //alert("Start Date Should not be greater than End Date");
                toastr.warning("Start Date Should not be greater than End Date", "warning");
                return false;
            };
            return true;
        }

        //search  query
        $scope.filterMedicationList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.Medicationsearchquery);
            if ($scope.Medicationsearchquery == "") {
                $scope.PatientMedicationListData = angular.copy($scope.PatientMedicationListFilterData);

            }
            else {
                $scope.PatientMedicationListData = $ff($scope.PatientMedicationListFilterData, function (value) {
                    return angular.lowercase(value.Drug_Code).match(searchstring) ||
                        angular.lowercase(value.FrequencyName).match(searchstring) ||
                        angular.lowercase(value.FrequencyName).match(searchstring) ||
                        angular.lowercase(value.Generic_name).match(searchstring) ||
                        angular.lowercase(value.Item_Code).match(searchstring) ||
                        angular.lowercase(value.Dosage_FromName).match(searchstring) ||
                        angular.lowercase(value.StrengthName).match(searchstring) ||
                        //  angular.lowercase(value.NoOfDays).match(searchstring)||
                        angular.lowercase(value.RouteName).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.StartDate, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.EndDate, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);


                });
            }
        }
        /***To get Drug Code Search filter List Function**/
        $scope.CodeSearch = "";
        $scope.DrugCodeList = [];
        $scope.DrugCodeListsFilter = [];
        $scope.selectedMedicationRow = 0;
        $scope.Drugcodesearchkey = function (selectedRow) {
            var SearchDrugCode = angular.lowercase($scope.CodeSearch);
            if (SearchDrugCode.length > 2) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + 'api/User/DrugCode_List/?DrugCodeSearch=' + SearchDrugCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.SearchMsg = "No Data Available";
                    $scope.DrugCodeList = [];
                    $scope.DrugCodeListsFilter = [];
                    $scope.DrugCodeList = data;
                    $scope.DrugCodeListsFilter = angular.copy($scope.DrugCodeList);
                    if ($scope.DrugCodeListsFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }

                });
            }
            else {
                $scope.DrugCodeList = [];
                $scope.DrugCodeListsFilter = [];
            }
            angular.element('#DrugCodeListModal').modal('show');

        }
        /**Drug Code Search button Click Popup window**/
        $scope.DrugcodeSearchPopup = function (selectedRow) {
            $scope.CodeSearch = "";
            $scope.DrugCodeListsFilter = [];
            $scope.selectedMedicationRow = selectedRow;
            angular.element('#DrugCodeListModal').modal('show');
            $("#txtdrugCodeSearch").focus();
        }
        $scope.DrugCodeSelect = function (rowItem) {
            angular.forEach($scope.AddMedicationDetails, function (value, index) {
                if (index == $scope.selectedMedicationRow) {
                    value.DrugCodeId = rowItem.Id;
                    value.DrugCode = rowItem.Drug_Code;
                    value.Generic_name = rowItem.Generic_name;
                    value.StrengthName = rowItem.StrengthName;
                    value.Dosage_FormName = rowItem.Dosage_FromName;
                    value.Item_Code = rowItem.Item_Code;
                }
            });

            if ($scope.Id > 0) {
                angular.forEach($scope.AddMedicationDetails, function (value, index) {
                    $scope.Generic_name = value.GenericName;
                });
            }
            angular.element('#DrugCodeListModal').modal('hide');
        }

        $scope.DrugcodeSearchCancelPopup = function () {
            angular.element('#DrugCodeListModal').modal('hide');
        }
        $scope.PatientMedication_EditInsert_Validationcontrols = function () {
            if (typeof ($scope.DrugId) == "undefined" || $scope.DrugId == 0) {
                //alert("Please select Drug Code");
                toastr.warning("Please select Drug Code", "warning");
                return false;
            }
            else if (typeof ($scope.FrequencyId) == "undefined" || $scope.FrequencyId == 0) {
                //alert("Please select Frequency");
                toastr.warning("Please select Frequency", "warning");
                return false;
            }
            else if (typeof ($scope.NoOfDays) == "undefined" || $scope.FrequencyId == "") {
                //alert("Please enter No. of Days");
                toastr.warning("Please enter No. of Days", "warning");
                return false;
            }
            else if (typeof ($scope.RouteId) == "undefined" || $scope.RouteId == 0) {
                //alert("Please select Route");
                toastr.warning("Please select Route", "warning");
                return false;
            }
            else if (typeof ($scope.StartDate) == "undefined" || $scope.StartDate == 0) {
                //alert("Please select StartDate");
                toastr.warning("Please select StartDate", "warning");
                return false;
            }
            else if (typeof ($scope.EndDate) == "undefined" || $scope.EndDate == 0) {
                //alert("Please select EndDate");
                toastr.warning("Please select EndDate", "warning");
                return false;
            }
            else if (($scope.StartDate !== null) && ($scope.EndDate !== null)) {
                $scope.StartDate = moment($scope.StartDate).format('DD-MMM-YYYY');
                $scope.EndDate = moment($scope.EndDate).format('DD-MMM-YYYY');

                if ((ParseDate($scope.EndDate) < ParseDate($scope.StartDate))) {
                    //alert("Start Date Should not be greater than End Date");
                    toastr.warning("Start Date Should not be greater than End Date", "warning");
                    $scope.StartDate = DateFormatEdit($scope.StartDate);
                    $scope.EndDate = DateFormatEdit($scope.EndDate);
                    return false;
                }
                $scope.StartDate = DateFormatEdit($scope.StartDate);
                $scope.EndDate = DateFormatEdit($scope.EndDate);
            }
            return true;
        };

        $scope.MedicationList = [];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.PatientMedication_EditInsert = function () {
            $scope.MedicationList = [];
            if ($scope.PatientMedication_EditInsert_Validationcontrols() == true) {
                $('#save2').attr("disabled", true);
                var Medicationobj = {
                    Id: $scope.Id,
                    PatientId: $scope.SelectedPatientId,
                    DrugId: $scope.DrugCodeId,
                    FrequencyId: $scope.FrequencyId,
                    RouteId: $scope.RouteId,
                    NoOfDays: $scope.NoOfDays,
                    StartDate: $scope.StartDate,
                    EndDate: $scope.EndDate,
                    Created_By: $window.localStorage['UserId'],
                    Modified_By: $window.localStorage['UserId'],
                    InstitutionId: $window.localStorage['InstitutionId']
                }
                $scope.MedicationList.push(Medicationobj);
                $http.post(baseUrl + '/api/User/MedicationInsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, $scope.MedicationList).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.error(data.Message, "warning");
                    }
                    $('#save2').attr("disabled", false);
                    if (data.ReturnFlag == "2") {
                        $scope.PatientMedicationCreateModalClear();
                        $scope.CancelMedicationPopUp();
                        $scope.CancelEditPopUp();
                        $scope.PatientMedicationList();
                    }

                });
            }
        };

        // This is for Medication InsertUpdate
        $scope.Id = 0;
        $scope.AddMedicationDetails = [];
        $scope.PatientMedication_InsertUpdate = function (itemIndex) {

            if ($scope.PatientMedication_InsertUpdate_Validationcontrols() == true) {
                $('#save1').attr("disabled", true);
                $scope.MedicationList = [];
                $("#chatLoaderPV").show();
                angular.forEach($scope.AddMedicationDetails, function (value, index) {
                    var Medicationobj = {
                        Id: value.Id,
                        PatientId: $scope.SelectedPatientId,
                        DrugId: value.DrugCodeId,
                        FrequencyId: value.FrequencyId,
                        RouteId: value.RouteId,
                        NoOfDays: value.NoOfDays,
                        StartDate: value.StartDate,
                        EndDate: value.EndDate,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.MedicationList.push(Medicationobj);
                });

                $http.post(baseUrl + '/api/User/MedicationInsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, $scope.MedicationList).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $('#save1').attr("disabled", false);
                    if (data.ReturnFlag == "2") {
                        $scope.PatientMedicationCreateModalClear();
                        $scope.CancelMedicationPopUp();
                        $scope.CancelEditPopUp();
                        $scope.PatientMedicationList();
                    }

                });
            }
        }

        $scope.setPage3 = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageBox;
            }
            else {
                $scope.inputPageBox = PageNo;
            }
            $scope.current_pagePillBox = PageNo;
            $scope.PatientMedicationList();

        }

        //MedicationList
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.Medication_flag = 0;
        $scope.MedicationActive = true;
        $scope.PatientMedicationEmptyData = [];
        $scope.PatientMedicationListData = [];
        $scope.PatientMedicationListFilterData = [];
        $scope.PatientMedicationList = function () {
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_pagePillBox - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_pagePillBox * $scope.page_size;

                $scope.ISact = 1;       // default active
                if ($scope.MedicationActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.MedicationActive == false) {
                    $scope.ISact = -1 //all
                }
                $("#chatLoaderPV").show();
                $http.get(baseUrl + 'api/User/MedicationList/?Patient_Id=' + $scope.SelectedPatientId + '&IsActive=' + $scope.ISact + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart +
                    '&EndRowNumber=' + $scope.PageEnd).success(function (data) {

                        $("#chatLoaderPV").hide();
                        $scope.SearchMsg = "No Data Available";
                        $scope.PatientMedicationEmptyData = [];
                        $scope.PatientMedicationDataList = [];
                        $scope.PatientMedicationListData = data.DrugDBMaster;
                        if ($scope.PatientMedicationListData.length > 0) {
                            $scope.PatientMedicationcount = $scope.PatientMedicationListData[0].TotalRecord;
                        } else {
                            $scope.PatientMedicationcount = 0
                        }
                        $scope.PatientMedicationListFilterData = data.DrugDBMaster;
                        $scope.PatientMedicationDataList = angular.copy($scope.PatientMedicationListData);
                        if ($scope.PatientMedicationDataList.length > 0) {
                            $scope.flag = 1;
                        }
                        else {
                            $scope.flag = 0;
                        }
                        $scope.PatientPillBoxPages = Math.ceil(($scope.PatientMedicationcount) / ($scope.page_size));
                    })
            }).error(function (data) {
                $("#chatLoaderPV").hide();
                $scope.error = "AN error has occured while Listing the records!" + data;
            })
        }
        //Medication View	
        $scope.PatientMedicationView = function () {
            $http.get(baseUrl + 'api/User/MedicationView/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.AddMedicationDetails = [{
                    'Id': data.Id,
                    'DrugId': data.DrugId.toString(),
                    'DrugCode': data.Drug_Code,
                    'Generic_name': data.Generic_name,
                    'StrengthName': data.StrengthName,
                    'Item_Code': data.Item_Code,
                    'FrequencyId': data.FrequencyId.toString(),
                    'NoOfDays': data.NoOfDays,
                    'RouteId': data.RouteId.toString(),
                    'StartDate': DateFormatEdit($filter('date')(data.StartDate, "dd-MMM-yyyy")),
                    'EndDate': DateFormatEdit($filter('date')(data.EndDate, "dd-MMM-yyyy"))
                }];
                $scope.Id = data.Id,
                    $scope.DrugId = data.DrugId.toString();
                $scope.Drug_Code = data.Drug_Code;
                $scope.DrugCodeId = data.DrugId,
                    $scope.Generic_name = data.Generic_name,
                    $scope.Item_Code = data.Item_Code,
                    $scope.StrengthName = data.StrengthName,
                    $scope.Dosage_FromName = data.Dosage_FromName,
                    $scope.ViewDrugCode = data.Drug_Code,
                    $scope.FrequencyId = data.FrequencyId.toString(),
                    $scope.FrequencyDuplicateId = $scope.FrequencyId;
                $scope.ViewFrequencyName = data.FrequencyName,
                    $scope.NoOfDays = data.NoOfDays,
                    $scope.RouteId = data.RouteId.toString(),
                    $scope.RouteDuplicateId = $scope.RouteId;
                $scope.ViewRouteName = data.RouteName,
                    $scope.StartDate = DateFormatEdit($filter('date')(data.StartDate, "dd-MMM-yyyy"));
                $scope.EndDate = DateFormatEdit($filter('date')(data.EndDate, "dd-MMM-yyyy"));
                if ($scope.DrugDropDown == 2) {
                    $scope.DrugbasedDetails($scope.DrugId);
                }
            });
        }
        $scope.PatientMedicationCreateModalClear = function () {
            $scope.AddMedicationDetails = [{
                'Id': 0,
                'DrugId': 0,
                'Generic_name': '',
                'Item_Code': '',
                'Dosage_FromName': '',
                'StrengthName': '',
                'FrequencyId': 0,
                'NoOfDays': '',
                'RouteId': 0,
                'StartDate': new Date(DatetimepickermaxDate),
                'EndDate': new Date(DatetimepickermaxDate)
            }];
        }
        $scope.CancelEditMedicationPopUp = function () {
            $scope.PatientMedicationCreateModalClear();
            angular.element('#PatientMedicationEditModal').modal('hide');
        }



        /* 
       Calling the api method to detele the details of the Medication
       for the  Medication Id,
       and redirected to the list page.
       */
        $scope.InActiveMedication = function (MedId) {
            $scope.Id = MedId;
            $scope.Medication_Delete();
        };
        $scope.Medication_Delete = function () {
            var del = confirm("Do you like to deactivate the selected Medication?");
            if (del == true) {
                $http.get(baseUrl + '/api/User/MedicationDetails_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Medication has been deactivated Successfully");
                    toastr.success("Selected Medication has been deactivated Successfully", "success");
                    $scope.PatientMedicationList();
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting Medication!" + data;
                });
            };
        };

        /*'Active' the Medication*/
        $scope.ActiveMedication = function (MedId) {
            $scope.Id = MedId;
            $scope.MedicationDetails();
        };

        /* 
        Calling the api method to inactived the details of the Medication 
        for the  Medication Id,
        and redirected to the list page.
        */
        $scope.MedicationDetails = function () {
            var Ins = confirm("Do you like to activate the selected Medication?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/User/MedicationDetails_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Medication has been activated successfully");
                    toastr.success("Selected Medication has been activated successfully", "success");
                    $scope.PatientMedicationList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while Medication" + data;
                });
            };
        }

        $scope.AllergyTabClick = 1;
        $scope.AllergyClickDetailsList = function () {
            if ($scope.AllergyTabClick == 1) {
                $scope.AllergyDetailsList();
                $scope.AllergyTabClick = $scope.AllergyTabClick + 1;
            }
        }
        $scope.AllergyDropDown = 2;
        $scope.AllergenId = "0";
        $scope.AllergyTypeId = "0";
        $scope.AllergyOnsetId = "0";
        $scope.AllergySeverityId = "0";
        $scope.AllergyReactionId = "0";
        $scope.AllergyDetailsList = function () {
            /* This is for Patient Allergy Details*/
            $scope.AllergyTypeList = [];
            $http.get(baseUrl + 'api/User/AllergyTypeList/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                $scope.AllergyTypeListTemp = [];
                $scope.AllergyTypeListTemp = data;
                var obj = { "Id": 0, "AllergyTypeName": "Select", "IsActive": 1 };
                $scope.AllergyTypeListTemp.splice(0, 0, obj);
                $scope.AllergyTypeList = angular.copy($scope.AllergyTypeListTemp);
            })


            $scope.AllergenListfilter = [];
            $scope.AllegenBasedType = function (AllergyTypeId) {
                var id = "0"
                id = $scope.AllergenId;
                $http.get(baseUrl + 'api/User/AllergenList/?ALLERGYTYPE_ID=' + AllergyTypeId + '&Institution_Id=' + $scope.Institution_Id).success(function (data) {
                    $scope.AllergenListTemp = [];
                    $scope.AllergenListTemp = data;
                    var obj = { "Id": 0, "AllergenName": "Select", "IsActive": 1 };
                    $scope.AllergenListTemp.splice(0, 0, obj);
                    $scope.AllergenListfilter = angular.copy($scope.AllergenListTemp);
                    $scope.AllergenId = id;

                })
            }


            $scope.AllergenNameClearFunction = function () {
                $scope.AllergenId = "0";
            }

            $scope.AllergyOnsetList = [];
            $http.get(baseUrl + 'api/User/AllergyOnsetList/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                $scope.AllergyOnsetListTemp = [];
                $scope.AllergyOnsetListTemp = data;
                var obj = { "Id": 0, "AllergyOnsetName": "Select", "IsActive": 1 };
                $scope.AllergyOnsetListTemp.splice(0, 0, obj);
                $scope.AllergyOnsetList = angular.copy($scope.AllergyOnsetListTemp);
            })

            $scope.AllergySeverityList = [];
            $http.get(baseUrl + 'api/User/AllergySeverityList/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                $scope.AllergySeverityListTemp = [];
                $scope.AllergySeverityListTemp = data;
                var obj = { "Id": 0, "AllergySeverityName": "Select", "IsActive": 1 };
                $scope.AllergySeverityListTemp.splice(0, 0, obj);
                $scope.AllergySeverityList = angular.copy($scope.AllergySeverityListTemp);
            })
            $scope.AllergyReactionList = [];
            $http.get(baseUrl + 'api/User/AllergyReactionList/?Institution_Id=' + $scope.Institution_Id).success(function (data) {
                $scope.AllergyReactionList = data;
            })
        }
        $scope.AddAllergyPopUp = function () {
            $scope.PatientAllergyCreateModalClear();
            $scope.AllergyClickDetailsList();
            $('#Allergysave').attr("disabled", false);
            angular.element('#PatientAllergyCreateModal').modal('show');
        }
        $scope.CancelAllergyPopUp = function () {
            angular.element('#PatientAllergyCreateModal').modal('hide');
        }

        /*This is for Patient Allergy View Popup*/
        $scope.PatientAllergyViewPopUp = function (AllergyViewId) {
            $scope.PatientAllergyCreateModalClear();
            $scope.Id = AllergyViewId;
            $scope.PatientAllergyView();
            $scope.AllergyDropDown = 1;
            angular.element('#ViewAllergyPopModal').modal('show');
        }
        $scope.CancelViewAllergypopup = function () {
            angular.element('#ViewAllergyPopModal').modal('hide');
        }

        /* This is for Patient Allergy Edit Popup*/
        $scope.EditAllergy = function (AllergyViewId, createdDt) {
            $('#Allergysave').attr("disabled", false);
            if ($scope.IsEditableCheck(createdDt) == false) {
                //alert("Allergy Cannot be edited");
                toastr.info("Allergy Cannot be edited", "info");
            }
            else {
                $scope.AllergyClickDetailsList();
                $scope.Id = AllergyViewId;
                $scope.PatientAllergyView();
                $scope.AllergyDropDown = 2;
                angular.element('#PatientAllergyCreateModal').modal('show');
            }
        }
        $scope.CancelPopUp = function () {
            angular.element('#PatientAllergyCreateModal').modal('hide');
        }
        /* This is for Allergy Insert Update*/

        $scope.SelectedAllergyReaction = [];
        $scope.SelectedAllergyReactionList = [];
        $scope.Id = 0;
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.AllergyInsert_Update = function () {
            if ($scope.AllergyInsert_Update_Validationcontrols() == true) {
                $('#Allergysave').attr("disabled", true);
                $("#chatLoaderPV").show();
                $scope.SelectedAllergyReactionList = [];
                angular.forEach($scope.SelectedAllergyReaction, function (value, index) {

                    var obj = {
                        Id: value
                    }
                    $scope.SelectedAllergyReactionList.push(obj);
                });
                var obj = {
                    Id: $scope.Id,
                    OnSetDate: $scope.OnSetDate,
                    AllergenId: $scope.AllergenId,
                    AllergyTypeId: $scope.AllergyTypeId,
                    AllergyOnsetId: $scope.AllergyOnsetId == 0 ? null : $scope.AllergyOnsetId,
                    AllergySeverityId: $scope.AllergySeverityId == 0 ? null : $scope.AllergySeverityId,
                    AllergyReactionId: $scope.AllergyReactionId == 0 ? null : $scope.AllergyReactionId,
                    Remarks: $scope.Remarks == '' ? null : $scope.Remarks,
                    SelectedAllergyList: $scope.SelectedAllergyReactionList,
                    AllergyReaction_List: $scope.AllergyReactionList,
                    Patient_Id: $scope.SelectedPatientId,
                    Created_By: $window.localStorage['UserId'],
                    Modified_By: $window.localStorage['UserId'],
                };
                $("#chatLoaderPV").show();
                $http.post(baseUrl + 'api/User/Allergy_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $('#Allergysave').attr("disabled", false);
                    $scope.PatientAllergyList();
                    $scope.PatientAllergyCreateModalClear();
                    $scope.CancelAllergyPopUp();


                });
            }
        }
        /* This is for Mandatorycondition*/
        $scope.AllergyInsert_Update_Validationcontrols = function () {
            if (typeof ($scope.AllergyTypeId) == "" || $scope.AllergyTypeId == "0") {
                //alert("Please select Allergy Type Name ");
                toastr.warning("Please select Allergy Type Name ", "warning");
                return false;
            }
            else if (typeof ($scope.AllergenId) == "" || $scope.AllergenId == "0") {
                //alert("Please select Allergen Name");
                toastr.warning("Please select Allergen Name", "warning");
                return false;
            }
            return true;
        }
        $scope.setPage4 = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageAllergy;
            }
            else {
                $scope.inputPageAllergy = PageNo;
            }
            $scope.current_PatientAllergyPages = PageNo;
            $scope.PatientAllergyList();

        }
        /* This is for Patient Allergy List*/
        $scope.Allergy_flag = 0;
        $scope.PatientAllergyListData = [];
        $scope.PatientAllergyListFilterData = [];
        $scope.PatientAssignedknownAllergyDataList = [];
        $scope.PatientAssignedknownAllergyActiveDataList = [];
        $scope.PatientAssignedAllergyDataList = [];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.PatientAllergyList = function () {
            $("#chatLoaderPV").show();
            $('.chartTabs').addClass('charTabsNone');
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_PatientAllergyPages - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_PatientAllergyPages * $scope.page_size;
                $scope.ISact = 1;       // default active
                if ($scope.allergyActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.allergyActive == false) {
                    $scope.ISact = -1 //all
                }
                $http.get(baseUrl + 'api/User/PatientAllergylist/?Patient_Id=' + $scope.SelectedPatientId + '&IsActive=' + $scope.ISact + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart + '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.SearchMsg = "No Data Available";
                    $scope.PatientAllergyEmptyData = [];
                    $scope.PatientAllergyListData = [];
                    $scope.PatientAssignedAllergyDataList = [];
                    $scope.PatientAllergyListData = data.PatientAllergyDetails;
                    if ($scope.PatientAllergyListData.length > 0) {
                        $scope.PatientAllergyCount = $scope.PatientAllergyListData[0].TotalRecord;
                    } else {
                        $scope.PatientAllergyCount = 0;
                    }

                    $scope.PatientAllergyListFilterData = data.PatientAllergyDetails;
                    $scope.PatientAllergyCountFilterData = data.PatientAllergyDetails;
                    for (i = 0; i < $scope.PatientAllergyListFilterData.length; i++) {
                        if ($scope.PatientAllergyListFilterData[0].AllergyTypeName === "No Known Allergies") {
                            document.getElementById("IconAllergy").style.color = '#32CD32';
                        }
                        else if ($scope.PatientAllergyListFilterData[0].AllergyTypeName === "Unknown") {
                            document.getElementById("IconAllergy").style.color = '#FFD700';
                        }
                        else if ($scope.PatientAllergyListFilterData[0].AllergenName === "No Known Allergies") {
                            document.getElementById("IconAllergy").style.color = '#32CD32';
                        }
                        else if ($scope.PatientAllergyListFilterData[0].AllergenName === "Unknown") {
                            document.getElementById("IconAllergy").style.color = '#FFD700';
                        }
                        else {
                            //document.getElementById("IconAllergy").style.color = '#FF0000';
                        }
                    }
                    $scope.PatientAssignedAllergyDataList = angular.copy($scope.PatientAllergyListData);

                    // $scope.PatientAssignedknownAllergyDataList =angular.copy($scope.PatientAssignedAllergyDataList);
                    $scope.PatientAssignedknownAllergyActiveDataList = $ff($scope.PatientAllergyListFilterData, { IsActive: 1 }, true);

                    if ($scope.PatientAssignedAllergyDataList.length > 0) {
                        $scope.Allergy_flag = 1;
                    }
                    else {
                        $scope.Allergy_flag = 0;
                    }
                    $scope.PatientAllergyPages = Math.ceil(($scope.PatientAllergyCount) / ($scope.page_size));

                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            });
        };
        /* 
     Calling the api method to detele the details of the Allergy
     for the  Allergy Id,
     and redirected to the list page.
     */
        $scope.InActiveAllergy = function (comId) {
            $scope.Id = comId;
            $scope.Allergy_InActive();
        };
        $scope.Allergy_InActive = function () {
            var del = confirm("Do you like to deactivate the selected Allergy?");
            if (del == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/User/AllergyDetails_InActive/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.PatientAllergyList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Doctor Notes" + data;
                });
            };
        };

        /*'Active' the Allergy*/
        $scope.ActiveAllergy = function (comId) {
            $scope.Id = comId;
            $scope.Allergy_Active();
        };
        /* 
        Calling the api method to inactived the details of the Allergy 
        for the  Allergy Id,
        and redirected to the list page.
        */
        $scope.Allergy_Active = function () {
            var Ins = confirm("Do you like to activate the selected Allergy?");
            if (Ins == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/User/AllergyDetails_Active/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.PatientAllergyList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Doctor Notes" + data;
                });
            };
        }

        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }
        $scope.AllergyTypeeId = "0";
        $scope.SeverityIdTemp = "";
        $scope.AssignedSeverityId = "";
        $scope.AllergyTypeDuplicateId = "0";
        $scope.AllergenDuplicateId = "0";
        /*This is for Patient Allergy View*/
        $scope.EditSelectedAllergyReaction = [];
        $scope.PatientAllergyView = function () {
            $("#chatLoaderPVV").show();
            $scope.AllergenListfilter = [];
            $scope.EditSelectedAllergyReaction = []

            $http.get(baseUrl + 'api/User/PatientAllergyView/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                console.log(data);
                $scope.AllergyTypeId = data.AllergyTypeId.toString();
                $scope.AllergyTypeDuplicateId = $scope.AllergyTypeId;

                $scope.AllergenId = data.AllergenId.toString();
                $scope.AllergenDuplicateId = $scope.AllergenId;
                if ($scope.AllergyDropDown == 2) {
                    $scope.AllegenBasedType($scope.AllergyTypeId);
                }
                $scope.ViewAllergyType = data.AllergyTypeName;
                $scope.AllergenName = data.AllergenName;
                $scope.ViewAllegenName = data.AllergenName;
                if (data.AllergySeverityId != null) {
                    $scope.SeverityIdTemp = data.AllergySeverityId;
                    $scope.ViewSeverity = data.AllergySeverityName;
                    $scope.AssignedSeverityId = $scope.SeverityIdTemp;
                    $scope.AllergySeverityId = $scope.SeverityIdTemp.toString();
                }
                else {
                    $scope.ViewSeverity = "";
                    $scope.AllergySeverityId = "0";
                }
                if (data.AllergyOnsetId == null) {
                    $scope.AllergyOnsetId = "0";
                }
                else {
                    $scope.AllergyOnsetId = data.AllergyOnsetId.toString();
                }
                $scope.ViewOnset = data.AllergyOnsetName,
                    $scope.OnSetDate = DateFormatEdit($filter('date')(data.OnSetDate, "dd-MMM-yyyy"));
                $scope.Remarks = data.Remarks;
                $scope.ViewAllergyReactionName = data.AllergyReactionName;
                // For Multiselect dropdown	
                angular.forEach(data.AllergyReaction_List, function (value, index) {
                    $scope.EditSelectedAllergyReaction.push(value.Id);
                    $scope.SelectedAllergyReaction = $scope.EditSelectedAllergyReaction;
                });
            });
            $("#chatLoaderPVV").hide();
        }
        /*  This is for Allergy searchquery*/
        $scope.filterAllergyList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.Allergysearchquery);
            if ($scope.Allergysearchquery == "") {
                $scope.PatientAssignedAllergyDataList = angular.copy($scope.PatientAllergyListFilterData);
            }
            else {
                var val;
                $scope.PatientAssignedAllergyDataList = $ff($scope.PatientAllergyListFilterData, function (value) {


                    return angular.lowercase(value.AllergyTypeName).match(searchstring) ||
                        angular.lowercase(value.AllergenName).match(searchstring) ||
                        angular.lowercase(value.AllergySeverityName).match(searchstring) ||
                        angular.lowercase(value.AllergyOnsetName).match(searchstring) ||
                        angular.lowercase(value.AllergyReactionName).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.OnSetDate, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);
                });
                if ($scope.PatientAssignedAllergyDataList.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                }
                $scope.PatientAllergyPages = Math.ceil(($scope.PatientAssignedAllergyDataList) / ($scope.page_size));
            }
        }

        $scope.PatientAllergyCreateModalClear = function () {
            $scope.Id = "0";
            $scope.AllergenId = "0";
            $scope.AllergyTypeId = "0";
            $scope.AllergyOnsetId = "0";
            $scope.AllergySeverityId = "0";
            $scope.AllergyReactionId = "0";
            $scope.OnSetDate = "";
            $scope.Remarks = "";
            $scope.SelectedAllergyReaction = "";
            $scope.OnSetDate = new Date(DatetimepickermaxDate);
        }



        //Initilization For Patient Notes
        $scope.Id = "0";
        $scope.Notes = "";
        $scope.PatientNotesrowCollectionFilter = [];

        //To open a popup window form for add new notes
        $scope.PatientNotesAddPopup = function () {
            $scope.Id = 0;
            $scope.PatientNotesClear();
            $('#saved').attr("disabled", false);
            angular.element('#PatientNotesAddEditModal').modal('show');
        }

        //To Close the patient notes model window for Add and Edit function. 
        $scope.CancelPatientNotesAddPopup = function () {
            angular.element('#PatientNotesAddEditModal').modal('hide');
        }


        //This is opening popup window form for view
        $scope.ViewPatientNotesPopUP = function (PatNoteId) {
            $scope.PatientNotesClear();
            $scope.Id = PatNoteId;
            $scope.PatientDetails_View();
            angular.element('#ViewPatientNoteModal').modal('show');

        }


        //To close the view patient popup modal
        $scope.CancelViewPatientNotespopup = function () {
            angular.element('#ViewPatientNoteModal').modal('hide');
        }


        //Edit Function for doctor notes open in modal window with data
        $scope.EditPatientNotes = function (PatNoteId, createdDt, createdBy) {
            $('#saved').attr("disabled", false);
            if ($window.localStorage['UserId'] == createdBy) {
                $scope.Id = PatNoteId;
                $scope.PatientDetails_View();
                angular.element('#PatientNotesAddEditModal').modal('show');
            } else {
                //alert('Notes only edited by author');
                toastr.info("Notes only edited by author", "info");
            }

        }

        //Validation for insert function
        $scope.PatientNotesInsertUpdate_Validations = function () {
            if (typeof ($scope.Notes) == "" || $scope.Notes == "") {
                //alert("Please enter Notes");
                toastr.warning("Please enter Notes", "warning");
                return false;
            }
            return true;
        };

        //Insert function for doctor Notes
        $scope.PatientNotesInsertUpdate = function () {
            if ($scope.PatientNotesInsertUpdate_Validations() == true) {
                $('#saved').attr("disabled", true);
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    PatientId: $scope.SelectedPatientId,
                    Notes: $scope.Notes,
                    Created_By: $window.localStorage['UserId'],
                    Modified_By: $window.localStorage['UserId'],
                }
                $http.post(baseUrl + '/api/User/PatientNotesInsertUpdate/', obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.warning(data.Message, "warning");
                    }
                    $('#saved').attr("disabled", false);
                    if (data.ReturnFlag == "1") {
                        $scope.CancelPatientNotesAddPopup();
                        $scope.patientnotelist();
                    }
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while adding patient notes" + data.ExceptionMessage;
                });
            }
        }
        $scope.PatientNotesListTabCount = 1;
        $scope.ClinicalNotesListData = function (CurrentTab) {
            if (CurrentTab == 7) {
                if ($scope.PatientNotesListTabCount == 1) {
                    $('.chartTabs').addClass('charTabsNone');
                    $scope.patientnotelist();
                }
                $scope.PatientNotesListTabCount = $scope.PatientNotesListTabCount + 1;
            }
        }
        $scope.setPage1 = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNote;
            }
            else {
                $scope.inputPageNote = PageNo;
            }
            $scope.current_pageNote = PageNo;
            $scope.patientnotelist();

        }

        $scope.NotesActive = true;

        //List function for doctor Notes   
        $scope.patientnotelist = function () {
            $scope.PatientNotesemptydata = [];
            $scope.PatientNotesrowCollection = [];
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_pageNote - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_pageNote * $scope.page_size;
                $scope.ISact = 1;
                if ($scope.NotesActive == true) {
                    $scope.ISact = 1
                }
                else if ($scope.NotesActive == false) {
                    $scope.ISact = -1
                }
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/User/PatientNotes_List/?Patient_Id=' + $scope.SelectedPatientId + '&IsActive=' + $scope.ISact + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart +
                    '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.SearchMsg = "No Data Available";
                        $scope.PatientNotesemptydata = [];
                        $scope.PatientNotesrowCollection = [];
                        //$scope.PatientNotesrowCollection = data;
                        //$scope.NotesCount = $scope.PatientNotesrowCollection[0].TotalRecord;
                        //$scope.NotesCountFilterData = data; 
                        $scope.PatientNotesrowCollection = data.NotesDetails;
                        if ($scope.PatientNotesrowCollection.length > 0) {
                            $scope.NotesCount = $scope.PatientNotesrowCollection[0].TotalRecord;
                        } else {
                            $scope.NotesCount = 0;
                        }
                        $scope.NotesCountFilterData = data.NotesDetails;
                        $scope.PatientNotesrowCollectionFilter = angular.copy($scope.PatientNotesrowCollection);
                        if ($scope.PatientNotesrowCollectionFilter.length > 0) {
                            $scope.flag = 1;
                        }
                        else {
                            $scope.flag = 0;
                        }
                        $scope.PatientNotes_pages = Math.ceil(($scope.NotesCount) / ($scope.page_size));
                    }).error(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.error = "the error occured! " + data;
                    })
            }).error(function (data) {
                $("#chatLoaderPV").hide();
                $scope.error = "AN error has occured while Listing the records!" + data;
            })
        }

        //Search function for doctor notes
        $scope.filterPatientNotesList = function () {
            var searchstring = angular.lowercase($scope.searchNotesData);
            if ($scope.searchNotesData == "") {
                $scope.PatientNotesrowCollectionFilter = [];
                $scope.PatientNotesrowCollectionFilter = angular.copy($scope.PatientNotesrowCollection);
            }
            else {
                $scope.PatientNotesrowCollectionFilter = $ff($scope.PatientNotesrowCollection, function (value) {
                    return angular.lowercase(value.Notes).match(searchstring) ||
                        angular.lowercase(value.Created_By_Name).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Created_Dt, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);
                });
                $scope.PatientNotes_pages = Math.ceil(($scope.PatientNotesrowCollectionFilter) / ($scope.page_size));
            }
        }

        //View Function for Doctor Notes
        $scope.PatientDetails_View = function () {
            $http.get(baseUrl + '/api/User/PatientNotes_View/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.Notes = data.Notes;
            });
        }

        //To open a patient notes show more function modal window
        $scope.NotesPopupModal = function (Notes, rowlist) {
            $scope.NotesFilterList = [];
            $scope.PatientNotesFilterNo = [];
            $scope.Notes = rowlist.Notes;
            angular.element('#ViewPatientNoteModal').modal('show');

        };

        //list page show 'more' function
        $(function () {
            $('[data-toggle="modal"]').hover(function () {
                var modalId = $(this).data('target');
                $(modalId).modal('hide');
            });

        });

        //To Clear the Notes in popup window
        $scope.PatientNotesClear = function () {
            $scope.Notes = "";
        }

        // Patient Other Data
        $scope.Patient_OtherData_AddModal = function () {
            $('#other_Datasave').attr("disabled", false);
            angular.element('#Patient_OtherData_AddModal').modal('show');
        }
        $scope.b64toBlob = function (b64Data, contentType, sliceSize) {
            contentType = contentType || '';
            sliceSize = sliceSize || 512;

            var byteCharacters = atob(b64Data);
            var byteArrays = [];

            for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                var slice = byteCharacters.slice(offset, offset + sliceSize);

                var byteNumbers = new Array(slice.length);
                for (var i = 0; i < slice.length; i++) {
                    byteNumbers[i] = slice.charCodeAt(i);
                }

                var byteArray = new Uint8Array(byteNumbers);

                byteArrays.push(byteArray);
            }

            var blob = new Blob(byteArrays, { type: contentType });
            return blob;
        }
        $scope.Patient_OtherData_ViewModal = function (Id) {
            var contentType = 'image/png';
            $scope.Patient_OtherData_View(Id);
            //var blob = b64toBlob(b64Data, contentType);
            //var blobUrl = URL.createObjectURL(blob);
            angular.element('#Patient_OtherData_ViewModal').modal('show');
        }


        $scope.Patient_OtherData_Image_View = function (Id, filetype) {
            $http.get(baseUrl + '/api/User/Patient_OtherData_GetDocument?Id=' + Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                //var mtype = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                //var url = 'data:' + mtype + ';base64,' + data.DocumentBlobData.toString();
                /*window.open(url);*/
                let pdfWindow = window.open("", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=100,left=500,width=500,height=400");
                pdfWindow.document.write("<html><head><title>Test</title><style>body{margin: 0px;}iframe{border-width: 0px;}</style></head>");
                pdfWindow.document.write("<body><embed width='100%' height='100%' src='data:" + data.Filetype.toString() + ";base64, " + data.DocumentBlobData.toString() + "#toolbar=0&navpanes=0&scrollbar=0'></embed></body></html>");
                /*pdfWindow.target = '_top';*/

            });
        }

        $scope.Patient_OtherData_EditModal = function (Id, createdDt) {
            $('#other_Datasave1').attr("disabled", false);
            if ($scope.IsEditableCheck(createdDt) == false) {
                //alert("Other Data Cannot be edited");
                toastr.info("Other Data Cannot be edited", "info");
            }
            else {
                $scope.Patient_OtherData_View(Id);
                angular.element('#OtherData_EditModel').modal('show');
            }
        }
        $scope.OtherData_CancelPopup = function () {
            angular.element('#Patient_OtherData_AddModal').modal('hide');
            angular.element('#Patient_OtherData_ViewModal').modal('hide');
            angular.element('#OtherData_EditModel').modal('hide');
            $scope.OtherData_ClearPopup();
        }
        $scope.OtherData_ClearPopup = function () {
            $scope.Patient_OtherData = [{
                'OtherData_Id': 0,
                'DocumentDate': new Date(),
                'DocumentType': '',
                'resumedoc': $scope.resumedoc,
                'DocumentName': '',
                'Remarks': '',
            }];
            $scope.Remarks = "";
            $scope.DocumentDate = new Date();
            $scope.DocumentType = "";
            $scope.DocumentName = "";
            $scope.EditFileName = "";
            $scope.Editresumedoc = "";
        }
        $scope.Patient_OtherData = [];
        $scope.Patient_OtherData = [{
            'OtherData_Id': 0,
            'DocumentDate': new Date(),
            'resumedoc': $scope.resumedoc,
            'DocumentType': '',
            'DocumentName': '',
            'Remarks': '',
        }];

        $scope.AddPatient_OtherData = function () {
            if ($scope.Patient_OtherData.length > 0) {
                var obj =
                {
                    'OtherData_Id': 0,
                    'resumedoc': $scope.resumedoc,
                    'DocumentDate': new Date(),
                    'DocumentType': '',
                    'DocumentName': '',
                    'Remarks': '',
                }
                $scope.Patient_OtherData.push(obj);
            }
            else {
                $scope.Patient_OtherData = [{
                    'OtherData_Id': 0,
                    'resumedoc': $scope.resumedoc,
                    'DocumentName': '',
                    'Remarks': '',
                    'DocumentDate': new Date(),
                    'DocumentType': '',
                }];
            };
        };
        $scope.docfileChange = function (e, index) {
            //if ($('#Userdocument')[0].files[0] != undefined) {
            //    $scope.CertificateFileName = $('#Userdocument')[0].files[0]['name'];
            //}
            var row = $scope.Patient_OtherData[index];
            if (row != undefined)
                row.CertificateFileName = e.files[0]['name'];
        }
        $scope.Editfile=[]
        $scope.EditdocfileChange = function (e) {
            if ($('#EditDocument')[0].files[0] != undefined) {
                $scope.EditFileName = $('#EditDocument')[0].files[0]['name'];
            }
            $scope.Editfile = []
            $scope.Editfile.push(e.files[0])
        }

        /*This is for getting a file url for uploading the url into the database*/
        $scope.dataURItoBlob = function (dataURI) {
            var binary = atob(dataURI.split(',')[1]);
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            var array = [];
            for (var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {
                type: mimeString
            });
        }
        $scope.Patient_OtherData_Insert_Validations = function () {
            if ($scope.Patient_OtherData.length == 0) {
                //alert("Please add atleast one row");
                toastr.info("Please add atleast one row", "info");
                return false;
            }
            else {
                var AMitem = 0;
                angular.forEach($scope.Patient_OtherData, function (value, index) {
                    if ((value.DocumentName == null) || (value.DocumentName == undefined) || (value.DocumentName == "")) {
                        AMitem = 1;
                    }

                    $scope.filetype = value.CertificateFileName.split(".");
                    var fileExtenstion = "";
                    if ($scope.filetype.length > 0) {
                        fileExtenstion = $scope.filetype[$scope.filetype.length - 1];
                    }

                    //OpenDocument Text Documen (.odt),Microsoft Word Open XML Document (.docx),Microsoft Word Document (.doc),LaTex (.tex)
                    if (fileExtenstion.toLocaleLowerCase() == "jpeg" || fileExtenstion.toLocaleLowerCase() == "jpg" || fileExtenstion.toLocaleLowerCase() == "png"
                        || fileExtenstion.toLocaleLowerCase() == "bmp" || fileExtenstion.toLocaleLowerCase() == "gif" || fileExtenstion.toLocaleLowerCase() == "ico"
                        || fileExtenstion.toLocaleLowerCase() == "pdf" || fileExtenstion.toLocaleLowerCase() == "xls" || fileExtenstion.toLocaleLowerCase() == "xlsx"
                        || fileExtenstion.toLocaleLowerCase() == "doc" || fileExtenstion.toLocaleLowerCase() == "docx" || fileExtenstion.toLocaleLowerCase() == "odt"
                        || fileExtenstion.toLocaleLowerCase() == "txt" || fileExtenstion.toLocaleLowerCase() == "pptx" || fileExtenstion.toLocaleLowerCase() == "ppt"
                        || fileExtenstion.toLocaleLowerCase() == "rtf" || fileExtenstion.toLocaleLowerCase() == "tex"
                    ) {// check more condition with MIME type                      
                        fileval = 1;
                    }
                    else {
                        fileval = 2;
                    }
                    if (fileval == 2) {
                        //alert("Please choose files of type jpeg/jpg/png/bmp/gif/ico/pdf/xls/xlsx/doc/docx/odt/txt/pptx/ppt/rtf/tex");
                        toastr.warning("Please choose files of type jpeg/jpg/png/bmp/gif/ico/pdf/xls/xlsx/doc/docx/odt/txt/pptx/ppt/rtf/tex", "warning");
                        return false;
                    }
                });

                if ($scope.Patient_OtherData.length < 1 || AMitem == 1) {
                    //alert("Please enter Document Name");
                    toastr.warning("Please enter Document Name", "warning");
                    return false;
                }
                var Uploaditem = 0;
                angular.forEach($scope.Patient_OtherData, function (value, index) {
                    if ((value.CertificateFileName == null) || (value.CertificateFileName == undefined) || (value.CertificateFileName == "")) {
                        Uploaditem = 1;
                    }
                    else if ($scope.dataURItoBlob(value.resumedoc).size > 5242880) {

                        Uploaditem = 2;
                    }
                });
                if ($scope.Patient_OtherData.length < 1 || Uploaditem == 1) {
                    //alert("Please upload Document");
                    toastr.warning("Please upload Document", "warning");
                    return false;
                }
                else if (Uploaditem == 2) {
                    //alert("Uploaded file size cannot be greater than 5MB");
                    toastr.warning("Uploaded file size cannot be greater than 5MB", "warning");
                    return false;
                }
            }
            return true;
        }
        function convert(str) {
            var date = new Date(str),
                mnth = ("0" + (date.getMonth() + 1)).slice(-2),
                day = ("0" + date.getDate()).slice(-2);
            return [date.getFullYear(), mnth, day].join("-") + ' ' + [date.getHours(), date.getMinutes(), date.getSeconds()].join(':');
        }
        $scope.Patient_OtherData_InsertUpdate = function () {
            if ($scope.Patient_OtherData_Insert_Validations() == true) {
                $('#other_Datasave').attr("disabled", true);
                $("#chatLoaderPV").show();
                var cnt = $scope.Patient_OtherData.length;
                $scope.insertcount = 0;
                angular.forEach($scope.Patient_OtherData, function (value, index) {
                    $scope.Id = "0",
                        $scope.Patient_Id = $scope.SelectedPatientId,
                        $scope.FileName = value.CertificateFileName,
                        $scope.DocumentName = value.DocumentName,
                        $scope.DocumentType = value.DocumentType,
                        $scope.DocumentDate = convert(value.DocumentDate),
                        $scope.Remarks = value.Remarks,
                        $scope.Created_By = $window.localStorage['UserId'];
                    $scope.Modified_By = $window.localStorage['UserId'];
                    var fd = new FormData();
                    var imgBlob;
                    var imgBlobfile;
                    var itemIndexLogo = -1;
                    var itemIndexdoc = -1;
                    imgBlob = $scope.dataURItoBlob(value.resumedoc);
                    itemIndexLogo = 0;
                    if (itemIndexLogo != -1) {
                        fd.append('file', imgBlob);
                    }
                    /*
                    calling the api method for read the file path
                    and saving the image uploaded in the local server.
                    */
                    $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                    $http.post(baseUrl + '/api/User/Patient_OtherData_InsertUpdate?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId + '&Appointment_Id=0' + '&Id=' + $scope.Id + '&FileName=' + value.CertificateFileName + '&DocumentName=' + $scope.DocumentName + '&Remarks=' + $scope.Remarks + '&Created_By=' + $scope.Created_By + '&DocumentDate=' + $scope.DocumentDate + '&DocumentType=' + $scope.DocumentType,
                        fd,
                        {
                            transformRequest: angular.identity,
                            headers: {
                                'Content-Type': undefined
                            }
                        }
                    )
                        .success(function (response) {
                            $scope.insertcount = $scope.insertcount + 1;

                            if (cnt == $scope.insertcount) {
                                $("#chatLoaderPV").hide();
                                //alert(response.Message);
                                toastr.success(response.Message, "success");
                                $('#other_Datasave').attr("disabled", false);
                                $scope.OtherData_CancelPopup();
                                $scope.Patient_OtherData_List();
                            }
                        });
                });
            }
        }

        $scope.Patient_OtherData_Update_Validations = function () {


            if (typeof ($scope.DocumentName) == "undefined" || $scope.DocumentName == "" || $scope.DocumentName == null) {
                //alert("Please enter Document Name");
                toastr.warning("Please enter Document Name", "warning");
                return false;
            }
            if (typeof ($scope.EditFileName) == "undefined" || $scope.EditFileName == "" || $scope.EditFileName == null) {
                //alert("Please Upload Document");
                toastr.warning("Please Upload Document", "warning");
                return false;
            }
            var fileval = 0;
            $scope.filetype = $scope.EditFileName.split(".");
            var fileExtenstion = "";

            if ($scope.filetype.length > 0) {
                fileExtenstion = $scope.filetype[$scope.filetype.length - 1];
            }
            if (fileExtenstion.toLocaleLowerCase() == "jpeg" || fileExtenstion.toLocaleLowerCase() == "jpg" || fileExtenstion.toLocaleLowerCase() == "png"
                || fileExtenstion.toLocaleLowerCase() == "bmp" || fileExtenstion.toLocaleLowerCase() == "gif" || fileExtenstion.toLocaleLowerCase() == "ico"
                || fileExtenstion.toLocaleLowerCase() == "pdf" || fileExtenstion.toLocaleLowerCase() == "xls" || fileExtenstion.toLocaleLowerCase() == "xlsx"
                || fileExtenstion.toLocaleLowerCase() == "doc" || fileExtenstion.toLocaleLowerCase() == "docx" || fileExtenstion.toLocaleLowerCase() == "odt"
                || fileExtenstion.toLocaleLowerCase() == "txt" || fileExtenstion.toLocaleLowerCase() == "pptx" || fileExtenstion.toLocaleLowerCase() == "ppt"
                || fileExtenstion.toLocaleLowerCase() == "rtf" || fileExtenstion.toLocaleLowerCase() == "tex"
            ) {// check more condition with MIME type                      
                fileval = 1;
            }
            else {
                fileval = 2;
            }
            if (fileval == 2) {
                //alert("Please choose jpeg/jpg/png/bmp/gif/ico/pdf/xls/xlsx/doc/docx/odt/txt/pptx/ppt/rtf/tex file.");
                toastr.warning("Please choose jpeg/jpg/png/bmp/gif/ico/pdf/xls/xlsx/doc/docx/odt/txt/pptx/ppt/rtf/tex file.", "warning");
                return false;
            }
            if ($scope.CertificateValue == 1) {
                if ($scope.dataURItoBlob($scope.EditFileName).size > 5242880) {
                    //alert("Uploaded file size cannot be greater than 5MB");
                    toastr.warning("Uploaded file size cannot be greater than 5MB", "warning");
                    return false;
                }
            }
            return true;
        }

        $scope.CertificateValue = 0;
        $scope.CertificateUplaodSelected = function () {
            $scope.CertificateValue = 1;
        };
        $scope.Editresumedoc = "";
        $scope.Patient_OtherData_Edit = function () {
            if ($scope.Patient_OtherData_Update_Validations() == true) {
                $("#chatLoaderPV").show();
                $('#other_Datasave1').attr("disabled", true);
                $scope.Id = $scope.OtherData_Id,
                    $scope.Patient_Id = $scope.SelectedPatientId;
                $scope.Created_By = $window.localStorage['UserId'];
                $scope.Modified_By = $window.localStorage['UserId'];
                var fd = new FormData();
                var imgBlob;
                var imgBlobfile;
                var itemIndexLogo = -1;
                var itemIndexdoc = -1;

                if ($('#EditDocument')[0].files[0] != undefined) {
                    CertificateFileName = $('#EditDocument')[0].files[0]['name'];
                    //imgBlob = $scope.dataURItoBlob($scope.Editresumedoc);
                    //if (itemIndexLogo == -1) {
                    //    itemIndexfile = 0;
                    //}
                    //else {
                    //    itemIndexfile = 1;
                    //}
                }
                /*if (itemIndexLogo != -1) {*/
                console.log($scope.Editfile[0])
                fd.append('file', $scope.Editfile[0]);
                //}
                /*
                calling the api method for read the file path
                and saving the image uploaded in the local server.
                */
                $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
                $http.post(baseUrl + '/api/User/Patient_OtherData_InsertUpdate?Patient_Id=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId + '&Appointment_Id=0' + '&Id=' + $scope.Id + '&FileName=' + $scope.EditFileName + '&DocumentName=' + $scope.DocumentName + '&Remarks=' + $scope.Remarks + '&Created_By=' + $scope.Created_By + '&DocumentDate=' + convert($scope.DocumentDate) + '&DocumentType=' + $scope.DocumentType,
                    fd,
                    {
                        transformRequest: angular.identity,
                        headers: {
                            'Content-Type': undefined
                        }
                    }
                )
                    .success(function (response) {
                        $("#chatLoaderPV").hide();
                        //alert(response.Message);
                        toastr.success(response.Message, "success");
                        $('#other_Datasave1').attr("disabled", false);
                        $scope.OtherData_CancelPopup();
                        $scope.Patient_OtherData_List();
                        $("#EditDocument").val('');
                    });
            }
        }

        $scope.PatientOtherDataListTabCount = 1;
        $scope.OthersListData = function (CurrentTab) {
            if (CurrentTab == 8) {
                if ($scope.PatientOtherDataListTabCount == 1) {
                    $('.chartTabs').addClass('charTabsNone');
                    $scope.Patient_OtherData_List();
                }
                $scope.PatientOtherDataListTabCount = $scope.PatientOtherDataListTabCount + 1;
            }
        }
        $scope.setPage5 = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageOthers;
            }
            else {
                $scope.inputPageOthers = PageNo;
            }
            $scope.current_others = PageNo;
            $scope.Patient_OtherData_List();

        }

        $scope.OtherData_IsActive = true;
        $scope.OtherData_List = [];
        $scope.OtherData_ListData = [];
        $scope.OtherDataflag = 0;
        $scope.Add_OtherDataflag = 0;
        $scope.OtherData_searchquery == ""
        $scope.Patient_OtherData_List = function () {
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_others - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_others * $scope.page_size;
                $scope.ISact = 1;
                $scope.ActiveStatus = $scope.OtherData_IsActive == true ? 1 : -1;
                $("#chatLoaderPV").show();
                $http.get(baseUrl + 'api/User/Patient_OtherData_List/?Patient_Id=' + $scope.SelectedPatientId + '&IsActive=' + $scope.ActiveStatus + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart +
                    '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.SearchMsg = "No Data Available";
                        $scope.OtherDataEmptyData = [];
                        $scope.OtherData_List = [];
                        $scope.OtherData_List = data.DocumentDetails1;
                        if ($scope.OtherData_List.length > 0) {
                            $scope.OtherDataCount = $scope.OtherData_List[0].TotalRecord;
                        } else {
                            $scope.OtherDataCount = 0;
                        }
                        $scope.OtherData_ListFilterdata = data.DocumentDetails1;
                        $scope.OtherData_ListData = angular.copy($scope.OtherData_List);
                        if ($scope.OtherData_ListData.length > 0) {
                            $scope.OtherDataflag = 1;
                        }
                        else {
                            $scope.OtherDataflag = 0;
                        }
                        $scope.Patientothers = Math.ceil(($scope.OtherDataCount) / ($scope.page_size));
                    })
            })
        }
        $scope.filter_OtherData = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.OtherData_searchquery);
            if ($scope.OtherData_searchquery == "") {
                $scope.OtherData_ListData = angular.copy($scope.OtherData_List);
            }
            else {
                $scope.OtherData_ListData = $ff($scope.OtherData_List, function (value) {
                    return angular.lowercase(value.DocumentName).match(searchstring) ||
                        angular.lowercase(value.FileName).match(searchstring) ||
                        angular.lowercase(value.Created_Name).match(searchstring) ||
                        angular.lowercase(value.DocumentType).match(searchstring) ||
                        angular.lowercase(value.Created_Date).match(searchstring);
                });
                if ($scope.OtherData_ListData.length > 0) {
                    $scope.OtherDataflag = 1;
                }
                else {
                    $scope.OtherDataflag = 0;
                }
                $scope.Patientothers = Math.ceil(($scope.OtherData_ListData) / ($scope.page_size));
            }

        }
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }
        $scope.dataURItoBlob = function (dataURI) {
            var binary = atob(dataURI.split(',')[1]);
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            var array = [];
            for (var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {
                type: mimeString
            });
        }
        $scope.DownloadDocument = function (GetId) {
            $scope.OtherData_Id = GetId;
            var a = document.createElement("a");
            document.body.appendChild(a);
            $http.get(baseUrl + '/Home/GetPatient_OtherDataDocument/?Id=' + $scope.OtherData_Id).success(function (data) {
            });

        };
        $scope.Patient_OtherData_View = function (Id) {
            $scope.OtherData_Id = Id;
            $http.get(baseUrl + '/api/User/Patient_OtherData_View/Id?=' + $scope.OtherData_Id).success(function (data) {
                $scope.OtherData_Id = data.Id;
                $scope.FileName = data.FileName;
                $scope.EditFileName = data.FileName;
                $scope.DocumentDate = new Date(data.DocumentDate);
                $scope.DocumentType = data.DocumentType;
                $scope.DocumentName = data.DocumentName;
                $scope.Remarks = data.Remarks;
            });
        }
        $scope.RemovePatient_OtherData_Item = function (rowIndex) {
            var del = confirm("Do you like to delete document");
            if (del == true) {
                var Previous_DocumentItem = [];

                angular.forEach($scope.Patient_OtherData, function (selectedPre, index) {
                    if (index != rowIndex)
                        Previous_DocumentItem.push(selectedPre);
                });
                $scope.Patient_OtherData = Previous_DocumentItem;
                if ($scope.Patient_OtherData.length > 0) {
                    $scope.Add_OtherDataflag = 1;
                }
                else {
                    $scope.Add_OtherDataflag = 0;
                }
            }
        };
        $scope.Patient_OtherData_InActive = function (GetId) {
            $scope.Id = GetId;
            var del = confirm("Do you like to deactivate the selected Document?");
            if (del == true) {
                var obj = {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId'],
                }
                $http.post(baseUrl + '/api/User/Patient_OtherData_InActive', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.Patient_OtherData_List();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Document" + data;
                });
            }
        };

        $scope.Patient_OtherData_Active = function (GetId) {
            $scope.Id = GetId;
            var del = confirm("Do you like to activate the selected Document?");
            if (del == true) {
                var obj = {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId'],
                }
                $http.post(baseUrl + '/api/User/Patient_OtherData_Active', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.Patient_OtherData_List();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Document" + data;
                });
            }
        };

        $scope.Allergies = function () {
            angular.element('#PatientAllergyListModal').modal('show');
        }

        $scope.NoknownAllergies = function () {
            angular.element('#PatientAllergyListModal').modal('show');
        }

        $scope.DoctorNotesDetails_InActive = function (comId) {
            if ($window.localStorage['UserTypeId'] == 2) {
                //alert('Not allowed');
                toastr.info("Not allowed", "info");
            } else {
                $scope.Id = comId;
                $scope.DoctorNotes_Delete();
            }
        };
        $scope.DoctorNotes_Delete = function () {
            var del = confirm("Do you like to deactivate the selected Notes?");
            if (del == true) {
                var obj = {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId'],
                }
                $http.post(baseUrl + '/api/User/DoctorNotesDetails_InActive/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.patientnotelist();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Doctor Notes" + data;
                });
            }
        };

        /*'Active' the Institution*/
        $scope.DoctorNotesDetails_Active = function (comId) {
            if ($window.localStorage['UserTypeId'] == 2) {
                //alert('Not Allowed');
                toastr.info("Not Allowed", "info");
            } else {
                $scope.Id = comId;
                $scope.ReInsertDoctorNotesDetails();
            }

        };

        /* 
        Calling the api method to inactived the details of the company 
        for the  company Id,
        and redirected to the list page.
        */
        $scope.ReInsertDoctorNotesDetails = function () {
            var Ins = confirm("Do you like to activate the selected Notes?");
            if (Ins == true) {
                var obj = {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId'],
                }
                $http.post(baseUrl + '/api/User/DoctorNotesDetails_Active/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.patientnotelist();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Doctor Notes" + data;
                });

            };
        }
    }
]);

// This is for Patient Appointments controller functions//    
MyCortexControllers.controller("PatientAppointmentController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.Doctor_Id = $window.localStorage['UserId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.AppointmentDate = "";
        $scope.Appointmentdate = "";
        $scope.ReasonTypeId = 0;

        $scope.ViewPatientPopUp = function (eventId) {
            $scope.Id = eventId;
            $window.location.href = baseUrl + "/Home/Index#/PatientVitals/" + $scope.Id + "/2";
        }

        $scope.ViewPatientPopUp_30days = function (eventId) {
            $scope.Id = eventId;
            $window.location.href = baseUrl + "/Home/Index#/PatientVitals/" + $scope.Id + "/3";
        }

        $scope.CancelAppointmentModal = function (AppointmentId, AppointmentDate) {
            $scope.Cancelled_Remarks = "";
            $scope.Appointment_Id = AppointmentId;
            $scope.AppointmentDate = moment(AppointmentDate).format('DD-MMM-YYYY');
            angular.element('#PatientAppointmentModal').modal('show');
            $scope.ReasonTypeDropDownList();
            $scope.ClearAppointments();
            $scope.Cancelled_Remarks = "";
            $scope.ReasonTypeId = 0;
        }

        $scope.Cancel_CancelledAppointment = function (AppointmentId) {
            angular.element('#PatientAppointmentModal').modal('hide');
            $scope.Cancelled_Remarks = "";
            $scope.ReasonTypeId = 0;
        }
        $scope.ClearAppointments = function () {
            $scope.Cancelled_Remarks = "";
            $scope.ReasonTypeId = 0;
        }
        $scope.ReasonTypeDropDownList = function () {
            $http.get(baseUrl + '/api/PatientAppointments/AppointmentReasonType_List/?Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
                $scope.AppointmentReasonTypeListTemp = [];
                $scope.AppointmentReasonTypeListTemp = data;
                var obj = { "ReasonTypeId": 0, "ReasonType": "Select", "IsActive": 1 };
                $scope.AppointmentReasonTypeListTemp.splice(0, 0, obj);
                $scope.AppointmentReasonTypeList = angular.copy($scope.AppointmentReasonTypeListTemp);
            });
        };
        $scope.Update_CancelledAppointment = function () {
            $("#chatLoaderPV").show();
            if (typeof ($scope.ReasonTypeId) == "undefined" || $scope.ReasonTypeId == "") {
                //alert("Please select Reason Type for  cancellation");
                toastr.warning("Please select Reason Type for  cancellation", "warning");
                return false;
            }
            else {
                var obj = {
                    CancelledBy_Id: $scope.Doctor_Id,
                    Id: $scope.Appointment_Id,
                    Cancelled_Remarks: $scope.Cancelled_Remarks,
                    ReasonTypeId: $scope.ReasonTypeId
                }
                $http.post(baseUrl + '/api/PatientAppointments/CancelPatient_Appointment/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    angular.element('#PatientAppointmentModal').modal('hide');
                    $scope.Cancelled_Remarks = "";
                    $scope.ReasonTypeId = '0';
                    // refresh monthly calendar
                    $scope.flag = 2;
                    $scope.dataCalendar1 = [];
                    $("#chatLoaderPV1").show();
                    $http.get(baseUrl + '/api/PatientAppointments/DoctorAppointmentList/?Doctor_Id=' + $scope.Doctor_Id + '&flag=' + $scope.flag + '&ViewDate=' + moment() + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (patientdata) {
                        angular.forEach(patientdata, function (value, index) {
                            var obj = {
                                title: moment(value.Appointment_FromTime).format('hh:mm a') + '-' + moment(value.Appointment_ToTime).format('hh:mm a') + '-' + value.PatientName,
                                start: value.Appointment_FromTime,
                                end: value.Appointment_ToTime,
                                id: value.Patient_Id,
                                PatientName: value.PatientName,
                                Appointment_Id: value.Id,
                                MRN_No: value.MRN_No,
                                Photo: value.PhotoBlob == null ? '../../Images/male.png' : 'data:image/png;base64,' + value.PhotoBlob,
                                Smoker: value.Smoker == 1 ? 'Yes' ? value.Smoker == 2 : 'No' : 'UnKnown',
                                ReasonForVisit: value.ReasonForVisit
                            };
                            $scope.dataCalendar1.push(obj);
                        })
                        $('#calendar1').fullCalendar('removeEvents');
                        $('#calendar1').fullCalendar('removeEventSource', $scope.dataCalendar1)
                        $('#calendar1').fullCalendar('addEventSource', $scope.dataCalendar1)
                        $('#calendar1').fullCalendar('refetchEvents');
                        $("#chatLoaderPV1").hide();
                    }).error(function (data) {
                        $("#chatLoaderPV1").hide();
                        $scope.error = "An error has occurred while Listing Today's appointment!" + data;
                    });

                    // refresh daily calendar
                    $scope.dataCalendar = [];
                    $http.get(baseUrl + '/api/PatientAppointments/DoctorAppointmentList/?Doctor_Id=' + $scope.Doctor_Id + '&flag=' + $scope.flag + '&ViewDate=' + $scope.AppointmentDate + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                        angular.forEach(data, function (value, index) {
                            var obj = {
                                title: moment(value.Appointment_FromTime).format('hh:mm a') + '-' + moment(value.Appointment_ToTime).format('hh:mm a') + '-' + value.PatientName,
                                start: value.Appointment_FromTime,
                                end: value.Appointment_ToTime,
                                id: value.Patient_Id,
                                PatientName: value.PatientName,
                                Appointment_Id: value.Id,
                                MRN_No: value.MRN_No,
                                Photo: value.PhotoBlob == null ? '../../Images/male.png' : 'data:image/png;base64,' + value.PhotoBlob,
                                Smoker: value.Smoker == 1 ? 'Yes' ? value.Smoker == 2 : 'No' : 'UnKnown',
                                ReasonForVisit: value.ReasonForVisit
                            };
                            $scope.dataCalendar.push(obj);
                        });
                        $('#calendar').fullCalendar('removeEvents');
                        $('#calendar').fullCalendar('removeEventSource', $scope.dataCalendar)
                        $('#calendar').fullCalendar('addEventSource', $scope.dataCalendar)
                        $('#calendar').fullCalendar('refetchEvents');
                        $("#chatLoaderPV").hide();
                    }).error(function (data) {
                        $scope.error = "An error has occurred while Listing Today's appointment!" + data;
                    });
                }).error(function (data) {
                    $scope.error = "An error has occurred while Updating Appointment Details" + data;
                });
                $('#calendar1').fullCalendar('gotoDate', $scope.AppointmentDate);
                $('#calendar').fullCalendar('gotoDate', $scope.AppointmentDate);
            }
        }
        $scope.flag = 1;
        var scrollTime = moment().format("HH:mm:ss");
        angular.element(document).ready(function () {
            if ($window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 7 || $window.localStorage['UserTypeId'] == 5) {

                var calendar = $('#calendar').fullCalendar(
                    {
                        timeZone: 'UTC',
                        scrollTime: scrollTime,
                        slotDuration: '00:15:00',
                        eventLimit: true,
                        displayEventTime: false,
                        slotEventOverlap: false,
                        header: {
                            left: '',
                            center: 'title',
                            right: ''
                        },
                        titleFormat: {
                            month: 'MMMM YYYY',   // like 'September 2009', for month view
                            week: 'MMM D YYYY', // like 'Sep 13 2009', for week views
                            day: 'MMMM D YYYY' // like 'September 8 2009', for day views
                        },
                        views: {
                            agendaFiveDay: {
                                type: 'agenda',
                                duration: { days: 5 },
                                buttonText: 'Five Day'
                            }
                        },
                        defaultView: 'agendaDay',
                        selectable: true,
                        selectHelper: true,
                        //eventClick: function (calEvent, jsEvent, view) {
                        //},
                        // Remove Event On Click
                        eventRender: function (event, element) {
                            if (event.id != undefined) {
                                element.html(event.title + '<span class="removeEvent glyphicon glyphicon-trash pull-right" id="Delete"></span>');
                            }
                        },
                        eventClick: function (calEvent, jsEvent, view) {
                            $('.tooltipevent').remove();
                            if (jsEvent.target.id === 'Delete') {
                                var msg = confirm("Do you like to Cancel the Patient Appointment?");
                                if (msg == true) {
                                    $scope.CancelAppointmentModal(calEvent.Appointment_Id, calEvent.start);
                                }
                            }
                            else {
                                $scope.Id = calEvent.id;
                                $scope.ViewPatientPopUp($scope.Id);
                            }
                        },
                        viewRender: function (view, element) {
                            $scope.FromDate = view.intervalStart._d;
                            $scope.ToDate = view.intervalEnd._d;
                            $scope.dataCalendar = [];
                            $("#chatLoaderPV1").show();
                            $http.get(baseUrl + '/api/PatientAppointments/DoctorAppointmentList/?Doctor_Id=' + $scope.Doctor_Id + '&flag=' + $scope.flag + '&ViewDate=' + view.intervalStart.format("DD-MMM-YYYY") + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                                angular.forEach(data, function (value, index) {
                                    var obj = {
                                        title: moment(value.Appointment_FromTime).format('hh:mm a') + '-' + moment(value.Appointment_ToTime).format('hh:mm a') + '-' + value.PatientName,
                                        start: value.Appointment_FromTime,
                                        end: value.Appointment_ToTime,
                                        id: value.Patient_Id,
                                        PatientName: value.PatientName,
                                        Appointment_Id: value.Id,
                                        MRN_No: value.MRN_No,
                                        Photo: value.PhotoBlob == null ? '../../Images/male.png' : 'data:image/png;base64,' + value.PhotoBlob,
                                        Smoker: value.Smoker == 1 ? 'Yes' ? value.Smoker == 2 : 'No' : 'UnKnown',
                                        ReasonForVisit: value.ReasonForVisit
                                    };
                                    $scope.dataCalendar.push(obj);
                                });

                                $('#calendar').fullCalendar('removeEvents');
                                $('#calendar').fullCalendar('removeEventSource', $scope.dataCalendar)
                                $('#calendar').fullCalendar('addEventSource', $scope.dataCalendar)
                                $('#calendar').fullCalendar('refetchEvents');
                                $("#chatLoaderPV1").hide();
                            }).error(function (data) {
                                $("#chatLoaderPV1").hide();
                                $scope.error = "An error has occurred while Listing Today's appointment!" + data;
                            });

                        },
                        eventMouseover: function (calEvent, jsEvent) {
                            //var tooltip = '<div class="tooltipevent patientCard"><div class="row">' + '<div class="col-sm-6"><div class="row">' 
                            //            + '<div class="col-sm-8">'+ calEvent.PatientName +'</div>' + '<div class="col-sm-8"><label>MRN No.:</label>'+ calEvent.MRN_No +'</div>'
                            //            + '<div class="col-sm-8"><label>Smoker:</label>'+ calEvent.Smoker +'</div>'
                            //            + '<div class="col-sm-8"><label>Reason For Visit:</label>'+ calEvent.ReasonForVisit 
                            //            +'</div>'+'</div></div>' + '<div class="col-sm-6"><div><img src="'+calEvent.Photo + '"/></div></div>' + '</div></div>';        
                            if (calEvent.MRN_No != undefined) {
                                var tooltip = '<div class="tooltipevent patientCard"><div class="row">' + '<div class="col-sm-6"><div class="row">'
                                    + '<div class="col-sm-12"><label>MRN No.:</label><span>' + calEvent.MRN_No + '</span></div>'
                                    + '<div class="col-sm-12"><label>Smoker:</label><span>' + calEvent.Smoker + '</span></div>'
                                    + '<div class="col-sm-12"><label>Reason For Visit:</label><span>' + calEvent.ReasonForVisit
                                    + '</span></div>' + '</div></div>' + '<div class="col-sm-6"><img src="' + calEvent.Photo + '"/><div class="col-sm-12"><h1><span>' + calEvent.PatientName + '</span></h1></div></div>' + '</div></div>';


                                var $tooltip = $(tooltip).appendTo('body');
                                $(this).mouseover(function (e) {
                                    $(this).css('z-index', 10000);
                                    $tooltip.fadeIn('500');
                                    $tooltip.fadeTo('10', 1.9);
                                }).mousemove(function (e) {
                                    $tooltip.css('top', e.pageY + 10);
                                    $tooltip.css('left', e.pageX + 20);
                                });
                            };
                        },

                        eventMouseout: function (calEvent, jsEvent) {
                            $(this).css('z-index', 8);
                            $('.tooltipevent').remove();
                        },
                        events: $scope.dataCalendar,
                        timeFormat: 'H:mm:ss', // uppercase H for 24-hour clock
                        timezone: "local",
                        cache: false
                    });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        });

        $scope.dayClicked = function (date) {
            $scope.flag = 3;
            $('#calendar').fullCalendar('gotoDate', date);
        }

        var dueStartDate = moment().subtract(1, 'days');
        var dueEndDate = moment().add(30, 'days');

        $scope.getMonthlyAppointment = function () {
            var calendar = $('#calendar1').fullCalendar(
                {
                    scrollTime: scrollTime,
                    slotDuration: '00:15:00',
                    visibleRange: {
                        start: '2020-02-01',
                        end: '2020-03-20'
                    },
                    eventLimit: true,
                    displayEventTime: false,

                    header: {
                        left: 'prev,next',
                        center: 'title',
                        right: ''
                    },
                    titleFormat: {
                        month: 'MMMM YYYY',   // like 'September 2009', for month view
                        week: 'MMM D YYYY', // like 'Sep 13 2009', for week views
                        day: 'MMMM D YYYY' // like 'September 8 2009', for day views
                    },
                    views: {
                        agendaFiveDay: {
                            type: 'agenda',
                            duration: { days: 5 },
                            buttonText: 'Five Day'
                        }
                    },
                    defaultView: 'month',
                    selectable: true,
                    selectHelper: true,
                    // Remove Event On Click
                    eventRender: function (event, element) {

                        var dateString = moment(event.start).format('YYYY-MM-DD');
                        $('#calendar1').find('.fc-day[data-date="' + dateString + '"]').css('background-color', '#FAA732');
                        if (event.id != undefined) {
                            element.html(event.title + '<span class="removeEvent glyphicon glyphicon-trash pull-right" id="Delete"></span>');
                        }
                    },
                    eventAfterAllRender: function (view) {
                        for (cDay = view.start.clone(); cDay.isBefore(view.end); cDay.add(1, 'day')) {

                            var dateNum = cDay.format('YYYY-MM-DD');

                            var dayEl = $('.fc-day[data-date="' + dateNum + '"]');
                            var eventCount = $('.fc-event[date-num="' + dateNum + '"]').length;
                            if (eventCount) {
                                var html = '<div class="numberCircle">' +
                                    eventCount +
                                    '</div>';
                                dayEl.append(html);
                            }
                        }
                    },

                    dayClick: function (date, allDay, jsEvent, view) {
                        var startdate = moment(dueStartDate).format('YYYY-MM-DD');
                        var date1 = moment(date).format('YYYY-MM-DD');
                        var EndDate = moment(dueEndDate).format('YYYY-MM-DD');
                        if (moment(date1).isBetween(startdate, EndDate) == false) {
                            //alert("Appointment is only for 30 days, cannot view this date");
                            toastr.info("Appointment is only for 30 days, cannot view this date", "info");
                            $('#calendar1').fullCalendar('gotoDate', date1);
                            return false;
                        }

                        $scope.dayClicked(date);
                    },
                    eventClick: function (calEvent, jsEvent, view) {
                        $('.tooltipevent').remove();
                        if (jsEvent.target.id === 'Delete') {
                            var msg = confirm("Do you like to Canncel the Patient Appointment?");
                            if (msg == true) {
                                $scope.CancelAppointmentModal(calEvent.Appointment_Id, calEvent.start);
                            }
                        }
                        else {
                            $scope.Id = calEvent.id;
                            $scope.ViewPatientPopUp_30days($scope.Id);
                        }
                    },
                    viewRender: function (view, element) {
                        $scope.FromDate = view.intervalStart._d;
                        $scope.ToDate = view.intervalEnd._d;
                        $scope.dataCalendar1 = [];
                        $scope.flag = 2;
                        $scope.dataCalendar1 = [];
                        $("#chatLoaderPV1").show();
                        $http.get(baseUrl + '/api/PatientAppointments/DoctorAppointmentList/?Doctor_Id=' + $scope.Doctor_Id + '&flag=' + $scope.flag + '&ViewDate=' + moment() + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (patientdata) {
                            angular.forEach(patientdata, function (value, index) {
                                var obj = {
                                    title: moment(value.Appointment_FromTime).format('hh:mm a') + '-' + moment(value.Appointment_ToTime).format('hh:mm a') + '-' + value.PatientName,
                                    start: value.Appointment_FromTime,
                                    end: value.Appointment_ToTime,
                                    id: value.Patient_Id,
                                    PatientName: value.PatientName,
                                    Appointment_Id: value.Id,
                                    MRN_No: value.MRN_No,
                                    Photo: value.PhotoBlob == null ? '../../Images/male.png' : 'data:image/png;base64,' + value.PhotoBlob,
                                    Smoker: value.Smoker == 1 ? 'Yes' ? value.Smoker == 2 : 'No' : 'UnKnown',
                                    ReasonForVisit: value.ReasonForVisit
                                };
                                $scope.dataCalendar1.push(obj);
                            })
                            $('#calendar1').fullCalendar('removeEvents');
                            $('#calendar1').fullCalendar('removeEventSource', $scope.dataCalendar1)
                            $('#calendar1').fullCalendar('addEventSource', $scope.dataCalendar1)
                            $('#calendar1').fullCalendar('refetchEvents');
                            $("#chatLoaderPV1").hide();
                        }).error(function (data) {
                            $("#chatLoaderPV1").hide();
                            $scope.error = "An error has occurred while Listing Today's appointment!" + data;
                        });
                    },
                    eventMouseover: function (calEvent, jsEvent) {
                        //var tooltip = '<div class="tooltipevent patientCard"><div class="row">' + '<div class="col-sm-6"><div class="row">' + '<div class="col-sm-8">'+ calEvent.PatientName +'</div>' + '<div class="col-sm-8"><label>MRN No.:</label>'+ calEvent.MRN_No +'</div>'+ '<div class="col-sm-8"><label>Smoker:</label>'+ calEvent.Smoker +'</div>'+ '<div class="col-sm-8"><label>Reason For Visit:</label>'+ calEvent.ReasonForVisit +'</div>'+'</div></div>' + '<div class="col-sm-6"><div><img src="'+calEvent.Photo + '"/></div></div>' + '</div></div>';

                        var tooltip = '<div class="tooltipevent patientCard"><div class="row">' + '<div class="col-sm-6"><div class="row">'
                            + '<div class="col-sm-12"><label>MRN No.:</label><span>' + calEvent.MRN_No + '</span></div>'
                            + '<div class="col-sm-12"><label>Smoker:</label><span>' + calEvent.Smoker + '</span></div>'
                            + '<div class="col-sm-12"><label>Reason For Visit:</label><span>' + calEvent.ReasonForVisit
                            + '</span></div>' + '</div></div>' + '<div class="col-sm-6"><img src="' + calEvent.Photo + '"/><div class="col-sm-12"><h1><span>' + calEvent.PatientName + '</span></h1></div></div>' + '</div></div>';

                        var $tooltip = $(tooltip).appendTo('body');
                        $(this).mouseover(function (e) {
                            $(this).css('z-index', 10000);
                            $tooltip.fadeIn('500');
                            $tooltip.fadeTo('10', 1.9);
                        }).mousemove(function (e) {
                            $tooltip.css('top', e.pageY + 10);
                            $tooltip.css('left', e.pageX + 20);
                        });
                    },

                    eventMouseout: function (calEvent, jsEvent) {
                        $(this).css('z-index', 8);
                        $('.tooltipevent').remove();
                    },
                    events: $scope.dataCalendar1,
                    timeFormat: 'H:mm:ss', // uppercase H for 24-hour clock
                    timezone: "local",
                    cache: false
                });
        }
        $scope.getMonthlyAppointment();
    }

]);
/* THIS IS FOR PARAMETER SETTINGS CONTROLLER FUNCTION */
MyCortexControllers.controller("ParameterSettingsController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', '$timeout', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, $timeout, toastr) {
        $scope.Id = 0;
        $scope.User_Id = 0;
        $scope.Units_ID = [];
        $scope.Units_Name = [];
        $scope.ProtocolParametersList = [];
        $scope.UnitMasterList = [];
        $scope.Min_Possible = [];
        $scope.NormalRange_High = [];
        $scope.NormalRange_low = [];
        $scope.Average = [];
        $scope.Max_Possible = [];
        $scope.Remarks = [];
        $scope.Diagnostic_Flag = [];
        $scope.Compliance_Flag = [];
        $scope.UnitGroupType = 1;

        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.ParameterSettings_Validations = function () {

            var validateflag = true;
            var validationMsg = "";
            angular.forEach($scope.ProtocolParametersList, function (value, index) {

                var minval = 0;
                if ((parseFloat($scope.Min_Possible[value.Id]) > ($scope.Max_Possible[value.Id])) && ($scope.Min_Possible[value.Id] != "" && $scope.Max_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Maximum Possible is greater than Minimum Possible for " + value.Name;
                    //alert("Maximum Possible is greater than Minimum Possible, cannot Save " + value.Name);
                    validateflag = false;
                    return false;
                }
                if ((parseFloat($scope.NormalRange_low[value.Id]) > ($scope.NormalRange_High[value.Id])) && ($scope.NormalRange_low[value.Id] != "" && $scope.NormalRange_High[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Normal Range High is greater than normal Range Low for " + value.Name;
                    //alert("Please enter Normal Range High is greater than normal Range Low " + value.Name);
                    validateflag = false;
                    return false;
                }
                if ((parseFloat($scope.NormalRange_High[value.Id]) > ($scope.Max_Possible[value.Id])) && ($scope.NormalRange_High[value.Id] != "" && $scope.Max_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Normal Range High is less than than Maximum Possible for " + value.Name;
                    //alert("Please enter Normal Range High is less than than Maximum Possible " + value.Name);
                    validateflag = false;
                    return false;
                }
                if ((parseFloat($scope.NormalRange_High[value.Id]) < ($scope.Min_Possible[value.Id])) && ($scope.NormalRange_High[value.Id] != "" && $scope.Min_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Normal Range High is less than Minimum Possible for " + value.Name;
                    //alert("Please enter Normal Range High is less than Minimum Possible " + value.Name);
                    validateflag = false;
                    return false;
                }

                if ((parseFloat($scope.NormalRange_low[value.Id]) < ($scope.Min_Possible[value.Id])) && ($scope.NormalRange_low[value.Id] != "" && $scope.Min_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Normal Range Low is less than Minimum Possible for " + value.Name;
                    //alert("Please enter Normal Range Low is less than Minimum Possible " + value.Name);
                    validateflag = false;
                    return false;
                }
                if ((parseFloat($scope.NormalRange_low[value.Id]) > ($scope.Max_Possible[value.Id])) && ($scope.NormalRange_low[value.Id] != "" && $scope.Max_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Normal Range Low is greater than Maximum Possible for " + value.Name;
                    //alert("Please enter Normal Range Low is greater than Maximum Possible " + value.Name);
                    validateflag = false;
                    return false;
                }

                if ((parseFloat($scope.Average[value.Id]) > ($scope.Max_Possible[value.Id])) && ($scope.Average[value.Id] != "" && $scope.Max_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Average is greater than Maximum Possible for " + value.Name;
                    //alert("Please enter Average is grater than Maximum Possible " + value.Name);
                    validateflag = false;
                    return false;
                }
                if ((parseFloat($scope.Average[value.Id]) < ($scope.Min_Possible[value.Id])) && ($scope.Average[value.Id] != "" && $scope.Min_Possible[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Average is less than Minimum Possible for " + value.Name;
                    //alert("Please enter Average is less than Minimum Possible " + value.Name);
                    validateflag = false;
                    return false;
                }

                if ((parseFloat($scope.Average[value.Id]) > ($scope.NormalRange_High[value.Id])) && ($scope.Average[value.Id] != "" && $scope.NormalRange_High[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Average is grater than Normal Range High for " + value.Name;
                    //alert("Please enter Average is grater than Normal Range High " + value.Name);
                    validateflag = false;
                    return false;
                }
                if ((parseFloat($scope.Average[value.Id]) < ($scope.NormalRange_low[value.Id])) && ($scope.Average[value.Id] != "" && $scope.NormalRange_low[value.Id] != "")) {
                    validationMsg = validationMsg + "\n" + "Average is less than Normal Range Low for " + value.Name;
                    //alert("Please enter Average is less than Normal Range Low " + value.Name);
                    validateflag = false;
                    return false;
                }

                if (($scope.Min_Possible[value.Id] != "" || $scope.Max_Possible[value.Id] != "" || $scope.NormalRange_High[value.Id] != ""
                    || $scope.NormalRange_low[value.Id] != "" || $scope.Average[value.Id] != "") && ($scope.Units_ID[value.Id] == null || $scope.Units_ID[value.Id] == undefined)) {
                    validationMsg = validationMsg + "\n" + "Please select Units for " + value.Name;
                    //alert("Please select Units");
                    validateflag = false;
                    //return false;
                }
            });

            if (validateflag == false) {
                alert(validationMsg + "\n" + "cannot Save ");
                return false;
            }
            return true;
        }

        /* 
        Calling api method for the dropdown list in the html page for the field Category
        */
        //$http.get(baseUrl + '/api/ParameterSettings/ProtocolParameterMasterList/').success(function (data) {
        //    $scope.ProtocolParametersList = data;
        //    $scope.ResultListFiltered = $scope.ProtocolParametersList;
        //});

        /*Set Unit Group Preference*/
        $scope.SetUnitGroupPreference = function () {
            $http.get(baseUrl + '/api/ParameterSettings/UnitGroupPreferenceGet/?institutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                $scope.UnitGroupType = data.PreferenceType;
            })
        }

        /*Store Chat Preference*/
        $scope.SaveUnitGroupPreference = function () {
            var type = $scope.UnitGroupType;
            $http.get(baseUrl + '/api/ParameterSettings/UnitGroupPreferenceSave/?institutionId=' + $window.localStorage['InstitutionId'] + '&preferenceType=' + type).success(function (data) {
                return data;
            })
        }

        //$http.get(baseUrl + '/api/ParameterSettings/ParameterMappingList/?Parameter_Id=0&Unitgroup_Type=1').success(function (data) {
        //    $scope.UnitMasterList = data;
        //});

        $scope.query = "";
        /* Filter the master list function.*/
        $scope.StandardFilterlist = function () {
            var searchstring = angular.lowercase($scope.query);
            if ($scope.query == "") {
                $scope.ProtocolParametersList = angular.copy($scope.ResultListFiltered);
            }
            else {
                $scope.ProtocolParametersList = $ff($scope.ResultListFiltered, function (value, index) {
                    var UnitsList_Name = "";

                    if ($ff($scope.UnitMasterList, function (unititem, unitindex) {
                        return unititem.Units_ID == $scope.Units_ID[value.Id];
                    })[0]) {
                        UnitsList_Name = $ff($scope.UnitMasterList, function (unititem, unitindex) {
                            return unititem.Units_ID == $scope.Units_ID[value.Id];
                        })[0].Units_Name
                    }
                    return angular.lowercase(value.Name).match(searchstring) ||
                        angular.lowercase(UnitsList_Name).match(searchstring)
                });
            }
        };

        $scope.ViewParamList = [];
        $scope.ViewParamList1 = [];
        $scope.ChatSettings_ViewEdit = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                // $scope.UnitGroupType = UnitGroupType;
                $http.get(baseUrl + '/api/ParameterSettings/ParameterMappingList/?Parameter_Id=0&Unitgroup_Type=' + $scope.UnitGroupType + '&Institution_Id=' + $scope.InstituteId).success(function (data) {
                    $scope.UnitMasterList = data;
                    $http.get(baseUrl + '/api/ParameterSettings/ProtocolParameterMasterList/').success(function (data1) {
                        $scope.ProtocolParametersList = data1;
                        $scope.ResultListFiltered = $scope.ProtocolParametersList;
                        $http.get(baseUrl + 'api/ParameterSettings/ViewEditProtocolParameters/?Id=' + $scope.InstituteId + '&Unitgroup_Type=' + $scope.UnitGroupType).success(function (data) {
                            $scope.ViewParamList = data;
                            $("#chatLoaderPV").hide();
                            angular.forEach($scope.ProtocolParametersList, function (masterVal, masterInd) {
                                $scope.ViewParamList1 = $ff($scope.ViewParamList, { Parameter_ID: masterVal.Id }, true)[0];
                                if ($scope.ViewParamList1 != undefined) {

                                    $scope.Units_ID[masterVal.Id] = $scope.ViewParamList1.Units_ID == null ? "0" : $scope.ViewParamList1.Units_ID.toString();
                                    if ($scope.IsEdit == false) {
                                        $scope.Units_Name[masterVal.Id] = $scope.ViewParamList1.Units_Name == null ? "" : $scope.ViewParamList1.Units_Name.toString();
                                    }
                                    $scope.Diagnostic_Flag[masterVal.Id] = $scope.ViewParamList1.Diagnostic_Flag == null ? true : $scope.ViewParamList1.Diagnostic_Flag;
                                    $scope.Compliance_Flag[masterVal.Id] = $scope.ViewParamList1.Compliance_Flag == null ? true : $scope.ViewParamList1.Compliance_Flag;
                                    $scope.Max_Possible[masterVal.Id] = $scope.ViewParamList1.Max_Possible == null ? "" : $scope.ViewParamList1.Max_Possible;
                                    $scope.Min_Possible[masterVal.Id] = $scope.ViewParamList1.Min_Possible == null ? "" : $scope.ViewParamList1.Min_Possible;
                                    $scope.NormalRange_High[masterVal.Id] = $scope.ViewParamList1.NormalRange_High == null ? "" : $scope.ViewParamList1.NormalRange_High;
                                    $scope.NormalRange_low[masterVal.Id] = $scope.ViewParamList1.NormalRange_low == null ? "" : $scope.ViewParamList1.NormalRange_low;
                                    $scope.Average[masterVal.Id] = $scope.ViewParamList1.Average == null ? "" : $scope.ViewParamList1.Average;
                                    $scope.Remarks[masterVal.Id] = $scope.ViewParamList1.Remarks == null ? "" : $scope.ViewParamList1.Remarks;
                                }
                                else {
                                    $scope.Units_ID[masterVal.Id] = "0";
                                    $scope.Diagnostic_Flag[masterVal.Id] = true;
                                    $scope.Compliance_Flag[masterVal.Id] = true;
                                    $scope.Max_Possible[masterVal.Id] = "";
                                    $scope.Min_Possible[masterVal.Id] = "";
                                    $scope.NormalRange_High[masterVal.Id] = "";
                                    $scope.NormalRange_low[masterVal.Id] = "";
                                    $scope.Average[masterVal.Id] = "";
                                    $scope.Remarks[masterVal.Id] = "";
                                }
                            });

                        }).error(function (data) {
                            $("#chatLoaderPV").hide();
                            $scope.error = "An error has occcurred while viewing standard parameter Details!" + data;
                            alert($scope.error);
                        });
                    });
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.User_Id = $window.localStorage['UserId'];
        $scope.UnitsParameterdata = [];
        /* THIS IS FOR ADD/EDIT PROCEDURE */

        $scope.StandardParameter_AddEdit = function () {
            $scope.SaveUnitGroupPreference();
            $scope.UnitsParameterdata = [];
            if ($scope.ParameterSettings_Validations() == true) {
                $("#chatLoaderPV").show();
                angular.forEach($scope.ProtocolParametersList, function (value, index) {
                    var obj = {
                        Id: $scope.Id,
                        Institution_ID: $scope.InstituteId,
                        //   User_Id: $scope.User_Id,
                        Parameter_ID: value.Id,
                        Units_ID: $scope.Units_ID[value.Id] == 0 ? null : $scope.Units_ID[value.Id],
                        Diagnostic_Flag: $scope.Diagnostic_Flag[value.Id] == null ? false : $scope.Diagnostic_Flag[value.Id],
                        Compliance_Flag: $scope.Compliance_Flag[value.Id] == null ? false : $scope.Compliance_Flag[value.Id],
                        Max_Possible: $scope.Max_Possible[value.Id] == null ? "" : $scope.Max_Possible[value.Id],
                        Min_Possible: $scope.Min_Possible[value.Id] == null ? "" : $scope.Min_Possible[value.Id],
                        NormalRange_High: $scope.NormalRange_High[value.Id] == null ? "" : $scope.NormalRange_High[value.Id],
                        NormalRange_low: $scope.NormalRange_low[value.Id] == null ? "" : $scope.NormalRange_low[value.Id],
                        Average: $scope.Average[value.Id] == null ? "" : $scope.Average[value.Id],
                        Remarks: $scope.Remarks[value.Id] == null ? "" : $scope.Remarks[value.Id],
                    }
                    $('#save').attr("disabled", true);
                    $scope.UnitsParameterdata.push(obj);
                });

                angular.forEach($scope.UnitsParameterdata, function (value, index) {
                    if (value.Units_ID == undefined) {
                        value.Units_ID = null;
                    }
                })

                $http.post(baseUrl + '/api/ParameterSettings/ParameterSettings_AddEdit/', $scope.UnitsParameterdata).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert("Standard parameter saved successfully");
                    toastr.success("Standard parameter saved successfully", "success");
                    $('#btnsave').attr("disabled", false);
                    $scope.ChatSettings_ViewEdit();
                    $scope.IsEdit = false;
                    //$location.path("/ParameterSettings");
                });
            }
        };

        $scope.IsEdit = false;
        $scope.StandardParameterEdit = function () {
            $scope.IsEdit = true;
        }
        $scope.IsEdit = false;
        $scope.StandardParameterCancel = function () {
            $scope.ChatSettings_ViewEdit();
            $scope.IsEdit = false;
            // $location.path("/ParameterSettings");
        }
    }
]);


MyCortexControllers.controller("CareCoordinatorController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.currentTab = '1';
        $scope.flag = 0;
        $scope.Coordinator_Id = $window.localStorage['UserId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.EthnicGroupList = [];
        $scope.BloodGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.GroupTypeList = [];
        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.PageParameter = $routeParams.PageParameter;
        $scope.UserTypeId = $window.localStorage['UserTypeId'];

        $scope.InstitutionId = $window.localStorage['InstitutionId'];
        $scope.rowCollectionFilter = [];
        $scope.CareCoordinator_PatientList = [];
        $scope.coordinator_searchquery = "";

        $scope.CC_PatientNo = "";
        $scope.CC_InsuranceId = "";
        $scope.CC_GenderId = "0";
        $scope.CC_NationalityId = "0";
        $scope.CC_EthinicGroupId = "0";
        $scope.CC_MOBILE_NO = "";
        $scope.CC_HomePhoneNo = "";
        $scope.CC_Email = "";
        $scope.CC_MaritalStatus = "0";
        $scope.CC_CountryId = "0";
        $scope.CC_StataId = "0";
        $scope.CC_CityId = "0";
        $scope.CC_BloodGroupId = "0";
        $scope.CC_GroupId = "0";
        $scope.PageNumber = 1;
        $scope.loadCount = 0;
        $scope.TabClick = false;

        $scope.Reset_CC_Filter = function () {
            $scope.CC_PatientNo = "";
            $scope.CC_InsuranceId = "";
            $scope.CC_GenderId = "0";
            $scope.CC_NationalityId = "0";
            $scope.CC_EthinicGroupId = "0";
            $scope.CC_MOBILE_NO = "";
            $scope.CC_HomePhoneNo = "";
            $scope.CC_Email = "";
            $scope.CC_MaritalStatus = "0";
            $scope.CC_CountryId = "0";
            $scope.CC_StataId = "0";
            $scope.CC_CityId = "0";
            $scope.CC_BloodGroupId = "0";
            $scope.CC_GroupId = "0";
            $scope.CareCoordinator_PatientListFunction(1);
        }

        $scope.CarecoordinatorDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstitutionId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $scope.CountryStateList();
            }
        }

        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];

        $scope.CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;
            });
        }

        $scope.CC_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.CC_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.CC_CityId = "0";
                });
            }
        }
        $scope.CC_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.CC_CountryId + '&StateId=' + $scope.CC_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }
        $scope.PatientFilterCopy = [];
        $scope.PatientFilterCopyList = [];
        $scope.PageCountArray = [];
        $scope.CareCoordinator_PatientListFunction = function (PageNumber) {
            if ($window.localStorage['UserTypeId'] == 6) {

                $("#chatLoaderPV").show();
                $scope.PatientFilterCopy = [];
                $scope.PageNumber = PageNumber;
                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.Patient_PerPage = data1[0].ConfigValue;
                    $http.post(baseUrl + '/api/CareCoordinnator/CareCoordinator_PatientList/?Coordinator_Id=' + $scope.Coordinator_Id + '&PATIENTNO=' + $scope.CC_PatientNo + '&INSURANCEID=' + $scope.CC_InsuranceId + '&GENDER_ID=' + $scope.CC_GenderId + '&NATIONALITY_ID=' + $scope.CC_NationalityId + '&ETHINICGROUP_ID=' + $scope.CC_EthinicGroupId + '&MOBILE_NO=' + $scope.CC_MOBILE_NO + '&HOME_PHONENO=' + $scope.CC_HomePhoneNo + '&EMAILID=' + $scope.CC_Email + '&MARITALSTATUS_ID=' + $scope.CC_MaritalStatus + '&COUNTRY_ID=' + $scope.CC_CountryId + '&STATE_ID=' + $scope.CC_StataId + '&CITY_ID=' + $scope.CC_CityId + '&BLOODGROUP_ID=' + $scope.CC_BloodGroupId + '&Group_Id=' + $scope.CC_GroupId + '&TypeId=' + $scope.PageParameter + '&UserTypeId=' + $scope.UserTypeId
                    ).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.emptydata = [];
                        $scope.CareCoordinator_PatientList = [];
                        $window.localStorage['CC_Date'] = new Date();
                        $scope.CareCoordinator_PatientList = data;
                        $scope.PatientCount = $scope.CareCoordinator_PatientList.length;
                        total = Math.ceil(($scope.PatientCount) / ($scope.Patient_PerPage));
                        for (var i = 0; i < total; i++) {
                            var obj = {
                                PageNumber: i + 1
                            }
                            $scope.PageCountArray.push(obj);
                        }
                        $scope.rowCollectionFilter = angular.copy($scope.CareCoordinator_PatientList);
                        $scope.PatientFilterCopyList = angular.copy($scope.CareCoordinator_PatientList);
                        $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
                        $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
                        //Get the records for Page Load
                        $scope.rowCollectionFilter = $ff($scope.CareCoordinator_PatientList, function (value, index) {
                            return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
                        });
                        if ($scope.rowCollectionFilter.length > 0) {
                            $scope.flag = 1;
                        }
                        else {
                            $scope.flag = 0;
                        }
                    });
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }

        }


        $scope.Next_CareCoordinator_PatientListFunction = function (PageNumber) {
            $scope.PageNumber = PageNumber;
            $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
            $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
            //Get the records for Page Load
            $scope.rowCollectionFilter = $ff($scope.CareCoordinator_PatientList, function (value, index) {
                return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
            });
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.flag = 1;
            }
            else {
                $scope.flag = 0;
            }
        }

        $scope.Coordinator_ListFilter = function () {
            $scope.ResultListFiltered = [];
            $scope.PageCountArray = [];
            $scope.PageNumber = 1;
            var searchstring = angular.lowercase($scope.coordinator_searchquery);
            if ($scope.coordinator_searchquery == "") {
                $scope.rowCollectionFilter = [];
                $scope.rowCollectionFilter = angular.copy($scope.PatientFilterCopyList);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.PatientFilterCopyList, function (value) {
                    return angular.lowercase(value.PatientName).match(searchstring) ||
                        angular.lowercase(value.MRN_NO).match(searchstring) ||
                        angular.lowercase(value.Smoker_Option).match(searchstring) ||
                        angular.lowercase(value.Diabetic_Option).match(searchstring) ||
                        angular.lowercase(value.Diabetic_Option).match(searchstring) ||
                        angular.lowercase(value.Cholestrol_Option).match(searchstring);
                });

            }
            $scope.PatientCount = $scope.rowCollectionFilter.length;
            total = Math.ceil(($scope.PatientCount) / ($scope.Patient_PerPage));
            for (var i = 0; i < total; i++) {
                var obj = {
                    PageNumber: i + 1
                }
                $scope.PageCountArray.push(obj);
            }
            $scope.CareCoordinator_PatientList = $scope.rowCollectionFilter;
            $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
            $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
            $scope.rowCollectionFilter = $ff($scope.rowCollectionFilter, function (value, index) {
                return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
            });
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.flag = 1;
            }
            else {
                $scope.flag = 0;
            }
        }
        $scope.AlertArray = [];
        $scope.HighSelected = false;
        $scope.MediumSelected = false;
        $scope.LowSelected = false;
        $scope.Filter_Selected = ["1", "2", "3"];
        $scope.Coordinator_Filter = function () {
            $scope.PageNumber = 1;
            $scope.PageCountArray = [];
            $scope.PageNumber = 1;
            $scope.HighSelected = false;
            $scope.MediumSelected = false;
            $scope.LowSelected = false;
            $scope.SelectedFilter = $scope.Filter_Selected.toString();
            /*if ((($scope.SelectedFilter.match('1')) && ($scope.SelectedFilter.match('2')) && ($scope.SelectedFilter.match('3')))) {
                $scope.CareCoordinator_PatientList = angular.copy($scope.PatientFilterCopyList);
            }*/
            if ($scope.CareCoordinator_PatientList.length == 0) {
                $scope.CareCoordinator_PatientList = angular.copy($scope.PatientFilterCopyList);
            }
            if (($scope.SelectedFilter.match('1'))) {
                $scope.HighSelected = true;
            }
            if (($scope.SelectedFilter.match('2'))) {
                $scope.MediumSelected = true;
            }
            if (($scope.SelectedFilter.match('3'))) {
                $scope.LowSelected = true;
            }
            $scope.rowCollectionFilter = $ff($scope.CareCoordinator_PatientList, function (value) {
                return (value.HighCount > 0 && $scope.HighSelected == true) ||
                    (value.MediumCount > 0 && $scope.MediumSelected == true) ||
                    (value.LowCount > 0 && $scope.LowSelected == true);

                /*return ((value.HighCount > 0 && $scope.HighSelected == true) || (value.HighCount == 0 && ($scope.MediumSelected == true || $scope.LowSelected == true)) ||
                ($scope.HighSelected == false && ($scope.MediumSelected == true || $scope.LowSelected == true))) &&
                ((value.MediumCount > 0 && $scope.MediumSelected == true) || (value.MediumCount == 0 && ($scope.HighSelected == true || $scope.LowSelected == true)) ||
                ($scope.MediumSelected == false && ($scope.HighSelected == true || $scope.LowSelected == true))) &&
                ((value.LowCount > 0 && $scope.LowSelected == true) || (value.LowCount == 0 && ($scope.HighSelected == true || $scope.MediumSelected == true)) ||
                ($scope.LowSelected == false && ($scope.HighSelected == true || $scope.MediumSelected == true)))
                ;*/
            });
            $scope.PatientCount = $scope.rowCollectionFilter.length;
            total = Math.ceil(($scope.PatientCount) / ($scope.Patient_PerPage));
            for (var i = 0; i < total; i++) {
                var obj = {
                    PageNumber: i + 1
                }
                $scope.PageCountArray.push(obj);
            }
            $scope.CareCoordinator_PatientList = $scope.rowCollectionFilter;
            $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
            $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
            $scope.rowCollectionFilter = $ff($scope.rowCollectionFilter, function (value, index) {
                return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
            });
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.flag = 1;
            }
            else {
                $scope.flag = 0;
            }
        }
        $scope.DiagosticAlert_PatientData = function (eventId) {
            //Diagostic Alert
            $scope.Id = eventId;
            $window.location.href = baseUrl + "/Home/Index#/PatientVitals/" + $scope.Id + "/5";
        }
        $scope.ComplianceAlert_PatientData = function (eventId) {
            //Compliance Alert
            $scope.Id = eventId;
            $window.location.href = baseUrl + "/Home/Index#/PatientVitals/" + $scope.Id + "/6";
        }
    }
]);

MyCortexControllers.controller("CareGiverAssignedPatientsController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];
        $scope.caregiver_PatientList = [];
        $scope.caregiver_searchquery = "";
        $scope.CareGiver_Id = $window.localStorage['UserId'];
        $scope.InstitutionId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.EthnicGroupList = [];
        $scope.BloodGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.GroupTypeList = [];
        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.CG_PatientNo = "";
        $scope.CG_InsuranceId = "";
        $scope.CG_GenderId = "0";
        $scope.CG_NationalityId = "0";
        $scope.CG_EthinicGroupId = "0";
        $scope.CG_MOBILE_NO = "";
        $scope.CG_HomePhoneNo = "";
        $scope.CG_Email = "";
        $scope.CG_MaritalStatus = "0";
        $scope.CG_CountryId = "0";
        $scope.CG_StateId = "0";
        $scope.CG_CityId = "0";
        $scope.CG_BloodGroupId = "0";
        $scope.CG_GroupId = "0";
        $scope.PageNumber = 1;
        $scope.TabClick = false;

        $scope.ResetFilter = function () {
            $scope.CG_PatientNo = "";
            $scope.CG_InsuranceId = "";
            $scope.CG_GenderId = "0";
            $scope.CG_NationalityId = "0";
            $scope.CG_EthinicGroupId = "0";
            $scope.CG_MOBILE_NO = "";
            $scope.CG_HomePhoneNo = "";
            $scope.CG_Email = "";
            $scope.CG_MaritalStatus = "0";
            $scope.CG_CountryId = "0";
            $scope.CG_StateId = "0";
            $scope.CG_CityId = "0";
            $scope.CG_BloodGroupId = "0";
            $scope.CG_GroupId = "0";
            $scope.CareGiver_PatientListFunction(1)
        }

        $scope.CaregiverPatientsDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstitutionId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $scope.CountryStateList();
            }
        }
        $scope.loadCount = 0;
        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];

        $scope.CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;

            });
        }
        $scope.CG_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        };
        $scope.CG_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        };
        $scope.PageCountArray = [];
        $scope.PatientFilterCopy = [];
        $scope.PatientFilterCopyList = [];
        $scope.CareGiver_PatientListFunction = function (PageNumber) {
            if ($window.localStorage['UserTypeId'] == 5) {

                $("#chatLoaderPV").show();
                $scope.PageNumber = PageNumber;
                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.Patient_PerPage = data1[0].ConfigValue;
                    $http.get(baseUrl + '/api/CareGiver/CareGiver_AssignedPatientList/?CareGiver_Id=' + $scope.CareGiver_Id + '&PATIENTNO=' + $scope.CG_PatientNo + '&INSURANCEID=' + $scope.CG_InsuranceId + '&GENDER_ID=' + $scope.CG_GenderId + '&NATIONALITY_ID=' + $scope.CG_NationalityId + '&ETHINICGROUP_ID=' + $scope.CG_EthinicGroupId + '&MOBILE_NO=' + $scope.CG_MOBILE_NO + '&HOME_PHONENO=' + $scope.CG_HomePhoneNo + '&EMAILID=' + $scope.CG_Email + '&MARITALSTATUS_ID=' + $scope.CG_MaritalStatus + '&COUNTRY_ID=' + $scope.CG_CountryId + '&STATE_ID=' + $scope.CG_StataId + '&CITY_ID=' + $scope.CG_CityId + '&BLOODGROUP_ID=' + $scope.CG_BloodGroupId + '&Group_Id=' + $scope.CG_GroupId + '&PageNumber=' + $scope.PageNumber + '&Login_Session_Id=' + $scope.LoginSessionId
                    ).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.emptydata = [];
                        $scope.CareGiver_PatientList = [];
                        $scope.CareGiver_PatientList = data;
                        $scope.PatientCount = $scope.CareGiver_PatientList.length;
                        total = Math.ceil(($scope.PatientCount) / ($scope.Patient_PerPage));
                        for (var i = 0; i < total; i++) {
                            var obj = {
                                PageNumber: i + 1
                            }
                            $scope.PageCountArray.push(obj);
                        }
                        $scope.rowCollectionFilter = angular.copy($scope.CareGiver_PatientList);
                        $scope.PatientFilterCopyList = angular.copy($scope.CareGiver_PatientList);
                        $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
                        $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
                        //Get the records for Page Load
                        $scope.rowCollectionFilter = $ff($scope.CareGiver_PatientList, function (value, index) {
                            return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
                        });
                        if ($scope.rowCollectionFilter.length > 0) {
                            $scope.flag = 1;
                        }
                        else {
                            $scope.flag = 0;
                        }
                    });
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        }
        $scope.Next_CareGiver_PatientListFunction = function (PageNumber) {
            $scope.PageNumber = PageNumber;
            $scope.SelectedFilter = $scope.Filter_Selected.toString();
            //if($scope.caregiver_searchquery == "" && (($scope.SelectedFilter.match('1')) && ($scope.SelectedFilter.match('2')) && ($scope.SelectedFilter.match('3'))))
            //{
            //    $scope.CareGiver_PatientList = angular.copy($scope.PatientFilterCopyList);
            //}
            //else
            //{
            //    $scope.CareGiver_PatientList = angular.copy($scope.PatientFilterCopy);
            //}
            $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
            $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
            //Get the records for Page Load
            $scope.rowCollectionFilter = $ff($scope.CareGiver_PatientList, function (value, index) {
                return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
            });
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.flag = 1;
            }
            else {
                $scope.flag = 0;
            }
        }

        $scope.HighSelected = false;
        $scope.MediumSelected = false;
        $scope.LowSelected = false;
        $scope.NoAlertSelected = false;
        $scope.Filter_Selected = ["1", "2", "3", "4"];
        $scope.Coordinator_Filter = function () {
            $scope.PageCountArray = [];
            $scope.PageNumber = 1;
            $scope.HighSelected = false;
            $scope.MediumSelected = false;
            $scope.LowSelected = false;
            $scope.NoAlertSelected = false;
            $scope.SelectedFilter = $scope.Filter_Selected.toString();
            /*if ((($scope.SelectedFilter.match('1')) && ($scope.SelectedFilter.match('2')) && ($scope.SelectedFilter.match('3')) && ($scope.SelectedFilter.match('4')))) {
                $scope.CareGiver_PatientList = angular.copy($scope.PatientFilterCopyList);
            }
            else*/
            if ($scope.CareGiver_PatientList.length == 0) {
                $scope.CareGiver_PatientList = angular.copy($scope.PatientFilterCopyList);
            }
            if (($scope.SelectedFilter.match('1'))) {
                $scope.HighSelected = true;
            }
            if (($scope.SelectedFilter.match('2'))) {
                $scope.MediumSelected = true;
            }
            if (($scope.SelectedFilter.match('3'))) {
                $scope.LowSelected = true;
            }
            if (($scope.SelectedFilter.match('4'))) {
                $scope.NoAlertSelected = true;
            }
            $scope.rowCollectionFilter = $ff($scope.CareGiver_PatientList, function (value) {
                return (value.HighCount > 0 && $scope.HighSelected == true) ||
                    (value.MediumCount > 0 && $scope.MediumSelected == true) ||
                    (value.LowCount > 0 && $scope.LowSelected == true) ||
                    ($scope.NoAlertSelected == true && value.HighCount == 0 && value.MediumCount == 0 && value.LowCount == 0);

            });
        }

        $scope.CareGiver_ListFilter = function () {
            $scope.ResultListFiltered = [];
            $scope.PageCountArray = [];
            $scope.PageNumber = 1;
            var searchstring = angular.lowercase($scope.caregiver_searchquery);
            if ($scope.caregiver_searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.CareGiver_PatientList);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.CareGiver_PatientList, function (value) {
                    return angular.lowercase(value.PatientName).match(searchstring) ||
                        angular.lowercase(value.MRN_NO).match(searchstring);
                });
            }
            $scope.PatientCount = $scope.rowCollectionFilter.length;
            total = Math.ceil(($scope.PatientCount) / ($scope.Patient_PerPage));
            for (var i = 0; i < total; i++) {
                var obj = {
                    PageNumber: i + 1
                }
                $scope.PageCountArray.push(obj);
            }
            $scope.CareGiver_PatientList = $scope.rowCollectionFilter;
            $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
            $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
            $scope.rowCollectionFilter = $ff($scope.rowCollectionFilter, function (value, index) {
                return (index >= ($scope.PageStart - 1) && index <= $scope.PageEnd - 1);
            });
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.flag = 1;
            }
            else {
                $scope.flag = 0;
            }
        }
        $scope.CareGiver_AssignedPatients = function (eventId) {
            //Care Giver Assigned patients
            $scope.Id = eventId;
            $window.location.href = baseUrl + "/Home/Index#/PatientVitals/" + $scope.Id + "/7";
        }
    }
]);

/* THIS IS FOR LOGIN CONTROLLER FUNCTION */
MyCortexControllers.controller("ParameterController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, toastr) {

        $scope.AddParameterPopup = function () {

            angular.element('#ParameterCreateModal').modal('show');
        }

        $scope.CancelParameterPopup = function () {

            angular.element('#ParameterCreateModal').modal('hide');
        }

        $scope.ViewIntstitutionPopup = function () {

            angular.element('#ViewModal').modal('show');
        }

        $scope.CancelViewIntstitutionPopup = function () {

            angular.element('#ViewModal').modal('hide');
        }

    }

]);

// This is for ICD10 controller functions//    
MyCortexControllers.controller("ICD10Controller", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        $scope.Id = "0";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.Category_ID = "0";
        $scope.IsActive = true;

        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.total_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.Patient_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {
            if (typeof ($scope.ICD_Code) == "undefined" || $scope.ICD_Code == 0) {
                //alert("Please enter ICD Code");
                toastr.warning("Please enter ICD Code", "warning");
                return false;
            }
            else if (typeof ($scope.Description) == "undefined" || $scope.Description == 0) {
                //alert("Please enter ICD Description");
                toastr.warning("Please enter ICD Description", "warning");
                return false;
            }
            /*else if (typeof ($scope.Category_ID) == "undefined" || $scope.Category_ID == "0") {
                alert("Please select Category");
                return false;
            }*/
            return true;
        };

        /* THIS IS FOR ADD/EDIT PROCEDURE */
        $scope.ICD10AddEdit = function () {
            if ($scope.Validationcontrols() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    ICD_Code: $scope.ICD_Code,
                    Category_ID: $scope.Category_ID == 0 ? null : $scope.Category_ID,
                    Description: $scope.Description,
                    InstitutionId: $scope.InstituteId,
                    Created_By: $scope.Patient_Id
                }
                $("#btnsave").attr("disabled", true);
                $http.post(baseUrl + '/api/MasterICD/MasterICD_AddEdit/', obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $("#btnsave").attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.ClearPopup();
                        $scope.ICD10list();
                    }
                    //$scope.AddId = data;
                    angular.element('#ICD10Modal').modal('hide');
                })
            }
        }

        /*
  Calling api method for the dropdown list in the html page for the field Category
 */
        //$("#chatLoaderPV").show();
        //$http.get(baseUrl + '/api/MasterICD/CategoryMasterList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
        //    $("#chatLoaderPV").hide();
        //    $scope.CategoryIDListTemp = [];
        //    $scope.CategoryIDListTemp = data;
        //    var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
        //    $scope.CategoryIDListTemp.splice(0, 0, obj);
        //    $scope.CategoryIDList = angular.copy($scope.CategoryIDListTemp);
        //});


        /* THIS IS FOR LIST PROCEDURE */
        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];
        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            $scope.ICD10list();
        }

        $scope.ICD10list = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active

                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }



                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;
                    $http.get(baseUrl + '/api/MasterICD/ICDMasterList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.InstituteId + '&StartRowNumber=' + $scope.PageStart +
                        '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                            $("#chatLoaderPV").hide();
                            $scope.emptydata = [];
                            $scope.rowCollection = [];
                            $scope.rowCollection = data;
                            $scope.PatientCount = $scope.rowCollection[0].TotalRecord;
                            $scope.rowCollectionFilter = angular.copy($scope.rowCollection);

                            if ($scope.rowCollectionFilter.length > 0) {
                                $scope.flag = 1;
                            }
                            else {
                                $scope.flag = 0;
                            }
                            $http.get(baseUrl + '/api/MasterICD/CategoryMasterList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                                $("#chatLoaderPV").hide();
                                $scope.CategoryIDListTemp = [];
                                $scope.CategoryIDListTemp = data;
                                var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                                $scope.CategoryIDListTemp.splice(0, 0, obj);
                                $scope.CategoryIDList = angular.copy($scope.CategoryIDListTemp);
                            });
                            $scope.total_page = Math.ceil(($scope.PatientCount) / ($scope.page_size));
                        })
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.searchquery = "";
        /* FILTER THE MASTER LIST FUNCTION.*/
        $scope.fliterICD10List = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.ICD_Code).match(searchstring) ||
                        angular.lowercase(value.Description).match(searchstring) ||
                        angular.lowercase(value.CategoryName).match(searchstring);
                });
            }
        }

        /* THIS IS FOR VIEW PROCEDURE */

        $scope.ViewICD10 = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }

            $http.get(baseUrl + '/api/MasterICD/ICDMasterView/?Id=' + $scope.Id).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.DuplicatesId = data.Id;
                $scope.ICD_Code = data.ICD_Code;
                $scope.Description = data.Description;
                $scope.Category_ID = data.Category_ID.toString();
                $scope.ViewCategoryName = data.CategoryName;
            });
        }

        $scope.DeleteICD10 = function (DId) {
            $scope.Id = DId;
            $scope.ICDMaster_Delete();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.ICDMaster_Delete = function () {

            var del = confirm("Do you like to deactivate the selected ICD 10 details?");
            if (del == true) {
                $http.get(baseUrl + '/api/MasterICD/ICDMaster_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert(" ICD 10 details has been deactivated Successfully");
                    toastr.success(" ICD 10 details has been deactivated Successfully", "success");
                    $scope.ICD10list();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  ICD 10 details" + data;
                });
            }
        };

        $scope.ActiveICD10 = function (PId) {
            $scope.Id = PId;
            $scope.ICDMaster_Active();
        };


        /* 
            Calling the api method to activate the details of ICD 10 
            matching the specified ICD 10 Id,
            and redirected to the list page.
           */
        $scope.ICDMaster_Active = function () {

            var Ins = confirm("Do you like to activate the selected ICD 10 details?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/MasterICD/ICDMaster_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected ICD 10 details has been activated successfully");
                    toastr.success("Selected ICD 10 details has been activated successfully", "success");
                    $scope.ICD10list();
                }).error(function (data) {
                    $scope.error = "An error has occured while deleting ICD 1O records" + data;
                });
            }
        };

        $scope.Active_ErrorFunction = function () {
            //alert("Inactive ICD 10 details cannot be edited");
            toastr.info("Inactive ICD 10 details cannot be edited", "info");
        };

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }


        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddICD10PopUP = function () {
            angular.element('#ICD10Modal').modal('show');
            $("#btnsave").attr("disabled", false);
            $scope.ClearPopup();
        }
        /* THIS IS OPENING POP WINDOW FORM VIEW */
        $scope.ViewICD1OPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewICD10();
            angular.element('#ICD10ViewModal').modal('show');
        }
        /* THIS IS OPENING POP WINDOW FORM EDIT */
        $scope.EditICD10PopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewICD10();
            angular.element('#ICD10Modal').modal('show');
            $("#btnsave").attr("disabled", false);
        }
        /* THIS IS CANCEL POPUP FUNCTION */
        $scope.CancelPopUP = function () {
            angular.element('#ICD10Modal').modal('hide')
        }
        /* THIS IS CANCEL VIEW POPUP FUNCTION*/
        $scope.CancelViewPopup = function () {
            angular.element('#ICD10ViewModal').modal('hide')
        }
        /* THIS IS CLEAR POPUP FUNCTION */
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.ICD_Code = "";
            $scope.Description = "";
            $scope.Category_ID = "0";
        }
        /* THIS IS OPENING POP WINDOW FORM LIST */
        $scope.ListICD10PopUP = function (CatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;
            $scope.ICDCodeList();

        }
    }
]);

// This is for Payor controller functions//    
MyCortexControllers.controller("PayorMasterController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        $scope.Id = "0";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.Category_ID = "0";
        $scope.IsActive = true;
        $scope.Payor = "";
        $scope.Plan = "";
        $scope.PayorName = "";
        $scope.ShortCode = "";
        $scope.Description = "";
        $scope.ReferCode = "";
        $scope.PayorSave = true;

        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.total_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.User_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {
            //if (typeof ($scope.Payor) == "undefined" || $scope.Payor == "") {
            //    alert("Please enter Payor");
            //    return false;
            //}
            //else if (typeof ($scope.Plan) == "undefined" || $scope.Plan == "") {
            //    alert("Please enter ICD Description");
            //    return false;
            //}
            if (typeof ($scope.PayorName) == "undefined" || $scope.PayorName == "") {
                //alert("Please enter PayorName");
                toastr.warning("Please enter PayorName", "warning");
                return false;
            }
            else if (typeof ($scope.ShortCode) == "undefined" || $scope.ShortCode == "") {
                //alert("Please enter ShortCode");
                toastr.warning("Please enter ShortCode", "warning");
                return false;
            }
            else if (typeof ($scope.Description) == "undefined" || $scope.Description == "") {
                //alert("Please enter Description");
                toastr.warning("Please enter Description", "warning");
                return false;
            }
            else if (typeof ($scope.ReferCode) == "undefined" || $scope.ReferCode == "") {
                //alert("Please enter ReferCode");
                toastr.warning("Please enter ReferCode", "warning");
                return false;
            }

            return true;
        };

        $scope.Payorlist = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active

                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;
                    $http.get(baseUrl + '/api/PayorMaster/PayorList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.InstituteId + '&StartRowNumber=' + $scope.PageStart +
                        '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                            $("#chatLoaderPV").hide();
                            $scope.emptydata = [];
                            $scope.rowCollection = [];
                            $scope.rowCollection = data;
                            $scope.PatientCount = $scope.rowCollection[0].TotalRecord;
                            $scope.rowCollectionFilter = angular.copy($scope.rowCollection);

                            if ($scope.rowCollectionFilter.length > 0) {
                                $scope.flag = 1;
                            }
                            else {
                                $scope.flag = 0;
                            }
                            $scope.total_page = Math.ceil(($scope.PatientCount) / ($scope.page_size));
                        })
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        /* THIS IS FOR ADD/EDIT PROCEDURE */
        $scope.PayorAddEdit = function () {
            if ($scope.Validationcontrols() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    PayorName: $scope.PayorName,
                    ShortCode: $scope.ShortCode,
                    Description: $scope.Description,
                    ReferCode: $scope.ReferCode,
                    InstitutionId: $scope.InstituteId,
                    Created_By: $scope.User_Id
                }
                $('#btnsave').attr("disabled", true);
                $http.post(baseUrl + '/api/PayorMaster/PayorMaster_AddEdit/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $('#btnsave').attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.ClearPopup();
                        $scope.Payorlist();
                        angular.element('#PayorModal').modal('hide');
                    }
                    //$scope.AddId = data;
                    //angular.element('#ICD10Modal').modal('hide');
                });
            }
        }

        /* THIS IS FOR LIST PROCEDURE */
        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];
        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            $scope.Payorlist();
        }

        $scope.searchquery = "";
        /* FILTER THE MASTER LIST FUNCTION.*/
        $scope.fliterPayorList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.PayorName).match(searchstring) ||
                        angular.lowercase(value.ShortCode).match(searchstring) ||
                        angular.lowercase(value.ReferCode).match(searchstring) ||
                        angular.lowercase(value.Description).match(searchstring);
                });
            }
        }

        /* THIS IS FOR VIEW PROCEDURE */

        $scope.ViewPayor = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }

            $http.get(baseUrl + '/api/PayorMaster/PayorMasterView/?Id=' + $scope.Id).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.PayorName = data.PayorName;
                $scope.ShortCode = data.ShortCode;
                $scope.Description = data.Description;
                $scope.ReferCode = data.ReferCode;
            });
        }

        $scope.DeletePayor = function (DId) {
            $scope.Id = DId;
            $scope.PayorMaster_Delete();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.PayorMaster_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Payor Master details?");
            if (del == true) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/PayorMaster/PayorMaster_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Payor details has been deactivated Successfully");
                    toastr.success("Payor details has been deactivated Successfully", "success");
                    $("#chatLoaderPV").hide();
                    $scope.Payorlist();
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while deleting  Payor Master details" + data;
                });
            }
        };

        $scope.ActivePayor = function (PId) {
            $scope.Id = PId;
            $scope.PayorMaster_Active();
        };

        $scope.PayorMaster_Active = function () {

            var Ins = confirm("Do you like to activate the selected Payor Master details?");
            if (Ins == true) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/PayorMaster/PayorMaster_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Payor details has been activated successfully");
                    toastr.success("Selected Payor details has been activated successfully", "success");
                    $("#chatLoaderPV").hide();
                    $scope.Payorlist();
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occured while deleting Payor records" + data;
                });
            }
        };

        $scope.Active_ErrorFunction = function () {
            //alert("Inactive Payor details cannot be edited");
            toastr.info("Inactive Payor details cannot be edited", "info");
        };

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }


        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddPayorPopUP = function () {
            $scope.Id = 0;
            $scope.PayorSave = true;
            $('#btnsave').attr("disabled", false);
            $("#PayorName").attr("disabled", false);
            $("#ShortCode").attr("disabled", false);
            $("#Description").attr("disabled", false);
            $("#ReferCode").attr("disabled", false);
            angular.element('#PayorModal').modal('show');
            $scope.ClearPopup();
        }
        /* THIS IS OPENING POP WINDOW FORM VIEW */
        $scope.ViewPayorPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewPayor();
            $scope.PayorSave = false;
            $("#PayorName").attr("disabled", true);
            $("#ShortCode").attr("disabled", true);
            $("#Description").attr("disabled", true);
            $("#ReferCode").attr("disabled", true);
            angular.element('#PayorModal').modal('show');
        }
        /* THIS IS OPENING POP WINDOW FORM EDIT */
        $scope.EditPayorPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewPayor();
            $scope.PayorSave = true;
            $('#btnsave').attr("disabled", false);
            $("#PayorName").attr("disabled", false);
            $("#ShortCode").attr("disabled", false);
            $("#Description").attr("disabled", false);
            $("#ReferCode").attr("disabled", false);
            angular.element('#PayorModal').modal('show');
        }
        /* THIS IS CANCEL POPUP FUNCTION */
        $scope.CancelPopUP = function () {
            $scope.ClearPopup();
            angular.element('#PayorModal').modal('hide')
        }
        /* THIS IS CANCEL VIEW POPUP FUNCTION*/
        $scope.CancelViewPopup = function () {
            $scope.ClearPopup();
            angular.element('#PayorModal').modal('hide')
        }
        /* THIS IS CLEAR POPUP FUNCTION */
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.PayorName = "";
            $scope.Description = "";
            $scope.ReferCode = "";
            $scope.ShortCode = "";
        }
        /* THIS IS OPENING POP WINDOW FORM LIST */
        $scope.ListPayorPopUP = function (CatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;
            $scope.PayorCodeList();

        }
    }
]);

// This is for Plan controller functions//    
MyCortexControllers.controller("PlanMasterController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        $scope.Id = "0";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.Category_ID = "0";
        $scope.IsActive = true;
        $scope.SelectedPayor = [];
        $scope.PayorMasterList = [];
        $scope.PlanName = "";
        $scope.SelectedPlan = [];
        $scope.ShortCode = "";
        $scope.Description = "";
        $scope.PackageName = "";
        $scope.FinancialClass = "";
        $scope.PriceCode = "";
        $scope.ReferCode = "";
        $scope.ValidFromDate = new Date();
        $scope.ValidToDate = new Date();
        $scope.PlanSave = true;

        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.total_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.User_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.ConfigCode = "PATIENTPAGE_COUNT";
        $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
            $scope.page_size = data1[0].ConfigValue;
            $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
            $scope.PageEnd = $scope.current_page * $scope.page_size;
            $http.get(baseUrl + '/api/PayorMaster/PayorList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.InstituteId + '&StartRowNumber=' + $scope.PageStart + '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                $scope.PayorMasterList = data;
            });
        }).error(function (data) {
            $scope.error = "AN error has occured while Listing the records!" + data;
        })

        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {
            $scope.ValidFromDate = moment($scope.ValidFromDate).format('DD-MMM-YYYY');
            $scope.ValidToDate = moment($scope.ValidToDate).format('DD-MMM-YYYY');

            if (typeof ($scope.SelectedPayor) == "undefined" || $scope.SelectedPayor == "" || $scope.SelectedPayor == null) {
                //alert("Please Select Any Payor");
                toastr.warning("Please Select Any Payor", "warning");
                return false;
            }
            else if (typeof ($scope.PlanName) == "undefined" || $scope.PlanName == "") {
                //alert("Please enter PlanName");
                toastr.warning("Please enter PlanName", "warning");
                return false;
            }

            if (typeof ($scope.ShortCode) == "undefined" || $scope.ShortCode == "") {
                //alert("Please enter ShortCode");
                toastr.warning("Please enter ShortCode", "warning");
                return false;
            }
            else if (typeof ($scope.Description) == "undefined" || $scope.Description == "") {
                //alert("Please enter Description");
                toastr.warning("Please enter Description", "warning");
                return false;
            }
            else if (typeof ($scope.PackageName) == "undefined" || $scope.PackageName == "") {
                //alert("Please enter PackageName");
                toastr.warning("Please enter PackageName", "warning");
                return false;
            }
            else if (typeof ($scope.FinancialClass) == "undefined" || $scope.FinancialClass == "") {
                //alert("Please enter FinancialClass");
                toastr.warning("Please enter FinancialClass", "warning");
                return false;
            }
            else if (typeof ($scope.PriceCode) == "undefined" || $scope.PriceCode == "") {
                //alert("Please enter PriceCode");
                toastr.warning("Please enter PriceCode", "warning");
                return false;
            }
            else if (typeof ($scope.ReferCode) == "undefined" || $scope.ReferCode == "") {
                //alert("Please enter ReferCode");
                toastr.warning("Please enter ReferCode", "warning");
                return false;
            }
            else if (typeof ($scope.ValidFromDate) == "undefined" || $scope.ValidFromDate == "") {
                //alert("Please enter ValidFromDate");
                toastr.warning("Please enter ValidFromDate", "warning");
                return false;
            }
            else if (typeof ($scope.ValidToDate) == "undefined" || $scope.ValidToDate == "") {
                //alert("Please enter ValidToDate");
                toastr.warning("Please enter ValidToDate", "warning");
                return false;
            }
            if (($scope.ValidFromDate !== null) && ($scope.ValidToDate !== null)) {
                if ((ParseDate($scope.ValidToDate) < ParseDate($scope.ValidFromDate))) {
                    //alert("From Date should not be greater than To Date");
                    toastr.warning("From Date should not be greater than To Date", "warning");
                    $scope.ValidFromDate = DateFormatEdit($scope.ValidFromDate);
                    $scope.ValidToDate = DateFormatEdit($scope.ValidToDate);
                    return false;
                }
            }
            $scope.ValidFromDate = DateFormatEdit($scope.ValidFromDate);
            $scope.ValidToDate = DateFormatEdit($scope.ValidToDate);
            return true;
        };

        $scope.Planlist = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active

                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;
                    $http.get(baseUrl + '/api/PlanMaster/PlanList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.InstituteId + '&StartRowNumber=' + $scope.PageStart +
                        '&EndRowNumber=' + $scope.PageEnd + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                            $("#chatLoaderPV").hide();
                            $scope.emptydata = [];
                            $scope.rowCollection = [];
                            $scope.rowCollection = data;
                            $scope.PatientCount = $scope.rowCollection[0].TotalRecord;
                            $scope.rowCollectionFilter = angular.copy($scope.rowCollection);

                            if ($scope.rowCollectionFilter.length > 0) {
                                $scope.flag = 1;
                            }
                            else {
                                $scope.flag = 0;
                            }
                            $scope.total_page = Math.ceil(($scope.PatientCount) / ($scope.page_size));
                        })
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        /* THIS IS FOR ADD/EDIT PROCEDURE */
        $scope.PlanAddEdit = function () {
            if ($scope.Validationcontrols() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    SelectPayor: parseInt($scope.SelectedPayor),
                    PlanName: $scope.PlanName,
                    ShortCode: $scope.ShortCode,
                    Description: $scope.Description,
                    FinancialClass: $scope.FinancialClass,
                    PackageName: $scope.PackageName,
                    PriceCode: $scope.PriceCode,
                    ReferCode: $scope.ReferCode,
                    ValidFromDate: $scope.ValidFromDate,
                    ValidToDate: $scope.ValidToDate,
                    CreatedBy: $scope.User_Id,
                    InstitutionId: $scope.InstituteId
                }
                $('#btnsave').attr("disabled", true);
                $http.post(baseUrl + '/api/PlanMaster/PlanMasterAddEdit/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $('#btnsave').attr("disabled", false);

                    if (data.ReturnFlag == 1) {
                        $scope.ClearPopup();
                        $scope.Planlist();
                        angular.element('#PlanMasterModal').modal('hide');
                    }
                    //$scope.AddId = data;
                    //angular.element('#ICD10Modal').modal('hide');
                });
            }
        }

        /* THIS IS FOR LIST PROCEDURE */
        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];
        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            $scope.Planlist();
        }

        $scope.searchquery = "";
        /* FILTER THE MASTER LIST FUNCTION.*/
        $scope.fliterPayorList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.PayorName).match(searchstring) ||
                        angular.lowercase(value.ShortCode).match(searchstring) ||
                        angular.lowercase(value.ReferCode).match(searchstring) ||
                        angular.lowercase(value.Description).match(searchstring);
                });
            }
        }

        /* THIS IS FOR VIEW PROCEDURE */

        $scope.ViewPlan = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $scope.EditSelectedPayor = [];
            //$scope.SelectedPayor = [];
            $http.get(baseUrl + '/api/PlanMaster/PlanMasterView/Id?=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.SelectedPayor = [];
                $scope.EditSelectedPayor = data.SelectPayor.toString();
                $scope.SelectedPayor.push($scope.EditSelectedPayor);
                $scope.PlanName = data.PlanName;
                $scope.ShortCode = data.ShortCode;
                $scope.Description = data.Description;
                $scope.PackageName = data.PackageName;
                $scope.FinancialClass = data.FinancialClass;
                $scope.PriceCode = data.PriceCode;
                $scope.ReferCode = data.ReferCode;
                $scope.ValidFromDate = DateFormatEdit($filter('date')(data.ValidFromDate, "dd-MMM-yyyy"));
                $scope.ValidToDate = DateFormatEdit($filter('date')(data.ValidToDate, "dd-MMM-yyyy"));

            });
            $("#chatLoaderPV").hide();
        }

        $scope.DeletePlan = function (DId) {
            $scope.Id = DId;
            $scope.PlanMaster_Delete();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.PlanMaster_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Plan Master details?");
            if (del == true) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/PlanMaster/PlanMaster_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Plan details has been deactivated Successfully");
                    toastr.success("Plan details has been deactivated Successfully", "success");
                    $("#chatLoaderPV").hide();
                    $scope.Planlist();
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while deleting  Plan Master details" + data;
                });
            }
        };

        $scope.ActivePlan = function (PId) {
            $scope.Id = PId;
            $scope.PlanMaster_Active();
        };

        $scope.PlanMaster_Active = function () {

            var Ins = confirm("Do you like to activate the selected Plan Master details?");
            if (Ins == true) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/PlanMaster/PlanMaster_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Plan details has been activated successfully");
                    toastr.success("Selected Plan details has been activated successfully", "success");
                    $("#chatLoaderPV").hide();
                    $scope.Planlist();
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occured while deleting Payor records" + data;
                });
            }
        };

        $scope.Active_ErrorFunction = function () {
            //alert("Inactive Payor details cannot be edited");
            toastr.info("Inactive Payor details cannot be edited", "info");
        };

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }


        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddPlanPopUP = function () {
            $scope.Id = 0;
            $scope.PlanSave = true;
            var sel1 = $('#SelectedPayor');
            sel1.prop('disabled', false);
            $('#btnsave').attr("disabled", false);
            $("#PlanName").attr("disabled", false);
            $("#ShortCode").attr("disabled", false);
            $("#Description").attr("disabled", false);
            $("#FinancialClass").attr("disabled", false);
            $("#PackageName").attr("disabled", false);
            $("#PriceCode").attr("disabled", false);
            $("#ReferCode").attr("disabled", false);
            $("#ValidFromDate").attr("disabled", false);
            $("#ValidToDate").attr("disabled", false);
            $("#ReferCode").attr("disabled", false);
            angular.element('#PlanMasterModal').modal('show');
            $scope.ClearPopup();
        }
        /* THIS IS OPENING POP WINDOW FORM VIEW */
        $scope.ViewPlanPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewPlan();
            $scope.PlanSave = false;
            var sel1 = $('#SelectedPayor');
            sel1.prop('disabled', true);
            $("#PlanName").attr("disabled", true);
            $("#ShortCode").attr("disabled", true);
            $("#Description").attr("disabled", true);
            $("#FinancialClass").attr("disabled", true);
            $("#PackageName").attr("disabled", true);
            $("#PriceCode").attr("disabled", true);
            $("#ReferCode").attr("disabled", true);
            $("#ValidFromDate").attr("disabled", true);
            $("#ValidToDate").attr("disabled", true);
            $("#ReferCode").attr("disabled", true);
            angular.element('#PlanMasterModal').modal('show');
        }
        /* THIS IS OPENING POP WINDOW FORM EDIT */
        $scope.EditPlanPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewPlan();
            $scope.PlanSave = true;
            var sel1 = $('#SelectedPayor');
            sel1.prop('disabled', false);
            $('#btnsave').attr("disabled", false);
            $("#PlanName").attr("disabled", false);
            $("#ShortCode").attr("disabled", false);
            $("#Description").attr("disabled", false);
            $("#FinancialClass").attr("disabled", false);
            $("#PackageName").attr("disabled", false);
            $("#PriceCode").attr("disabled", false);
            $("#ReferCode").attr("disabled", false);
            $("#ValidFromDate").attr("disabled", false);
            $("#ValidToDate").attr("disabled", false);
            $("#ReferCode").attr("disabled", false);
            angular.element('#PlanMasterModal').modal('show');
        }
        /* THIS IS CANCEL POPUP FUNCTION */
        $scope.CancelPopUP = function () {
            $scope.ClearPopup();
            angular.element('#PlanMasterModal').modal('hide')
        }
        /* THIS IS CANCEL VIEW POPUP FUNCTION*/
        $scope.CancelViewPopup = function () {
            $scope.ClearPopup();
            angular.element('#PlanMasterModal').modal('hide')
        }
        /* THIS IS CLEAR POPUP FUNCTION */
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.PlanName = "";
            $scope.SelectedPayor = [];
            $scope.ShortCode = "";
            $scope.Description = "";
            $scope.PackageName = "";
            $scope.FinancialClass = "";
            $scope.PriceCode = "";
            $scope.ReferCode = "";
            $scope.ValidFromDate = new Date();
            $scope.ValidToDate = new Date();
        }
        /* THIS IS OPENING POP WINDOW FORM LIST */
        $scope.ListPayorPopUP = function (CatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;

        }
    }
]);

// This is for Drug DB controller functions//    
MyCortexControllers.controller("DrugDBController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        // Declaration and initialization of Scope Variables.
        $scope.Id = "0";
        $scope.Name = "0";
        $scope.Dosage_From_ID = "0";
        $scope.Dosage_FromName = "0";
        $scope.Strength_ID = "0";
        $scope.Item_Code = "";
        $scope.Drug_Code = "";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.DuplicateId = 0;
        $scope.DuplicateId = "0";
        $scope.IsActive = true;

        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.total_pageDrug = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.Patient_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']

        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {

            if (typeof ($scope.Generic_Name) == "undefined" || $scope.Generic_Name == 0) {
                //alert("Please enter Generic Name");
                toastr.warning("Please enter Generic Name", "warning");
                return false;
            }
            else if (typeof ($scope.Strength_ID) == "undefined" || $scope.Strength_ID == 0) {
                //alert("Please select Strength");
                toastr.warning("Please select Strength", "warning");
                return false;
            }
            else if (typeof ($scope.Dosage_From_ID) == "undefined" || $scope.Dosage_From_ID == 0) {
                //alert("Please select Dosage Form");
                toastr.warning("Please select Dosage Form", "warning");
                return false;
            }
            /*else if(typeof ($scope.Item_Code) == "undefined" || $scope.Item_Code == 0) {
                alert("Please enter Item Code");
                return false;
            }
            else if(typeof ($scope.Drug_Code) == "undefined" || $scope.Drug_Code == 0) {
                alert("Please enter Drug Code");
                return false;
            }*/
            return true;
        };


        /*
        Calling api method for the dropdown list in the html page for the fields
        Strength, DosageForm, DosageTime & Administration
       */
        $scope.StrengthIDList = [];
        $scope.DosageFromIDList = [];

        /* THIS IS FOR ADD/EDIT PROCEDURE */
        $scope.DrugDBAddEdit = function () {
            if ($scope.Validationcontrols() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    Generic_name: $scope.Generic_Name,
                    Strength_ID: $scope.Strength_ID,
                    Dosage_From_ID: $scope.Dosage_From_ID,
                    Item_Code: $scope.Item_Code == 0 ? null : $scope.Item_Code,
                    Drug_Code: $scope.Drug_Code == 0 ? null : $scope.Drug_Code,
                    InstitutionId: $scope.InstituteId,
                    Created_By: $scope.Patient_Id
                };
                $("#btnsave").attr("disabled", true);

                $http.post(baseUrl + '/api/DrugDBMaster/DrugDBMaster_AddEdit/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $("#btnsave").attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.CancelPopup();
                        $scope.DrugDB_List();
                        $("#chatLoaderPV").hide();
                    }
                    //angular.element('#DrugDBModal').modal('hide');
                    // $scope.ClearPopup();
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "An error has occurred while adding DrugDBMaster details" + data.ExceptionMessage;
                });
            };
        }

        $scope.Active_ErrorFunction = function () {
            //alert("Inactive Drug DB details cannot be edited");
            toastr.info("Inactive Drug DB details cannot be edited", "info");
        };


        /* THIS IS FOR LIST PROCEDURE */
        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];

        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            $scope.DrugDB_List();
        }

        $scope.DrugDB_List = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }
                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_page * $scope.page_size;
                    $http.get(baseUrl + '/api/DrugDBMaster/DrugDBMasterList/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.InstituteId + '&StartRowNumber=' + $scope.PageStart +
                        '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                            $scope.emptydata = [];
                            $scope.rowCollection = [];
                            $scope.rowCollection = data;
                            if ($scope.rowCollection.length > 0) {
                                $scope.DrugCount = $scope.rowCollection[0].TotalRecord;
                            }
                            $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                            if ($scope.rowCollectionFilter.length > 0) {
                                $scope.flag = 1;
                            }
                            else {
                                $scope.flag = 0;
                            }

                            $("#chatLoaderPV").hide();

                            $http.get(baseUrl + '/api/DrugDBMaster/DrugStrengthList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                                $scope.StrengthIDListTemp = [];
                                $scope.StrengthIDListTemp = data;

                                var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                                $scope.StrengthIDListTemp.splice(0, 0, obj);

                                $scope.StrengthIDList = angular.copy($scope.StrengthIDListTemp);
                            })
                            $http.get(baseUrl + '/api/DrugDBMaster/DosageFormList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                                $scope.DosageFromIDListTemp = [];
                                $scope.DosageFromIDListTemp = data;

                                var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                                $scope.DosageFromIDListTemp.splice(0, 0, obj);

                                $scope.DosageFromIDList = angular.copy($scope.DosageFromIDListTemp);
                            })
                            $scope.total_pageDrug = Math.ceil(($scope.DrugCount) / ($scope.page_size));
                        })
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };
        /* CANCEL POPUP FUNCTION*/
        $scope.CancelPopup = function () {
            angular.element('#DrugDBModal').modal('hide');
        }

        //$http.get(baseUrl + '/api/DrugDBMaster/DrugStrengthList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
        //    $scope.StrengthIDListTemp = [];
        //    $scope.StrengthIDListTemp = data;

        //    var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
        //    $scope.StrengthIDListTemp.splice(0, 0, obj);

        //    $scope.StrengthIDList = angular.copy($scope.StrengthIDListTemp);
        //})
        //$http.get(baseUrl + '/api/DrugDBMaster/DosageFormList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
        //    $scope.DosageFromIDListTemp = [];
        //    $scope.DosageFromIDListTemp = data;

        //    var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
        //    $scope.DosageFromIDListTemp.splice(0, 0, obj);

        //    $scope.DosageFromIDList = angular.copy($scope.DosageFromIDListTemp);
        //})
        $scope.searchquery = "";
        /* FILTER THE MASTER LIST FUNCTION.*/
        $scope.filterInstitutionList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.Generic_name).match(searchstring) ||
                        angular.lowercase(value.StrengthName).match(searchstring) ||
                        angular.lowercase(value.Dosage_FromName).match(searchstring) ||
                        angular.lowercase(value.Item_Code).match(searchstring) ||
                        angular.lowercase(value.Drug_Code).match(searchstring)

                });
            }
        }

        /* THIS IS FOR VIEW PROCEDURE */
        $scope.ViewDrugDB = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/DrugDBMaster/DrugDBMasterView/?Id=' + $scope.Id).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.DuplicatesId = data.Id;
                $scope.Generic_Name = data.Generic_name;
                $scope.Strength_ID = data.Strength_ID.toString();
                $scope.ViewStrengthName = data.StrengthName;
                $scope.Dosage_From_ID = data.Dosage_From_ID.toString();
                $scope.ViewDosage_FromName = data.Dosage_FromName;
                $scope.Item_Code = data.Item_Code;
                $scope.Drug_Code = data.Drug_Code;
            });
        }

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }

        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddDrugDBPopUP = function () {
            $scope.ClearPopup();
            angular.element('#DrugDBModal').modal('show');
            $("#btnsave").attr("disabled", false);
        }
        /* THIS IS OPENING POP WINDOW VIEW */
        $scope.ViewDrugDBPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewDrugDB();
            angular.element('#DrugDBViewModal').modal('show');
        }
        /* THIS IS EDIT POPUP FUNCTION */
        $scope.EditDrugDBPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewDrugDB();
            angular.element('#DrugDBModal').modal('show');
            $("#btnsave").attr("disabled", false);
        }
        /* THIS IS CANCEL VIEW POPUP FUNCTION  */
        $scope.CancelViewPopup = function () {
            angular.element('#DrugDBViewModal').modal('hide');
        }
        /* THIS IS CLEAR POPUP FUNCTION */
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.Generic_Name = "";
            $scope.Strength_ID = "0";
            $scope.Dosage_From_ID = "0";
            $scope.Item_Code = "";
            $scope.Drug_Code = "";
        }

        //$scope.CancelPopup = function () {
        //    angular.element('#DrugDBModal').modal('hide');
        //};

        /* THIS IS FOR DELETE FUNCTION*/
        $scope.DeleteDrugDB = function (DId) {
            $scope.Id = DId;
            $scope.DrugDBMaster_Delete();
        };


        /*THIS IS FOR DELETE FUNCTION */
        $scope.DrugDBMaster_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Drug DB details?");
            if (del == true) {
                $http.get(baseUrl + '/api/DrugDBMaster/DrugDBMaster_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert(" Drug DB details has been deactivated Successfully");
                    toastr.success(" Drug DB details has been deactivated Successfully", "success");
                    $scope.DrugDB_List();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  Drug DB details" + data;
                });
            }
        };

        $scope.ActiveDrugDB = function (PId) {
            $scope.Id = PId;
            $scope.DrugDBMasterActive();
        };
        /*
            Calling the api method to activate the details of the Patient
            matching the specified Patient Id,
            and redirected to the list page.
           */
        $scope.DrugDBMasterActive = function () {

            var Ins = confirm("Do you like to activate the selected Drug DB details?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/DrugDBMaster/DrugDBMaster_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Drug DB details has been activated successfully");
                    toastr.success("Selected Drug DB details has been activated successfully", "success");
                    $scope.DrugDB_List();
                }).error(function (data) {
                    $scope.error = "An error has occured while deleting Drug DB records" + data;
                });
            }
        };
    }
]);

// This is for AlertConfiguration controller functions//    
MyCortexControllers.controller("AlertConfigurationController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.Id = "0";
        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD,VIEW AND EDIT */
        $scope.AddAlertConfigurationPopUP = function () {
            angular.element('#AlertConfigurationModal').modal('show');
        }

        $scope.ViewICD10PopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewICD10();
            angular.element('#AlertConfigurationViewModal').modal('show');
        }

        $scope.EditICD10PopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewITSection();
            angular.element('#AlertConfigurationModal').modal('show');
        }

        $scope.CancelPopUP = function () {
            angular.element('#AlertConfigurationModal').modal('hide')
        }

        $scope.ListICD10PopUP = function (CatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;
            $scope.ICDCodeList();

        }
    }
]);

// This is for Protocol controller functions//    
MyCortexControllers.controller("ProtocolController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.Id = "0";
        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD,VIEW AND EDIT */
        $scope.AddProtocolPopUP = function () {
            angular.element('#ProtocolModal').modal('show');
        }
        $scope.ViewProtocolPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewICD10();
            angular.element('#ProtocolViewModal').modal('show');
        }

        $scope.EditProtocolPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewITSection();
            angular.element('#ProtocolModal').modal('show');
        }

        $scope.CancelProtocolPopUP = function () {
            angular.element('#ProtocolModal').modal('hide')
        }


        $scope.ListProtocolPopUP = function (CatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;
            $scope.DrugDBList();

        }

    }
]);

// This is for User controller functions/ /
MyCortexControllers.controller("PatientController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.Id = "0";
        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD,VIEW AND EDIT */
        $scope.AddPatientPopup = function () {
            $('#btnsave1').attr("disabled", false);
            angular.element('#PatientCreateModal').modal('show');
        }

        $scope.CancelPopup = function () {
            angular.element('#PatientCreateModal').modal('hide')
        }
        $scope.AdvanceSearchPopup = function () {
            angular.element('#ViewModal').modal('show')
        }
    }
]);


// This is for Monitoring Protocol controller functions/ /
MyCortexControllers.controller("MonitoringProtocolController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.IsActive = true;
        $scope.Protocol_Names = "0";
        $scope.Cloneval = 0;
        $scope.Id = 0;
        $scope.IsAdd = 0;
        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD,VIEW AND EDIT */
        $scope.AddMonitoringProtocolPopup = function () {
            $scope.IsAdd = 1;
            $('#btnsave').attr("disabled", false);
            angular.element('#ProtocolCreateModal').modal('show');
            $scope.MonitoringProtocolDropDownList();

        }

        $scope.AddCloneProtocolPopup = function () {
            $scope.Cloneval = 1;
            $('#btnsave').attr("disabled", false);
            angular.element('#ProtocolCreateModal').modal('show');
        }

        $scope.CancelMonitoringProtocolPopup = function () {
            angular.element('#ProtocolCreateModal').modal('hide')
        }

        $scope.flag = 0;
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        /*THIS IS FOR LIST FUNCTION*/
        $scope.rowCollectionFilter = [];
        $scope.MonitoringProtocolDetailsListGo = function () {
            if ($window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 5 || $window.localStorage['UserTypeId'] == 7) {
                $("#chatLoaderPV").show();
                $scope.emptydata = [];
                $scope.rowCollection = [];
                $scope.Institution_Id = "";

                $scope.ActiveStatus = $scope.IsActive == true ? 1 : 0;

                $http.get(baseUrl + 'api/Protocol/StandardProtocol_List/?IsActive=' + $scope.ActiveStatus + '&InstitutionId=' + $scope.InstituteId).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                }).error(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.CloneProtocolList = [];
        $scope.CloneProtocolFunction = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + 'api/Protocol/StandardProtocol_View/?Id=' + $scope.Protocol_Names).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.ParameterSettingslist = data;
                angular.forEach($scope.ParameterSettingslist, function (value, index) {
                    // $scope.ProtocolName = value.ProtocolName;
                    value.Id = "0";
                });

            });
        };
        $scope.ParameterTypeList = [];
        $scope.MonitoringProtocolDropDownList = function () {
            $scope.ViewParamList = [];
            $http.get(baseUrl + 'api/ParameterSettings/ViewEditProtocolParameters/?Id=' + $scope.InstituteId).success(function (data) {
                $scope.ViewParamList = data;
            })

            $scope.UnitTypeList = [];
            $scope.ParameterTypeList = [];
            $http.get(baseUrl + '/api/Protocol/ParameterNameList/?InstitutionId=' + $scope.InstituteId).success(function (data) {
                $scope.ParameterTypeList = data;

                if ($scope.IsAdd == 1) {
                    if ($scope.ParameterTypeList.length == 0)
                        //alert("Standard parameter is not configured, Monitoring Protocol cannot be created");
                        toastr.info("Standard parameter is not configured, Monitoring Protocol cannot be created", "info");
                }
                $scope.IsAdd = 0;

            });

            $scope.DurationTypeList = [];
            $http.get(baseUrl + '/api/Protocol/DurationTypeDetails/').success(function (data) {
                $scope.DurationTypeList = data;
            });

            $http.get(baseUrl + '/api/ParameterSettings/ParameterMappingList/?Parameter_Id=0&Unitgroup_Type=1&Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.UnitTypeList = data;
            });

        }

        $scope.ViewParamList1 = [];
        $scope.ParameterSettingslist1 = [];
        $scope.ParameterSettings_ViewEdit = function (row) {

            ParamId = row.Parameter_Id;
            $scope.ViewParamList1 = $ff($scope.ViewParamList, { Parameter_ID: ParamId }, true);

            if ($scope.ViewParamList1.length > 0) {
                $ff($scope.ViewParamList1, function (masterVal1, masterInd1) {
                    return row.NormalRange_High = masterVal1.NormalRange_High,
                        row.NormalRange_Low = masterVal1.NormalRange_low,
                        row.Units_Id = masterVal1.Units_ID
                })
            }

            else {
                row.NormalRange_High = "";
                row.NormalRange_Low = "";
                row.Units_Id = "";
            };
        };


        /* on click view, view popup opened*/
        $scope.ViewProtocol = function (CatId) {
            $scope.ProtocolClear();
            $scope.CloneProtocolClear();
            $scope.Id = CatId;
            $scope.ProtocolDetails_View();
            angular.element('#ProtocolviewModal').modal('show');
        };

        /* on click Edit, edit popup opened*/
        $scope.EditProtocol = function (CatId, activeFlag) {
            if (activeFlag == 1) {
                $scope.ProtocolClear();
                $scope.CloneProtocolClear();
                $scope.Id = CatId;
                $scope.ProtocolDetails_View();
                $('#btnsave').attr("disabled", false);
                angular.element('#ProtocolCreateModal').modal('show');
                $scope.MonitoringProtocolDropDownList();
            }
            else {
                //alert("Inactive record cannot be edited");
                toastr.info("Inactive record cannot be edited", "info");
            }
        };

        /* 
        Calling api method for the dropdown list in the html page for the field Category
        */
        //$scope.UnitTypeList = [];
        //$scope.ParameterTypeList = [];
        //$http.get(baseUrl + '/api/ParameterSettings/ProtocolParameterMasterList/').success(function (data) {           
        //    $scope.ParameterTypeList = data;
        //});

        //$scope.ProtocolNameList = [];
        //$http.get(baseUrl + '/api/Protocol/ProtocolNameDetails/?InstitutionId=' + $scope.InstituteId).success(function (data) {           
        //    $scope.ProtocolNameList = data;
        //});






        $scope.query = "";
        /* Filter the master list function.*/
        $scope.filterProtocolList = function () {
            var searchstring = angular.lowercase($scope.query);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = [];
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.ProtocolName).match(searchstring)
                });
            }
        }


        $scope.GetParamName = function (Param) {
            var ParamId = Param;
            var Param_Name = "";
            Param_Name = $.grep($scope.getSkill, function (Param) {
                return Param.Id == ParamId;
            })[0].ParameterName;

            return Param_Name;
        }

        $scope.addFields = function () {
            var number = document.getElementById("member").value;
            var container = document.getElementById("container");
            while (container.hasChildNodes()) {
                container.removeChild(container.lastChild);
            }
            for (i = 0; i < number; i++) {
                container.appendChild(document.createTextNode("Timing " + (i + 1)));
                var input = document.createElement("input");
                input.type = "time";
                input.name = "member" + i;
                input.id = "member" + i;
                container.appendChild(input);
                container.appendChild(document.createElement("br"));
            }
            for (i = 0; i < number; i++) {
                var number = document.getElementById("member" + (i + 1)).value;
                console.log(number);
            }
        }

        $scope.ComplianceWeekly = 0;
        $scope.ChangeMethod = function () {
            if ($scope.Compliancealert == 2) {
                $scope.ComplianceWeekly = 1;
            } else if ($scope.Compliancealert == 3) {
                $scope.ComplianceWeekly = 2;
            } else {
                $scope.ComplianceWeekly = 0;
            }
        }

        /* Validating the create page mandatory fields
       checking mandatory for the follwing fields
       InstituionName,InstitutionPrintName,Email,CountryName,StateName,LocationName,Registrationdate
       and showing alert message when it is null.
       */
        $scope.ProtocolMonitoring_Validations = function () {

            if ((typeof ($scope.Protocol_Names) == "undefined" || ($scope.Protocol_Names == 0)) && ($scope.Cloneval == 1)) {
                //alert("Please select Clone Name");
                toastr.warning("Please select Clone Name", "warning");
                return false;
            }
            if (typeof ($scope.ProtocolName) == "undefined" || $scope.ProtocolName == "") {
                //alert("Please enter Protocol Name");
                toastr.warning("Please enter Protocol Name", "warning");
                return false;
            }

            var paramval = 0;
            var unitsval = 0;
            var HighMax = 0;
            var MediumMax = 0;
            var LowMax = 0;
            var HighMax1 = 0;
            var HighMin1 = 0;
            var MediumMax1 = 0;
            var val = 0;
            var valone = 0;
            var valtwo = 0;
            var valthree = 0;
            var valfour = 0;
            var valfive = 0;
            var valsix = 0;
            var splitval = 0;
            var highonesplitval = 0;
            var Normalrange = 0;
            var minPossible = 0;
            var maxPossible = 0;

            var stdone = 0;
            var stdtwo = 0;
            var stdthree = 0;
            var stdfour = 0;
            var stdfive = 0;
            var stdsix = 0;

            angular.forEach($scope.ParameterSettingslist, function (value, index) {
                if (value.Parameter_Id == null || value.Parameter_Id == 0) {
                    paramval = 1;
                }

                minPossible = $ff($scope.ViewParamList, { Parameter_ID: value.Parameter_Id }, true)[0].Min_Possible;
                maxPossible = $ff($scope.ViewParamList, { Parameter_ID: value.Parameter_Id }, true)[0].Max_Possible;

                if (value.Units_Id == null || value.Units_Id == 0) {
                    unitsval = 1;
                }

                if (parseFloat(value.Comp_Duration < value.Comp_Low) && value.Comp_Duration != null) {
                    HighMax = 1;
                }
                if (parseFloat(value.Comp_Duration < value.Comp_Medium) && value.Comp_Duration != null) {
                    MediumMax = 1;
                }
                if (parseFloat(value.Comp_Duration < value.Comp_High) && value.Comp_Duration != null) {
                    LowMax = 1;
                }

                if (parseFloat(value.Comp_Medium > value.Comp_Low) && value.Comp_Duration != null && value.Comp_Low != null) {
                    HighMax1 = 1;
                }
                if (parseFloat(value.Comp_High > value.Comp_Medium) && value.Comp_Duration != null && value.Comp_Medium != null) {
                    HighMin1 = 1;
                }
                if (parseFloat(value.Comp_High > value.Comp_Low) && value.Comp_Duration != null && value.Comp_Medium != null && value.Comp_Low != null) {
                    MediumMax1 = 1;
                }
                if (parseFloat(value.NormalRange_low) > parseFloat(value.NormalRange_High)) {
                    Normalrange = 1;
                }
                if (parseFloat(value.Diag_HighMin_One) > parseFloat(value.Diag_HighMax_One)) {
                    valone = 1;
                }
                if (parseFloat(value.Diag_MediumMin_One) > parseFloat(value.Diag_MediumMax_One)) {
                    valtwo = 1;
                }
                if (parseFloat(value.Diag_LowMin_One) > parseFloat(value.Diag_LowMax_One)) {
                    valthree = 1;
                }
                if (parseFloat(value.Diag_HighMin_Two) > parseFloat(value.Diag_HighMax_Two)) {
                    valfour = 1;
                }
                if (parseFloat(value.Diag_MediumMin_Two) > parseFloat(value.Diag_MediumMax_Two)) {
                    valfive = 1;
                }
                if (parseFloat(value.Diag_LowMin_Two) > parseFloat(value.Diag_LowMax_Two)) {
                    valsix = 1;
                }

                stdone = 0;
                stdtwo = 0;
                stdthree = 0;
                stdfour = 0;
                stdfive = 0;
                stdsix = 0;

                if (parseFloat(minPossible) < parseFloat(value.Diag_HighMin_One) || parseFloat(maxPossible) > parseFloat(value.Diag_HighMax_One)) {
                    stdone = 1;
                }
                if (parseFloat(minPossible) < parseFloat(value.Diag_MediumMin_One) || parseFloat(maxPossible) > parseFloat(value.Diag_MediumMax_One)) {
                    stdtwo = 1;
                }
                if (parseFloat(minPossible) < parseFloat(value.Diag_LowMin_One) || parseFloat(maxPossible) > parseFloat(value.Diag_LowMax_One)) {
                    stdthree = 1;
                }
                if (parseFloat(minPossible) < parseFloat(value.Diag_HighMin_Two) || parseFloat(maxPossible) > parseFloat(value.Diag_HighMax_Two)) {
                    stdfour = 1;
                }
                if (parseFloat(minPossible) < parseFloat(value.Diag_MediumMin_Two) || parseFloat(maxPossible) > parseFloat(value.Diag_MediumMax_Two)) {
                    stdfive = 1;
                }
                if (parseFloat(minPossible) < parseFloat(value.Diag_LowMin_Two) || parseFloat(maxPossible) > parseFloat(value.Diag_LowMax_Two)) {
                    stdsix = 1;
                }
                //if (value.COMP_HIGH !=null|| value.COMP_MEDIUM!=null || value.COMP_LOW!=null)  {
                //    val = 1;
                //}               

                if (((value.Diag_HighMin_One + "").split(".")[1] == "")
                    || ((value.Diag_HighMax_One + "").split(".")[1] == "")
                    || ((value.Diag_MediumMin_One + "").split(".")[1] == "")
                    || ((value.Diag_MediumMax_One + "").split(".")[1] == "")
                    || ((value.Diag_LowMin_One + "").split(".")[1] == "")
                    || ((value.Diag_LowMax_One + "").split(".")[1] == "")
                    || ((value.Diag_HighMin_Two + "").split(".")[1] == "")
                    || ((value.Diag_HighMax_Two + "").split(".")[1] == "")
                    || ((value.Diag_MediumMin_Two + "").split(".")[1] == "")
                    || ((value.Diag_MediumMax_Two + "").split(".")[1] == "")
                    || ((value.Diag_LowMin_Two + "").split(".")[1] == "")
                    || ((value.Diag_LowMax_Two + "").split(".")[1] == "")
                ) {
                    splitval = 1;
                }
            });

            if (($scope.ParameterSettingslist.length) != null) {
                var Empvalue = 0;
                angular.forEach($scope.ParameterSettingslist, function (value, index) {

                    if (value.Parameter_Id == null || value.Parameter_Id == 0) {
                        Empvalue = 1;
                    }
                });

                if (Empvalue == 1) {
                    //alert("Please select any one Parameter");
                    toastr.warning("Please select any one Parameter", "warning");
                    return false
                }
                if (paramval == 1) {
                    //alert("Please select Parameter ");
                    toastr.warning("Please select Parameter ", "info");
                    return false
                }

                if (HighMax == 1) {
                    //alert("Please enter Compliance Low less than Compliance Count ");
                    toastr.warning("Please enter Compliance Low less than Compliance Count ", "warning");
                    return false
                }

                if (MediumMax == 1) {
                    //alert("Please enter Compliance Medium less than Compliance Count ");
                    toastr.warning("Please enter Compliance Medium less than Compliance Count ", "warning");
                    return false
                }

                if (LowMax == 1) {
                    //alert("Please enter Compliance High less than Compliance Count");
                    toastr.warning("Please enter Compliance High less than Compliance Count", "warning");
                    return false
                }

                if (HighMax1 == 1) {
                    //alert("Please enter Compliance Medium less than Compliance Low");
                    toastr.warning("Please enter Compliance Medium less than Compliance Low", "warning");
                    return false
                }

                if (HighMin1 == 1) {
                    //alert("Please enter Compliance High less than Compliance Medium");
                    toastr.warning("Please enter Compliance High less than Compliance Medium", "warning");
                    return false
                }

                if (valone == 1) {
                    //alert("Please enter Diagnostic High Max One greater than Diagnostic High Min One");
                    toastr.warning("Please enter Diagnostic High Max One greater than Diagnostic High Min One", "warning");
                    return false
                }
                if (valtwo == 1) {
                    //alert("Please enter Diagnostic Medium Max One greater than Medium Min One");
                    toastr.warning("Please enter Diagnostic Medium Max One greater than Medium Min One", "warning");
                    return false
                }
                if (valthree == 1) {
                    //alert("Please enter Diagnostic Low Max One greater than Diagnostic Low Min One");
                    toastr.warning("Please enter Diagnostic Low Max One greater than Diagnostic Low Min One", "warning");
                    return false
                }
                if (valfour == 1) {
                    //alert("Please enter Diagnostic High Max Two greater than Diagnostic High Min Two");
                    toastr.warning("Please enter Diagnostic High Max Two greater than Diagnostic High Min Two", "warning");
                    return false
                }
                if (valfive == 1) {
                    //alert("Please enter Diagnostic Medium Max Two greater than Diagnostic Medium Min Two");
                    toastr.warning("Please enter Diagnostic Medium Max Two greater than Diagnostic Medium Min Two", "warning");
                    return false
                }
                if (valsix == 1) {
                    //alert("Please enter Diagnostic Low Max Two greater than Diagnostic Low Min Two");
                    toastr.warning("Please enter Diagnostic Low Max Two greater than Diagnostic Low Min Two", "warning");
                    return false
                }

                /*
                if (stdone == 1) {
                    alert("Please enter Diagnostic High one for the possible range " + minPossible+ "-" +  maxPossible);
                    return false
                }
                if (stdtwo == 1) {
                    alert("Please enter Diagnostic Medium one for the possible range " + minPossible + "-" + maxPossible);
                    return false
                }
                if (stdthree == 1) {
                    alert("Please enter Diagnostic Low one for the possible range " + minPossible + "-" + maxPossible);
                    return false
                }
                if (stdfour == 1) {
                    alert("Please enter Diagnostic High two for the possible range " + minPossible + "-" + maxPossible);
                    return false
                }
                if (stdfive == 1) {
                    alert("Please enter Diagnostic Medium two for the possible range " + minPossible + "-" + maxPossible);
                    return false
                }
                if (stdsix == 1) {
                    alert("Please enter Diagnostic Low two for the possible range " + minPossible + "-" + maxPossible);
                    return false
                }*/

                if (splitval == 1) {
                    //alert("Please enter valid values");
                    toastr.warning("Please enter valid values", "warning");
                    return false
                }
                if (Normalrange == 1) {
                    //alert("Please enter Diagnostic From greater than Diagnostic Low");
                    toastr.warning("Please enter Diagnostic From greater than Diagnostic Low", "warning");
                    return false
                }
                //if (val == 1) {
                //    alert("Please enter Compliance Count");
                //    return false
                //}                

            };


            var TSDuplicate = 0;
            var Duplicateparameter = '';
            angular.forEach($scope.ParameterSettingslist, function (value1, index1) {
                angular.forEach($scope.ParameterSettingslist, function (value2, index2) {
                    if (index1 > index2 && value1.Parameter_Id == value2.Parameter_Id) {
                        TSDuplicate = 1;
                        Duplicateparameter = Duplicateparameter + value2.ParameterName + ',';
                    };
                });
            });


            var MinvalueDuplicate1 = 0;
            var DuplicateMinvalue1 = '';
            var MinvalueDuplicate2 = 0;
            var DuplicateMinvalue2 = '';
            var MinvalueDuplicate3 = 0;
            var DuplicateMinvalue3 = '';
            var MinvalueDuplicate4 = 0;
            var DuplicateMinvalue4 = '';
            var MinvalueDuplicate5 = 0;
            var DuplicateMinvalue5 = '';
            var MinvalueDuplicate6 = 0;
            var DuplicateMinvalue6 = '';


            angular.forEach($scope.ParameterSettingslist, function (value1, index1) {
                angular.forEach($scope.ParameterSettingslist, function (value2, index2) {

                    if (value1.Diag_MediumMin_One != null && value1.Diag_MediumMax_One != null) {
                        //Medium //hight min and max
                        if ((parseFloat(value1.Diag_MediumMin_One) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_MediumMin_One) < parseFloat(value1.Diag_HighMax_One))
                            || (parseFloat(value1.Diag_MediumMax_One) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_MediumMax_One) < parseFloat(value1.Diag_HighMax_One))
                            //low min and max
                            || (parseFloat(value1.Diag_MediumMin_One) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_MediumMin_One) < parseFloat(value1.Diag_LowMax_One))
                            || (parseFloat(value1.Diag_MediumMax_One) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_MediumMax_One) < parseFloat(value1.Diag_LowMax_One))
                            //high1 min and max
                            || (parseFloat(value1.Diag_MediumMin_One) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_MediumMin_One) < parseFloat(value1.Diag_HighMax_Two))
                            || (parseFloat(value1.Diag_MediumMax_One) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_MediumMax_One) < parseFloat(value1.Diag_HighMax_Two))
                            //medium1 min and max
                            || (parseFloat(value1.Diag_MediumMin_One) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_MediumMin_One) < (value1.Diag_MediumMax_Two))
                            || (parseFloat(value1.Diag_MediumMax_One) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_MediumMax_One) < parseFloat(value1.Diag_MediumMax_Two))
                            //low1 min and max
                            || (parseFloat(value1.Diag_MediumMin_One) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_MediumMin_One) < parseFloat(value1.Diag_LowMax_Two))
                            || (parseFloat(value1.Diag_MediumMax_One) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_MediumMax_One) < parseFloat(value1.Diag_LowMax_Two))

                        ) {
                            MinvalueDuplicate1 = 1;
                            DuplicateMinvalue1 = "Diagnostic already exist for Parameter " + value1.ParameterName + " ( Min Value " + value1.Diag_MediumMin_One + " to " + "Max Value " + value1.Diag_MediumMax_One + " )";
                        }
                    }

                    if (value1.Diag_HighMin_One != null && value1.Diag_HighMax_One != null) {
                        //High // Medium min and max
                        if ((parseFloat(value1.Diag_HighMin_One) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_HighMin_One) < parseFloat(value1.Diag_MediumMax_One))
                            || (parseFloat(value1.Diag_HighMax_One) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_HighMax_One) < parseFloat(value1.Diag_MediumMax_One))
                            //low min and max
                            || (parseFloat(value1.Diag_HighMin_One) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_HighMin_One) < parseFloat(value1.Diag_LowMax_One))
                            || (parseFloat(value1.Diag_HighMax_One) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_HighMax_One) < parseFloat(value1.Diag_LowMax_One))
                            //high1 min and max
                            || (parseFloat(value1.Diag_HighMin_One) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_HighMin_One) < parseFloat(value1.Diag_HighMax_Two))
                            || (parseFloat(value1.Diag_HighMax_One) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_HighMax_One) < parseFloat(value1.Diag_HighMax_Two))
                            //medium1 min and max
                            || (parseFloat(value1.Diag_HighMin_One) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_HighMin_One) < parseFloat(value1.Diag_MediumMax_Two))
                            || (parseFloat(value1.Diag_HighMax_One) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_HighMax_One) < parseFloat(value1.Diag_MediumMax_Two))
                            //low1 min and max
                            || (parseFloat(value1.Diag_HighMin_One) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_HighMin_One) < parseFloat(value1.Diag_LowMax_Two))
                            || (parseFloat(value1.Diag_HighMax_One) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_HighMax_One) < parseFloat(value1.Diag_LowMax_Two))

                        ) {
                            MinvalueDuplicate2 = 1;
                            DuplicateMinvalue2 = "Diagnostic already exist for Parameter " + value1.ParameterName + "  ( Min Value" + value1.Diag_HighMin_One + " to " + "Max Value " + value1.Diag_HighMax_One + " )";
                        }
                    }

                    if (value1.Diag_LowMin_One != null && value1.Diag_LowMax_One != null) {
                        //Low // high min and max
                        if ((parseFloat(value1.Diag_LowMin_One) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_LowMin_One) < parseFloat(value1.Diag_MediumMax_One))
                            || (parseFloat(value1.Diag_LowMax_One) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_LowMax_One) < parseFloat(value1.Diag_MediumMax_One))
                            //low min and max
                            || (parseFloat(value1.Diag_LowMin_One) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_LowMin_One) < parseFloat(value1.Diag_HighMax_One))
                            || (parseFloat(value1.Diag_LowMax_One) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_LowMax_One) < parseFloat(value1.Diag_HighMax_One))
                            //high1 min and max
                            || (parseFloat(value1.Diag_LowMin_One) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_LowMin_One) < parseFloat(value1.Diag_HighMax_Two))
                            || (parseFloat(value1.Diag_LowMax_One) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_LowMax_One) < parseFloat(value1.Diag_HighMax_Two))
                            //medium1 min and max
                            || (parseFloat(value1.Diag_LowMin_One) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_LowMin_One) < parseFloat(value1.Diag_MediumMax_Two))
                            || (parseFloat(value1.Diag_LowMax_One) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_LowMax_One) < parseFloat(value1.Diag_MediumMax_Two))
                            //low1 min and max
                            || (parseFloat(value1.Diag_LowMin_One) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_LowMin_One) < parseFloat(value1.Diag_LowMax_Two))
                            || (parseFloat(value1.Diag_LowMax_One) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_LowMax_One) < parseFloat(value1.Diag_LowMax_Two))

                        ) {
                            MinvalueDuplicate3 = 1;
                            DuplicateMinvalue3 = "Diagnostic already exist for Parameter " + value1.ParameterName + "  ( Min Value " + value1.Diag_LowMin_One + " to " + "Max Value " + value1.Diag_LowMax_One + " )";
                        }
                    }

                    if (value1.Diag_HighMin_Two != null && value1.Diag_HighMax_Two != null) {
                        //High1 // high min and max
                        if ((parseFloat(value1.Diag_HighMin_Two) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_HighMin_Two) < parseFloat(value1.Diag_MediumMax_One))
                            || (parseFloat(value1.Diag_HighMax_Two) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_HighMax_Two) < parseFloat(value1.Diag_MediumMax_One))
                            //low min and max
                            || (parseFloat(value1.Diag_HighMin_Two) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_HighMin_Two) < parseFloat(value1.Diag_HighMax_One))
                            || (parseFloat(value1.Diag_HighMax_Two) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_HighMax_Two) < parseFloat(value1.Diag_HighMax_One))
                            //high1 min and max
                            || (parseFloat(value1.Diag_HighMin_Two) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_HighMin_Two) < parseFloat(value1.Diag_LowMax_One))
                            || (parseFloat(value1.Diag_HighMax_Two) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_HighMax_Two) < parseFloat(value1.Diag_LowMax_One))
                            //medium1 min and max
                            || (parseFloat(value1.Diag_HighMin_Two) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_HighMin_Two) < parseFloat(value1.Diag_MediumMax_Two))
                            || (parseFloat(value1.Diag_HighMax_Two) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_HighMax_Two) < parseFloat(value1.Diag_MediumMax_Two))
                            //low1 min and max
                            || (parseFloat(value1.Diag_HighMin_Two) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_HighMin_Two) < parseFloat(value1.Diag_LowMax_Two))
                            || (parseFloat(value1.Diag_HighMax_Two) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_HighMax_Two) < parseFloat(value1.Diag_LowMax_Two))

                        ) {
                            MinvalueDuplicate4 = 1;
                            DuplicateMinvalue4 = "Diagnostic already exist for Parameter " + value1.ParameterName + "  ( Min Value " + value1.Diag_HighMin_Two + " to " + "Max Value " + value1.Diag_HighMax_Two + " )";
                        }
                    }

                    if (value1.Diag_MediumMin_Two != null && value1.Diag_MediumMax_Two != null) {
                        //Medium1 // high min and max
                        if ((parseFloat(value1.Diag_MediumMin_Two) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_MediumMin_Two) < parseFloat(value1.Diag_MediumMax_One))
                            || (parseFloat(value1.Diag_MediumMax_Two) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_MediumMax_Two) < parseFloat(value1.Diag_MediumMax_One))
                            //low min and max
                            || (parseFloat(value1.Diag_MediumMin_Two) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_MediumMin_Two) < parseFloat(value1.Diag_HighMax_One))
                            || (parseFloat(value1.Diag_MediumMax_Two) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_MediumMax_Two) < parseFloat(value1.Diag_HighMax_One))
                            //high1 min and max
                            || (parseFloat(value1.Diag_MediumMin_Two) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_MediumMin_Two) < parseFloat(value1.Diag_LowMax_One))
                            || (parseFloat(value1.Diag_MediumMax_Two) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_MediumMax_Two) < parseFloat(value1.Diag_LowMax_One))
                            //medium1 min and max
                            || (parseFloat(value1.Diag_MediumMin_Two) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_MediumMin_Two) < parseFloat(value1.Diag_HighMax_Two))
                            || (parseFloat(value1.Diag_MediumMax_Two) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_MediumMax_Two) < parseFloat(value1.Diag_HighMax_Two))
                            //low1 min and max
                            || (parseFloat(value1.Diag_MediumMin_Two) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_MediumMin_Two) < parseFloat(value1.Diag_LowMax_Two))
                            || (parseFloat(value1.Diag_MediumMax_Two) > parseFloat(value1.Diag_LowMin_Two) && parseFloat(value1.Diag_MediumMax_Two) < parseFloat(value1.Diag_LowMax_Two))

                        ) {
                            MinvalueDuplicate5 = 1;
                            DuplicateMinvalue5 = "Diagnostic already exist for Parameter " + value1.ParameterName + "  ( Min Value " + value1.Diag_MediumMin_Two + " to " + "Max Value " + value1.Diag_MediumMax_Two + " )";
                        }
                    }

                    if (value1.Diag_LowMin_Two != null && value1.Diag_LowMax_Two != null) {
                        //low1 // high min and max
                        if ((parseFloat(value1.Diag_LowMin_Two) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_LowMin_Two) < parseFloat(value1.Diag_MediumMax_One))
                            || (parseFloat(value1.Diag_LowMax_Two) > parseFloat(value1.Diag_MediumMin_One) && parseFloat(value1.Diag_LowMax_Two) < parseFloat(value1.Diag_MediumMax_One))
                            //low min and max
                            || (parseFloat(value1.Diag_LowMin_Two) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_LowMin_Two) < parseFloat(value1.Diag_HighMax_One))
                            || (parseFloat(value1.Diag_LowMax_Two) > parseFloat(value1.Diag_HighMin_One) && parseFloat(value1.Diag_LowMax_Two) < parseFloat(value1.Diag_HighMax_One))
                            //high1 min and max
                            || (parseFloat(value1.Diag_LowMin_Two) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_LowMin_Two) < parseFloat(value1.Diag_LowMax_One))
                            || (parseFloat(value1.Diag_LowMax_Two) > parseFloat(value1.Diag_LowMin_One) && parseFloat(value1.Diag_LowMax_Two) < parseFloat(value1.Diag_LowMax_One))
                            //medium1 min and max
                            || (parseFloat(value1.Diag_LowMin_Two) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_LowMin_Two) < parseFloat(value1.Diag_HighMax_Two))
                            || (parseFloat(value1.Diag_LowMax_Two) > parseFloat(value1.Diag_HighMin_Two) && parseFloat(value1.Diag_LowMax_Two) < parseFloat(value1.Diag_HighMax_Two))
                            //low1 min and max
                            || (parseFloat(value1.Diag_LowMin_Two) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_LowMin_Two) < parseFloat(value1.Diag_MediumMax_Two))
                            || (parseFloat(value1.Diag_LowMax_Two) > parseFloat(value1.Diag_MediumMin_Two) && parseFloat(value1.Diag_LowMax_Two) < parseFloat(value1.Diag_MediumMax_Two))
                        ) {
                            MinvalueDuplicate6 = 1;
                            DuplicateMinvalue6 = "Diagnostic already exist for Parameter " + value1.ParameterName + "  ( Min Value " + value1.Diag_LowMin_Two + " to " + "Max Value " + value1.Diag_LowMax_Two + " )";
                        }
                    }

                })
            });


            if (TSDuplicate == 1) {
                alert('Parameters ' + Duplicateparameter + ' already exist, cannot be Duplicated');
                return false;
            }
            if (MinvalueDuplicate1 == 1) {
                alert(DuplicateMinvalue1);
                return false;
            }
            if (MinvalueDuplicate2 == 1) {
                alert(DuplicateMinvalue2);
                return false;
            }
            if (MinvalueDuplicate3 == 1) {
                alert(DuplicateMinvalue3);
                return false;
            }
            if (MinvalueDuplicate4 == 1) {
                alert(DuplicateMinvalue4);
                return false;
            }
            if (MinvalueDuplicate5 == 1) {
                alert(DuplicateMinvalue5);
                return false;
            }
            if (MinvalueDuplicate6 == 1) {
                alert(DuplicateMinvalue6);
                return false;
            }
            return true;
        }


        $scope.ParameterSettingslist = [];
        /*ARRAY LIST FOR THE CHILD TABLE CUSTOMER DETAILS */
        $scope.ParameterSettingslist = [{
            'Id': 0,
            'Protocol_Id': 0,
            'ProtocolName': '',
            'Institution_Id': 0,
            'Institution_Name': '',
            'Parameter_Id': 0,
            'ParameterName': '',
            'Units_Id': '',
            'UnitsName': '',
            'Com_DurationType': 0,
            'DurationName': '',
            'Diag_HighMax_One': '',
            'Diag_HighMin_One': '',
            'Diag_MediumMax_One': '',
            'Diag_MediumMin_One': '',
            'Diag_LowMax_One': '',
            'Diag_LowMin_One': '',
            'Diag_HighMax_Two': '',
            'Diag_HighMin_Two': '',
            'Diag_MediumMax_Two': '',
            'Diag_MediumMin_Two': '',
            'Diag_LowMax_Two': '',
            'Diag_LowMin_Two': '',
            'Comp_Duration': '',
            'Comp_High': '',
            'Comp_Medium': '',
            'Comp_Low': '',
            'Isactive': 1,
            'Created_By': '',
            'NormalRange_High': '',
            'NormalRange_Low': ''
        }];

        /*Add New Row */
        $scope.MonitoringParameterSettings_Insert = function () {
            if ($scope.ParameterSettingslist.length > 0) {
                var obj =
                {
                    'Id': 0,
                    'Protocol_Id': 0,
                    'ProtocolName': '',
                    'Institution_Id': 0,
                    'Institution_Name': '',
                    'Parameter_Id': 0,
                    'ParameterName': '',
                    'Units_Id': '',
                    'UnitsName': '',
                    'Com_DurationType': 0,
                    'DurationName': '',
                    'Diag_HighMax_One': '',
                    'Diag_HighMin_One': '',
                    'Diag_MediumMax_One': '',
                    'Diag_MediumMin_One': '',
                    'Diag_LowMax_One': '',
                    'Diag_LowMin_One': '',
                    'Diag_HighMax_Two': '',
                    'Diag_HighMin_Two': '',
                    'Diag_MediumMax_Two': '',
                    'Diag_MediumMin_Two': '',
                    'Diag_LowMax_Two': '',
                    'Diag_LowMin_Two': '',
                    'Comp_Duration': '',
                    'Comp_High': '',
                    'Comp_Medium': '',
                    'Comp_Low': '',
                    'Isactive': 1,
                    'Created_By': '',
                    'NormalRange_High': '',
                    'NormalRange_Low': ''
                }
                $scope.ParameterSettingslist.push(obj);
            }
            else {
                $scope.ParameterSettingslist = [{
                    'Id': 0,
                    'Protocol_Id': 0,
                    'ProtocolName': '',
                    'Institution_Id': 0,
                    'Institution_Name': '',
                    'Parameter_Id': 0,
                    'ParameterName': '',
                    'Units_Id': '',
                    'UnitsName': '',
                    'Com_DurationType': 0,
                    'DurationName': '',
                    'Diag_HighMax_One': '',
                    'Diag_HighMin_One': '',
                    'Diag_MediumMax_One': '',
                    'Diag_MediumMin_One': '',
                    'Diag_LowMax_One': '',
                    'Diag_LowMin_One': '',
                    'Diag_HighMax_Two': '',
                    'Diag_HighMin_Two': '',
                    'Diag_MediumMax_Two': '',
                    'Diag_MediumMin_Two': '',
                    'Diag_LowMax_Two': '',
                    'Diag_LowMin_Two': '',
                    'Comp_Duration': '',
                    'Comp_High': '',
                    'Comp_Medium': '',
                    'Comp_Low': '',
                    'Isactive': 1,
                    'Created_By': '',
                    'NormalRange_High': '',
                    'NormalRange_Low': ''
                }];
            };
        };

        /*on click Save calling the insert update function for Monitoring Protocol
         and check the Monitoring Protocol Name already exist,if exist it display alert message or its 
         calling the insert update function*/
        $scope.Id = 0;
        $scope.ChildId = 0;
        $scope.InstituteId = 0;
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.User_Id = $window.localStorage['UserId'];
        $scope.ParameterSettingslist = [];
        $scope.MonitoringDetails = [];
        $scope.ProtocolParameter_AddEdit = function () {
            $scope.MonitoringDetails = [];

            if ($scope.ProtocolMonitoring_Validations() == true) {
                $("#chatLoaderPV").show();
                if ($scope.ParameterSettingslistDelete.length > 0) {
                    angular.forEach($scope.ParameterSettingslistDelete, function (Selected1, index1) {
                        $scope.ProtocolDetails_Delete(Selected1.Id);
                    });
                }

                angular.forEach($scope.ParameterSettingslist, function (Selected, index) {

                    var obj = {
                        Id: Selected.Id,
                        // PROTOCOL_ID: Selected.PARAMETER_ID,
                        Institution_Id: $scope.InstituteId == 0 ? null : $scope.InstituteId,
                        Parameter_Id: Selected.Parameter_Id == 0 ? null : Selected.Parameter_Id,
                        Units_Id: Selected.Units_Id == 0 ? null : Selected.Units_Id,
                        Diag_HighMax_One: Selected.Diag_HighMax_One,
                        Diag_HighMin_One: Selected.Diag_HighMin_One,
                        Diag_MediumMax_One: Selected.Diag_MediumMax_One,
                        Diag_MediumMin_One: Selected.Diag_MediumMin_One,
                        Diag_LowMax_One: Selected.Diag_LowMax_One,
                        Diag_LowMin_One: Selected.Diag_LowMin_One,
                        Diag_HighMax_Two: Selected.Diag_HighMax_Two,
                        Diag_HighMin_Two: Selected.Diag_HighMin_Two,
                        Diag_MediumMax_Two: Selected.Diag_MediumMax_Two,
                        Diag_MediumMin_Two: Selected.Diag_MediumMin_Two,
                        Diag_LowMax_Two: Selected.Diag_LowMax_Two,
                        Diag_LowMin_Two: Selected.Diag_LowMin_Two,
                        Com_DurationType: Selected.Com_DurationType == 0 ? null : Selected.Com_DurationType,
                        Comp_Duration: Selected.Comp_Duration,
                        Comp_High: Selected.Comp_High,
                        Comp_Medium: Selected.Comp_Medium,
                        Comp_Low: Selected.Comp_Low,
                        //ISACTIVE: Selected.IsActive,
                        Created_By: $scope.User_Id,
                        NormalRange_High: Selected.NormalRange_High,
                        NormalRange_Low: Selected.NormalRange_Low,
                    }
                    $('#btnsave').attr("disabled", true);
                    $scope.MonitoringDetails.push(obj);
                });

                var obj1 = {
                    Id: $scope.Id,
                    Institution_Id: $scope.InstituteId == 0 ? null : $scope.InstituteId,
                    Protocol_Name: $scope.ProtocolName,
                    Created_By: $scope.User_Id,
                    ChildModuleList: $scope.MonitoringDetails
                };

                $http.post(baseUrl + '/api/Protocol/ProtocolMonitoring_AddEdit/', obj1).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //$http.post(baseUrl + '/api/StandaredProtocol/ProtocolMonitoring_AddEdit/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 0) {
                        toastr.warning(data.Message, "warning");
                    }
                    else if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    $('#btnsave').attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.CancelProtocol();

                        $scope.MonitoringProtocolDetailsListGo();

                        $scope.ProtocolClear();
                        $scope.CloneProtocolFunction();
                    }
                });
            }
        }

        $scope.CloneProtocolClear = function () {
            $scope.Cloneval = 0;
        };


        /* Protocol clear fucntion */
        $scope.ProtocolClear = function () {
            $scope.Id = 0;
            $scope.Protocol_Id = "0";
            $scope.ProtocolName = "";
            $scope.Protocol_Names = "0";
            //  $scope.Cloneval =0;
            $scope.ParameterSettingslist = [];
            $scope.ParameterSettingslist = [{
                // 'Id': 0,
                'Protocol_Id': 0,
                'ProtocolName': '',
                'Institution_Id': 0,
                'Institution_Name': '',
                'Parameter_Id': 0,
                'ParameterName': '',
                'Units_Id': '',
                'UnitsName': '',
                'Com_DurationType': 0,
                'DurationName': '',
                'Diag_HighMax_One': '',
                'Diag_HighMin_One': '',
                'Diag_MediumMax_One': '',
                'Diag_MediumMin_One': '',
                'Diag_LowMax_One': '',
                'Diag_LowMin_One': '',
                'Diag_HighMax_Two': '',
                'Diag_HighMin_Two': '',
                'Diag_MediumMax_Two': '',
                'Diag_MediumMin_Two': '',
                'Diag_LowMax_Two': '',
                'Diag_LowMin_Two': '',
                'Comp_Duration': '',
                'Comp_High': '',
                'Comp_Medium': '',
                'Comp_Low': '',
                'Isactive': 1,
                'Created_By': '',
                'NormalRange_High': '',
                'NormalRange_Low': ''
            }];
        };

        $scope.DuplicatesId = 0;
        /*THIS IS FOR View FUNCTION*/
        $scope.ProtocolDetails_View = function () {

            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $("#chatLoaderPV").show();
            $http.get(baseUrl + 'api/Protocol/ProtocolMonitoring_View/?Id=' + $scope.Id).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.DuplicatesId = data.Id;
                $scope.Institution_Name = data.Institution_Id;
                $scope.ViewInstitution_Name = data.Institution_Name;
                $scope.ProtocolName = data.Protocol_Name;
                $scope.ParameterSettingslist = data.ChildModuleList;

                angular.forEach($scope.ParameterSettingslist, function (value, index) {
                    if (value.NormalRange_High == null || value.NormalRange_Low == null) {
                        $scope.ParameterSettings_ViewEdit();
                    }
                })
            });
        }

        /* THIS IS FUNCTION FOR CLOSE Page  */
        $scope.CancelProtocol = function () {
            angular.element('#ProtocolCreateModal').modal('hide');
        };
        $scope.CancelCloneProtocol = function () {
            angular.element('#CloneProtocolCreateModal').modal('hide');
        };
        $scope.CancelViewProtocol = function () {
            angular.element('#ProtocolviewModal').modal('hide');
        }

        /* 
        Calling the api method to detele the details of the Protocol Monitoring 
        for the Protocol Monitoring Id,
        and redirected to the list page.
        */
        $scope.DeleteInstitution = function (comId) {
            $scope.Id = comId;
            $scope.Institution_Delete();
        };

        $scope.Institution_Delete = function () {
            var del = confirm("Do you like to deactivate the selected Institution?");
            if (del == true) {
                $http.get(baseUrl + 'api/Institution/InstitutionDetails_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Institution has been deactivated Successfully");
                    toastr.success("Selected Institution has been deactivated Successfully", "success");
                    $scope.InstitutionDetailsListGo();
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting Institution!" + data;
                });
            };
        };

        /*'Active' the Protocol Monitoring*/
        $scope.ReInsertProtocol = function (comId) {
            $scope.Id = comId;
            $scope.ReInsertProtocolDetails();
        };

        /* 
        Calling the api method to inactived the details of the Protocol Monitoring
        and redirected to the list page.
        */
        $scope.ReInsertProtocolDetails = function () {
            var Ins = confirm("Do you like to activate the selected Monitoring Protocol?");
            if (Ins == true) {
                $http.get(baseUrl + 'api/Protocol/ProtocolMonitoring_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Monitoring Protocol has been activated successfully");
                    toastr.success("Selected Monitoring Protocol has been activated successfully", "success");
                    $scope.MonitoringProtocolDetailsListGo();
                }).error(function (data) {
                    $scope.error = "An error has occurred while ReInsert Monitoring Protocol Details" + data;
                });
            };
        }

        /* Calling the api method to detele the details of the Protocol Monitoring 
        for the Protocol Monitoring Id,
        and redirected to the list page.
        */
        $scope.InActiveProtocol = function (comId) {
            $scope.Id = comId;
            $scope.Protocol_InActive();
        };
        $scope.Protocol_InActive = function () {
            var del = confirm("Do you like to deactivate the selected Monitoring Protocol?");
            if (del == true) {
                $http.get(baseUrl + 'api/Protocol/ProtocolMonitoring_InActive/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Monitoring Protocol has been deactivated Successfully");
                    toastr.success("Selected Monitoring Protocol has been deactivated Successfully", "success");
                    $scope.MonitoringProtocolDetailsListGo();
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting Monitoring Protocol!" + data;
                });
            };
        };

        /*'Active' the Protocol Monitoring*/
        $scope.ReInsertInstitution = function (comId) {
            $scope.Id = comId;
            $scope.ReInsertInstitutionDetails();

        };

        /* 
        Calling the api method to inactived the details of the Protocol 
        for the  Protocol Id,
        and redirected to the list page.
        */
        $scope.ReInsertInstitutionDetails = function () {
            var Ins = confirm("Do you like to activate the selected Institution?");
            if (Ins == true) {
                $http.get(baseUrl + 'api/Protocol/ProtocolMonitoring_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Institution has been activated successfully");
                    toastr.success("Selected Institution has been activated successfully", "success");
                    $scope.InstitutionDetailsListGo();
                }).error(function (data) {
                    $scope.error = "An error has occurred while ReInsertInstitutionDetails" + data;
                });
            };
        }

        /*Calling api method for delete selected Skill details for the Protocol name*/
        $scope.ProtocolDetails_Delete = function (ParamId) {

            $http.get(baseUrl + '/api/Protocol/ProtocolMonitoring_Delete/?Id=' + ParamId).success(function (Vitaldata) {
            }).error(function (Vitaldata) {
                $scope.error = "AN error has occured while deleting records" + Vitaldata;
            });
        };
        $scope.ParameterSettingslistDelete = [];
        $scope.MonitoringProtocolDelete = function (itemIndex, ParamId) {
            var del = confirm("Do you like to delete the selected Parameter?");
            if (del == true) {
                if ($scope.Id <= 0) {
                    $scope.ParameterSettingslist.splice(itemIndex, 1);
                    if ($scope.ParameterSettingslist.length == 0) {
                        $scope.ParameterSettingslist = [{
                            'Id': 0,
                            'Protocol_Id': 0,
                            'ProtocolName': '',
                            'Institution_Id': 0,
                            'Institution_Name': '',
                            'Parameter_Id': 0,
                            'ParameterName': '',
                            'Units_Id': 0,
                            'UnitsName': '',
                            'Com_DurationType': 0,
                            'DurationName': '',
                            'Diag_HighMax_One': '',
                            'Diag_HighMin_One': '',
                            'Diag_MediumMax_One': '',
                            'Diag_MediumMin_One': '',
                            'Diag_LowMax_One': '',
                            'Diag_LowMin_One': '',
                            'Diag_HighMax_Two': '',
                            'Diag_HighMin_Two': '',
                            'Diag_MediumMax_Two': '',
                            'Diag_MediumMin_Two': '',
                            'Diag_LowMax_Two': '',
                            'Diag_LowMin_Two': '',
                            'Comp_Duration': '',
                            'Comp_High': '',
                            'Comp_Medium': '',
                            'Comp_Low': '',
                            'Isactive': 1,
                            'Created_By': '',
                            'NormalRange_High': '',
                            'NormalRange_Low': ''
                        }];
                    }
                }
                else {

                    $scope.ParameterSettingslistDelete.push(ParamId);

                    $scope.ParameterSettingslist.splice(itemIndex, 1);

                    if ($scope.ParameterSettingslist.length == 0) {
                        $scope.ParameterSettingslist = [{
                            'Id': 0,
                            'Protocol_Id': 0,
                            'ProtocolName': '',
                            'Institution_Id': 0,
                            'Institution_Name': '',
                            'Parameter_Id': 0,
                            'ParameterName': '',
                            'Units_Id': 0,
                            'UnitsName': '',
                            'Com_DurationType': 0,
                            'DurationName': '',
                            'Diag_HighMax_One': '',
                            'Diag_HighMin_One': '',
                            'Diag_MediumMax_One': '',
                            'Diag_MediumMin_One': '',
                            'Diag_LowMax_One': '',
                            'Diag_LowMin_One': '',
                            'Diag_HighMax_Two': '',
                            'Diag_HighMin_Two': '',
                            'Diag_MediumMax_Two': '',
                            'Diag_MediumMin_Two': '',
                            'Diag_LowMax_Two': '',
                            'Diag_LowMin_Two': '',
                            'Comp_Duration': '',
                            'Comp_High': '',
                            'Comp_Medium': '',
                            'Comp_Low': '',
                            'Isactive': 1,
                            'Created_By': '',
                            'NormalRange_High': '',
                            'NormalRange_Low': ''
                        }];

                    }
                }
            }
        };

        /*on clicking Remove in Protocol Filed its calling the Protocol delete funtion */
        $scope.RemoveQualification_Item = function (rowItem) {
            var del = confirm("Do you like to delete this Protocol?");
            if (del == true) {
                var Protocol_Item = [];

                if ($scope.Id <= 0) {
                    angular.forEach($scope.ParameterSettingslist, function (selectedQual, index) {
                        if (index != rowItem) {
                            Protocol_Item.push(selectedQual);
                        }
                    });
                    $scope.ParameterSettingslist = Protocol_Item;
                }
                else if ($scope.Id > 0) {
                    angular.forEach($scope.ParameterSettingslist, function (selectedQual, index) {
                        if (index == rowItem) {
                            $scope.QuaId = selectedQual.Id;
                            $scope.ProtocolDetails_Delete();
                            $scope.AddQualification = [];;
                        }
                        else {
                            Protocol_Item.push(selectedQual);
                        }
                        $scope.AddQualification = Protocol_Item;
                    });

                }
            }
        };
    }
]);


/* THIS IS FOR LOGIN CONTROLLER FUNCTION */
MyCortexControllers.controller("DoctorProfileController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter) {
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']

        $scope.AddDoctorProfileCreatePopup = function () {

            angular.element('#DoctorProfilePopupCreateModal').modal('show');
        }
        $scope.CancelIntstitutionSubPopup = function () {

            angular.element('#InstitutionsubCreateModal').modal('hide');
        }
        $scope.ViewIntstitutionSubPopup = function () {

            angular.element('#ViewsubModal').modal('show');
        }
        $scope.CancelCreateDoctorProfilePopup = function () {

            angular.element('#DoctorProfilePopupCreateModal').modal('hide');
        }
    }
]);

MyCortexControllers.controller("CoordinatorController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter) {

        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.Mode = $routeParams.Id;


        $scope.CGAddPatientPopup = function () {
            $location.path("/Carecoordinatorpatient/1");
        }

        $scope.AddPatientPopup = function () {
            $location.path("/Carecoordinatorpatient/2");
        }

        $scope.AddPatientHomePopup = function () {
            $location.path("/Carecoordinatorpatient/4");
        }


        $scope.searchDoctor = function () {

            angular.element('#searchDoctor').modal('show');
        }
        $scope.openProtocol = function () {

            angular.element('#MonitoringProtocolCreateModal').modal('show');
        }


        $scope.PatientAppointmentpopup = function () {
            angular.element('#PatientAppointmentCreateModal').modal('show');
        }
        $scope.CancelPatientAppointment = function () {
            angular.element('#PatientAppointmentCreateModal').modal('show');
        }
    }
]);

MyCortexControllers.controller("AllPatientListController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.SearchMsg = "No Data Available";
        $scope.searchquery = "";
        $scope.SearchEncryptedQuery = "";
        $scope.PatientFilter = [];
        $scope.PatientList = [];
        $scope.Filter_PatientNo = "";
        $scope.filter_InsuranceId = "";
        $scope.filter_MOBILE_NO = "";
        $scope.filter_HomePhoneNo = "";
        $scope.filter_Email = "";
        $scope.Filter_GenderId = "0";
        $scope.filter_NationalityId = "0";
        $scope.filter_EthinicGroupId = "0";
        $scope.filter_MaritalStatus = "0";
        $scope.filter_CountryId = "0";
        $scope.filter_StataId = "0";
        $scope.filter_CityId = "0";
        $scope.filter_BloodGroupId = "0";
        $scope.filter_GroupId = "0";
        $scope.flag = 0;
        $scope.CommaSeparated_Group = $scope.filter_GroupId.toString();
        $scope.Doctor_Id = $window.localStorage['UserId'];
        $scope.ActiveStatus = "1";
        $scope.EthnicGroupList = [];
        $scope.BloodGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.GroupTypeList = [];
        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.PageCountArray = [];
        $scope.Patient_PerPage = 0;
        $scope.PatientCount = 0;
        $scope.InstitutionId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.PageNumber = 1;
        $scope.loadCount = 0;
        $scope.TabClick = false;

        $scope.ResetPatientFilter = function () {
            $scope.Filter_PatientNo = "";
            $scope.filter_InsuranceId = "";
            $scope.Filter_GenderId = "0";
            $scope.filter_NationalityId = "0";
            $scope.filter_EthinicGroupId = "0";
            $scope.filter_MOBILE_NO = "";
            $scope.filter_HomePhoneNo = "";
            $scope.filter_Email = "";
            $scope.filter_MaritalStatus = "0";
            $scope.filter_CountryId = "0";
            $scope.filter_StataId = "0";
            $scope.filter_CityId = "0";
            $scope.filter_BloodGroupId = "0";
            $scope.filter_GroupId = "0";
            //$scope.PatientListFunction(1);
            $scope.Next_PatientListFunction(1);
        }

        $scope.AllPatientsDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstitutionId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $scope.CountryStateList();
            }
        }

        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];

        $scope.CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;

            });
        }
        $scope.Filter_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        }
        $scope.Filter_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }
        $scope.PatientFilterCopy = [];
        $scope.PatientFilterCopyList = [];


        $scope.PatientListFunction = function (PageNumber) {
            if ($window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 5 || $window.localStorage['UserTypeId'] == 6 || $window.localStorage['UserTypeId'] == 7) {
                $("#chatLoaderPV").show();
                $scope.PageNumber = PageNumber;
                $scope.PageCountArray = [];
                //Get the Count of All Patient List
                //  $http.get(baseUrl + '/api/AllPatientList/GetPatientList_Count/?Doctor_Id=' + $scope.Doctor_Id + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId + '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' + $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus + '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId + '&Group_Id=' + $scope.filter_GroupId + '&UserTypeId=' + $scope.UserTypeId 
                //).success(function (data) {
                //    $scope.PatientCount = data[0].PatientCount;
                //Get the Patient Per Page Count
                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $scope.UserTypeId = $window.localStorage['UserTypeId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.Patient_PerPage = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.PageNumber - 1) * ($scope.Patient_PerPage)) + 1;
                    $scope.PageEnd = $scope.PageNumber * $scope.Patient_PerPage;
                    $scope.Input_Type = 1;
                    $scope.SearchEncryptedQuery = $scope.searchquery;
                    var obj = {
                        InputType: $scope.Input_Type,
                        DecryptInput: $scope.SearchEncryptedQuery
                    };
                    $http.post(baseUrl + '/api/Common/EncryptDecrypt', obj).success(function (data) {
                        $scope.SearchEncryptedQuery = data;

                        //Get the Patient List
                        $http.get(baseUrl + '/api/AllPatientList/PatientList/?Doctor_Id=' + $scope.Doctor_Id + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId + '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' + $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus + '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId + '&Group_Id=' + $scope.filter_GroupId + '&UserTypeId=' + $scope.UserTypeId + '&StartRowNumber=' + $scope.PageStart + '&EndRowNumber=' + $scope.PageEnd + '&SearchQuery=' + $scope.searchquery + '&SearchEncryptedQuery=' + $scope.SearchEncryptedQuery
                        ).success(function (Patientdata) {
                            $("#chatLoaderPV").hide();
                            $scope.SearchMsg = "No Data Available";
                            $scope.PageCountArray = [];
                            $scope.Patientemptydata = [];
                            $scope.PatientList = [];
                            $scope.PatientList = Patientdata;
                            $scope.Patientemptydata = Patientdata;
                            //$scope.PatientCount = $scope.PatientList.length;
                            $scope.PatientCount = $scope.PatientList[0].TotalRecord;
                            if ($scope.searchquery == '') {
                                total = Math.ceil(($scope.PatientCount) / ($scope.Patient_PerPage));
                                for (var i = 0; i < total; i++) {
                                    var obj = {
                                        PageNumber: i + 1
                                    }
                                    $scope.PageCountArray.push(obj);
                                }
                            }
                            $scope.PatientFilter = angular.copy($scope.PatientList);
                            $scope.PatientFilterCopyList = angular.copy($scope.PatientList);

                        });
                    });
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        }
        $scope.filterPatientList = function () {
            $("#chatLoaderPV").show();
            $scope.Patientemptydata = [];
            $scope.PatientListFunction(1);
        }
        $scope.Next_PatientListFunction = function (PageNumber) {
            $scope.PageNumber = PageNumber;
            $("#chatLoaderPV").show();
            $scope.Patientemptydata = [];
            $scope.PatientListFunction(PageNumber);
        }
        $scope.AllPatient_PatientData = function (eventId) {
            //All Patients
            $scope.Id = eventId;
            $window.location.href = baseUrl + "/Home/Index#/PatientVitals/" + $scope.Id + "/4";
        }
    }
]);

/* THIS IS FOR CHAT SETTINGS CONTROLLER FUNCTION */
MyCortexControllers.controller("ChatSettingsController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', '$timeout', '$document', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, $timeout, $document, toastr) {
        $scope.Id = 0;
        $scope.Flag = [];
        $scope.UserGroupList = [];
        $scope.checkboxObj = [];
        $scope.UserGroupListtwo = [];

        $scope.ChatSettingslist = [];
        $scope.User_Id = $window.localStorage['UserId'];
        $scope.Institution_Id = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        // inittialize the list object for user type
        if ($window.localStorage['UserTypeId'] == 3) {
            $http.get(baseUrl + '/api/ChatSettings/ChatSettingsUserType_List/').success(function (data) {

                $scope.UserGroupList = data;
                $scope.UserGroupListtwo = data;
                $scope.firstobj = [];
                $scope.secondobj = [];
                angular.forEach($scope.UserGroupList, function (Ovalue, Oindex) {

                    angular.forEach($scope.UserGroupList, function (Ivalue, Iindex) {
                        var name = Ivalue.Id.toString();
                    })
                })

            });

            $http.get(baseUrl + '/api/ChatSettings/ChatPreferenceGet/').success(function (data) {

                $scope.UserGroupList = data;
                $scope.UserGroupListtwo = data;
                $scope.firstobj = [];
                $scope.secondobj = [];
                angular.forEach($scope.UserGroupList, function (Ovalue, Oindex) {

                    angular.forEach($scope.UserGroupList, function (Ivalue, Iindex) {
                        var name = Ivalue.Id.toString();
                    })
                })

            });
        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }


        //Assign the usertype true or false
        $scope.updateCheckValue = function (OId, IId, $event) {
            var obj = { "OuterId": OId, "InnerId": IId, "Flag": true[0] }
            $scope.checkboxObj.push(obj);

            var checkbox = $event.target;
            var filterObj = $ff($scope.checkboxObj, { "OuterId": OId, "InnerId": IId }, true)[0];
            var checkbox = checkbox.checked;
            if (checkbox == true) {
                filterObj.Flag = 1;
            }
            else {
                filterObj.Flag = 0;
            }
        }


        $scope.ViewupdateCheckValue = function (idx, parentidx, $event) {
            $("#chatLoaderPV").show();
            // call after binding all checkboxes
            if (idx == $scope.UserGroupList.length && parentidx == $scope.UserGroupList.length) {
                setTimeout(function () {
                    $http.get(baseUrl + 'api/ChatSettings/ViewEditChatSettings/?Id=' + $scope.Institution_Id).success(function (data) {
                        $scope.ChatSettingslist = data;

                        angular.forEach($scope.UserGroupList, function (Ovalue, Oindex) {
                            angular.forEach($scope.UserGroupList, function (Ivalue, Iindex) {

                                var target = document.getElementById('chk-' + Ovalue.Id + '-' + Ivalue.Id);
                                target.checked = false;
                                var filObj = $ff($scope.ChatSettingslist, { "FromUser_TypeId": Ovalue.Id, "ToUser_TypeId": Ivalue.Id }, 1)

                                if ((typeof (filObj) != undefined || typeof (filObj) != null) && filObj.length > 0) {
                                    if (filObj[0].Flag == 1) {
                                        target.checked = true;
                                        var obj = { "OuterId": Ovalue.Id, "InnerId": Ivalue.Id, "Flag": true }
                                        $scope.checkboxObj.push(obj);
                                    }
                                    else {
                                        var obj = { "OuterId": Ovalue.Id, "InnerId": Ivalue.Id, "Flag": false }
                                        $scope.checkboxObj.push(obj);
                                    }
                                }
                                else {
                                    var obj = { "OuterId": Ovalue.Id, "InnerId": Ivalue.Id, "Flag": false }
                                    $scope.checkboxObj.push(obj);
                                }
                            })
                        })
                        $("#chatLoaderPV").hide();
                    })
                }, 1500);
            }

        }


        $scope.FromUser_TypeId = [];
        $scope.ToUser_TypeId = [];
        /*
          Call the api method for insert and Update the record for a chat settings
          and display the record of selected chat settings when Id is greater than 0
          in edit.html and provide an option for select and modify the chat settings and save the chat settings record
          */
        $scope.ChatSettings_AddEdit = function () {

            $scope.SaveChatPreference();

            var savecnt = $scope.UserGroupList.length * 2;
            var lpcnt = 0;
            $("#chatLoaderPV").show();
            angular.forEach($scope.UserGroupList, function (Ovalue, Oindex) {
                angular.forEach($scope.UserGroupList, function (Ivalue, Iindex) {
                    var flagstatus = 0;

                    if (($scope.checkboxObj != undefined || $scope.checkboxObj != null) && $scope.checkboxObj.length > 0) {
                        flagstatus = $ff($scope.checkboxObj, { "OuterId": Ovalue.Id, "InnerId": Ivalue.Id }, 1)[0].Flag
                    }
                    else {
                        flagstatus = $ff($scope.checkboxObj, { "OuterId": Ovalue.Id, "InnerId": Ivalue.Id }, 0)[0]
                    };

                    var obj = {
                        Id: $scope.Id,
                        Institution_Id: $scope.Institution_Id,
                        FromUser_TypeId: Ovalue.Id,
                        ToUser_TypeId: Ivalue.Id,
                        Flag: flagstatus,
                        Created_by: $scope.User_Id
                    }
                    $('#save').attr("disabled", true);

                    if (obj.Flag == true) {
                        obj.Flag = 1;
                    }
                    else {
                        obj.Flag = 0;
                    };


                    $http.post(baseUrl + '/api/ChatSettings/ChatSettings_AddEdit/', obj).success(function (data) {

                        lpcnt = lpcnt + 1
                        if (savecnt == lpcnt) {
                            //alert(data.Message);
                            toastr.success(data.Message, "success");
                            $('#save').attr("disabled", false);
                            $location.path("/EditChatSettings/" + $scope.Institution_Id);
                            //$scope.loading = false;
                            //$rootScope.$broadcast('hide'); 
                            $("#chatLoaderPV").hide();
                        }

                    })

                })
            })

        };

        /*Store Chat Preference*/
        $scope.SaveChatPreference = function () {
            var type = $scope.Preference_Type;
            $http.get(baseUrl + '/api/ChatSettings/ChatPreferenceSave/?institutionId=' + $window.localStorage['InstitutionId'] + '&preferenceType=' + type).success(function (data) {
                return data;
            })
        }

        /*Set Chat Preference*/
        $scope.SetChatPreference = function () {
            $http.get(baseUrl + '/api/ChatSettings/ChatPreferenceGet/?institutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                $scope.Preference_Type = data.PreferenceType;
            })
        }

        /*LIST REDIRECT FUNCTION */
        $scope.ListRedirect = function () {
            $location.path("/ChatSettings");
        }
    }
]);

// This is for Change Password and Rest Password controller functions/ /
MyCortexControllers.controller("PasswordController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', '$timeout', '$rootScope', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, $timeout, $rootScope, toastr) {
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.Id = "0";
        $scope.Institution_Id = "";
        $scope.UserTypeName = "0";
        $scope.Usertypelist = [];
        $scope.Userlist = [];
        $scope.Validationchangepasscontrols = function () {
            if (typeof ($scope.Password) != ($scope.OldPassword == "")) {
                $scope.errorlist = "Not a valid password";
                return false;
            }
            return true;
        };

        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.policyExist = false;
        $scope.PasswordPolicyDetails = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/Common/PasswordPolicyDetails_View/?Insitution_Id=' + $scope.InstituteId).success(function (data) {
                if (data != null) {
                    $scope.Insitution_Id = data.Insitution_Id;
                    $scope.Insitution_Name = data.Insitution_Name;
                    $scope.Minimum_Length = data.Minimum_Length;
                    $scope.Maximum_Length = data.Maximum_Length;
                    $scope.UpperCase_Required = data.UpperCase_Required;
                    $scope.LowerCase_Required = data.LowerCase_Required;
                    $scope.Numeric_Required = data.Numeric_Required;
                    $scope.SpecialChar_Required = data.SpecialChar_Required;
                    $scope.Without_Char = data.Without_Char;
                    $scope.Expiry_Period = data.Expiry_Period;
                    $scope.Allow_UserName = data.Allow_UserName;
                    $scope.Restrict_LastPassword = data.Restrict_LastPassword;
                    $scope.MaxLoginMins = data.MaxLoginMins;
                }
                //$scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
                //$scope.NewPassword = "";
                $("#chatLoaderPV").hide();
            });
            //$scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
            //$scope.NewPassword = "";
        };
        $scope.PasswordPolicyDetails();

        $scope.Validationcontrolspassword = function () {
            $scope.PasswordPolicyDetails();

            if (typeof ($scope.OldPassword) == "undefined" || $scope.OldPassword == '') {
                //alert("Please enter Password");
                toastr.warning("Please enter Password", "warning");
                return false;
            }

            if (typeof ($scope.NewPassword) == "undefined" || $scope.NewPassword == '') {
                //alert("Please enter New password");
                toastr.warning("Please enter Password", "warning");
                return false;
            }
            else if (typeof ($scope.confirmpassword) == "undefined" || $scope.confirmpassword == '') {
                //alert("Please enter Confirm password");
                toastr.warning("Please enter Confirm password", "warning");
                return false;
            }

            else if (($scope.confirmpassword) != ($scope.NewPassword)) {
                //alert("New password and Confirm Password mismatch Please enter same password");
                toastr.warning("New password and Confirm Password mismatch Please enter same password", "warning");
                return false;
            }
            //Password policy based validations
            else if (parseInt(('' + $scope.NewPassword).length) < parseInt($scope.Minimum_Length)) {
                //alert("Your Name Should Contain Minimum Length is " + $scope.Minimum_Length);
                toastr.warning("Your Name Should Contain Minimum Length is " + $scope.Minimum_Length, "warning");
                return false;
            }

            else if (parseInt(('' + $scope.NewPassword).length) > parseInt($scope.Maximum_Length)) {
                //alert("Sorry You are Exceeding the Limit is " + $scope.Maximum_Length);
                toastr.warning("Sorry You are Exceeding the Limit is " + $scope.Maximum_Length, "warning");
                return false;
            }
            $scope.flag = 0;
            $scope.flagchar = 0;

            var newpass = ('' + $scope.NewPassword).length;

            /* Validation for new password have a special character password */
            if (($scope.SpecialChar_Required != null)) {

                var newpasschar = ('' + $scope.NewPassword).length;
                var format = /^[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/;

                while (newpasschar--) {

                    var y = $scope.NewPassword.substring(newpasschar, newpasschar + 1);

                    if (y.match(format)) {

                        $scope.flagchar += 1;
                    }
                }

                if ($scope.flagchar <= 0) {
                    //alert("Please enter atleast one special character ");
                    toastr.warning("Please enter atleast one special character ", "warning");
                    return false;
                }
            }


            $scope.flagspl = 0;
            $scope.flagchars = 0;
            /* Validation for new password have not a special character and number in password */
            if (($scope.Without_Char != null)) {

                var newpasssplchar = ('' + $scope.NewPassword).length;
                while (newpasssplchar--) {
                    var z = $scope.NewPassword.substring(newpasssplchar, newpasssplchar + 1);

                    var leng = ('' + $scope.Without_Char).length;
                    while (leng--) {
                        var a = $scope.Without_Char.substring(leng, leng + 1);

                        if (angular.equals(z, a)) {
                            alert($scope.Without_Char + "  characters not allowed, please check");
                            return false;
                        }

                    }

                }
            }


            /* Validation for new password have a number password */
            if (($scope.Numeric_Required != null)) {
                while (newpass--) {
                    var x = $scope.NewPassword.substring(newpass, newpass + 1);
                    if (!isNaN(x)) {
                        $scope.flag += 1;
                    }
                }
                if ($scope.flag <= 0) {
                    //alert("Please enter atleast one number ");
                    toastr.warning("Please enter atleast one number ", "warning");
                    return false;
                }
            }

            /* Allow the user name same as password*/
            $scope.flagAllow = 0;
            if (($scope.Allow_UserName == null)) {
                $scope.username = $window.localStorage['Username'];
                var user = $scope.username;
                var pwd = $scope.NewPassword;
                if (user == pwd) {
                    //alert("Username and password is same, please check the password");
                    toastr.info("Username and password is same, please check the password", "info");
                    return false;
                }

            }

            $scope.flagUpper = 0;
            $scope.flagcharUpper = 0;

            var newpass = ('' + $scope.NewPassword).length;

            /* Validation for new password have a special character password */
            if (($scope.UpperCase_Required != null)) {

                var newpassupperchar = ('' + $scope.NewPassword).length;
                var format = /[A-Z]/;

                while (newpassupperchar--) {

                    var y = $scope.NewPassword.substring(newpassupperchar, newpassupperchar + 1);

                    if (y.match(format)) {

                        $scope.flagcharUpper += 1;
                    }
                }

                if ($scope.flagcharUpper <= 0) {
                    //alert("Please enter atleast one uppercase letter ");
                    toastr.warning("Please enter atleast one uppercase letter ", "warning");
                    return false;
                }
            }

            $scope.flagLower = 0;
            $scope.flagcharLower = 0;

            var newpass = ('' + $scope.NewPassword).length;

            /* Validation for new password have a special character password */
            if (($scope.LowerCase_Required != null)) {

                var newpasslowerchar = ('' + $scope.NewPassword).length;
                var formats = /[a-z]/;

                while (newpasslowerchar--) {

                    var y = $scope.NewPassword.substring(newpasslowerchar, newpasslowerchar + 1);

                    if (y.match(formats)) {

                        $scope.flagcharLower += 1;
                    }
                }

                if ($scope.flagcharLower <= 0) {
                    //alert("Please enter atleast one lowercase letter ");
                    toastr.warning("Please enter atleast one lowercase letter ", "warning");
                    return false;
                }
            }


            return true;
        }
        /* Validating the create page mandatory fields
                checking mandatory for the follwing fields
                NewPasssword,ReenterPassword
                and showing alert message when it is null.
                */
        $scope.Validationresetcontrols = function () {
            //$scope.PasswordPolicyDetails();
            if (typeof ($scope.UserTypeName) == "undefined" || $scope.UserTypeName == 0) {
                //alert("Please select User Type");
                toastr.warning("Please select User Type", "warning");
                return false;
            }
            if (typeof ($scope.User_Selected) == "undefined" || $scope.User_Selected == '') {
                //alert("Please select User");
                toastr.warning("Please select User", "warning");
                return false;
            }
            if (typeof ($scope.NewPassword) == "undefined" || $scope.NewPassword == '') {
                //alert("Please enter New password");
                toastr.warning("Please enter New password", "warning");
                return false;
            }
            if (typeof ($scope.ReenterPassword) == "undefined" || $scope.ReenterPassword == '') {
                //alert("Please enter Re-enter password");
                toastr.warning("Please enter Re-enter password", "warning");
                return false;
            }
            if (($scope.NewPassword) != ($scope.ReenterPassword)) {
                //alert("New password and Re-enter Password mismatch please enter same password");
                toastr.warning("New password and Re-enter Password mismatch please enter same password", "warning");
                return NewPasssword;
            }
            //Password policy based validations
            else if (parseInt(('' + $scope.NewPassword).length) < parseInt($scope.Minimum_Length)) {
                //alert("Your Name Should Contain Minimum Length is " + $scope.Minimum_Length);
                toastr.warning("Your Name Should Contain Minimum Length is " + $scope.Minimum_Length, "warning");
                return false;
            }

            else if (parseInt(('' + $scope.NewPassword).length) > parseInt($scope.Maximum_Length)) {
                //alert("Sorry You are Exceeding the Limit is " + $scope.Maximum_Length);
                toastr.warning("Sorry You are Exceeding the Limit is " + $scope.Maximum_Length, "warning");
                return false;
            }
            $scope.flag = 0;
            $scope.flagchar = 0;

            var newpass = ('' + $scope.NewPassword).length;

            /* Validation for new password have a special character password */
            if (($scope.SpecialChar_Required != null)) {

                var newpasschar = ('' + $scope.NewPassword).length;
                var format = /^[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/;

                while (newpasschar--) {

                    var y = $scope.NewPassword.substring(newpasschar, newpasschar + 1);

                    if (y.match(format)) {

                        $scope.flagchar += 1;
                    }
                }

                if ($scope.flagchar <= 0) {
                    //alert("Please enter atleast one special character ");
                    toastr.warning("Please enter atleast one special character ", "warning");
                    return false;
                }
            }


            $scope.flagspl = 0;
            $scope.flagchars = 0;
            /* Validation for new password have not a special character and number in password */
            if (($scope.Without_Char != null)) {

                var newpasssplchar = ('' + $scope.NewPassword).length;
                while (newpasssplchar--) {
                    var z = $scope.NewPassword.substring(newpasssplchar, newpasssplchar + 1);

                    var leng = ('' + $scope.Without_Char).length;
                    while (leng--) {
                        var a = $scope.Without_Char.substring(leng, leng + 1);

                        if (angular.equals(z, a)) {
                            alert($scope.Without_Char + "  characters not allowed, please check");
                            return false;
                        }

                    }

                }
            }


            /* Validation for new password have a number password */
            if (($scope.Numeric_Required != null)) {
                while (newpass--) {
                    var x = $scope.NewPassword.substring(newpass, newpass + 1);
                    if (!isNaN(x)) {
                        $scope.flag += 1;
                    }
                }
                if ($scope.flag <= 0) {
                    //alert("Please enter atleast one number ");
                    toastr.warning("Please enter atleast one number ", "warning");
                    return false;
                }
            }

            /* Allow the user name same as password*/
            $scope.flagAllow = 0;
            if (($scope.Allow_UserName == null)) {
                $scope.username = $window.localStorage['Username'];
                var user = $scope.username;
                var pwd = $scope.NewPassword;
                if (user == pwd) {
                    //alert("Username and password is same, please check the password");
                    toastr.info("Username and password is same, please check the password", "info");
                    return false;
                }

            }

            $scope.flagUpper = 0;
            $scope.flagcharUpper = 0;

            var newpass = ('' + $scope.NewPassword).length;

            /* Validation for new password have a special character password */
            if (($scope.UpperCase_Required != null)) {

                var newpassupperchar = ('' + $scope.NewPassword).length;
                var format = /[A-Z]/;

                while (newpassupperchar--) {

                    var y = $scope.NewPassword.substring(newpassupperchar, newpassupperchar + 1);

                    if (y.match(format)) {

                        $scope.flagcharUpper += 1;
                    }
                }

                if ($scope.flagcharUpper <= 0) {
                    //alert("Please enter atleast one uppercase letter ");
                    toastr.warning("Please enter atleast one uppercase letter ", "warning");
                    return false;
                }
            }

            $scope.flagLower = 0;
            $scope.flagcharLower = 0;

            var newpass = ('' + $scope.NewPassword).length;

            /* Validation for new password have a special character password */
            if (($scope.LowerCase_Required != null)) {

                var newpasslowerchar = ('' + $scope.NewPassword).length;
                var formats = /[a-z]/;

                while (newpasslowerchar--) {

                    var y = $scope.NewPassword.substring(newpasslowerchar, newpasslowerchar + 1);

                    if (y.match(formats)) {

                        $scope.flagcharLower += 1;
                    }
                }

                if ($scope.flagcharLower <= 0) {
                    //alert("Please enter atleast one lowercase letter ");
                    toastr.warning("Please enter atleast one lowercase letter ", "warning");
                    return false;
                }
            }

            return true;

        };
        $scope.PageParameter = $routeParams.Id;
        $scope.CancelPopup = function () {
            angular.element('#ChangepasswordpopupModal').modal('hide');
        }
        /*
    Call the api method for insert and Update the record for a change password
    and display the record of selected change password when Id is greater than 0
    in edit.html and provide an option for create and modify the change password and save the change password record
    */
        $scope.ChangePassword = function () {
            if ($scope.Validationcontrolspassword() == true) {
                $("#chatLoaderPV").show();
                $scope.changepasswordId = $window.localStorage['UserId'];
                $scope.ModifiedUser_Id = $window.localStorage['UserId'];
                $scope.InstituteId = $window.localStorage['InstitutionId'];
                $scope.NewPassword = $scope.NewPassword.replace(/(#|&)/g, "amp");
                $scope.confirmpassword = $scope.confirmpassword.replace(/(#|&)/g, "amp");
                var obj = {
                    UserId: $scope.changepasswordId,
                    InstitutionId: $window.localStorage['InstitutionId'],
                    NewPassword: $scope.NewPassword,
                    ReenterPassword: $scope.confirmpassword,
                    Password: $scope.OldPassword,
                    LoginType: $scope.PageParameter
                };
                $http.post(baseUrl + '/api/Login/ChangePassword', obj)
                    /*/?Id=' + $scope.changepasswordId
                    + '&NewPassword=' + $scope.NewPassword
                    + '&OldPassword=' + $scope.OldPassword
                    + '&Confirmpassword=' + $scope.confirmpassword
                    + '&ModifiedUser_Id=' + $scope.ModifiedUser_Id
                    + '&InstitutionId=' + $scope.InstituteId
                    + '&PageTypeId=' + $scope.PageParameter*/
                    .success(function (data) {
                        alert(data.Message);
                        if (data.ReturnFlag == "1") {
                            $scope.ClearPassword();
                            angular.element('#ChangepasswordpopupModal').modal('hide');
                        }
                    }).error(function (data) {
                        $scope.error = "Problem in changing the password duplicate!" + data.ExceptionMessage;
                    });
                $("#chatLoaderPV").hide();
            }
        };
        $scope.PasswordChecking = function () {
            var elless = $scope.NewPassword;
            var isUpperCaseLetter = (/[A-Z]/.test(elless));
            if (isUpperCaseLetter) {
                document.getElementById("UpperCase").checked = true;
            } else {
                document.getElementById("UpperCase").checked = false;
            }
            var isNumber = (/[0-9]/.test(elless));
            if (isNumber) {
                document.getElementById("Numeric").checked = true;
            } else {
                document.getElementById("Numeric").checked = false;
            }
            if (elless == null || elless == undefined || elless == "") {
                document.getElementById("Blank").checked = true;
            } else {
                document.getElementById("Blank").checked = false;
            }
            var Passwordlength = elless.length;
            if (Passwordlength >= $scope.Minimum_Length) {
                document.getElementById("Minchar").checked = true;
            } else {
                document.getElementById("Minchar").checked = false;
            }
            if (Passwordlength <= $scope.Maximum_Length & Passwordlength >= $scope.Minimum_Length) {
                document.getElementById("Maxchar").checked = true;
            } else {
                document.getElementById("Maxchar").checked = false;
            }
            if ($scope.NewPassword == $scope.confirmpassword & $scope.NewPassword != "") {
                document.getElementById("MatchOk").checked = true;
            } else {
                document.getElementById("MatchOk").checked = false;
            }
        }
        $scope.PasswordConfirm = function () {
            if ($scope.NewPassword == $scope.confirmpassword & $scope.NewPassword != "") {
                document.getElementById("MatchOk").checked = true;
            } else {
                document.getElementById("MatchOk").checked = false;
            }
        }

        /* User type details list*/
        $http.get(baseUrl + '/api/Login/Usertypedetailslist/').success(function (data) {
            //$scope.Usertypelist = data;
            $scope.Usertypelist = [];
            $("#chatLoaderPV").show();
            //$scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
            //$scope.NewPassword = "";
            angular.forEach(data, function (row, value) {
                if (row.Id != 1)
                    $scope.Usertypelist.push(row)
            });
            $("#chatLoaderPV").hide();
        });

        /* User basic details list*/
        $scope.Userdetailsdatalist = function () {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/Login/Userdetailslist/?UserTypeId=' + $scope.UserTypeName + '&InstitutionId=' + $scope.InstituteId).success(function (data) {
                $scope.Userlist = data;
                $("#chatLoaderPV").hide();
            });
        };

        $scope.ClearPassword = function () {
            $scope.NewPassword = "";
            $scope.OldPassword = "";
            $scope.confirmpassword = "";
            $scope.ModifiedUser_Id = "";
            $scope.User_Id = "";
            $scope.ReenterPassword = "";
            $scope.UserTypeName = "0";
            $scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
        };
        /*
       Call the api method for insert and Update the record for a reset password
       and display the record of selected reset password when Id is greater than 0
       in edit.html and provide an option for create and modify the reset password and save the reset password record
       */
        $scope.ResetPassword = function () {
            if ($scope.Validationresetcontrols() == true) {
                $("#chatLoaderPV").show();
                $('#btn-signup').attr("disabled", true);
                if ($scope.User_Selected != undefined) {
                    $scope.User_Id = $scope.User_Selected.originalObject.Id;
                    {
                        $scope.ResetpasswordId = $window.localStorage['UserId'];
                        $scope.NewPassword = $scope.NewPassword.replace(/(#|&)/g, "amp");
                        $scope.ReenterPassword = $scope.ReenterPassword.replace(/(#|&)/g, "amp");
                        $http.get(baseUrl + '/api/Login/ResetPassword/?Id=' + $scope.User_Id
                            + '&NewPassword=' + $scope.NewPassword
                            + '&ReenterPassword=' + $scope.ReenterPassword
                            + '&created_By=' + $window.localStorage['UserId']
                            + '&EmailId=""'
                            + '&InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                                //alert(data.Message);
                                toastr.success(data.Message, "success");
                                $('#btn-signup').attr("disabled", false);
                                $scope.ClearPassword();
                                $("#chatLoaderPV").hide();
                            }).error(function (data) {
                                $scope.error = "An error has occurred while deleting reset password details" + data;
                            });
                    }
                }
            }
        };

        //validation for password policy insert update
        $scope.ValidationPasswordControls = function () {
            if (typeof ($scope.Minimum_Length) == "undefined" || $scope.Minimum_Length == "") {
                //alert("Please enter Minimum Length");
                toastr.warning("Please enter Minimum Length", "warning");
                return false;
            }
            else if (typeof ($scope.Maximum_Length) == "undefined" || $scope.Maximum_Length == "") {
                //alert("Please enter Maximum Length");
                toastr.warning("Please enter Maximum Length", "warning");
                return false;
            }
            else if (parseInt($scope.Maximum_Length) < parseInt($scope.Minimum_Length)) {
                //alert("Please enter Maximum Length greater than Minimum Length");
                toastr.warning("Please enter Maximum Length greater than Minimum Length", "warning");
                return false;
            }
            else if (typeof ($scope.Expiry_Period) == "undefined" || $scope.Expiry_Period == "" && $scope.AllowExpiryDays != 1) {
                //alert("Please enter Password  Expiry Period");
                toastr.warning("Please enter Password  Expiry Period", "warning");
                return false;
            }
            return true;
        };


        //Insert function for password policy

        //Insert function for password policy  //Insert function for password policy
        $scope.PasswordPolicyInsertUpdate = function () {
            if ($scope.ValidationPasswordControls() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    Minimum_Length: $scope.Minimum_Length,
                    Maximum_Length: $scope.Maximum_Length,
                    UpperCase_Required: $scope.UpperCase_Required == 0 ? null : $scope.UpperCase_Required,
                    LowerCase_Required: $scope.LowerCase_Required == 0 ? null : $scope.LowerCase_Required,
                    Numeric_Required: $scope.Numeric_Required == 0 ? null : $scope.Numeric_Required,
                    SpecialChar_Required: $scope.SpecialChar_Required == 0 ? null : $scope.SpecialChar_Required,
                    Without_Char: $scope.Without_Char == "" ? null : $scope.Without_Char,
                    AllowExpiryDays: $scope.AllowExpiryDays == 0 ? null : $scope.AllowExpiryDays,
                    Expiry_Period: $scope.Expiry_Period == 0 ? null : $scope.Expiry_Period,
                    Allow_UserName: $scope.Allow_UserName == 0 ? null : $scope.Allow_UserName,
                    Restrict_LastPassword: $scope.Restrict_LastPassword == "" ? null : $scope.Restrict_LastPassword,
                    MaxLoginTime: $scope.MaxLoginTime == "" ? null : $scope.MaxLoginTime,
                    MaxLoginHours: $scope.MaxLoginHours == "" ? null : $scope.MaxLoginHours,
                    MaxLoginMins: $scope.MaxLoginMins == "" ? null : $scope.MaxLoginMins,
                    Remember_Password: $scope.Remember_Password == 0 ? null : $scope.Remember_Password,
                    Institution_Id: $scope.InstituteId = $window.localStorage['InstitutionId'],
                    Created_By: $scope.Created_By = $window.localStorage['UserId']
                };
                $('#btnsave').attr("disabled", true);
                $scope.loading = true;

                $http.post(baseUrl + '/api/Common/PasswordPolicy_InsertUpdate/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $('#btnsave').attr("disabled", false);
                    $scope.PasswordPolicyView();
                    $scope.ClearFields();

                    if (data.ReturnFlag == "1") {
                        $location.path("/EditPasswordPolicy/");
                        $scope.loading = false;
                        $rootScope.$broadcast('hide');
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "An error has occurred while adding Password Policy Details!" + data.ExceptionMessage;
                });

            };
        }

        //view function for password policy
        $scope.PasswordPolicyView = function () {

            $("#chatLoaderPV").show();
            //$scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
            //  $scope.NewPassword = "";
            $http.get(baseUrl + '/api/Common/PasswordPolicy_View/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                if (data != null) {
                    $scope.policyExist = true;
                    $scope.Institution_Id = data.Institution_Id;
                    $scope.Insitution_Name = data.Insitution_Name;
                    $scope.Minimum_Length = data.Minimum_Length;
                    $scope.Maximum_Length = data.Maximum_Length;
                    $scope.UpperCase_Required = data.UpperCase_Required;
                    $scope.LowerCase_Required = data.LowerCase_Required;
                    $scope.Numeric_Required = data.Numeric_Required;
                    $scope.SpecialChar_Required = data.SpecialChar_Required;
                    $scope.Without_Char = data.Without_Char;
                    $scope.AllowExpiryDays = data.AllowExpiryDays;
                    $scope.Expiry_Period = data.Expiry_Period;
                    $scope.Allow_UserName = data.Allow_UserName;
                    $scope.Restrict_LastPassword = data.Restrict_LastPassword;
                    $scope.MaxLoginTime = data.MaxLoginTime;
                    $scope.MaxLoginHours = data.MaxLoginHours;
                    $scope.MaxLoginMins = data.MaxLoginMins;
                    $scope.Created_By = data.Created_By;
                    $scope.Remember_Password = data.Remember_Password;
                    $scope.Created_Dt = data.Created_Dt;
                }
                $("#chatLoaderPV").hide();
                //$scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
                //$scope.NewPassword = "";
            });

        };

        //view function for password policy
        $scope.PasswordPolicyDetails = function () {
            //$scope.$broadcast('angucomplete-alt:clearInput', 'Div1');
            //$scope.NewPassword = "";
            $http.get(baseUrl + '/api/Common/PasswordPolicyDetails_View/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.Institution_Id = data.Institution_Id;
                $scope.Insitution_Name = data.Insitution_Name;
                $scope.Minimum_Length = data.Minimum_Length;
                $scope.Maximum_Length = data.Maximum_Length;
                $scope.UpperCase_Required = data.UpperCase_Required;
                $scope.LowerCase_Required = data.LowerCase_Required;
                $scope.Numeric_Required = data.Numeric_Required;
                $scope.SpecialChar_Required = data.SpecialChar_Required;
                $scope.Without_Char = data.Without_Char;
                $scope.AllowExpiryDays = data.AllowExpiryDays;
                $scope.Expiry_Period = data.Expiry_Period;
                $scope.Allow_UserName = data.Allow_UserName;
                $scope.Restrict_LastPassword = data.Restrict_LastPassword;
                $scope.MaxLoginTime = data.MaxLoginTime;
                $scope.MaxLoginHours = data.MaxLoginHours;
                $scope.MaxLoginMins = data.MaxLoginMins;
                $scope.Created_By = data.Created_By;
                $scope.Remember_Password = data.Remember_Password;
                $scope.Created_Dt = data.Created_Dt;
            });
        };
        //clear function for expiry period
        $scope.ClearPasswordExpiryperiod = function () {
            $scope.Expiry_Period = "";

        }

        /*Clear the scope variables values*/
        $scope.ClearFields = function () {
            $scope.Minimum_Length = "";
            $scope.Maximum_Length = "";
            $scope.UpperCase_Required = "";
            $scope.LowerCase_Required = "";
            $scope.Numeric_Required = "";
            $scope.SpecialChar_Required = "";
            $scope.Without_Char = "";
            $scope.Expiry_Period = "";
            $scope.Allow_UserName = "";
            $scope.Restrict_LastPassword = "";
            $scope.MaxLoginTime = "";
            $scope.MaxLoginHours = "";
            $scope.MaxLoginMins = "";
            $scope.Institution_Id = "";
            $scope.Created_By = "";
            $scope.Created_Dt = "";
            $scope.Remember_Password = "";
            $scope.AllowExpiryDays = "";
        };

        /**Change Password Popup function**/
        angular.element('#ChangepasswordpopupModal').modal('show');
        $('#ChangepasswordpopupModal').on('hide.bs.modal', function () {
            //window.location.href = baseUrl + "/Home/Index#/home";
            var res = $rootScope.previousPage.split("/");
            if (res[res.length - 2].toLowerCase() == "changepassword") {
                window.location.href = baseUrl + "/Home/Index#/home";
            }
            else {
                window.location.href = $rootScope.previousPage;
            }

            //$PreviousState.goToLastState();
        })

        /**Cancel Change Password Popup function**/
        $scope.CancelChangePasswordPopup = function () {
            angular.element('#ChangepasswordpopupModal').modal('hide');
        };



    }
]);

MyCortexControllers.controller("PatientApprovalController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {

        $scope.Id = "0";
        $scope.Filter_PatientNo = "";
        $scope.filter_InsuranceId = "";
        $scope.filter_MOBILE_NO = "";
        $scope.filter_HomePhoneNo = "";
        $scope.filter_Email = "";
        $scope.Filter_GenderId = "0";
        $scope.filter_NationalityId = "0";
        $scope.filter_EthinicGroupId = "0";
        $scope.filter_MaritalStatus = "0";
        $scope.filter_CountryId = "0";
        $scope.filter_StataId = "0";
        $scope.filter_CityId = "0";
        $scope.filter_BloodGroupId = "0";
        $scope.filter_GroupId = "0";
        $scope.InstitutionId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.Approvalflag = 0;
        $scope.EthnicGroupList = [];
        $scope.BloodGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.GroupTypeList = [];
        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.loadCount = 0;
        $scope.rowCollectionFilter = [];
        $scope.TabClick = false;

        $scope.ResetPatientFilter = function () {
            $scope.Filter_PatientNo = "";
            $scope.filter_InsuranceId = "";
            $scope.Filter_GenderId = "0";
            $scope.filter_NationalityId = "0";
            $scope.filter_EthinicGroupId = "0";
            $scope.filter_MOBILE_NO = "";
            $scope.filter_HomePhoneNo = "";
            $scope.filter_Email = "";
            $scope.filter_MaritalStatus = "0";
            $scope.filter_CountryId = "0";
            $scope.filter_StataId = "0";
            $scope.filter_CityId = "0";
            $scope.filter_BloodGroupId = "0";
            $scope.filter_GroupId = "0";
            $scope.PatientApprovalList();
        }

        $scope.PatientApprovalDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstitutionId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $scope.CountryStateList();
            }
        };

        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];

        $scope.CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;
            });
        }
        /*   $scope.Filter_Country_onChange = function () {
               $scope.StateNameList = $ff($scope.State_Template, { CountryId: $scope.filter_CountryId });
               setTimeout(function () {
                   jQuery("#stateselectpicker").selectpicker('refresh')
               }, 500);
           };
           $scope.Filter_State_onChange = function () {
               $scope.CityNameList = $ff($scope.City_Template, { StateId: $scope.filter_StataId });
           };*/

        $scope.Filter_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        }
        $scope.Filter_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }

        //* THIS IS FOR LIST FUNCTION */

        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.Approvalflag = 0;
        $scope.rowCollectionFilter = [];
        /*List Page Pagination*/

        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.PatientApprovalList = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/PatientApproval/PatientApproval_List/?InstitutionId=' + $scope.InstitutionId + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId + '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' + $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus + '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId + '&Group_Id=' + $scope.filter_GroupId
                ).success(function (data) {

                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.Approvalflag = 1;
                    }
                    else {
                        $scope.Approvalflag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.Active_PatientApproval = function (PId) {
            $scope.Id = PId;
            $location.path("/PatientView/" + $scope.Id + "/0/3");
        };


        $scope.searchquery = "";
        /* Filter the master list function.*/
        $scope.filterPatientList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.FullName).match(searchstring) ||
                        angular.lowercase(value.MRN_NO).match(searchstring) ||
                        angular.lowercase(value.Mobile_No).match(searchstring) ||
                        angular.lowercase(value.EmailId).match(searchstring) ||
                        angular.lowercase(value.PendingSince).match(searchstring);
                });
            }
            if ($scope.rowCollectionFilter.length > 0) {
                $scope.Approvalflag = 1;
            }
            else {
                $scope.Approvalflag = 0;
            }
        }
        $scope.checkAll = function () {
            if ($scope.SelectedAllPatient == true) {
                $scope.SelectedAllPatient = true;
            } else {
                $scope.SelectedAllPatient = false;
            }
            angular.forEach($scope.rowCollectionFilter, function (row) {
                if (row.Approval_Flag == 0)
                    row.SelectedPatient = $scope.SelectedAllPatient;
            });
        };
        $scope.ApprovePatient = function () {
            //var cnt = ($filter('filter')($scope.rowCollectionFilter, 'true')).length;
            var cnt = $ff(($filter('filter')($scope.rowCollectionFilter, 'true')), { Approval_Flag: 0 }).length;
            $('#btnsave').attr("disabled", true);
            if (cnt == 0) {
                //alert("Please select atleast one Patient to Approve");
                toastr.warning("Please select atleast one Patient to Approve", "warning");
                $('#btnsave').attr("disabled", false);
            }
            else {
                $http.get(baseUrl + '/api/PatientApproval/Get_PatientCount/?InstitutionId=' + $scope.InstitutionId).success(function (data) {
                    $scope.PatientCount = data[0].PatientCount;
                    if ($scope.PatientCount >= cnt) {
                        var msg = confirm("Do you like to Approve the Selected Patient?");
                        if (msg == true) {
                            $scope.ApprovedPatientList = [];
                            angular.forEach($scope.rowCollectionFilter, function (SelectedPatient, index) {
                                if (SelectedPatient.SelectedPatient == true) {
                                    if (SelectedPatient.Approval_Flag == 0) {
                                        var ApprovePatientobj = {
                                            Patient_Id: SelectedPatient.Id
                                        };
                                        $scope.ApprovedPatientList.push(ApprovePatientobj);
                                    }
                                }
                            });
                            $http.post(baseUrl + '/api/PatientApproval/Multiple_PatientApproval_Active/', $scope.ApprovedPatientList).success(function (data) {
                                //alert(data.Message);
                                toastr.success(data.Message, "success");
                                $('#btnsave').attr("disabled", false);
                                if (data.ReturnFlag == 1) {
                                    $scope.PatientApprovalList();
                                    $scope.SelectedAllPatient = false;
                                }
                            });
                        }
                    }
                    else {
                        //alert("Maximum Number of Patient License reached already, cannot be approved");
                        toastr.info("Maximum Number of Patient License reached already, cannot be approved", "info");
                        $('#btnsave').attr("disabled", false);
                        return false;
                    }
                });
            }
        }
    }

]);


/* THIS IS FOR EMPLOYEE EMAIL CONFIGURATION CONTROLLER FUNCTION */
MyCortexControllers.controller("EmailConfigurationController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {


        // Declaration and initialization of Scope Variables.
        $scope.Id = 0;
        $scope.InstitutionName = "0";
        $scope.SSL_Enable = "0";
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        /*clear the company details */
        $scope.clearInstitution = function () {
            if ($scope.InstitutionName != null) {
                $scope.ClearFields();
            }
        };

        /* Email configuration Validation function   */
        $scope.EmailConfigurationValidation = function () {
            if (typeof ($scope.Sender_Email_Id) == "undefined" || $scope.Sender_Email_Id == "") {
                //alert("Please enter Sender Email ID");
                toastr.warning("Please enter Sender Email ID", "warning");
                return false;
            }
            else if (typeof ($scope.UserName) == "undefined" || $scope.UserName == "") {
                //alert("Please enter User Name");
                toastr.warning("Please enter User Name", "warning");
                return false;
            }
            else if (typeof ($scope.Password) == "undefined" || $scope.Password == "") {
                //alert("Please enter Password");
                toastr.warning("Please enter Password", "warning");
                return false;
            }
            else if (typeof ($scope.ServerName) == "undefined" || $scope.ServerName == "") {
                //alert("Please enter Server Name(SMTP)");
                toastr.warning("Please enter Server Name(SMTP)", "warning");
                return false;
            }
            else if (typeof ($scope.PortNo) == "undefined" || $scope.PortNo == "") {
                //alert("Please enter Port No");
                toastr.warning("Please enter Port No", "warning");
                return false;
            }
            else if (typeof ($scope.DisplayName) == "undefined" || $scope.DisplayName == "") {
                //alert("Please enter Display Name");
                toastr.warning("Please enter Display Name", "warning");
                return false;
            }
            else if (typeof ($scope.SSL_Enable) == "undefined" || $scope.SSL_Enable == 0) {
                //alert("Please select SSL Enable");
                toastr.warning("Please select SSL Enable", "warning");
                return false;
            }
            if (EmailFormate($scope.Sender_Email_Id) == false) {
                //alert("Invalid email format");
                toastr.warning("Invalid email format", "warning");
                return false;
            }
            return true;
        };

        /* Institution Dropdown function  */
        $scope.InstitutionList = [];
        $scope.InstitutionFilterList = [];
        $http.get(baseUrl + '/api/Institution/InstitutionDetails_View/?Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
            $scope.Insitution_Name = data.Institution_Name;
            // $scope.InstitutionFilterList =  angular.copy($scope.InstitutionList); 
        });

        $scope.Id = 0;
        $scope.Sender_Email_Id = "";
        $scope.UserName = "";
        $scope.Password = "";
        $scope.ServerName = "";
        $scope.PortNo = "";
        $scope.DisplayName = "";
        $scope.SSL_Enable = "0";
        $scope.Id = "0";
        $scope.Remarks = "";
        /* Email configurations Save and Update Function*/
        $scope.EmailConfiguration_AddEdit = function () {
            if ($scope.EmailConfigurationValidation() == true) {
                $("#chatLoaderPV").show();
                var val_sslen = 2;
                if ($scope.SSL_Enable == "1") {
                    val_sslen = 1;

                }
                else {
                    val_sslen = 2;
                }
                var obj = {
                    Id: $scope.Id,
                    Institution_Id: $window.localStorage['InstitutionId'],
                    Sender_Email_Id: $scope.Sender_Email_Id,
                    UserName: $scope.UserName,
                    Password: $scope.Password,
                    ServerName: $scope.ServerName,
                    PortNo: $scope.PortNo,
                    DisplayName: $scope.DisplayName,
                    EConfigSSL_Enable: val_sslen,
                    Remarks: $scope.Remarks,
                    Created_By: $window.localStorage['UserId']
                };
                $('#save').attr("disabled", true);
                $http.post(baseUrl + '/api/EmailConfiguration/EmailConfiguration_AddEdit/', obj).success(function (data) {
                    //alert("Email setup saved successfully");
                    toastr.success("Email setup saved successfully", "success");
                    $('#save').attr("disabled", false);
                    $scope.EmailConfiguration_ViewEdit();
                    //$scope.ClearFields();
                    //   $scope.clearInstitution();
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "An error has occurred while adding Email Configuration!" + data.ExceptionMessage;
                });
            }
        };
        /* Email configurations View and Edit Function*/
        $scope.EmailConfiguration_ViewEdit = function () {
            if ($window.localStorage['UserTypeId'] == 3 || $window.localStorage['UserTypeId'] == 1) {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + 'api/EmailConfiguration/EmailConfiguration_View/?Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
                    if (data != null) {
                        $scope.Id = data.Id;
                        $scope.Insitution_Name = data.Institution_Name;
                        $scope.Sender_Email_Id = data.Sender_Email_Id;
                        $scope.UserName = data.UserName;
                        $scope.Password = data.Password;
                        $scope.ServerName = data.ServerName;
                        $scope.PortNo = data.PortNo;
                        $scope.DisplayName = data.DisplayName;
                        $scope.SSL_Enable = data.EConfigSSL_Enable.toString();
                        //   $scope.SSL_Enable = data.SSL_Enable.toString();
                        $scope.Remarks = data.Remarks;
                    }
                    $("#chatLoaderPV").hide();
                });
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };


        /* Clear the scope variables */
        $scope.ClearFields = function () {
            $scope.Id = 0;
            $scope.Sender_Email_Id = "";
            $scope.UserName = "";
            $scope.Password = "";
            $scope.ServerName = "";
            $scope.PortNo = "";
            $scope.DisplayName = "";
            $scope.SSL_Enable = "0";
            $scope.Id = "0";
            $scope.Remarks = "";
        }


    }
]);

MyCortexControllers.controller("EmailTemplateController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        $scope.PageParameter = $routeParams.PageParameter;
        $scope.Id = "0";
        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.IsActive = true;
        $scope.TemplateName = "";
        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.Patient_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.TemplateTagList = [];
        if ($window.localStorage['UserTypeId'] == 3) {
            $http.get(baseUrl + '/api/EmailTemplate/TemplateTag_List/?Id=' + $scope.InstituteId).success(function (data) {
                $scope.TemplateTagList = data;
            });
        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }

        $scope.TemplateTagMappingList = [];
        $scope.TempMappinglist = function () {
            if ($scope.PageParameter == 1) {
                $scope.Type = "1"; //For Email
            }
            else if ($scope.PageParameter == 2) {
                $scope.Type = "2";//For Notification
            }
            else if ($scope.PageParameter == 3) {
                $scope.Type = "3";//For SMS
            }
            $http.get(baseUrl + '/api/EmailTemplate/EmailTemplateTagMapping_List/?Id=' + $scope.Type + '&Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.TemplateTagMappingList = data;
            });
        };

        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {
            if ($scope.PageParameter == 1) {
                $scope.Template = (CKEDITOR.instances.editor1.getData());
            }
            else if ($scope.PageParameter == 3) {
                $scope.Template = (CKEDITOR.instances.editor1.getData());
            }
            if (typeof ($scope.TemplateName) == "undefined" || $scope.TemplateName == "") {
                //alert("Please enter Template Name");
                toastr.warning("Please enter Template Name", "warning");
                return false;
            }

            else if (typeof ($scope.EmailSubject) == "undefined" || $scope.EmailSubject == "") {
                if ($scope.PageParameter == 1)
                    //alert("Please enter Email Subject");
                     toastr.warning("Please enter Email Subject", "warning");
                else
                    //alert("Please enter Notification Title");
                    warning("Please enter Notification Title", "warning");

                return false;
            }
            else if (typeof ($scope.Template) == "undefined" || $scope.Template == "") {
                if ($scope.PageParameter == 1)
                    //alert("Please enter Email Template");
                    toastr.warning("Please enter Email Template", "warning");
                else if ($scope.PageParameter == 3)
                    toastr.warning("Please enter SMS Template", "warning");
                else
                    //alert("Please enter Notification Message");
                    toastr.warning("Please enter Notification Message", "warning");

                return false;
            }
            else if (typeof ($scope.EmailSubject) == "undefined" || $scope.EmailSubject == "") {
                if ($scope.PageParameter == 3)
                    toastr.warning("Please enter SMS Template", "warning");
                return false;
            }
            return true;
        };

        /* Array initialization */
        $scope.EamilTemplateTaglist = [];
        $scope.EamilTemplateTaglist = [{
            'Id': 0,
            'Institution_Id': 0,
            'Email_TemplateId': '',
            'TagName': '',
            'Institution_Name': '',
            'IsActive': 0,
            'Created_By': ''
        }];

        $scope.EmailTemplateTagDetails = [];

        /* THIS IS FOR ADD/EDIT FUNCTION */
        $scope.EmailTemplateAddEdit = function () {
            if ($scope.Validationcontrols() == true) {

                var TemplateChildList = [],

                    rxp = /{([^}]+)}/g,

                    TagName = $scope.Template,

                    arr;
                while (arr = rxp.exec(TagName)) {
                    TemplateChildList.push({
                        'TempName': arr[1]
                    });
                }

                angular.forEach(TemplateChildList, function (value, index) {

                    angular.forEach($scope.EamilTemplateTaglist, function (Selected, index) {

                        var obj = {
                            Id: Selected.Id,
                            Institution_Id: $scope.InstituteId,
                            Email_TemplateId: $scope.PageParameter == 1 ? '1' : $scope.PageParameter == 2 ? '2' : $scope.PageParameter == 3 ? '3' : '',
                            TagName: value.TempName,
                            IsActive: Selected.IsActive,
                            Created_By: $scope.Patient_Id
                        }
                        $scope.EmailTemplateTagDetails.push(obj);
                    });
                });

                var obj = {
                    Id: $scope.Id,
                    Institution_Id: $scope.InstituteId,
                    TemplateType_Id: $scope.PageParameter == 1 ? '1' : $scope.PageParameter == 2 ? '2' : $scope.PageParameter == 3 ? '3' : '',
                    //Type_Id: $scope.Type,
                    EmailSubject: $scope.EmailSubject,
                    EmailTemplate: $scope.Template,
                    ModifiedUser_Id: $scope.Patient_Id,
                    Created_By: $scope.Patient_Id,
                    EmailTemplateTagList: $scope.EmailTemplateTagDetails,
                    TemplateName: $scope.TemplateName
                }
                $("#chatLoaderPV").show();
                $('#btnsave').attr("disabled", true);
                $http.post(baseUrl + '/api/EmailTemplate/EmailTemplateTag_AddEdit/', obj).success(function (data) {
                    //alert(data.Message);
                    toastr.success(data.Message, "success");
                    $("#chatLoaderPV").hide();
                    $('#btnsave').attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.ClearPopup();
                        $scope.EmailTemplatelist();
                    }
                    //$scope.AddId = data;
                    $("#chatLoaderPV").hide();
                    angular.element('#EmailTemplateModal').modal('hide');
                })
            }
        }

        /* THIS IS FOR LIST PROCEDURE */
        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];

        $scope.EmailTemplatelist = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active

                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }
                $http.get(baseUrl + '/api/EmailTemplate/EmailTemplateTag_List/?Id=' + $scope.InstituteId + '&IsActive=' + $scope.ISact + '&TemplateType_Id=' + $scope.PageParameter).success(function (data) {
                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.searchquery = "";
        /* FILTER THE LIST FUNCTION.*/
        $scope.fliterTemplateList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.Institution_Name).match(searchstring) ||
                        angular.lowercase(value.TemplateName).match(searchstring) ||
                        angular.lowercase(value.EmailSubject).match(searchstring) ||
                        angular.lowercase(value.EmailTemplate).match(searchstring);
                });
            }
        }

        /* THIS IS FOR VIEW FUNCTION */
        $scope.ViewEmailTempalte = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }

            $http.get(baseUrl + '/api/EmailTemplate/EmailTemplateDetails_View/?Id=' + $scope.Id).success(function (data) {

                $scope.DuplicatesId = data.Id;
                $scope.Institution_Id = data.Institution_Id;
                $scope.Institution_Name = data.Institution_Name;
                $scope.TemplateType_Id = data.TemplateType_Id;
                $scope.TemplateName = data.TemplateName;
                $scope.EmailSubject = data.EmailSubject;
                $scope.Template = data.EmailTemplate;
                $scope.Type = data.Type_Id.toString();
                $scope.ViewType_Name = data.Type_Name;
                $scope.TemplateTagMappingList = data.EmailTemplateTagList;
                if ($scope.TemplateType_Id == 1 || $scope.TemplateType_Id == 3) {
                    $scope.ViewTemplate = CKEDITOR.instances.editor1.setData($scope.Template);
                }
                $scope.TempMappinglist();
                $("#chatLoaderPV").hide();
            });
        }

        $scope.DeleteEmailTempalte = function (DId) {
            $scope.Id = DId;
            $scope.EmailTempalte_Delete();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.EmailTempalte_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Template?");
            if (del == true) {
                $http.get(baseUrl + '/api/EmailTemplate/EmailTemplate_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Template has been deactivated Successfully");
                    toastr.success("Template has been deactivated Successfully", "success");
                    $scope.EmailTemplatelist();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  ICD 10 details" + data;
                });
            }
        };

        /* THIS IS FOR ACTIVE FUNCTION*/
        $scope.ActiveEmailTempalte = function (PId) {
            $scope.Id = PId;
            $scope.EmailTempalte_Active();
        };

        /* 
            Calling the api method to activate the details of Email Template
            matching the specified Email Template Id,
            and redirected to the list page.
           */
        $scope.EmailTempalte_Active = function () {

            var Ins = confirm("Do you like to activate the selected Template?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/EmailTemplate/EmailTemplate_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Template has been activated successfully");
                    toastr.success("Selected Template has been activated successfully", "success");
                    $scope.EmailTemplatelist();
                }).error(function (data) {
                    $scope.error = "An error has occured while deleting ICD 1O records" + data;
                });
            }
        };

        $scope.Active_ErrorFunction = function () {
            //alert("Inactive Template cannot be edited");
            toastr.info("Inactive Template cannot be edited", "info");
        };

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }

        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddEmailTemplatePopUP = function () {
            angular.element('#EmailTemplateModal').modal('show');
            $('#btnsave').attr("disabled", false);
            $scope.ClearPopup();
        }

        /* THIS IS OPENING POP WINDOW FORM VIEW */
        $scope.ViewEmailTemplatePopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewEmailTempalte();
            angular.element('#EmailTemplateViewModal').modal('show');
        }

        /* THIS IS OPENING POP WINDOW FORM EDIT */
        $scope.EditEmailTemplate = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewEmailTempalte();
            angular.element('#EmailTemplateModal').modal('show');
            $('#btnsave').attr("disabled", false);
        }

        /* THIS IS CANCEL POPUP FUNCTION */
        $scope.CancelPopUP = function () {
            angular.element('#EmailTemplateModal').modal('hide')
        }

        /* THIS IS CANCEL VIEW POPUP FUNCTION*/
        $scope.CancelViewPopup = function () {
            angular.element('#EmailTemplateViewModal').modal('hide')
        }

        /* THIS IS CLEAR POPUP FUNCTION */
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.Institution_Id = "0";
            $scope.Institution_Name = "";
            $scope.TemplateType_Id = "0";
            $scope.TemplateName = "";
            $scope.EmailSubject = "";
            $scope.EmailTemplate = "";
            $scope.Type = "0";
            $scope.Template = "";
            if ($scope.PageParameter == 1) {
                $scope.Template = CKEDITOR.instances.editor1.setData($scope.Template);
            }
        }

        /* THIS IS OPENING POP WINDOW FORM LIST */
        $scope.ListICD10PopUP = function (EmailTemplateCatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;
            $scope.EmailTemplateList();
        }
    }
]);

MyCortexControllers.controller("EmailHistoryController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        $scope.PageParameter = $routeParams.PageParameter;

        $scope.currentTab = "1";
        $scope.Id = "0";
        $scope.IsActive = true;
        $scope.Filter_GenderId = "0";
        $scope.filter_NationalityId = "0";
        $scope.filter_EthinicGroupId = "0";
        $scope.filter_MaritalStatus = "0";
        $scope.filter_CountryId = "0";
        $scope.filter_StataId = "0";
        $scope.filter_CityId = "0";
        $scope.filter_BloodGroupId = "0";
        $scope.filter_GroupId = "0";
        $scope.Filter_PatientNo = "";
        $scope.filter_InsuranceId = "";
        $scope.filter_MOBILE_NO = "";
        $scope.filter_HomePhoneNo = "";
        $scope.filter_Email = "";
        $scope.loadCount = 0;
        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.TabClick = false;
        $scope.Patient_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.EthnicGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];
        $scope.BloodGroupList = [];
        $scope.GroupTypeList = [];

        $scope.Filter_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        }
        $scope.Filter_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }

        $scope.MessageingHistoryDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $scope.InstitutionBased_CountryStateList();
            }
        }

        $scope.TemplateTagList = [];
        $http.get(baseUrl + '/api/EmailTemplate/TemplateTag_List/?Id=' + $scope.InstituteId).success(function (data) {
            $scope.TemplateTagList = data;
        });
        $scope.ConfigCode = "EMAILHISTORY_DATE_LIMIT";
        $scope.ValidateDays = 14;
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.InstituteId)
            .success(function (data) {
                if (data[0] != undefined) {
                    $scope.ValidateDays = parseInt(data[0].ConfigValue);
                }
                else {
                    $scope.ValidateDays = 14;
                }
            });

        $scope.FilterValidation = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.Period_From = moment($scope.Period_From).format('DD-MMM-YYYY');
            $scope.Period_To = moment($scope.Period_To).format('DD-MMM-YYYY');

            if (typeof ($scope.Period_From) == "undefined" || $scope.Period_From == "") {
                //alert("Please select Period From");
                toastr.warning("Please select Period From", "warning");
                return false;
            }
            //else if (isDate($scope.Period_From) == false) {
            //    alert("Period From is in Invalid format, please enter dd-mm-yyyy");
            //    return false;
            //}
            if (typeof ($scope.Period_To) == "undefined" || $scope.Period_To == "") {
                //alert("Please select Period To");
                toastr.warning("Please select Period To", "warning");
                return false;
            }
            //else if (isDate($scope.Period_To) == false) {
            //    alert("Period To is in Invalid format, please enter dd-mm-yyyy");
            //    return false;
            //}

            var date1 = new Date($scope.Period_From);
            var date2 = new Date($scope.Period_To);
            var diffTime = Math.abs(date2 - date1);
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays >= $scope.ValidateDays) {
                //alert($scope.ValidateDays + '  ' + "days only allowed to filter");
                toastr.warning($scope.ValidateDays + '  ' + "days only allowed to filter", "warning");
                return false;
            }

            /*var date1 = new Date($scope.Period_From);
            var date2 = new Date($scope.Period_To);
            var diffTime = Math.abs(date2 - date1);
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays >= 14) {
                alert("14 days only allowed to filter");
                return false;
            }*/
            var retval = true;
            //if ((ParseDate($scope.Period_From) < ParseDate(today)))  {
            //    alert("FromDate Can Be Booked Only For Past");
            //    $scope.Period_From = DateFormatEdit($scope.Period_From);
            //    $scope.Period_To = DateFormatEdit($scope.Period_To);
            //    retval = false;
            //    return false;
            //}

            //if ((ParseDate($scope.Period_To) < ParseDate(today)))  {
            //    alert("To Date Can Be Booked Only For Past");
            //    $scope.Period_From = DateFormatEdit($scope.Period_From);
            //    $scope.Period_To = DateFormatEdit($scope.Period_To);
            //    retval = false;
            //    return false;
            //}

            if (($scope.Period_From != "") && ($scope.Period_To != "")) {

                if ((ParseDate($scope.Period_From) > ParseDate($scope.Period_To))) {
                    //alert("From Date should not be greater than To Date");
                    toastr.warning("From Date should not be greater than To Date", "warning");
                    $scope.Period_From = DateFormatEdit($scope.Period_From);
                    $scope.Period_To = DateFormatEdit($scope.Period_To);
                    retval = false;
                    return false;
                }
            }

            $scope.Period_From = DateFormatEdit($scope.Period_From);
            $scope.Period_To = DateFormatEdit($scope.Period_To);
            return retval;
        };

        $scope.DefaultCountryState = function () {
            $scope.CountryId = $scope.InsCountryId;
            $scope.StateId = $scope.InsStateId;
            $scope.Country_onChange();
            $scope.CityId = $scope.InsCityId;
            $scope.State_onChange();

            var cId = $scope.CountryId;
            if (cId != "0") {

            }
        }
        $scope.InstitutionBased_CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;

            });
        }
        $scope.Country_onChange = function () {
            $scope.StateNameList = $ff($scope.State_Template, { CountryId: $scope.CountryId });
            setTimeout(function () {
                jQuery("#stateselectpicker").selectpicker('refresh')
            }, 500);
        };
        $scope.StateClearFunction = function () {
            $scope.StateId = "0";
        };
        $scope.State_onChange = function () {
            $scope.CityNameList = $ff($scope.City_Template, { StateId: $scope.StateId });
        };
        $scope.LocationClearFunction = function () {
            $scope.CityId = "0";
        };

        $scope.TemplateTagMappingList = [];
        $scope.TempMappinglist = function () {
            $scope.Type = "1"; //For Email
            $http.get(baseUrl + '/api/EmailTemplate/EmailTemplateTagMapping_List/?Id=' + $scope.Type + '&Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.TemplateTagMappingList = data;
            });
        };

        $scope.Emailemptydata = [];
        $scope.EmailrowCollectionFilter = [];
        $scope.Emaildatalist = [];
        $scope.EmailHistoryDetailslist = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                if ($scope.FilterValidation() == true) {
                    $("#chatLoaderPV").show();
                    $http.get(baseUrl + '/api/SendEmail/EmailHistory_List/?Id=' + $scope.Id + '&Period_From=' + $scope.Period_From + '&Period_To=' + $scope.Period_To + '&Email_Stauts=' + $scope.Email_Stauts
                        + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId + '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' + $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus + '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId + '&Group_Id=' + $scope.filter_GroupId + '&IsActive=' + $scope.ActiveStatus + '&INSTITUTION_ID=' + $window.localStorage['InstitutionId']
                        + '&TemplateType_Id=' + $scope.PageParameter + '&Login_Session_Id=' + $scope.LoginSessionId
                    ).success(function (data) {
                        //$scope.Emailemptydata = [];
                        $scope.EmailrowCollectionFilter = [];
                        $scope.Emaildatalist = data;
                        //$scope.EmailrowCollectionFilter = data;
                        $scope.EmailrowCollectionFilter = angular.copy($scope.Emaildatalist);
                        $("#chatLoaderPV").hide();
                    });
                }
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.Email_Stauts = "0"
        $scope.searchquerylist = "";
        //$scope.EmailrowCollectionFilter =[];
        /* FILTER THE LIST FUNCTION.*/
        $scope.filterEmailHistoryList = function () {
            // $scope.EmailStatusList();
            $scope.EmailrowCollectionFilter = [];
            var searchstring = angular.lowercase($scope.searchquerylist);
            /* if ($scope.searchquerylist == "") {
                 if ($scope.EmailrowCollectionFilter.length > 0) {
                     $scope.EmailrowCollectionFilter = angular.copy($scope.Emaildatalist);
                 }
             }*/
            if ($scope.searchquerylist == "") {
                //  $scope.EmailrowCollectionFilter = [];
                $scope.EmailrowCollectionFilter = angular.copy($scope.Emaildatalist);
            }
            else {
                $scope.EmailrowCollectionFilter = $ff($scope.Emaildatalist, function (value) {
                    if (value.Email_Status == 0) {
                        val = "";
                    }
                    else {
                        val = value.Email_Status;
                    }
                    return angular.lowercase(value.EmailId).match(searchstring) ||
                        angular.lowercase(value.TypeName).match(searchstring) ||
                        angular.lowercase(value.FullName).match(searchstring) ||
                        angular.lowercase(value.TemplateName).match(searchstring) ||
                        angular.lowercase(value.EmailSubject).match(searchstring) ||
                        angular.lowercase(value.EmailTemplate).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Send_Date, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(val).match(searchstring) ||
                        angular.lowercase(value.Email_Error_Reason).match(searchstring) ||
                        angular.lowercase(value.EmailStatusType).match(searchstring);
                });
            }
        }

        $scope.ResetPatientFilter = function () {
            $scope.Filter_PatientNo = "";
            $scope.filter_InsuranceId = "";
            $scope.Filter_GenderId = "0";
            $scope.filter_NationalityId = "0";
            $scope.filter_EthinicGroupId = "0";
            $scope.filter_MOBILE_NO = "";
            $scope.filter_HomePhoneNo = "";
            $scope.filter_Email = "";
            $scope.filter_MaritalStatus = "0";
            $scope.filter_CountryId = "0";
            $scope.filter_StataId = "0";
            $scope.filter_CityId = "0";
            $scope.filter_BloodGroupId = "0";
            $scope.filter_GroupId = "0";
        }
        $scope.EmailBody_ViewModel = function (EmailId, EmailSubject, EmailBody) {
            angular.element('#EmailBody_ViewModel').modal('show');
            $scope.EmailId = EmailId;
            $scope.EmailSubject = EmailSubject;
            $scope.Generated_Template = EmailBody;
        }
        $scope.EmailBody_CancelModel = function () {
            angular.element('#EmailBody_ViewModel').modal('hide');
        }

    }
]);

MyCortexControllers.controller("SendEmailController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        $scope.PageParameter = $routeParams.PageParameter;
        $scope.UserId = $window.localStorage['UserId'];
        $scope.InstitutionId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
        $scope.UserTypeId = "0";
        $scope.Template_Id = "0";
        $scope.Usertypelistdata = [];
        $scope.SentEmailTemplateList = [];
        $scope.SendEmailUserList = [];
        $scope.Generated_TemplateList = [];
        $scope.Filter_SendEmailUserList = [];
        $scope.flag = "0";
        //More Filter Initialization
        $scope.Filter_PatientNo = "";
        $scope.filter_InsuranceId = "";
        $scope.filter_MOBILE_NO = "";
        $scope.filter_HomePhoneNo = "";
        $scope.filter_Email = "";
        $scope.Filter_GenderId = "0";
        $scope.filter_NationalityId = "0";
        $scope.filter_EthinicGroupId = "0";
        $scope.filter_MaritalStatus = "0";
        $scope.filter_CountryId = "0";
        $scope.filter_StataId = "0";
        $scope.filter_CityId = "0";
        $scope.filter_BloodGroupId = "0";
        $scope.filter_GroupId = "0";
        $scope.EthnicGroupList = [];
        $scope.BloodGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.GroupTypeList = [];
        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.loadCount = 0;
        $scope.TabClick = false;

        $scope.ResetPatientFilter = function () {
            $scope.Filter_PatientNo = "";
            $scope.filter_InsuranceId = "";
            $scope.Filter_GenderId = "0";
            $scope.filter_NationalityId = "0";
            $scope.filter_EthinicGroupId = "0";
            $scope.filter_MOBILE_NO = "";
            $scope.filter_HomePhoneNo = "";
            $scope.filter_Email = "";
            $scope.filter_MaritalStatus = "0";
            $scope.filter_CountryId = "0";
            $scope.filter_StataId = "0";
            $scope.filter_CityId = "0";
            $scope.filter_BloodGroupId = "0";
            $scope.filter_GroupId = "0";
            $scope.Get_SendEmail_UserList();
        }

        $scope.Filter_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        }
        $scope.Filter_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }

        $scope.SendEmailDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/?Institution_Id=' + $scope.InstitutionId).success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $scope.CountryStateList();
            }
        }

        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];

        $scope.CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;
            });
        }
        //List Page Pagination.
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.GenerateTemplate = function (GetId, EmailId) {
            if (typeof ($scope.Template_Id) == "undefined" || $scope.Template_Id == "0") {
                //alert("Please select Template");
                toastr.warning("Please select Template", "warning");
                return false;
            }
            else {
                angular.element('#Template_PreviewModel').modal('show');
                $scope.PrimaryKeyId = GetId;
                $http.post(baseUrl + '/api/SendEmail/GenerateTemplate/?Id=' + $scope.PrimaryKeyId + '&Template_Id=' + $scope.Template_Id + '&Institution_Id=' + $scope.InstitutionId + '&TemplateType_Id=' + $scope.PageParameter).success(function (data) {
                    $scope.Generated_TemplateList = data;
                    $scope.EmailSubject = $scope.Generated_TemplateList.Email_Subject;
                    $scope.Generated_Template = $scope.Generated_TemplateList.Email_Body;
                    $scope.EmailId = EmailId;
                });
            }
        }

        $scope.GenerateSMSTemplate = function (GetId, MobileNO) {
            if (typeof ($scope.Template_Id) == "undefined" || $scope.Template_Id == "0") {
                toastr.warning("Please select Template", "warning");
                return false;
            }
            else {
                angular.element('#Template_PreviewModel').modal('show');
                $scope.PrimaryKeyId = GetId;
                $http.post(baseUrl + '/api/SendEmail/GenerateTemplate/?Id=' + $scope.PrimaryKeyId + '&Template_Id=' + $scope.Template_Id + '&Institution_Id=' + $scope.InstitutionId + '&TemplateType_Id=' + $scope.PageParameter).success(function (data) {
                    $scope.Generated_TemplateList = data;
                    $scope.EmailSubject = $scope.Generated_TemplateList.Email_Subject;
                    $scope.Generated_Template = $scope.Generated_TemplateList.Email_Body;
                    $scope.MobileNO = MobileNO;
                });
            }
        }

        /* Get the List of User Type */
        if ($window.localStorage['UserTypeId'] == 3) {
            $http.get(baseUrl + '/api/SendEmail/Email_UserTypeList/').success(function (data) {
                $scope.Usertypelistdata = data;
            });


            /*Get the List of Template */
            $http.get(baseUrl + '/api/SendEmail/Email_TemplateTypeList/?InstitutionId=' + $scope.InstitutionId + '&TemplateType_Id=' + $scope.PageParameter).success(function (data) {
                $scope.SentEmailTemplateList = data;
            });
        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }
        /* Get the list of User for Send Email */
        $scope.Get_SendEmail_UserList = function () {

            if (typeof ($scope.UserTypeId) == "undefined" || $scope.UserTypeId == "0") {
                //alert("Please select User Type");
                toastr.warning("Please select User Type", "warning");
                return false;
            }
            else if (typeof ($scope.Template_Id) == "undefined" || $scope.Template_Id == "0") {
                //alert("Please select Template");
                toastr.warning("Please select Template", "warning");
                return false;
            }
            else {
                $("#chatLoaderPV").show();
                $http.get(baseUrl + '/api/SendEmail/Get_SendEmail_UserList/?UserTypeId=' + $scope.UserTypeId + '&Institution_Id=' + $scope.InstitutionId + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId + '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' + $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus + '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId + '&Group_Id=' + $scope.filter_GroupId).success(function (data) {
                    $scope.emptydata = [];
                    $scope.SendEmailUserList = data;
                    $scope.Filter_SendEmailUserList = angular.copy($scope.SendEmailUserList);
                    if ($scope.Filter_SendEmailUserList.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                });
            }
        }
        $scope.searchquery = "";
        /* FILTER THE LIST FUNCTION.*/
        $scope.ListFilter = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.Filter_SendEmailUserList = angular.copy($scope.SendEmailUserList);
            }
            else {
                $scope.Filter_SendEmailUserList = $ff($scope.SendEmailUserList, function (value) {
                    return angular.lowercase(value.UserName).match(searchstring) ||
                        angular.lowercase(value.UserType).match(searchstring) ||
                        angular.lowercase(value.EmailId).match(searchstring);
                });
                if ($scope.Filter_SendEmailUserList.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                }
            }
        }

        $scope.checkAll = function () {
            if ($scope.SelectedAllUser == true) {
                $scope.SelectedAllUser = true;
            } else {
                $scope.SelectedAllUser = false;
            }
            angular.forEach($scope.Filter_SendEmailUserList, function (row) {
                row.SelectedUser = $scope.SelectedAllUser;
            });
        };

        $scope.SendEmail_Insert = function () {

            var cnt = ($filter('filter')($scope.Filter_SendEmailUserList, 'true')).length;
            if (cnt == 0) {
                //alert("Please select atleast one User");
                toastr.warning("Please select atleast one User", "warning");
            }
            else if (typeof ($scope.Template_Id) == "undefined" || $scope.Template_Id == "0") {
                //alert("Please select Template");
                toastr.warning("Please select Template", "warning");
                return false;
            }
            else {
                $("#chatLoaderPV").show();
                var msgtype = "email";
                if ($scope.PageParameter == "2")
                    msgtype = "notification";
                else if ($scope.PageParameter == "3")
                    msgtype = "sms";
                var msg = confirm("Do you like to send " + msgtype + " for selected users?");
                if (msg == true) {
                    $scope.SelectedUserList = [];
                    angular.forEach($scope.Filter_SendEmailUserList, function (SelectedUser, index) {
                        if (SelectedUser.SelectedUser == true) {

                            var obj = {
                                UserId: SelectedUser.Id,
                                Template_Id: $scope.Template_Id,
                                Created_By: $scope.UserId,
                                Institution_Id: $scope.InstitutionId,
                                TemplateType_Id: $scope.PageParameter
                            };
                            $('#btnsave').attr("disabled", true);
                            $scope.SelectedUserList.push(obj);
                        }
                    });
                    $http.post(baseUrl + '/api/SendEmail/SendEmail_AddEdit/', $scope.SelectedUserList).success(function (data) {
                        //alert(data.Message);
                        if (data.ReturnFlag == 1) {
                            toastr.success(data.Message, "success");
                        }
                        else if (data.ReturnFlag == 0) {
                            toastr.info(data.Message, "info");
                        }
                        $('#btnsave').attr("disabled", false);
                        if (data.ReturnFlag == 1) {
                            $scope.ClearValues();
                            $scope.Get_SendEmail_UserList();
                        }
                        $("#chatLoaderPV").hide();
                    });

                }
            }
        }
        $scope.ClearValues = function () {
            angular.forEach($scope.Filter_SendEmailUserList, function (SelectedUser, index) {
                SelectedUser.SelectedUser = false;
            });
            $scope.SelectedAllUser = false;
        }
        $scope.CancelPreview_PopUp = function () {
            angular.element('#Template_PreviewModel').modal('hide');
        }
    }
]);

MyCortexControllers.controller("EmailUndeliveredController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        $scope.PageParameter = $routeParams.PageParameter;
        $scope.currentTab = "1";
        $scope.Id = "0";
        $scope.IsActive = 1;
        $scope.Filter_GenderId = "0";
        $scope.filter_NationalityId = "0";
        $scope.filter_EthinicGroupId = "0";
        $scope.filter_MaritalStatus = "0";
        $scope.filter_CountryId = "0";
        $scope.filter_StataId = "0";
        $scope.filter_CityId = "0";
        $scope.filter_BloodGroupId = "0";
        $scope.filter_GroupId = "0";
        $scope.Filter_PatientNo = "";
        $scope.filter_InsuranceId = "";
        $scope.filter_MOBILE_NO = "";
        $scope.filter_HomePhoneNo = "";
        $scope.filter_Email = "";
        $scope.loadCount = 0;
        $scope.TabClick = false;

        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.Patient_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']

        $scope.GenderList = [];
        $scope.NationalityList = [];
        $scope.EthnicGroupList = [];
        $scope.MaritalStatusList = [];
        $scope.State_Template = [];
        $scope.City_Template = [];
        $scope.CountryNameList = [];
        $scope.StateNameList = [];
        $scope.CityNameList = [];
        $scope.BloodGroupList = [];
        $scope.GroupTypeList = [];

        $scope.MessageUndeliveredDropdownList = function () {
            if ($scope.TabClick == false) {
                $scope.TabClick = true;
                alert("s");
                $http.get(baseUrl + '/api/Common/GenderList/').success(function (data) {
                    $scope.GenderList = data;
                });
                $http.get(baseUrl + '/api/Common/NationalityList/').success(function (data) {
                    $scope.NationalityList = data;
                });
                $http.get(baseUrl + '/api/Common/EthnicGroupList/').success(function (data) {
                    $scope.EthnicGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/MaritalStatusList/').success(function (data) {
                    $scope.MaritalStatusList = data;
                });
                $http.get(baseUrl + '/api/Common/BloodGroupList/').success(function (data) {
                    $scope.BloodGroupList = data;
                });
                $http.get(baseUrl + '/api/Common/GroupTypeList/').success(function (data) {
                    $scope.GroupTypeList = data;
                });
                $scope.InstitutionBased_CountryStateList();
            }
        }

        $scope.Filter_Country_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_StateList/?CountryId=' + $scope.filter_CountryId).success(function (data) {
                    $scope.StateNameList = data;
                    $scope.CityNameList = [];
                    $scope.filter_CityId = "0";
                });
            }
        }
        $scope.Filter_State_onChange = function () {
            if ($scope.loadCount == 0) {
                $http.get(baseUrl + '/api/Common/Get_LocationList/?CountryId=' + $scope.filter_CountryId + '&StateId=' + $scope.filter_StataId).success(function (data) {
                    $scope.CityNameList = data;
                });
            }
        }

        $scope.InstitutionBased_CountryStateList = function () {
            $http.get(baseUrl + '/api/Common/CountryList/').success(function (data) {
                $scope.CountryNameList = data;
            });
        }
        $scope.Country_onChange = function () {
            $scope.StateNameList = $ff($scope.State_Template, { CountryId: $scope.CountryId });
            setTimeout(function () {
                jQuery("#stateselectpicker").selectpicker('refresh')
            }, 500);
        };
        $scope.StateClearFunction = function () {
            $scope.StateId = "0";
        };
        $scope.State_onChange = function () {
            $scope.CityNameList = $ff($scope.City_Template, { StateId: $scope.StateId });
        };
        $scope.LocationClearFunction = function () {
            $scope.CityId = "0";
        };

        /*    $scope.Filter_Country_onChange = function () {
                $scope.StateNameList = $ff($scope.State_Template, { CountryId: $scope.filter_CountryId });
                setTimeout(function () {
                    jQuery("#stateselectpicker").selectpicker('refresh')
                }, 500);
            };
            $scope.Filter_State_onChange = function () {
                $scope.CityNameList = $ff($scope.City_Template, { StateId: $scope.filter_StataId });
            };
            */
        $scope.FilterValidation = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.Period_From = moment($scope.Period_From).format('DD-MMM-YYYY');
            $scope.Period_To = moment($scope.Period_To).format('DD-MMM-YYYY');

            if (typeof ($scope.Period_From) == "undefined" || $scope.Period_From == "") {
                //alert("Please select Period From");
                toastr.warning("Please select Period From", "warning");

                return false;
            }
            //else if (isDate($scope.Period_From) == false) {
            //    alert("Period From is in Invalid format, please enter dd-mm-yyyy");
            //    return false;
            //}
            if (typeof ($scope.Period_To) == "undefined" || $scope.Period_To == "") {
                //alert("Please select Period To");
                toastr.warning("Please select Period To", "warning");
                return false;
            }
            //else if (isDate($scope.Period_To) == false) {
            //    alert("Period To is in Invalid format, please enter dd-mm-yyyy");
            //    return false;
            //}
            var date1 = new Date($scope.Period_From);
            var date2 = new Date($scope.Period_To);
            var diffTime = Math.abs(date2 - date1);
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays >= 14) {
                //alert("14 days only allowed to filter");
                toastr.warning("14 days only allowed to filter", "warning");
                return false;
            }
            //if ((ParseDate($scope.Period_From) < ParseDate(today))) {
            //    //alert("FromDate Can Be Booked Only For Past");
            //    toastr.warning("FromDate Can Be Booked Only For Past", "warning");
            //    $scope.Period_From = DateFormatEdit($scope.Period_From);
            //    $scope.Period_To = DateFormatEdit($scope.Period_From);
            //    return false;
            //}
            //if ((ParseDate($scope.Period_To) < ParseDate(today))) {
            //    //alert("To Date Can Be Booked Only For Past");
            //    toastr.warning("To Date Can Be Booked Only For Past", "warning");
            //    $scope.Period_From = DateFormatEdit($scope.Period_From);
            //    $scope.Period_To = DateFormatEdit($scope.Period_From);
            //    return false;
            //}
            if (($scope.Period_From != "") && ($scope.Period_To != "")) {
                if ((ParseDate($scope.Period_From) > ParseDate($scope.Period_To))) {
                    //alert("From Date should not be greater than To Date");
                    toastr.warning("From Date should not be greater than To Date", "warning");
                    $scope.Period_From = DateFormatEdit($scope.Period_From);
                    $scope.Period_To = DateFormatEdit($scope.Period_To);
                    return false;
                }
            }
            $scope.Period_From = DateFormatEdit($scope.Period_From);
            $scope.Period_To = DateFormatEdit($scope.Period_To);
            return true;
        };


        $scope.Emailemptydata = [];
        $scope.EmailrowCollectionFilter = [];
        $scope.Emaildatalist = [];
        $scope.UndeliveredEmailDetailslist = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                if ($scope.FilterValidation() == true) {
                    $("#chatLoaderPV").show();
                    $scope.Email_Stauts = "2";
                    $scope.Period_From = document.getElementById("Period_From").value;
                    $scope.Period_To = document.getElementById("Period_To").value;

                    $scope.Period_From = moment($scope.Period_From).format('YYYY-MM-DD');
                    $scope.Period_To = moment($scope.Period_To).format('YYYY-MM-DD');

                    $http.get(baseUrl + '/api/SendEmail/EmailHistory_List/?Id=' + $scope.Id + '&Period_From=' + $scope.Period_From + '&Period_To=' + $scope.Period_To + '&Email_Stauts=' + $scope.Email_Stauts
                        + '&PATIENTNO=' + $scope.Filter_PatientNo + '&INSURANCEID=' + $scope.filter_InsuranceId + '&GENDER_ID=' + $scope.Filter_GenderId + '&NATIONALITY_ID=' + $scope.filter_NationalityId + '&ETHINICGROUP_ID=' + $scope.filter_EthinicGroupId + '&MOBILE_NO=' + $scope.filter_MOBILE_NO + '&HOME_PHONENO=' + $scope.filter_HomePhoneNo + '&EMAILID=' + $scope.filter_Email + '&MARITALSTATUS_ID=' + $scope.filter_MaritalStatus + '&COUNTRY_ID=' + $scope.filter_CountryId + '&STATE_ID=' + $scope.filter_StataId + '&CITY_ID=' + $scope.filter_CityId + '&BLOODGROUP_ID=' + $scope.filter_BloodGroupId + '&Group_Id=' + $scope.filter_GroupId + '&IsActive=' + $scope.IsActive + '&INSTITUTION_ID=' + $window.localStorage['InstitutionId']
                        + '&TemplateType_Id=' + $scope.PageParameter + '&Login_Session_Id=' + $scope.LoginSessionId
                    ).success(function (data) {
                        $scope.Emailemptydata = [];
                        $scope.EmailrowCollectionFilter = [];
                        $scope.Emailemptydata = data;
                        $scope.Emaildatalist = data;
                        $scope.EmailrowCollectionFilter = angular.copy($scope.Emailemptydata);
                        $("#chatLoaderPV").hide();
                    });
                }
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.searchquerylist = "";

        //$scope.EmailrowCollectionFilter =[];
        /* FILTER THE LIST FUNCTION.*/
        $scope.filterEmailHistoryList = function () {
            $scope.EmailrowCollectionFilter = [];
            var searchstring = angular.lowercase($scope.searchquerylist);
            if ($scope.searchquerylist == "") {
                if ($scope.Emaildatalist.length > 0) {
                    $scope.EmailrowCollectionFilter = angular.copy($scope.Emaildatalist);
                }
            }
            else {
                $scope.EmailrowCollectionFilter = $ff($scope.Emaildatalist, function (value) {

                    return angular.lowercase(value.FullName).match(searchstring) ||
                        angular.lowercase(value.TypeName).match(searchstring) ||
                        angular.lowercase(value.TemplateName).match(searchstring) ||
                        angular.lowercase(value.EmailSubject).match(searchstring) ||
                        angular.lowercase(value.EmailTemplate).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.Send_Date, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(value.Email_Error_Reason).match(searchstring);
                });
            }
        }


        $scope.ResetPatientFilter = function () {
            $scope.Filter_PatientNo = "";
            $scope.filter_InsuranceId = "";
            $scope.Filter_GenderId = "0";
            $scope.filter_NationalityId = "0";
            $scope.filter_EthinicGroupId = "0";
            $scope.filter_MOBILE_NO = "";
            $scope.filter_HomePhoneNo = "";
            $scope.filter_Email = "";
            $scope.filter_MaritalStatus = "0";
            $scope.filter_CountryId = "0";
            $scope.filter_StataId = "0";
            $scope.filter_CityId = "0";
            $scope.filter_BloodGroupId = "0";
            $scope.filter_GroupId = "0";
        }
        $scope.Generated_TemplateList = [];
        $scope.GenerateTemplate = function (EmailTemplate, EmailId, EmailSubject) {
            angular.element('#Template_PreviewModel').modal('show');
            $scope.EmailSubject = EmailSubject;
            $scope.Generated_Template = EmailTemplate;
            $scope.EmailId = EmailId;
        }
        $scope.ClearValues = function () {
            angular.forEach($scope.Filter_SendEmailUserList, function (SelectedUser, index) {
                SelectedUser.SelectedUser = false;
            });
            $scope.SelectedAllUser = false;
        }
        $scope.CancelPreview_PopUp = function () {
            angular.element('#Template_PreviewModel').modal('hide');
        }

        $scope.checkAll = function () {
            if ($scope.SelectedAllUser == true) {
                $scope.SelectedAllUser = true;
            } else {
                $scope.SelectedAllUser = false;
            }
            angular.forEach($scope.EmailrowCollectionFilter, function (row) {
                row.SelectedUser = $scope.SelectedAllUser;
            });
        };

        $scope.UndeliveredEmail_Insert = function () {

            var cnt = ($filter('filter')($scope.EmailrowCollectionFilter, 'true')).length;
            if (cnt == 0) {
                //alert("Please select atleast one User");
                toastr.warning("Please select atleast one User", "warning");
            }
            else {
                var msg = confirm("Do you like to Resend the Email for Selected User?");
                if (msg == true) {
                    $("#chatLoaderPV").show();
                    $scope.SelectedUserList = [];
                    angular.forEach($scope.EmailrowCollectionFilter, function (SelectedUser, index) {
                        if (SelectedUser.SelectedUser == true) {

                            var obj = {
                                UserId: SelectedUser.Id,
                                Template_Id: SelectedUser.Template_Id,
                                Created_By: $scope.UserId,
                                Institution_Id: $scope.InstituteId,
                                EmailId: SelectedUser.EmailId,
                                TemplateType_Id: $scope.PageParameter
                            };
                            $('#btnsave').attr("disabled", true);
                            $scope.SelectedUserList.push(obj);
                        }
                    });
                    $http.post(baseUrl + '/api/SendEmail/UndeliveredEmail_Insert/', $scope.SelectedUserList).success(function (data) {
                        //alert(data.Message);
                        toastr.success(data.Message, "success");
                        $('#btnsave').attr("disabled", false);
                        if (data.ReturnFlag == 1) {
                            $scope.ClearValues();
                            $scope.UndeliveredEmailDetailslist();
                        }
                        $("#chatLoaderPV").hide();
                    });
                }
            }
        }

        $scope.UndeliveredEmail_EditModel = function (EmailTemplate, EmailId, EmailSubject, SendEmail_Id, UserId) {
            angular.element('#EditModal').modal('show');
            $('#btnsave').attr("disabled", false);
            $('#send').attr("disabled", false);
            $scope.SendEmail_Id = SendEmail_Id;
            $scope.EmailSubject = EmailSubject;
            $scope.Generated_Template = EmailTemplate;
            $scope.PrimaryKeyId = UserId;
            if ($scope.PageParameter == 2) {
                $scope.EditEmail_Body = EmailTemplate;
            }
            if ($scope.PageParameter == 1) {
                $scope.Generated_Template = CKEDITOR.instances.editor1.setData($scope.Generated_Template);
            }
            $scope.EmailId = EmailId;
        }

        $scope.UndeliveredEmail_Edit = function () {
            $("#chatLoaderPV").show();
            $('#save').attr("disabled", true);
            $('#send').attr("disabled", true);
            if ($scope.PageParameter == 1) {
                $scope.EditEmail_Body = (CKEDITOR.instances.editor1.getData());
            }
            $scope.SelectedUserList = [];
            var obj = {
                Id: $scope.SendEmail_Id,
                UserId: $scope.PrimaryKeyId,
                Created_By: $window.localStorage['UserId'],
                Institution_Id: $scope.InstituteId,
                EmailId: $scope.EmailId,
                Email_Body: $scope.EditEmail_Body,
                Email_Subject: $scope.EmailSubject
            };
            $http.post(baseUrl + '/api/SendEmail/UndeliveredEmail_Edit/', obj).success(function (data) {
                //alert(data.Message);
                if (data.ReturnFlag == 1) {
                    toastr.success(data.Message, "success");
                }
                else if (data.ReturnFlag == 0) {
                    toastr.info(data.Message, "info");
                }
                $('#save').attr("disabled", false);
                $('#send').attr("disabled", false);
                if (data.ReturnFlag == 1) {
                    angular.element('#EditModal').modal('hide');
                    $scope.UndeliveredEmailDetailslist();
                }
                $("#chatLoaderPV").hide();
            });
        }
        $scope.UndeliveredEmail_Cancel = function () {
            angular.element('#EditModal').modal('hide');
        }
    }
]);

MyCortexControllers.controller("CommonController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff) {
        $scope.DecryptInput = "";
        $scope.Input_Type = 1;
        if ($window.localStorage['UserTypeId'] == 1) {
            $scope.EncryptDecryptvalue = function () {
                var obj = {
                    InputType: $scope.Input_Type,
                    DecryptInput: $scope.DecryptInput
                };
                $http.post(baseUrl + '/api/Common/EncryptDecrypt', obj).success(function (data) {
                    $scope.DecryptResult = data;
                })
                    .error(function () {
                        $scope.DecryptResult = "Invalid format";
                    });
            };
        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }
    }
]);
MyCortexControllers.controller("NotificationViewController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        if ($window.localStorage['UserTypeId'] == 3 || $window.localStorage['UserTypeId'] == 5 || $window.localStorage['UserTypeId'] == 2 || $window.localStorage['UserTypeId'] == 7 || $window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 6) {
            $scope.User_Id = $window.localStorage['UserId'];
            $scope.listdata = [];
            $scope.current_page = 1;
            $scope.page_size = $window.localStorage['Pagesize'];
            $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

            $scope.rembemberCurrentPage = function (p) {
                $scope.current_page = p
            }
            $scope.changeBackColor = [];
            $scope.NotificationUpdate = function (index1, SendEmailId, MessageSubject, MessageContent, ReadFlag) {
                $scope.changeBackColor = [];
                angular.element('#NotificationViewModel').modal('show');
                $scope.SendEmail_Id = SendEmailId;
                $scope.MessageSubject = MessageSubject;
                $scope.MessageContent = MessageContent;
                if (ReadFlag == 1) {
                    var obj = {
                        Id: $scope.SendEmail_Id,
                    }
                    $http.post(baseUrl + '/api/SendEmail/Notification_Update/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {

                        angular.forEach($scope.UserNotificationList_Filter, function (row, index) {
                            if (index == index1)
                                row.ReadFlag = "2";
                            $('#id' + index1).removeClass('tdBackColor');
                            $('#msubj' + index1).removeClass('tdBackColor');
                            $('#mbody' + index1).removeClass('tdBackColor');
                            $('#msend' + index1).removeClass('tdBackColor');
                            $('#viewid' + index1).removeClass('tdBackColor');


                        });
                    });
                    $http.get(baseUrl + '/api/SendEmail/CountNotification_Update/?User_Id=' + $scope.User_Id).success(function (data) {
                        document.getElementById("UnreadCountIcon").title = "Unread Notifications: " + data.NotificationUnread;
                        var NotificationCount = document.getElementById('notificationCount');
                        NotificationCount.textContent = data.NotificationUnread;
                    });

                }


            }
            $scope.UserNotificationList = [];
            $scope.flag = 0;
            $scope.UserNotificationList_Filter = [];
            $scope.searchquery = "";
            $scope.NotificationList = function () {
                $http.get(baseUrl + '/api/SendEmail/User_get_NotificationList/?User_Id=' + $scope.User_Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.emptydata = [];
                    $scope.UserNotificationList = data.usernotification;
                    $scope.UserNotificationList_Filter = angular.copy($scope.UserNotificationList);
                    if ($scope.UserNotificationList_Filter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    document.getElementById("UnreadCountIcon").title = "Unread Notifications: " + data.NotificationUnread;
                    var NotificationCount = document.getElementById('notificationCount');
                    NotificationCount.textContent = data.NotificationUnread;
                });

            }
            $scope.SelectedPatientId = $window.localStorage['UserId'];
            $scope.MyAppointmentsNotification = function () {
                $("#chatLoaderPV").show();
                $scope.ChronicDetails();
                $http.get(baseUrl + '/api/User/DoctorAppoinmentsList/?PatientId=' + $scope.SelectedPatientId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //var Patient = parseInt(window.localStorage['SelectedPatientId']);
                    $scope.MyAppoinmentdata = data;
                    //angular.forEach($scope.MyAppoinmentdata, function (value, index) {
                    //    if (Patient === value.Patient_Id) {
                    //        $scope.MyAppointment.push(value);
                    //    }
                    //});
                });
            }

            $scope.DefaultChronic = function () {
                var Brain = document.getElementById('Brain');
                Brain.innerHTML = '<img src="images/image004.png">';

                var detail = document.getElementById('Alzheimer');
                detail.innerHTML = "";
                var detail = document.getElementById('Arthritis');
                detail.innerHTML = "";
                var detail = document.getElementById('Epilepsy');
                detail.innerHTML = "";
                var detail = document.getElementById('Parkinson_Disease');
                detail.innerHTML = "";
                var detail = document.getElementById('Sclerosis');
                detail.innerHTML = "";
                var detail = document.getElementById('Stroke');
                detail.innerHTML = "";

                var Lungs = document.getElementById('Lungs');
                Lungs.innerHTML = '<img src="images/image006.png">';

                var detail = document.getElementById('Pulmonary_Disease');
                detail.innerHTML = "";
                var detail = document.getElementById('Lung_Disease');
                detail.innerHTML = "";
                var detail = document.getElementById('Asthma');
                detail.innerHTML = "";
                var detail = document.getElementById('Cancer');
                detail.innerHTML = "";
                var detail = document.getElementById('Diabetes');
                detail.innerHTML = "";

                var Heart = document.getElementById('Heart');
                Heart.innerHTML = '<img src="images/image009.png">';
                var detail = document.getElementById('Heart_Disease');
                detail.innerHTML = "";
                var detail = document.getElementById('Hypertension');
                detail.innerHTML = "";
                var detail = document.getElementById('Kidney_Disease');
                detail.innerHTML = "";
            }

            $scope.ChronicDetails = function () {
                $http.get(baseUrl + '/api/User/Chronic_Conditions/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                    if (data.length !== 0 && data != null && data != undefined) {
                        $scope.DefaultChronic();
                        for (let i = 0; i < data.length; i++) {
                            if (data[i].ChronicGroup == 1) {
                                var Brain = document.getElementById('Brain');
                                Brain.innerHTML = '<img src="images/image004Active.png">';

                                if (data[i].ChronicCondition === "Alzheimer") {
                                    var detail = document.getElementById('Alzheimer');
                                    detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Alzheimer</label>";
                                }
                                else if (data[i].ChronicCondition === "Arthritis") {
                                    var Arthritis = document.getElementById('Bone');
                                    Arthritis.innerHTML = '<img src="images/image005Active.png">';

                                    var detail = document.getElementById('Arthritis');
                                    detail.innerHTML = "<img src='images/image005Active.png' /> <label class='LetFont1'>Arthritis</label>";
                                }
                                else if (data[i].ChronicCondition === "Epilepsy") {
                                    var detail = document.getElementById('Epilepsy');
                                    detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Epilepsy</label>";
                                }
                                else if (data[i].ChronicCondition === "Parkinson Disease") {
                                    var detail = document.getElementById('Parkinson_Disease');
                                    detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Parkinson Disease</label>";
                                }
                                else if (data[i].ChronicCondition === "Sclerosis") {
                                    var detail = document.getElementById('Sclerosis');
                                    detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Sclerosis</label>";
                                }
                                else if (data[i].ChronicCondition === "Stroke") {
                                    var detail = document.getElementById('Stroke');
                                    detail.innerHTML = "<img src='images/image004Active.png' /> <label class='LetFont1'>Stroke</label>";
                                }
                            }

                            if (data[i].ChronicGroup == 2) {
                                if (data[i].ChronicCondition === "Pulmonary Disease") {
                                    var Lungs = document.getElementById('Lungs');
                                    Lungs.innerHTML = '<img src="images/image006Active.png">';

                                    var detail = document.getElementById('Pulmonary_Disease');
                                    detail.innerHTML = "<img src='images/image006Active.png' /> <label class='LetFont1'>Pulmonary Disease</label>";
                                }
                                else if (data[i].ChronicCondition === "Lung Disease") {
                                    var Lungs = document.getElementById('Lungs');
                                    Lungs.innerHTML = '<img src="images/image006Active.png">';

                                    var detail = document.getElementById('Lung_Disease');
                                    detail.innerHTML = "<img src='images/image006Active.png' /> <label class='LetFont1'>Lung Disease</label>";
                                }
                                else if (data[i].ChronicCondition === "Asthma") {
                                    var Lungs = document.getElementById('Lungs');
                                    Lungs.innerHTML = '<img src="images/image006Active.png">';

                                    var detail = document.getElementById('Asthma');
                                    detail.innerHTML = "<img src='images/image006Active.png' /> <label class='LetFont1'>Asthma</label>";
                                }
                                else if (data[i].ChronicCondition === "Cancer") {
                                    var Cancer = document.getElementById('Ribbon');
                                    Cancer.innerHTML = '<img src="images/image007Active.png">';

                                    var detail = document.getElementById('Cancer');
                                    detail.innerHTML = "<img src='images/image007Active.png' /> <label class='LetFont1'>Cancer</label>";
                                }
                                else if (data[i].ChronicCondition === "Diabetes") {
                                    var Diabetes = document.getElementById('Diabetes');
                                    Diabetes.innerHTML = '<img src="images/image008Active.png">';

                                    var detail = document.getElementById('sugarblood');
                                    detail.innerHTML = "<img src='images/image008Active.png' /> <label class='LetFont1'>Diabetes</label>";
                                }
                            }

                            if (data[i].ChronicGroup == 3) {
                                var Heart = document.getElementById('Heart');
                                Heart.innerHTML = '<img src="images/image009Active.png">';

                                if (data[i].ChronicCondition === "Heart Disease") {
                                    var detail = document.getElementById('Heart_Disease');
                                    detail.innerHTML = "<img src='images/image009Active.png' /> <label class='LetFont1'>Heart Disease</label>";
                                }
                                else if (data[i].ChronicCondition === "Hypertension") {
                                    var detail = document.getElementById('Hypertension');
                                    detail.innerHTML = "<img src='images/image009Active.png' /> <label class='LetFont1'>Hypertension</label>";
                                }
                                else if (data[i].ChronicCondition === "Kidney Disease") {
                                    var Diabetes = document.getElementById('Kidney');
                                    Diabetes.innerHTML = '<img src="images/image0010Active.png">';

                                    var detail = document.getElementById('Kidney_Disease');
                                    detail.innerHTML = "<img src='images/image0010Active.png' /> <label class='LetFont1'>Kidney Disease</label>";
                                }
                            }
                        }
                    }
                });
            }
            $scope.PatientAllergyNotificationList = function () {
                $("#chatLoaderPV").show();
                $('.chartTabs').addClass('charTabsNone');
                $scope.ConfigCode = "PATIENTPAGE_COUNT";
                $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                    $scope.page_size = data1[0].ConfigValue;
                    $scope.PageStart = (($scope.current_PatientAllergyPages - 1) * ($scope.page_size)) + 1;
                    $scope.PageEnd = $scope.current_PatientAllergyPages * $scope.page_size;
                    $scope.ISact = 1;       // default active
                    if ($scope.allergyActive == true) {
                        $scope.ISact = 1  //active
                    }
                    else if ($scope.allergyActive == false) {
                        $scope.ISact = -1 //all
                    }
                    $http.get(baseUrl + 'api/User/PatientAllergylist/?Patient_Id=' + $scope.SelectedPatientId + '&IsActive=' + $scope.ISact + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart + '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.SearchMsg = "No Data Available";
                        $scope.PatientAllergyEmptyData = [];
                        $scope.PatientAllergyListData = [];
                        $scope.PatientAssignedAllergyDataList = [];
                        $scope.PatientAllergyListData = data.PatientAllergyDetails;
                        if ($scope.PatientAllergyListData.length > 0) {
                            $scope.PatientAllergyCount = $scope.PatientAllergyListData[0].TotalRecord;
                        } else {
                            $scope.PatientAllergyCount = 0;
                        }

                        $scope.PatientAllergyListFilterData = data.PatientAllergyDetails;
                        $scope.PatientAllergyCountFilterData = data.PatientAllergyDetails;
                        for (i = 0; i < $scope.PatientAllergyListFilterData.length; i++) {
                            if ($scope.PatientAllergyListFilterData[0].AllergyTypeName === "No Known Allergies") {
                                document.getElementById("IconAllergy").style.color = '#32CD32';
                            }
                            else if ($scope.PatientAllergyListFilterData[0].AllergyTypeName === "Unknown") {
                                document.getElementById("IconAllergy").style.color = '#FFD700';
                            }
                            else if ($scope.PatientAllergyListFilterData[0].AllergenName === "No Known Allergies") {
                                document.getElementById("IconAllergy").style.color = '#32CD32';
                            }
                            else if ($scope.PatientAllergyListFilterData[0].AllergenName === "Unknown") {
                                document.getElementById("IconAllergy").style.color = '#FFD700';
                            }
                            else {
                                //document.getElementById("IconAllergy").style.color = '#FF0000';
                            }
                        }
                        $scope.PatientAssignedAllergyDataList = angular.copy($scope.PatientAllergyListData);

                        // $scope.PatientAssignedknownAllergyDataList =angular.copy($scope.PatientAssignedAllergyDataList);
                        $scope.PatientAssignedknownAllergyActiveDataList = $ff($scope.PatientAllergyListFilterData, { IsActive: 1 }, true);

                        if ($scope.PatientAssignedAllergyDataList.length > 0) {
                            $scope.Allergy_flag = 1;
                        }
                        else {
                            $scope.Allergy_flag = 0;
                        }
                        $scope.PatientAllergyPages = Math.ceil(($scope.PatientAllergyCount) / ($scope.page_size));

                    }).error(function (data) {
                        $scope.error = "AN error has occured while Listing the records!" + data;
                    })
                });
            };
            $scope.PatientNotification = function () {
                $scope.SelectedPatientId = $window.localStorage['UserId'];
                if ($window.localStorage['UserTypeId'] == 2 || $window.localStorage['UserTypeId'] == 4 || $window.localStorage['UserTypeId'] == 5 || $window.localStorage['UserTypeId'] == 6 || $window.localStorage['UserTypeId'] == 7) {
                    $("#chatLoaderPV").show();
                    $scope.ProtocolDetails_View();
                    $scope.PatientGroupNameList();
                    photoview = true;
                    //$scope.UpComingAppointmentCount = 0;
                    //$scope.PreviousAppointmentCount = 0;
                    var methodcnt = 2;
                    $http.get(baseUrl + '/api/User/UserDetails_GetPhoto/?Id=' + $scope.SelectedPatientId).success(function (data) {
                        methodcnt = methodcnt - 1;
                        if (methodcnt == 0)
                            $scope.uploadview = true;
                        if (data.PhotoBlob != null) {
                            $scope.uploadme = 'data:image/png;base64,' + data.PhotoBlob;
                        }
                        else {
                            $scope.uploadme = null;
                        }
                    })
                    $http.get(baseUrl + '/api/User/PatientBasicDetailsList/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.Id = data.PatientId;
                        $scope.FullName = data.FullName;
                        $scope.MobileNo = data.MOBILE_NO;
                        $scope.Photo = data.Photo;
                        $scope.FileName = data.FileName;
                        $scope.DOB = $filter('date')(data.DOB, "dd-MMM-yyyy");
                        $scope.MNR_No = data.MNR_NO;
                        $scope.NationalId = data.NATIONALID;
                        $scope.GenderId = data.GenderId;
                        $scope.ViewGenderName = data.GENDER_NAME;
                        $scope.PatientType = data.Patient_Type;
                        $scope.showUserType = data.UserType;
                        $scope.PhotoBlobs = data.PhotoBlobs;
                        methodcnt = methodcnt - 1;
                        $('#User_id').show();
                        $('#patient_profile').show();
                        $('#BrainGroup').show();
                        $('#KnownGroup').show();
                        var imgSrc = document.getElementById('imgSrc');
                        imgSrc.src = $scope.PhotoBlobs;
                        var NATIONALITY_ID = document.getElementById('NATIONALITY_ID');
                        NATIONALITY_ID.textContent = $scope.NationalId;

                        var USERTYPE_ID = document.getElementById('USERTYPE_ID');
                        USERTYPE_ID.textContent = $scope.showUserType;
                        var MOBILE_NO = document.getElementById('MOBILE_NO');
                        MOBILE_NO.textContent = $scope.MobileNo;

                        var DOB = document.getElementById('DOB');
                        $scope.DOB = moment($scope.DOB).format('DD-MMM-YYYY')
                        DOB.textContent = $scope.DOB;

                        var fullname = document.getElementById('fullname');
                        fullname.textContent = $scope.FullName;

                        var Gender = document.getElementById('Gender');
                        Gender.textContent = $scope.ViewGenderName;

                        var dob = $scope.DOB;
                        var gt = DateFormat(dob);
                        dob = gt.replace(/-/gi, '');
                        var year = dob.substr(4, 9);
                        var month = dob.substr(2, 2);
                        var day = dob.substr(0, 2);
                        var today = new Date();
                        var age = today.getFullYear() - year;

                        Age = document.getElementById('Age');
                        Age.textContent = age.toString();
                        if (methodcnt == 0)
                            $scope.uploadview = true;
                        if ($scope.PatientType == 2) {
                            $('#divPatientType').attr('style', 'display : none');
                        }
                        else
                            $('#divPatientType').attr('style', 'display : none');
                        if (data.Protocol_Id != null) {
                            $scope.MonitoringProtocolId = data.Protocol_Id.toString();
                            $scope.ViewProtocolName = data.ProtocolName;
                            $scope.MonitoringProtocolName = data.ProtocolName;
                            $scope.assignedProtocolId = $scope.MonitoringProtocolId;
                            $scope.Monitoring_ProtocolId = $scope.MonitoringProtocolId;
                        }
                        if ($scope.UserTypeId != 2) {
                            $scope.chattingWith = data.FullName;
                        }
                    });
                }
            }
            $scope.PatientGroupflag = 0;
            $scope.GroupName_List = [];
            /*This function is for List the Group Name based on UserId*/
            $scope.PatientGroupNameList = function () {
                $http.get(baseUrl + '/api/User/PatientGroupNameList/?PatientId=' + $scope.SelectedPatientId).success(function (data) {
                    $scope.GroupName_List = data;
                    $scope.SearchMsg = "No Data Available";

                })
            };
            $scope.ProtocolDetails_View = function () {

                if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                    $scope.Id = $routeParams.Id;
                    $scope.DuplicatesId = $routeParams.Id;
                }
                $("#chatLoaderPV").show();
                $http.get(baseUrl + 'api/Protocol/ProtocolMonitoring_View/?Id=' + $scope.Id).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.DuplicatesId = data.Id;
                    $scope.Institution_Name = data.Institution_Id;
                    $scope.ViewInstitution_Name = data.Institution_Name;
                    $scope.ProtocolName = data.Protocol_Name;
                    $scope.ParameterSettingslist = data.ChildModuleList;

                    angular.forEach($scope.ParameterSettingslist, function (value, index) {
                        if (value.NormalRange_High == null || value.NormalRange_Low == null) {
                            $scope.ParameterSettings_ViewEdit();
                        }
                    })
                });
            }
            $scope.CancelPatientGroupNamePopup = function () {
                angular.element('#PatientGroupListModal').modal('hide');

            };
            $scope.CancelPatientMonitoringProtocolModal = function () {
                angular.element('#PatientMonitoringProtocolModal').modal('hide');
            }
            $scope.CancelPatientAllergyNamePopup = function () {
                angular.element('#PatientAllergyListModal').modal('hide');
            }
            $scope.ListFilter = function () {
                $scope.ResultListFiltered = [];
                var searchstring = angular.lowercase($scope.searchquery);
                if ($scope.searchquery == "") {
                    $scope.UserNotificationList_Filter = angular.copy($scope.UserNotificationList);
                }
                else {
                    $scope.UserNotificationList_Filter = $ff($scope.UserNotificationList, function (value) {
                        return angular.lowercase(value.MessageSubject).match(searchstring) ||
                            angular.lowercase(value.MessageBody).match(searchstring) ||
                            angular.lowercase(($filter('date')(value.SentDate, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);
                    });
                    if ($scope.UserNotificationList_Filter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                }
            }
            $scope.closeNotification = function () {
                window.location.href = baseUrl + "/Home/Index#/home";
            }
            $scope.clearAllNotification = function () {
                if ($scope.UserNotificationList_Filter.length !== 0) {
                    $('#clear').attr("disabled", true);
                    $http.get(baseUrl + '/api/SendEmail/ClearNotification_Update/?User_Id=' + $scope.User_Id).success(function (data) {
                        //alert("Cleared All Notifications!");
                        toastr.info("Cleared All Notifications!", "info");
                        $('#clear').attr("disabled", false);
                        $scope.emptydata = "";
                        if ($scope.emptydata == "") {
                            $scope.UserNotificationList_Filter.length = 0;
                            $scope.flag = 0;

                        }
                        document.getElementById("UnreadCountIcon").title = "Unread Notifications: " + data.NotificationUnread;
                        var NotificationCount = document.getElementById('notificationCount');
                        NotificationCount.textContent = data.NotificationUnread;
                    });
                }
            }
            $scope.CancelModel = function () {
                angular.element('#NotificationViewModel').modal('hide');

            }
        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }
    }
]);
/* Email Alert Configuration Controller*/
MyCortexControllers.controller("EmailAlertlistController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {

        $scope.currentTab = "1";
        $scope.Id = "0";

        $scope.flag = 0;
        $scope.IsActive = true;

        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.Member_ID = "";
        $scope.Policy_Number = "";
        $scope.Reference_ID = "";
        $scope.ExpiryDate = "";
        $scope.SelectedPayor = [];
        $scope.SelectedPlan = [];
        $scope.Patient_Id = $window.localStorage['UserId'];
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']

        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {
            if (typeof ($scope.Event) == "undefined" || $scope.Event == "0") {
                //alert("Please select Event");
                toastr.warning("Please select Event", "warning");
                return false;
            }
            else if (($scope.EmailTemplate == 0) && $scope.EmailFlag == true) {
                //alert("Please select Email Template");
                toastr.warning("Please select Email Template", "warning");
                return false;
            }
            else if (($scope.AppTemplate == 0) && $scope.AppFlag == true) {
                //alert("Please select App Template");
                toastr.warning("Please select App Template", "warning");
                return false;
            }
            else if (($scope.WebTemplate == 0) && $scope.WebFlag == true) {
                //alert("Please select Web Template");
                toastr.warning("Please select Web Template", "warning");
                return false;
            }

            if (($scope.EmailFlag == false) && ($scope.AppFlag == false) && ($scope.WebFlag == false)) {
                //alert("Please select Email or App or Web for alert");
                toastr.warning("Please select Email or App or Web for alert", "warning");
                return false;
            }
            $scope.EventCodeName = "";
            angular.forEach($scope.AlertEvent, function (Selected, index) {
                if ($scope.Event == Selected.Id) {
                    $scope.Eventtype = Selected.EventType_Id;
                    $scope.Eventtype = Selected.EventCode
                }
            })
            if ($scope.Eventtype == "DOCTOR_APPOINTMENT_REMINDER" || $scope.Eventtype == "PAT_APPOINTMENT_REMINDER" ||
                $scope.Eventtype == "PASSWORD_EXPIRY" || $scope.Eventtype == "NEAR_PAT_LIMIT" || $scope.Eventtype == "NEAR_USR_LIMIT" ||
                $scope.Eventtype == "TARGET_DAILY" || $scope.Eventtype == "TARGET_WEEKLY") {
                if ($scope.AlertDays != null) {
                    if (($scope.AlertDays + "") == "") {
                        //alert("Please enter valid values");
                        toastr.warning("Please enter valid values", "warning");
                        $scope.DurationDisplayCheck();
                        return false;
                    }

                }
            }

            return true;
        };

        /* Email Alert List Function*/
        $scope.AlertEvent = [];
        $scope.AlertEventType = [];
        $scope.EmailTempalteTypeList = [];
        $scope.AppTempalteTypeList = [];
        $scope.TempalteTypeList = [];

        $scope.Eventselected = function () {
            $http.get(baseUrl + '/api/EmailAlertConfig/AlertEvent_List/?Institution_Id=' + $scope.InstituteId + '&Id=' + 0
                + '&status=' + $scope.status).success(function (data) {
                    $scope.AlertListTemp = [];
                    $scope.AlertListTemp = data;
                    /*var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                    $scope.AlertListTemp.splice(0, 0, obj);*/
                    $scope.AlertEvent = angular.copy($scope.AlertListTemp);

                });
        };
        $scope.Eventselected();
        $scope.EventDurationUOM = "";
        $scope.DurationDisplayCheck = function () {
            $scope.Eventtype = "1";
            angular.forEach($scope.AlertEvent, function (Selected, index) {
                if ($scope.Event == Selected.Id) {
                    $scope.Eventtype = Selected.EventType_Id;

                    if (Selected.EventCode == "DOCTOR_APPOINTMENT_REMINDER" || Selected.EventCode == "PAT_APPOINTMENT_REMINDER") {
                        $scope.EventDurationUOM = "mins"
                    }
                    else if (Selected.EventCode == "PASSWORD_EXPIRY") {
                        $scope.EventDurationUOM = "days"
                    }
                    else if (Selected.EventCode == "NEAR_PAT_LIMIT" || Selected.EventCode == "NEAR_USR_LIMIT"
                        || Selected.EventCode == "TARGET_DAILY" || Selected.EventCode == "TARGET_WEEKLY") {
                        $scope.EventDurationUOM = "%"
                    }
                }
            })
        }

        /* Email Flag List Function*/
        $scope.Emailselectlist = function () {
            $scope.EmailTempId = 1;
            $http.get(baseUrl + '/api/EmailAlertConfig/Template_List/?Institution_Id=' + $scope.InstituteId + '&TemplateType_Id=' + $scope.EmailTempId).success(function (data) {
                $scope.EmailTempalteTypeListTemp = [];
                $scope.EmailTempalteTypeListTemp = data;
                /*var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                $scope.EmailTempalteTypeListTemp.splice(0, 0, obj);*/
                $scope.EmailTempalteTypeList = angular.copy($scope.EmailTempalteTypeListTemp);
            });
        }
        $scope.Emailselectlist();

        /* Email Notification List Function*/
        $scope.Appselect = function () {
            $scope.AppTempId = 2;
            $http.get(baseUrl + '/api/EmailAlertConfig/Template_List/?Institution_Id=' + $scope.InstituteId + '&TemplateType_Id=' + $scope.AppTempId).success(function (data) {

                $scope.AppTempalteTypeListTemp = [];
                $scope.AppTempalteTypeListTemp = data;
                /*var obj = { "Id": 0, "Name": "Select", "IsActive": 1 };
                $scope.AppTempalteTypeListTemp.splice(0, 0, obj);*/
                $scope.AppTempalteTypeList = angular.copy($scope.AppTempalteTypeListTemp);

                $scope.TempalteTypeList = angular.copy($scope.AppTempalteTypeListTemp);
            });

        }
        $scope.Appselect();

        $scope.EventBasedToList = function () {
            $http.get(baseUrl + '/api/EmailAlertConfig/EventTo_List/?EventId=' + $scope.Event).success(function (data) {
                $scope.EventCC = data[0].EventCC;
                $scope.EventTo = data[0].EventTo;
            });
        };
        $scope.EventToClearFunction = function () {
            $scope.EventCC = "";
            $scope.EventTo = "";
        }



        $scope.EmailTemplate = "0";
        $scope.AppTemplate = "0";
        $scope.WebTemplate = "0";
        /* THIS IS FOR ADD/EDIT FUNCTION */
        $scope.EmailAlertAddEdit = function () {
            if ($scope.Validationcontrols() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    Institution_Id: $scope.InstituteId,
                    Event_Id: $scope.Event,
                    EmailFlag: $scope.EmailFlag,
                    AppFlag: $scope.AppFlag,
                    WebFlag: $scope.WebFlag,
                    EmailTemplate_Id: $scope.EmailTemplate == 0 ? null : $scope.EmailTemplate,
                    AppTemplate_Id: $scope.AppTemplate == 0 ? null : $scope.AppTemplate,
                    WebTemplate_Id: $scope.WebTemplate == 0 ? null : $scope.WebTemplate,
                    AlertDays: $scope.AlertDays,
                    ModifiedUser_Id: $scope.Patient_Id,
                    Created_By: $scope.Patient_Id
                }
                $('#btnsave').attr("disabled", true);
                $http.post(baseUrl + '/api/EmailAlertConfig/EmailAlertDetails_AddEdit/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $('#btnsave').attr("disabled", false);
                    if (data.ReturnFlag == 1) {
                        $scope.ClearPopup();
                        $scope.CancelPopUP();
                        $scope.EmailAlertlist();
                    }
                    $("#chatLoaderPV").hide();
                })
            }
        }

        /* THIS IS FOR LIST PROCEDURE */
        $scope.emptydata = [];
        $scope.rowCollection = [];
        $scope.flag = 0;
        $scope.rowCollectionFilter = [];
        $scope.Id = 0;
        $scope.EmailAlertlist = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }
                $http.get(baseUrl + '/api/EmailAlertConfig/EmailAlert_List/?Id=' + $scope.InstituteId + '&IsActive=' + $scope.ISact).success(function (data) {
                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.searchquery = "";
        /* FILTER THE LIST FUNCTION.*/
        $scope.filteralertList = function () {
            $scope.rowCollectionFilter = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.EventName).match(searchstring) ||
                        angular.lowercase(value.EmailTemplate == null ? '' : value.EmailTemplate).match(searchstring) ||
                        angular.lowercase(value.AppTemplate == null ? '' : value.AppTemplate).match(searchstring) ||
                        angular.lowercase(value.WebTemplate == null ? '' : value.WebTemplate).match(searchstring);
                });
            }
        }
        $scope.DuplicatesId = 0;
        $scope.assignedEvent = "";
        $scope.assignedEmailTemplate = "";
        $scope.assignedNotificationTemplate = "";
        $scope.assignedAppTemplate = "";
        /* THIS IS FOR VIEW FUNCTION */
        $scope.ViewEmailAlert = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/EmailAlertConfig/EmailAlert_View/?Id=' + $scope.Id).success(function (data) {
                $scope.DuplicatesId = data.Id;
                $scope.Institution_Id = data.Institution_Id;
                $scope.Institution_Name = data.Institution_Name;

                $scope.EmailFlag = data.EmailFlag;
                $scope.AppFlag = data.AppFlag;
                $scope.WebFlag = data.WebFlag;
                if (data.EmailTemplate_Id != null) {
                    $scope.EmailTemplate = data.EmailTemplate_Id.toString();
                    $scope.EmailTempId = 1;
                    $scope.ViewEmailTemplateName = data.EmailTemplate;
                }
                if (data.AppTemplate_Id != null) {
                    $scope.AppTemplate = data.AppTemplate_Id.toString();
                    $scope.AppTempId = 2;
                    $scope.ViewAppTemplateName = data.AppTemplate;
                }

                if (data.WebTemplate_Id != null) {
                    $scope.WebTemplate = data.WebTemplate_Id.toString();
                    $scope.WebTempId = 2;
                    $scope.ViewWebTemplateName = data.WebTemplate;
                }

                $scope.AlertDays = data.AlertDays == null ? "" : data.AlertDays;

                $scope.Event = data.Event_Id.toString();
                $scope.ViewEvent = data.EventName;
                $scope.assignedEvent = $scope.Event;
                $scope.Event = $scope.Event;
                $scope.DurationDisplayCheck();
                $scope.EventBasedToList();
                $("#chatLoaderPV").hide();
            });
        }

        $scope.DeleteEmailAlert = function (DId) {
            $scope.Id = DId;
            $scope.EmailAlert_Delete();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.EmailAlert_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Alert details?");
            if (del == true) {
                $http.get(baseUrl + '/api/EmailAlertConfig/EmailAlert_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Alert has been deactivated Successfully");
                    toastr.success("Alert has been deactivated Successfully", "success");
                    $scope.EmailAlertlist();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Alert details" + data;
                });
            }
        };

        /* THIS IS FOR ACTIVE FUNCTION*/
        $scope.ActiveEmailAlert = function (PId) {
            $scope.Id = PId;
            $scope.EmailAlert_Active();
        };

        /* 
            Calling the api method to activate the details of Email Template
            matching the specified Email Template Id,
            and redirected to the list page.
           */
        $scope.EmailAlert_Active = function () {

            var Ins = confirm("Do you like to activate the selected Alert details?");
            if (Ins == true) {
                $http.get(baseUrl + '/api/EmailAlertConfig/EmailAlert_Active/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Alert details has been activated successfully");
                    toastr.success("Selected Alert details has been activated successfully", "success");
                    $scope.EmailAlertlist();
                }).error(function (data) {
                    $scope.error = "An error has occured while deleting alert records" + data;
                });
            }
        };

        $scope.Active_ErrorFunction = function () {
            //alert("Inactive Alert details cannot be edited");
            toastr.info("Inactive Alert details cannot be edited", "info");
        };

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }

        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddEmailAlertPopUP = function () {
            angular.element('#EmailAlertModal').modal('show');
            $('#btnsave').attr("disabled", false);
            $scope.status = 1;
            //$scope.ClearPopup();
            $('[data-id="select1"]').prop('disabled', false);
            $scope.Eventselected();

        }

        /* THIS IS OPENING POP WINDOW FORM VIEW */
        $scope.ViewEmailAlertPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.EventClear();
            $scope.ViewEmailAlert();
            angular.element('#EmailAlertViewModal').modal('show');
        }

        /* THIS IS OPENING POP WINDOW FORM EDIT */
        $scope.EditEmailAlert = function (CatId) {
            $scope.Id = CatId;
            $scope.EventClear();
            $scope.ViewEmailAlert();
            $scope.status = 0;
            $('[data-id="select1"]').prop('disabled', true);
            $scope.Eventselected();
            angular.element('#EmailAlertModal').modal('show');
            $('#btnsave').attr("disabled", false);
        }

        /* THIS IS CANCEL POPUP FUNCTION */
        $scope.CancelPopUP = function () {
            angular.element('#EmailAlertModal').modal('hide')
        }

        /* THIS IS CANCEL VIEW POPUP FUNCTION*/
        $scope.CancelViewPopup = function () {
            angular.element('#EmailAlertViewModal').modal('hide')
        }
        $scope.EventClear = function () {
            $scope.Institution_Id = "0";
            $scope.Institution_Name = "";
            $scope.EmailFlag = 0;
            $scope.EmailTemplate = "0";
            $scope.AppFlag = 0;
            $scope.AppTemplate = "0";
            $scope.AppFlag = 0;
            $scope.AppTemplate = "0";
            $scope.AlertDays = "";
            $scope.WebTempId = -1;
            $scope.AppTempId = -1;
            $scope.EmailTempId = -1;
            $scope.EventCC = "";
            $scope.EventTo = "";

        };

        /* THIS IS CLEAR POPUP FUNCTION */
        $scope.ClearPopup = function () {
            $scope.Id = "0";
            $scope.Institution_Id = "0";
            $scope.Institution_Name = "";
            $scope.Event_Id = "0";
            $scope.Event = "0";
            $scope.EmailFlag = 0;
            $scope.EmailTemplate = "0";
            $scope.AppFlag = 0;
            $scope.AppTemplate = "0";
            $scope.WebFlag = 0;
            $scope.WebTemplate = "0";
            $scope.AlertDays = "";
            $scope.WebTempId = -1;
            $scope.AppTempId = -1;
            $scope.EmailTempId = -1;
        }

        /* THIS IS OPENING POP WINDOW FORM LIST */
        $scope.ListEmailAlertPopUP = function (EmailAlertCatId) {
            if ($routeParams.Id == 0) {
                $scope.rowCollection = [];
            }
            $scope.Id = CatId;
            $scope.EmailAlertList();
        }
    }
]);
MyCortexControllers.controller("PatientReportList", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
        if ($window.localStorage['UserTypeId'] == 3) {
            $scope.current_page = 1;
            $scope.TotalPageAuditReport = 1;
            $scope.page_size = $window.localStorage['Pagesize'];
            $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
            $scope.rembemberCurrentPage = function (p) {
                $scope.current_page = p
            }

            $scope.Reportflag = 0;
            $scope.UserTypeId = "0";
            $scope.UserNameId = "0";
            $scope.Id = "0";
            $scope.Usertype_listdata = [];
            $scope.UserName_listdata = [];
            $scope.ShortNameId = "";

            $scope.Period_From = DateFormatEdit($filter('date')(new Date(), 'dd-MMM-yyyy'));
            $scope.Period_To = DateFormatEdit($filter('date')(new Date(), 'dd-MMM-yyyy'));
            $scope.PeriodFromTime = DateFormatEdit($filter('date')(new Date(), 'hh:mm'));
            $scope.PeriodToTime = DateFormatEdit($filter('date')(new Date(), 'hh:mm'));

            $scope.InstituteId = $window.localStorage['InstitutionId'];

            $http.get(baseUrl + '/api/ReportDetails/TableShortName_List/').success(function (data) {
                $scope.TableShortName_listdata = data;
            });

            /* User type details list*/
            $http.get(baseUrl + '/api/Login/Usertypedetailslist/').success(function (data) {
                $scope.Usertype_listdataTemp = [];
                $scope.Usertype_listdataTemp = data;
                var obj = { "Id": 0, "TypeName": "Select", "IsActive": 1 };
                $scope.Usertype_listdataTemp.splice(0, 0, obj);
                $scope.Usertype_listdata = angular.copy($scope.Usertype_listdataTemp);
                $scope.UserTypeId = 0;
            });

            $scope.UserTypeBaseduserName = function () {
                $http.get(baseUrl + '/api/Login/Userdetailslist/?UserTypeId=' + $scope.UserTypeId + '&InstitutionId=' + $scope.InstituteId).success(function (data) {
                    $scope.UserName_listdataTemp = [];
                    $scope.UserName_listdataTemp = data;
                    var obj = { "Id": 0, "FullName": "Select", "IsActive": 1 };
                    $scope.UserName_listdataTemp.splice(0, 0, obj);
                    $scope.UserName_listdata = angular.copy($scope.UserName_listdataTemp);
                    $scope.UserNameId = 0;
                });
            }

            $scope.ConfigCode = "REPORT_DATE_LIMIT";
            $scope.ValidateDays = 90;
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.InstituteId)
                .success(function (data) {
                    if (data[0] != undefined) {
                        $scope.ValidateDays = parseInt(data[0].ConfigValue);
                    }
                    else {
                        $scope.ValidateDays = 90;
                    }
                });

            $scope.patientReportValidation = function () {
                if (typeof ($scope.UserTypeId) == "undefined" || $scope.UserTypeId == "0") {
                    //alert("Please select User Type");
                    toastr.warning("Please select User Type", "warning");
                    return false;
                }
                else if (typeof ($scope.UserNameId) == "undefined" || $scope.UserNameId == "0") {
                    //alert("Please select User Name");
                    toastr.warning("Please select User Name", "warning");
                    return false;
                }
                else if ($scope.ShortNameId == "" || $scope.ShortNameId == "0") {
                    //alert("Please select Table Short Name");
                    toastr.warning("Please select Table Short Name", "warning");
                    return false;
                }
                //else if (typeof ($scope.PeriodFromTime) == "undefined" || $scope.PeriodFromTime   == "") {
                //    alert("Please select Period To Time");
                //    return false;
                //}
                //else if (typeof ($scope.PeriodToTime) == "undefined" || $scope.PeriodToTime  == "") {
                //    alert("Please select Period To Time");
                //    return false;
                //}

                //else if (isDate($scope.Period_From) == false) {
                //    alert("Period From is in Invalid format, please enter dd-mm-yyyy");
                //    return false;
                //}
                //if (typeof ($scope.Period_To) == "undefined" || $scope.Period_To == "") {
                //    alert("Please select Period To");
                //    return false;
                //}
                //else if (isDate($scope.Period_To) == false) {
                //    alert("Period To is in Invalid format, please enter dd-mm-yyyy");
                //    return false;
                //}
                //var date1 = new Date($scope.Period_From);
                var date1 = new Date($('#datetimepicker').val());
                var date2 = new Date($('#datetimepicker_mask').val());
                var diffTime = Math.abs(date2 - date1);
                var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays >= $scope.ValidateDays) {
                    //alert($scope.ValidateDays.toString() + " days only allowed Audit Report");
                    toastr.warning($scope.ValidateDays.toString() + " days only allowed Audit Report", "warning");
                    return false;
                }
                var retval = true;
                if (($scope.Period_From != "") && ($scope.Period_To != "")) {
                    $scope.Period_From = moment($scope.Period_From).format('DD-MMM-YYYY');
                    $scope.Period_To = moment($scope.Period_To).format('DD-MMM-YYYY');

                    if ((ParseDate($scope.Period_From + " " + $scope.PeriodFromTime) > ParseDate($scope.Period_To + " " + $scope.PeriodToTime))) {
                        //alert("From Date should not be greater than To Date");
                        toastr.warning("From Date should not be greater than To Date", "warning");
                        $scope.Period_From = DateFormatEdit($scope.Period_From);
                        $scope.Period_To = DateFormatEdit($scope.Period_To);
                        retval = false;
                        return false;
                    }
                    $scope.Period_From = DateFormatEdit($scope.Period_From);
                    $scope.Period_To = DateFormatEdit($scope.Period_To);
                }

                return retval;
            };

            $scope.PatientReportListData = [];
            $scope.filterReportList = function () {
                $scope.ResultListFiltered = [];
                var searchstring = angular.lowercase($scope.searchreportquery);
                if ($scope.searchreportquery == "") {
                    $scope.PatientDetailsFilteredDataList = [];
                    $scope.PatientDetailsFilteredDataList = angular.copy($scope.ReportDetails_ListOrder);

                }
                else {
                    $scope.PatientDetailsFilteredDataList = $ff($scope.ReportDetails_ListOrder, function (value) {
                        return angular.lowercase(value.ShortName).match(searchstring) ||
                            angular.lowercase(value.TableDisplayName).match(searchstring) ||
                            angular.lowercase(value.Details).match(searchstring) ||
                            angular.lowercase(value.ColumnOrder).match(searchstring) ||
                            angular.lowercase(value.Action).match(searchstring) ||
                            angular.lowercase(value.NewValue).match(searchstring) ||
                            angular.lowercase(value.OldValue == null ? "" : value.OldValue).match(searchstring) ||
                            angular.lowercase(($filter('date')(value.ActionDateTime, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);


                    });
                }
            };
            $scope.Convert24to12Timeformat = function (inputTime) {
                var outputTime = null;
                if (inputTime != '' && inputTime != null) {
                    inputTime = inputTime.toString(); //value to string for splitting
                    var splitTime = inputTime.split(':');
                    splitTime.splice(2, 1);
                    var ampm = (splitTime[0] >= 12 ? ' PM' : ' AM'); //determine AM or PM
                    splitTime[0] = splitTime[0] % 12;
                    splitTime[0] = (splitTime[0] == 0 ? 12 : splitTime[0]); //adjust for 0 = 12
                    outputTime = splitTime.join(':') + ampm;
                }
                return outputTime;
            };
            $scope.Convert12To24Timeformat = function (timeval) {
                var outputTime = null;
                if (timeval != '' && timeval != null) {
                    var time = timeval;
                    var hours = Number(time.match(/^(\d+)/)[1]);
                    var minutes = Number(time.match(/:(\d+)/)[1]);
                    var AMPM = time.match(/\s(.*)$/)[1];
                    if (AMPM == "PM" && hours < 12) hours = hours + 12;
                    if (AMPM == "AM" && hours == 12) hours = hours - 12;
                    var sHours = hours.toString();
                    var sMinutes = minutes.toString();
                    if (hours < 10) sHours = "0" + sHours;
                    if (minutes < 10) sMinutes = "0" + sMinutes;
                    outputTime = sHours + ":" + sMinutes;
                }
                return outputTime;
            };
            $scope.setPage = function (PageNo) {
                if (PageNo == 0) {
                    PageNo = $scope.inputPage;
                }
                else {
                    $scope.inputPage = PageNo;
                }
                $scope.current_page = PageNo;
                $scope.PatientReportDetailslist();

            }

            $scope.ReportDetailsemptydata = [];
            $scope.ReportPatienAudit = [];
            $scope.PatientDetailsFilteredDataList = [];
            $scope.PatientReportDetailslist = function () {
                if ($scope.patientReportValidation() == true) {
                    $("#chatLoaderPV").show();
                    $scope.ConfigCode = "PATIENTPAGE_COUNT";
                    $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
                    $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                        $scope.page_size = data1[0].ConfigValue;
                        $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                        $scope.PageEnd = $scope.current_page * $scope.page_size;


                        //var PeriodFromTime = $scope.PeriodFromTime == "" ? null : $scope.Convert12To24Timeformat($scope.PeriodFromTime);
                        //var PeriodToTime  =  $scope.PeriodToTime == "" ? null : $scope.Convert12To24Timeformat($scope.PeriodToTime);   

                        var periodsplitfromdate = $('#datetimepicker').val().split(' ')[0];
                        var periodsplittodate = $('#datetimepicker_mask').val().split(' ')[0];
                        var PeriodFromTime = $scope.Convert24to12Timeformat($('#datetimepicker').val().split(' ')[1]);
                        var PeriodToTime = $scope.Convert24to12Timeformat($('#datetimepicker_mask').val().split(' ')[1]);
                        var fromtime2 = PeriodFromTime;
                        var totime = PeriodToTime;


                        $http.get(baseUrl + '/api/ReportDetails/PatientReportDetails_List?' +
                            'Period_From=' + moment(periodsplitfromdate).format('YYYY-MMM-DD') +
                            '&Period_To=' + moment(periodsplittodate).format('YYYY-MMM-DD') +
                            '&PeriodFromTime=' + fromtime2 +
                            '&PeriodToTime=' + totime +
                            '&ShortNameId=' + $scope.ShortNameId +
                            '&UserNameId=' + $scope.UserNameId
                            + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber='
                            + $scope.PageStart + '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                                if (data.length == 0) {
                                    $("#chatLoaderPV").hide();
                                    $scope.TotalPageAuditReport = 1;
                                    $scope.ReportDetailsemptydata = "";
                                    if ($scope.PatientDetailsFilteredDataList.length > 0) {

                                    } else {
                                        $scope.Reportflag = 0;
                                    }
                                    $scope.SearchMsg = "No Data Available";
                                } else {
                                    $scope.ReportDetails_ListOrder = [];
                                    $scope.ReportDetails_ListOrder = data;
                                    $scope.ReportDetailsCount = $scope.ReportDetails_ListOrder[0].TotalRecord;
                                    $scope.ReportDetailsCountFilterData = data;
                                    $scope.PatientDetailsFilteredDataList = angular.copy($scope.ReportDetails_ListOrder);
                                    if ($scope.PatientDetailsFilteredDataList.length > 0) {
                                        $scope.Reportflag = 1;
                                    }
                                    else {
                                        $scope.Reportflag = 0;
                                    }
                                    $scope.TotalPageAuditReport = Math.ceil(($scope.ReportDetailsCount) / ($scope.page_size));
                                    $("#chatLoaderPV").hide();
                                }
                            })
                    }).error(function (data) {
                        $("#chatLoaderPV").hide();
                        $scope.error = "AN error has occured while Listing the records!" + data;
                    })
                }
            }


        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }

    }
]);

MyCortexControllers.controller("AppointmentSlotController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {

        //List Page Pagination.
        if ($window.localStorage['UserTypeId'] == 3) {
            $scope.current_page = 1;
            $scope.page_size = $window.localStorage['Pagesize'];
            $scope.rembemberCurrentPage = function (p) {
                $scope.current_page = p
            }
            $scope.listdata = [];
            $scope.Institution_Name = "";
            $scope.Doctor_Id = "0";
            $scope.Doctor_Name = "";
            // $scope.Appoinment_Hours = "";
            $scope.Appoinment_Minutes = "";
            $scope.FollowUp_Appoinment = "";
            $scope.SlotInterval = "";
            $scope.DuplicateId = "0";
            $scope.flag = 0;
            $scope.IsActive = true;
            $scope.rowCollection = [];
            $scope.rowCollectionFilter = [];
            $scope.Id = 0;
            $scope.LoginSessionId = $window.localStorage['Login_Session_Id']

            $scope.AddSlot = function () {
                $scope.Id = 0;
                // $scope.AppoinmentSlotClear();
                angular.element('#AppointmentSlotModal').modal('show');
            }
            $scope.CancelSlot = function () {
                angular.element('#AppointmentSlotModal').modal('hide');
            }

            $scope.ViewAppoinmentpopup = function () {
                angular.element('#ViewAppoinmentSlot').modal('show');
            }

            $scope.CancelViewAppoinmentpopup = function () {
                angular.element('#ViewAppoinmentSlot').modal('hide');
            }

            /* on click view, view popup opened*/
            $scope.ViewAppoinmentSlot = function (CatId, DoctorId) {
                $scope.AppoinmentSlotClear();
                $scope.Id = CatId;
                $scope.AppoinmentSlot_View(CatId, DoctorId);
                angular.element('#ViewAppoinmentSlot').modal('show');
            };
            /* on click Edit, edit popup opened*/
            $scope.EditAppoinmentSlot = function (CatId, activeFlag, DoctorId) {
                if (activeFlag == 1) {
                    $scope.AppoinmentSlotClear();
                    $scope.Id = CatId;
                    $scope.AppoinmentSlot_View(CatId, DoctorId);
                    angular.element('#AppointmentSlotModal').modal('show');
                }
                else {
                    //alert("Inactive record cannot be edited");
                    toastr.info("Inactive record cannot be edited", "info");
                }
            };
            /* 
         Calling api method for the dropdown list in the html page for the fields 
         Doctor List
         */
            $scope.InstituteId = $window.localStorage['InstitutionId'];
            $scope.DoctorList = [];
            $scope.DoctorListActive = [];
            $http.get(baseUrl + '/api/AppoinmentSlot/Doctors_List/?Institution_Id=' + $scope.InstituteId).success(function (data) {
                $scope.DoctorList = $ff(data, { IsActive: 1 });
                $scope.DoctorListActive = data;
            });

            $scope.searchquery = "";
            /* Filter the master list function.*/
            $scope.filterAppoinmentSlotList = function () {
                $scope.ResultListFiltered = [];
                var searchstring = angular.lowercase($scope.searchquery);
                if (searchstring == "") {
                    $scope.rowCollectionFilter = [];
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                }
                else {
                    $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                        return angular.lowercase(value.Doctor_Name).match(searchstring) ||
                            angular.lowercase(value.Department_Name).match(searchstring)

                    });
                }
            }
            /* Validating the create page mandatory fields
               checking mandatory for the follwing fields
               InstituionName,InstitutionPrintName,Email,CountryName,StateName,LocationName,Registrationdate
               and showing alert message when it is null.
               */
            $scope.AppoinmentSlotAddEdit_Validations = function () {
                if (typeof ($scope.SelectedDoctor) == "undefined" || $scope.SelectedDoctor == "0" && $scope.Id == 0) {
                    //alert("Please select Doctor");
                    toastr.warning("Please select Doctor", "warning");
                    return false;
                }
                if (typeof ($scope.SelectedDoctor1) == "undefined" || $scope.SelectedDoctor1 == "0" && $scope.Id > 0) {
                    //alert("Please select Doctor");
                    toastr.warning("Please select Doctor", "warning");
                    return false;
                }
                //else if (typeof ($scope.Appoinment_Hours) == "undefined" || $scope.Appoinment_Hours == "") {
                //    alert("Please enter New Appointment Hours");
                //    return false;
                //}
                else if (typeof ($scope.Appoinment_Minutes) == "undefined" || $scope.Appoinment_Minutes == "") {
                    //alert("Please enter New Appointment Minutes");
                    toastr.warning("Please enter New Appointment Minutes", "warning");
                    return false;
                }
                else if (typeof ($scope.FollowUp_Appoinment) == "undefined" || $scope.FollowUp_Appoinment == "") {
                    //alert("Please enter Followup Appointment");
                    toastr.warning("Please enter Followup Appointment", "warning");
                    return false;
                }
                else if (typeof ($scope.SlotInterval) == "undefined" || $scope.SlotInterval == "") {
                    //alert("Please enter Slot Interval");
                    toastr.warning("Please enter Slot Interval", "warning");
                    return false;
                }
                return true;
            }
            $('#AppointmentSlotModal').on('hide.bs.modal', function () {
                console.log('hide');
                //return false;
            })

            $scope.SelectedDoctorval = function (val) {
                if ($scope.Id == 0) {
                    if (($scope.SelectedDoctor.length) == 1) {
                        angular.forEach($scope.DoctorList, function (Selected, index) {
                            $scope.DepartmentName = Selected.Department_Name;
                        });
                    }
                    else {
                        $scope.DepartmentName = ""
                    }
                }
            }

            /*on click Save calling the insert update function for Appoinment Slot
             and check the Doctor Appoinment already exist,if exist it display alert message or its 
             calling the insert update function*/
            $scope.AppoinmentDetails = [];
            $scope.SelectedDoctor = [];
            $scope.AppoinmentSlot_AddEdit = function () {
                $scope.DoctorListDetails = [];
                if ($scope.AppoinmentSlotAddEdit_Validations() == true) {
                    $("#chatLoaderPV").show();
                    if ($scope.Id == 0) {
                        angular.forEach($scope.SelectedDoctor, function (Selected, index) {

                            var obj = {
                                Id: $scope.Id,
                                Institution_Id: $window.localStorage['InstitutionId'],
                                Doctor_Id: Selected,
                                //    Appoinment_Hours:$scope.Appoinment_Hours,
                                Appoinment_Minutes: $scope.Appoinment_Minutes,
                                FollowUp_Appoinment: $scope.FollowUp_Appoinment,
                                SlotInterval: $scope.SlotInterval,
                                Created_By: $window.localStorage['UserId'],
                                Modified_By: $window.localStorage['UserId'],
                            };
                            $scope.DoctorListDetails.push(obj)
                        });
                    }
                    else {
                        var obj1 = {
                            Id: $scope.Id,
                            Institution_Id: $window.localStorage['InstitutionId'],
                            Doctor_Id: $scope.SelectedDoctor1,
                            // Appoinment_Hours:$scope.Appoinment_Hours,
                            Appoinment_Minutes: $scope.Appoinment_Minutes,
                            FollowUp_Appoinment: $scope.FollowUp_Appoinment,
                            SlotInterval: $scope.SlotInterval,
                            Created_By: $window.localStorage['UserId'],
                            Modified_By: $window.localStorage['UserId'],
                        };
                        $scope.DoctorListDetails.push(obj1)
                    }

                    $http.post(baseUrl + '/api/AppoinmentSlot/AppoinmentSlot_AddEdit/', $scope.DoctorListDetails).success(function (data) {
                        // $("#chatLoaderPV").hide();
                        alert(data.Message);
                        if (data.ReturnFlag == "1") {
                            $scope.CancelSlot();
                            $scope.AppoinmentSlotListGo();
                        }
                        $("#chatLoaderPV").hide();
                    })
                }
            }

            $scope.AppoinmentSlotClear = function () {
                $scope.SelectedDoctor1 = "0";
                $scope.SelectedDoctor = "0";
                $scope.Doctor_Id = "0";
                //  $scope.Appoinment_Hours="";
                $scope.Appoinment_Minutes = "";
                $scope.FollowUp_Appoinment = "";
                $scope.SlotInterval = "";
                $scope.Created_By = "";
                $scope.Modified_By = "";
                $scope.DepartmentName = ""
            }

            /*THIS IS FOR LIST FUNCTION*/
            $scope.AppoinmentSlotListGo = function () {
                $("#chatLoaderPV").show();
                $scope.emptydata = [];
                $scope.rowCollection = [];
                $scope.Institution_Id = "";

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }

                $http.get(baseUrl + '/api/AppoinmentSlot/AppoinmentSlot_List/Id?=0' + '&IsActive=' + $scope.ISact + '&Institution_Id=' + $scope.InstituteId).success(function (data) {

                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            };


            $scope.EditSelectedDoctor = [];
            $scope.EditSelectedDoctorList = [];
            $scope.CCCG_DetailsList = [];
            /*THIS IS FOR View FUNCTION*/
            $scope.AppoinmentSlot_View = function (Id, DoctorId) {
                $("#chatLoaderPV").show();
                $scope.EditSelectedDoctor = [];
                if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                    $scope.Id = $routeParams.Id;
                    $scope.DuplicatesId = $routeParams.Id;
                }

                $http.get(baseUrl + '/api/AppoinmentSlot/AppoinmentSlot_View/?Id=' + Id).success(function (data) {
                    $scope.Id = data.Id;
                    $scope.DuplicatesId = data.Id;
                    $scope.Doctor_Id = data.Doctor_Id.toString();
                    $scope.SelectedDoctor1 = $scope.Doctor_Id;
                    $scope.DepartmentName = data.Department_Name;
                    $scope.Doctor_Name = data.Doctor_Name;
                    //  $scope.Appoinment_Hours = data.Appoinment_Hours;
                    $scope.Appoinment_Minutes = data.Appoinment_Minutes;
                    $scope.FollowUp_Appoinment = data.FollowUp_Appoinment;
                    $scope.SlotInterval = data.SlotInterval;
                    //$scope.EditSelectedDoctor.push(data.Doctor_Id);
                    //$scope.SelectedDoctor = $scope.EditSelectedDoctor;
                    //$scope.SelectedDoctorval();
                    $("#chatLoaderPV").hide();
                });

            }

            /* 
           Calling the api method to detele the details of the Appoinment Slot 
           for the  Appoinment Slot Id,
           and redirected to the list page.
           */
            $scope.DeleteAppoinmentSlot = function (comId) {
                $scope.Id = comId;
                $scope.AppoinmentSlot_Delete();
            };
            $scope.AppoinmentSlot_Delete = function () {
                var del = confirm("Do you like to deactivate the selected Appoinment Slot?");
                if (del == true) {

                    var obj =
                    {
                        Id: $scope.Id,
                        Modified_By: $window.localStorage['UserId']
                    }

                    //  $http.post(baseUrl + '/api/MasterICD/MasterICD_AddEdit/', obj).success(function (data) {
                    $http.post(baseUrl + '/api/AppoinmentSlot/AppoinmentSlot_Delete/', obj).success(function (data) {
                        alert(data.Message);
                        $scope.AppoinmentSlotListGo();
                    }).error(function (data) {
                        $scope.error = "AN error has occured while deleting Institution!" + data;
                    });
                };
            };

            /*'Active' the Appoinment  Slot */
            $scope.ReInsertAppoinmentSlot = function (comId, DoctorId) {
                $scope.Id = comId;
                $scope.ReInsertAppoinmentSlotList(DoctorId);
            };

            /* 
            Calling the api method to inactived the details of the Appoinment  Slot 
            for the  company Id,
            and redirected to the list page.
            */
            $scope.ReInsertAppoinmentSlotList = function (DoctorId) {
                $http.get(baseUrl + '/api/AppoinmentSlot/ActivateDoctorSlot_List/?Id=' + $scope.Id
                    + '&Institution_Id=' + $window.localStorage['InstitutionId']
                    + '&Doctor_Id=' + DoctorId
                ).success(function (data) {
                    if (data.returnval == 1) {
                        alert("Activate Doctor Appoinment Slot is already created, Please check");
                    }
                    else {
                        var Ins = confirm("Do you like to activate the selected Appoinment Slot?");
                        if (Ins == true) {
                            var obj =
                            {
                                Id: $scope.Id,
                                Modified_By: $window.localStorage['UserId']
                            }
                            $http.post(baseUrl + '/api/AppoinmentSlot/AppoinmentSlot_Active/', obj).success(function (data) {
                                alert(data.Message);
                                $scope.AppoinmentSlotListGo();
                            }).error(function (data) {
                                $scope.error = "An error has occurred while ReInsertAppoinment Slot" + data;
                            });
                        };
                    }
                })
            }
        } else {
            window.location.href = baseUrl + "/Home/LoginIndex";
        }
    }
]);

MyCortexControllers.controller("SlotTimingController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff) {
        //  $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.ShiftName = "";
        $scope.IsActive = true;
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.currentTab = "1";

        $scope.page_size = 0;
        $scope.ConfigCode = "PAGINATION";
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            if (data[0] != undefined) {
                $scope.page_size = parseInt(data[0].ConfigValue);
                $window.localStorage['Pagesize'] = $scope.page_size;
            }
        });
        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.ViewShiftTimingsSlot = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewShiftTimings();
            angular.element('#ViewAppointmentSlotModal').modal('show');
        }

        $scope.EditShiftTimingsSlot = function (CatId, ActiveFlag) {
            if (ActiveFlag == 1) {
                $scope.ClearShiftTimingPopUp();
                $scope.Id = CatId;
                $scope.ViewShiftTimings();
                angular.element('#AppointmentSlotModal').modal('show');
            }
            else {
                //alert("Inactive record cannot be edited");
                toastr.info("Inactive record cannot be edited", "info");
            }
        };

        $scope.AddTiming = function () {
            angular.element('#AppointmentSlotModal').modal('show');
        }

        $scope.CancelTiming = function () {
            angular.element('#AppointmentSlotModal').modal('hide');
        }

        $scope.AddDoctorShift = function () {
            angular.element('#DoctorShiftModal').modal('show');
        }

        $scope.CancelDoctorShift = function () {
            angular.element('#DoctorShiftModal').modal('hide');
        }
        $scope.Convert24to12Timeformat = function (inputTime) {
            var outputTime = null;
            if (inputTime != '' && inputTime != null) {
                inputTime = inputTime.toString(); //value to string for splitting
                var splitTime = inputTime.split(':');
                splitTime.splice(2, 1);
                var ampm = (splitTime[0] >= 12 ? ' PM' : ' AM'); //determine AM or PM
                splitTime[0] = splitTime[0] % 12;
                splitTime[0] = (splitTime[0] == 0 ? 12 : splitTime[0]); //adjust for 0 = 12
                outputTime = splitTime.join(':') + ampm;
            }
            return outputTime;
        };
        $scope.Convert12To24Timeformat = function (timeval) {
            var outputTime = null;
            if (timeval != '' && timeval != null) {
                var time = timeval;
                var hours = Number(time.match(/^(\d+)/)[1]);
                var minutes = Number(time.match(/:(\d+)/)[1]);
                var AMPM = time.match(/\s(.*)$/)[1];
                if (AMPM == "PM" && hours < 12) hours = hours + 12;
                if (AMPM == "AM" && hours == 12) hours = hours - 12;
                var sHours = hours.toString();
                var sMinutes = minutes.toString();
                if (hours < 10) sHours = "0" + sHours;
                if (minutes < 10) sMinutes = "0" + sMinutes;
                outputTime = sHours + ":" + sMinutes;
            }
            return outputTime;
        };

        $scope.ShiftTimings_InsertUpdateValidations = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.ShiftFromDate = moment($scope.ShiftFromDate).format('DD-MMM-YYYY');
            $scope.ShiftToDate = moment($scope.ShiftToDate).format('DD-MMM-YYYY');

            if ($scope.ShiftName == "") {
                //alert("Please enter Shift");
                toastr.warning("Please enter Shift", "warning");
                return false;
            }
            else if ((ParseDate($scope.ShiftFromDate) < ParseDate(today))) {
                //alert("Shift Timing From Date Can Be Booked Only For Future");
                toastr.warning("Shift Timing From Date Can Be Booked Only For Future", "warning");
                $scope.ShiftFromDate = DateFormatEdit($scope.ShiftFromDate);
                $scope.ShiftToDate = DateFormatEdit($scope.ShiftToDate);
                return false;
            }
            else if ((ParseDate($scope.ShiftToDate) < ParseDate(today))) {
                //alert("Shift Timing ToDate Can Be Booked Only For Future");
                toastr.warning("Shift Timing ToDate Can Be Booked Only For Future", "warning");
                $scope.ShiftFromDate = DateFormatEdit($scope.ShiftFromDate);
                $scope.ShiftToDate = DateFormatEdit($scope.ShiftToDate);
                return false;
            }
            else if ((typeof ($scope.ShiftFromDate) != "") && (typeof ($scope.ShiftToDate) != "")) {

                if (moment($scope.ShiftFromDate + " " + $scope.ShiftFromTime) > moment($scope.ShiftToDate + " " + $scope.ShiftEndTime)) {
                    if (($scope.ShiftFromDate !== null) && ($scope.ShiftToDate !== null)) {
                        if ((ParseDate($scope.ShiftToDate) < ParseDate($scope.ShiftFromDate))) {
                            //alert("From Date Should not be greater than To Date");
                            toastr.warning("From Date Should not be greater than To Date", "warning");
                            $scope.ShiftFromDate = DateFormatEdit($scope.ShiftFromDate);
                            $scope.ShiftToDate = DateFormatEdit($scope.ShiftToDate);
                            return false;
                        }
                        //alert("Shift From Time should not be greater than Shift To Time");
                        toastr.warning("Shift From Time should not be greater than Shift To Time", "warning");
                        $scope.ShiftFromDate = DateFormatEdit($scope.ShiftFromDate);
                        $scope.ShiftToDate = DateFormatEdit($scope.ShiftToDate);
                        return false;
                    }

                }
            }
            else if ($scope.ShiftFromTime == "") {
                //alert("Please select Shift From time");
                toastr.warning("Please select Shift From time", "warning");
                return false;
            }
            else if ($scope.ShiftEndTime == "") {
                //alert("Please select Shift To time");
                toastr.warning("Please select Shift To time", "warning");
                return false;
            }

            else if (typeof ($scope.ShiftFromDate) == "undefined" || $scope.ShiftFromDate == 0) {
                //alert("Please select From Date");
                toastr.warning("Please select From Date", "warning");
                return false;
            }
            else if (typeof ($scope.ShiftToDate) == "undefined" || $scope.ShiftToDate == 0) {
                //alert("Please select To Date");
                toastr.warning("Please select To Date", "warning");
                return false;
            }
            $scope.ShiftFromDate = DateFormatEdit($scope.ShiftFromDate);
            $scope.ShiftToDate = DateFormatEdit($scope.ShiftToDate);
            return true;
        };

        $scope.ShiftTimingAddEdit = function () {
            if ($scope.ShiftTimings_InsertUpdateValidations() == true) {
                $("#chatLoaderPV").show();
                var obj = {
                    Id: $scope.Id,
                    InstituteId: $window.localStorage['InstitutionId'],
                    ShiftName: $scope.ShiftName,
                    ShiftFromTime: $scope.ShiftFromTime == '' ? null : $scope.Convert12To24Timeformat($scope.ShiftFromTime),
                    ShiftEndTime: $scope.ShiftEndTime == '' ? null : $scope.Convert12To24Timeformat($scope.ShiftEndTime),
                    ShiftFromDate: moment($scope.ShiftFromDate).format('DD-MMM-YYYY'),
                    ShiftToDate: moment($scope.ShiftToDate).format('DD-MMM-YYYY'),
                };
                $http.post(baseUrl + '/api/ShiftTmings/ShiftTimings_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $scope.ShiftTimingList();
                    $scope.ClearShiftTimingPopUp();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Parameter" + data;
                });
                $("#chatLoaderPV").hide();
            }
        };

        $scope.searchquerySlotTimings = "";
        /* Filter the master list function.*/
        $scope.FilterSlotTimingList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquerySlotTimings);
            if (searchstring == "") {
                $scope.rowCollectionShiftTimingsFilter = [];
                $scope.rowCollectionShiftTimingsFilter = angular.copy($scope.rowCollectionShiftTimings);
            }
            else {
                $scope.rowCollectionShiftTimingsFilter = $ff($scope.rowCollectionShiftTimings, function (value) {
                    return angular.lowercase(value.ShiftName).match(searchstring) ||
                        angular.lowercase($filter('date')(value.ShiftToDate, "dd-MMM-yyyy")).match(searchstring) ||
                        angular.lowercase($filter('date')(value.ShiftFromDate, "dd-MMM-yyyy")).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.ShiftFromTime, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.ShiftEndTime, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring);

                });
            }
        }
        $scope.ShiftTimingList = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.emptydataShiftTimings = [];
                $scope.rowCollectionShiftTimings = [];

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }

                $http.get(baseUrl + '/api/ShiftTmings/ShiftTimings_List/Id?=0' + '&IsActive=' + $scope.ISact + '&InstituteId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                    $scope.emptydataShiftTimings = [];
                    $scope.rowCollectionShiftTimings = [];
                    $scope.rowCollectionShiftTimings = data;
                    $scope.rowCollectionShiftTimingsFilter = angular.copy($scope.rowCollectionShiftTimings);
                    if ($scope.rowCollectionShiftTimingsFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };
        $scope.ClearShiftTimingPopUp = function () {
            $scope.Id = 0;
            $scope.InstituteId = "";
            $scope.ShiftName = "";
            $scope.ShiftFromTime = "";
            $scope.ShiftEndTime = "";
            $scope.ShiftFromDate = "";
            $scope.ShiftToDate = "";
            $scope.CancelShiftTimingPopUp();
        }

        $scope.CancelShiftTimingPopUp = function () {
            angular.element('#AppointmentSlotModal').modal('hide');
            angular.element('#ViewAppointmentSlotModal').modal('hide');

        };

        $scope.ViewShiftTimings = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/ShiftTmings/ShiftTimings_View/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.DuplicatesId = data.Id;
                $scope.Id = data.Id;
                $scope.ShiftName = data.ShiftName;
                var SFD = moment(data.ShiftFromDate).format('DD-MMM-YYYY');
                $scope.ShiftFromDate = DateFormatEdit(SFD);
                var STD = moment(data.ShiftToDate).format('DD-MMM-YYYY');
                $scope.ShiftToDate = DateFormatEdit(STD);
                $scope.ShiftFromTime = $filter('date')(data.ShiftFromTime, "hh:mm a");
                $scope.ShiftEndTime = $filter('date')(data.ShiftEndTime, "hh:mm a");
            });
            $("#chatLoaderPV").hide();
        };

        /* 
    Calling the api method to detele the details of the Allergy
    for the  Allergy Id,
    and redirected to the list page.
    */
        $scope.DeleteShiftTimingsSlot = function (comId) {
            $scope.Id = comId;
            $scope.ShiftTimings_InActive();
        };
        $scope.ShiftTimings_InActive = function () {
            var del = confirm("Do you like to deactivate the selected Shift Slot?");
            if (del == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/ShiftTmings/ShiftTimings_InActive/', obj).success(function (data) {
                    //alert(data.Message);
                    toastr.success(data.Message, "success");
                    $scope.ShiftTimingList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Shift Slot" + data;
                });
            };
        };

        /*'Active' the Allergy*/
        $scope.ReInsertShiftTimingsSlot = function (comId) {
            $scope.Id = comId;
            $scope.ShiftTimings_Active();
        };
        /* 
        Calling the api method to inactived the details of the Allergy 
        for the  Allergy Id,
        and redirected to the list page.
        */
        $scope.ShiftTimings_Active = function () {
            $http.get(baseUrl + '/api/ShiftTmings/ActivateShiftTiming_List/?Id=' + $scope.Id
                + '&Institution_Id=' + $window.localStorage['InstitutionId']
            ).success(function (data) {
                if (data.returnval == 1) {
                    //alert("Activate Shift Slot is already created, Please check");
                    toastr.info("Activate Shift Slot is already created, Please check", "info");
                }
                else {
                    var Ins = confirm("Do you like to activate the selected Shift Slot?");
                    if (Ins == true) {
                        var obj =
                        {
                            Id: $scope.Id,
                            Modified_By: $window.localStorage['UserId']
                        }

                        $http.post(baseUrl + '/api/ShiftTmings/ShiftTimings_Active/', obj).success(function (data) {
                            //alert(data.Message);
                            toastr.success(data.Message, "success");
                            $scope.ShiftTimingList();
                        }).error(function (data) {
                            $scope.error = "An error has occurred while deleting Shift Slot" + data;
                        });
                    };
                }
            })
        }

        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }

    }

]);

MyCortexControllers.controller("DoctorShiftController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {

        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.page_size = 0;
        $scope.currentTab = "1";
        $scope.DoctorSave = true;
        $scope.DevicesLists = [];
        $scope.SelectedDepartment = [];
        $scope.SelectedSpecialist = [];
        $scope.SelectedCCCG = [];
        $scope.ConfigCode = "PAGINATION";
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            if (data[0] != undefined) {
                $scope.page_size = parseInt(data[0].ConfigValue);
                $window.localStorage['Pagesize'] = $scope.page_size;
            }
        });
        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }

        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.listdata = [];
        $scope.Institution_Name = "";
        $scope.Doctor_Id = "0";
        $scope.Doctor_Name = "";
        $scope.SundayChildModuleList = [];
        $scope.MondayChildModuleList = [];
        $scope.TuesdayChildModuleList = [];
        $scope.WednessdayChildModuleList = [];
        $scope.ThursdayChildModuleList = [];
        $scope.FridayChildModuleList = [];
        $scope.SaturdayChildModuleList = [];
        $scope.FromDate = "";
        $scope.ToDate = "";
        $scope.Doctor_Id = [];
        $scope.SpecialitiesSelectList = [];
        $scope.Specialitiesinput = "";
        $scope.SelectedDays = [];

        $scope.DuplicateId = "0";
        $scope.flag = 0;
        $scope.IsActive = true;
        $scope.rowCollection = [];
        $scope.rowCollectionFilter = [];

        $scope.Id = 0;
        $scope.CC_Id = 3;
        $('#SundayCheck').hide();
        $('#MondayCheck').hide();
        $('#TuesdayCheck').hide();
        $('#WednesdayCheck').hide();
        $('#ThursdayCheck').hide();
        $('#FridayCheck').hide();
        $('#SaturdayCheck').hide();
        $("#SundayId").attr("disabled", true);
        $("#MondayId").attr("disabled", true);
        $("#TuesdayId").attr("disabled", true);
        $("#WednesdayId").attr("disabled", true);
        $("#ThursdayId").attr("disabled", true);
        $("#FridayId").attr("disabled", true);
        $("#SaturdayId").attr("disabled", true);
        $scope.TimeSlot1 = new Date();
        $scope.TimeSlot2 = new Date();
        $scope.TimeSlot3 = new Date();
        $scope.TimeSlot4 = new Date();
        $scope.TimeSlot5 = new Date();
        $scope.TimeSlot6 = new Date();
        $scope.TimeSlot7 = new Date();
        $scope.TimeSlot8 = new Date();
        $scope.TimeSlot9 = new Date();
        $scope.TimeSlot10 = new Date();
        $scope.TimeSlot11 = new Date();
        $scope.TimeSlot12 = new Date();
        $scope.TimeSlot13 = new Date();
        $scope.TimeSlot14 = new Date();
        $scope.TimeSlot15 = new Date();
        $scope.TimeSlot16 = new Date();
        $scope.TimeSlot17 = new Date();
        $scope.TimeSlot18 = new Date();
        $scope.TimeSlot19 = new Date();
        $scope.TimeSlot20 = new Date();
        $scope.TimeSlot21 = new Date();
        $scope.TimeSlot22 = new Date();
        $scope.TimeSlot23 = new Date();
        $scope.TimeSlot24 = new Date();
        $scope.TimeSlot25 = new Date();
        $scope.TimeSlot26 = new Date();
        $scope.TimeSlot27 = new Date();
        $scope.TimeSlot28 = new Date();
        $scope.TimeSlot29 = new Date();
        $scope.TimeSlot30 = new Date();
        $scope.TimeSlot31 = new Date();
        $scope.TimeSlot32 = new Date();
        $scope.TimeSlot33 = new Date();
        $scope.TimeSlot34 = new Date();
        $scope.TimeSlot35 = new Date();
        $scope.TimeSlot36 = new Date();
        $scope.TimeSlot37 = new Date();
        $scope.TimeSlot38 = new Date();
        $scope.TimeSlot39 = new Date();
        $scope.TimeSlot40 = new Date();
        $scope.TimeSlot41 = new Date();
        $scope.TimeSlot42 = new Date();
        $scope.TimeSlot43 = new Date();
        $scope.TimeSlot44 = new Date();
        $scope.TimeSlot45 = new Date();
        $scope.TimeSlot46 = new Date();
        $scope.TimeSlot47 = new Date();
        $scope.TimeSlot48 = new Date();
        $scope.TimeSlot49 = new Date();
        $scope.TimeSlot50 = new Date();
        $scope.TimeSlot51 = new Date();
        $scope.TimeSlot52 = new Date();
        $scope.TimeSlot53 = new Date();
        $scope.TimeSlot54 = new Date();
        $scope.TimeSlot55 = new Date();
        $scope.TimeSlot56 = new Date();
        $scope.NewAppointment2 = "0";
        $scope.followup2 = "0";
        $scope.IntervalBt2 = "0";
        $scope.Days2 = "0";
        $scope.Minutes2 = "0";

        $http.get(baseUrl + '/api/User/DepartmentList/').success(function (data) {
            $scope.DepartmentList = data;
        });
        $http.get(baseUrl + '/api/User/UserDetailsbyUserType_List/Id?=' + $scope.CC_Id + '&IsActive=' + 1 + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
            $scope.CCCG_DetailsList = data;
        });

        $scope.AddSlot = function () {
            $("#chatLoaderPV").show();
            $scope.Id = 0;
            $scope.DoctorSave = true;
            $('#Shift1Select').prop('checked', false);
            $('#Shift2Select').prop('checked', false);
            $('#Shift3Select').prop('checked', false);
            $('#Shift4Select').prop('checked', false);
            var $sel1 = $('#department');
            $sel1.multiselect('enable');
            var $sel2 = $('#Specialist');
            $sel2.multiselect('enable');
            var $sel3 = $('#CCCG');
            $sel3.multiselect('enable');
            $scope.EditShiftDoctor();
            // $scope.AppoinmentSlotClear();
            $('#saveDoctorShift1').attr("disabled", false);
            $('#saveDoctorShift2').attr("disabled", false);
            $('#saveDoctorShift3').attr("disabled", false);
            angular.element('#DoctorShiftModal').modal('show');
            $("#chatLoaderPV").hide();
        }
        $scope.onChangeDepartment = function () {
            $("#chatLoaderPV").show();
            var today = moment(new Date()).format('DD-MMM-YYYY');
            var SelectedDepartmentId = "";
            angular.forEach($scope.SelectedDepartment, function (Department_Id, index) {
                if ($scope.SelectedDepartment.length == 1) {
                    SelectedDepartmentId = Department_Id.toString();
                }
                else if (SelectedDepartmentId != "" || $scope.SelectedDepartment.length > 1) {
                    SelectedDepartmentId = SelectedDepartmentId + Department_Id + ',';

                }
            });
            if ($scope.SelectedDepartment.length != 1) {
                SelectedDepartmentId = SelectedDepartmentId.toString().slice(0, -1);
            }
            if (SelectedDepartmentId != "") {
                $http.get(baseUrl + '/api/PatientAppointments/DepartmentwiseDoctorList/?DepartmentIds=' + SelectedDepartmentId + '&InstitutionId=' + $window.localStorage['InstitutionId'] +
                    '&Date=' + today + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                        $scope.SelectedDoctorList = data;
                    });
            } else {
                $scope.SelectedDoctorList = [];
            }
            $("#chatLoaderPV").hide();
        }

        $scope.OrgDefaultClick = function (event) {
            var checked = $('#OrgDefaultId').is(":checked")
            if (checked == true) {
                if (($scope.NewAppointment2 == "0" && $scope.followup2 == "0" && $scope.IntervalBt2 == "0") || ($scope.NewAppointment2.toString().trim() == "" && $scope.followup2.toString().trim() == "" && $scope.IntervalBt2.toString().trim() == "")) {
                    $("#chatLoaderPV").show();
                    $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingView/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $window.localStorage['Login_Session_Id']).success(function (data) {
                        $("#chatLoaderPV").hide();
                        if (data != null && data.length != 0) {
                            $scope.Days = data.MaxScheduleDays;
                            $scope.Minutes = data.MinRescheduleMinutes;
                            $scope.Days2 = data.MaxScheduleDays;
                            $scope.Minutes2 = data.MinRescheduleMinutes;
                            $scope.NewAppointment = data.NewAppointmentDuration;
                            $scope.followup = data.FollowUpDuration;
                            $scope.IntervalBt = data.AppointmentInterval;
                            $scope.NewAppointment2 = data.NewAppointmentDuration;
                            $scope.followup2 = data.FollowUpDuration;
                            $scope.IntervalBt2 = data.AppointmentInterval;
                        } else {
                            $('#OrgDefaultId').prop('checked', false);
                        }

                    }).error(function (data) {
                        $("#chatLoaderPV").hide();
                    });
                } else {
                    $scope.NewAppointment = $scope.NewAppointment2;
                    $scope.followup = $scope.followup2;
                    $scope.IntervalBt = $scope.IntervalBt2;
                }
            } else {
                $scope.NewAppointment = "0";
                $scope.followup = "0";
                $scope.IntervalBt = "0";
            }
        }

        $scope.OrgBookInfoDefaultClick = function (event) {
            var checked = $('#OrgBookInfoId').is(":checked")
            if (checked == true) {
                if (($scope.Days2 == "0" && $scope.Minutes2 == "0") || ($scope.Days2.toString().trim() == "" && $scope.Minutes2.toString().trim() == "")) {
                    $("#chatLoaderPV").show();
                    $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingView/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $window.localStorage['Login_Session_Id']).success(function (data) {
                        $("#chatLoaderPV").hide();
                        if (data != null && data.length != 0) {
                            $scope.Days = data.MaxScheduleDays;
                            $scope.Minutes = data.MinRescheduleMinutes;
                            $scope.Days2 = data.MaxScheduleDays;
                            $scope.Minutes2 = data.MinRescheduleMinutes;
                            $scope.NewAppointment = data.NewAppointmentDuration;
                            $scope.followup = data.FollowUpDuration;
                            $scope.IntervalBt = data.AppointmentInterval;
                            $scope.NewAppointment2 = data.NewAppointmentDuration;
                            $scope.followup2 = data.FollowUpDuration;
                            $scope.IntervalBt2 = data.AppointmentInterval;
                        } else {
                            $('#OrgBookInfoId').prop('checked', false);
                        }
                    }).error(function (data) {
                        $("#chatLoaderPV").hide();
                    });
                } else {
                    $scope.Days = $scope.Days2;
                    $scope.Minutes = $scope.Minutes2;
                }
            } else {
                $scope.Days = "0";
                $scope.Minutes = "0";
            }
        }

        $scope.Shift1_SelectAllClick = function (event) {
            var checked = $('#Shift1Select').is(":checked")
            if (checked == true) {
                if (($scope.TimeSlot1 == 0 && $scope.TimeSlot2 == 0) && ($scope.TimeSlot7 == 0 && $scope.TimeSlot8 == 0) && ($scope.TimeSlot13 == 0 && $scope.TimeSlot14 == 0) && ($scope.TimeSlot19 == 0 && $scope.TimeSlot20 == 0) &&
                    ($scope.TimeSlot25 == 0 && $scope.TimeSlot26 == 0) && ($scope.TimeSlot31 == 0 && $scope.TimeSlot32 == 0) && ($scope.TimeSlot37 == 0 && $scope.TimeSlot38 == 0)) {
                    //alert('Please Enter Any One Shift !');
                    toastr.warning("Please Enter Any One Shift !", "warning");
                    $('#Shift1Select').prop('checked', false);
                }
                else {
                    $("#chatLoaderPV").show();
                    if ($scope.TimeSlot1 != 0 && $scope.TimeSlot2 != 0) {
                        $scope.TimeSlot7 = angular.copy($scope.TimeSlot1);
                        $scope.TimeSlot8 = angular.copy($scope.TimeSlot2);

                        $scope.TimeSlot13 = angular.copy($scope.TimeSlot1);
                        $scope.TimeSlot14 = angular.copy($scope.TimeSlot2);

                        $scope.TimeSlot19 = angular.copy($scope.TimeSlot1);
                        $scope.TimeSlot20 = angular.copy($scope.TimeSlot2);

                        $scope.TimeSlot25 = angular.copy($scope.TimeSlot1);
                        $scope.TimeSlot26 = angular.copy($scope.TimeSlot2);

                        $scope.TimeSlot31 = angular.copy($scope.TimeSlot1);
                        $scope.TimeSlot32 = angular.copy($scope.TimeSlot2);

                        $scope.TimeSlot37 = angular.copy($scope.TimeSlot1);
                        $scope.TimeSlot38 = angular.copy($scope.TimeSlot2);
                    }
                    else if ($scope.TimeSlot7 != 0 && $scope.TimeSlot8 != 0) {
                        $scope.TimeSlot1 = angular.copy($scope.TimeSlot7);
                        $scope.TimeSlot2 = angular.copy($scope.TimeSlot8);

                        $scope.TimeSlot13 = angular.copy($scope.TimeSlot7);
                        $scope.TimeSlot14 = angular.copy($scope.TimeSlot8);

                        $scope.TimeSlot19 = angular.copy($scope.TimeSlot7);
                        $scope.TimeSlot20 = angular.copy($scope.TimeSlot8);

                        $scope.TimeSlot25 = angular.copy($scope.TimeSlot7);
                        $scope.TimeSlot26 = angular.copy($scope.TimeSlot8);

                        $scope.TimeSlot31 = angular.copy($scope.TimeSlot7);
                        $scope.TimeSlot32 = angular.copy($scope.TimeSlot8);

                        $scope.TimeSlot37 = angular.copy($scope.TimeSlot7);
                        $scope.TimeSlot38 = angular.copy($scope.TimeSlot8);
                    }
                    else if ($scope.TimeSlot13 != 0 && $scope.TimeSlot14 != 0) {
                        $scope.TimeSlot1 = angular.copy($scope.TimeSlot13);
                        $scope.TimeSlot2 = angular.copy($scope.TimeSlot14);

                        $scope.TimeSlot7 = angular.copy($scope.TimeSlot13);
                        $scope.TimeSlot8 = angular.copy($scope.TimeSlot14);

                        $scope.TimeSlot19 = angular.copy($scope.TimeSlot13);
                        $scope.TimeSlot20 = angular.copy($scope.TimeSlot14);

                        $scope.TimeSlot25 = angular.copy($scope.TimeSlot13);
                        $scope.TimeSlot26 = angular.copy($scope.TimeSlot14);

                        $scope.TimeSlot31 = angular.copy($scope.TimeSlot13);
                        $scope.TimeSlot32 = angular.copy($scope.TimeSlot14);

                        $scope.TimeSlot37 = angular.copy($scope.TimeSlot13);
                        $scope.TimeSlot38 = angular.copy($scope.TimeSlot14);
                    }
                    else if ($scope.TimeSlot19 != 0 && $scope.TimeSlot20 != 0) {
                        $scope.TimeSlot1 = angular.copy($scope.TimeSlot19);
                        $scope.TimeSlot2 = angular.copy($scope.TimeSlot20);

                        $scope.TimeSlot7 = angular.copy($scope.TimeSlot19);
                        $scope.TimeSlot8 = angular.copy($scope.TimeSlot20);

                        $scope.TimeSlot13 = angular.copy($scope.TimeSlot19);
                        $scope.TimeSlot14 = angular.copy($scope.TimeSlot20);

                        $scope.TimeSlot25 = angular.copy($scope.TimeSlot19);
                        $scope.TimeSlot26 = angular.copy($scope.TimeSlot20);

                        $scope.TimeSlot31 = angular.copy($scope.TimeSlot19);
                        $scope.TimeSlot32 = angular.copy($scope.TimeSlot20);

                        $scope.TimeSlot37 = angular.copy($scope.TimeSlot19);
                        $scope.TimeSlot38 = angular.copy($scope.TimeSlot20);
                    }
                    else if ($scope.TimeSlot25 != 0 && $scope.TimeSlot26 != 0) {
                        $scope.TimeSlot1 = angular.copy($scope.TimeSlot25);
                        $scope.TimeSlot2 = angular.copy($scope.TimeSlot26);

                        $scope.TimeSlot7 = angular.copy($scope.TimeSlot25);
                        $scope.TimeSlot8 = angular.copy($scope.TimeSlot26);

                        $scope.TimeSlot13 = angular.copy($scope.TimeSlot25);
                        $scope.TimeSlot14 = angular.copy($scope.TimeSlot26);

                        $scope.TimeSlot19 = angular.copy($scope.TimeSlot25);
                        $scope.TimeSlot20 = angular.copy($scope.TimeSlot26);

                        $scope.TimeSlot31 = angular.copy($scope.TimeSlot25);
                        $scope.TimeSlot32 = angular.copy($scope.TimeSlot26);

                        $scope.TimeSlot37 = angular.copy($scope.TimeSlot25);
                        $scope.TimeSlot38 = angular.copy($scope.TimeSlot26);
                    }
                    else if ($scope.TimeSlot31 != 0 && $scope.TimeSlot32 != 0) {
                        $scope.TimeSlot1 = angular.copy($scope.TimeSlot31);
                        $scope.TimeSlot2 = angular.copy($scope.TimeSlot32);

                        $scope.TimeSlot7 = angular.copy($scope.TimeSlot31);
                        $scope.TimeSlot8 = angular.copy($scope.TimeSlot32);

                        $scope.TimeSlot13 = angular.copy($scope.TimeSlot31);
                        $scope.TimeSlot14 = angular.copy($scope.TimeSlot32);

                        $scope.TimeSlot19 = angular.copy($scope.TimeSlot31);
                        $scope.TimeSlot20 = angular.copy($scope.TimeSlot32);

                        $scope.TimeSlot25 = angular.copy($scope.TimeSlot31);
                        $scope.TimeSlot26 = angular.copy($scope.TimeSlot32);

                        $scope.TimeSlot37 = angular.copy($scope.TimeSlot31);
                        $scope.TimeSlot38 = angular.copy($scope.TimeSlot32);
                    }
                    else if ($scope.TimeSlot37 != 0 && $scope.TimeSlot38 != 0) {
                        $scope.TimeSlot1 = angular.copy($scope.TimeSlot37);
                        $scope.TimeSlot2 = angular.copy($scope.TimeSlot38);

                        $scope.TimeSlot7 = angular.copy($scope.TimeSlot37);
                        $scope.TimeSlot8 = angular.copy($scope.TimeSlot38);

                        $scope.TimeSlot13 = angular.copy($scope.TimeSlot37);
                        $scope.TimeSlot14 = angular.copy($scope.TimeSlot38);

                        $scope.TimeSlot19 = angular.copy($scope.TimeSlot37);
                        $scope.TimeSlot20 = angular.copy($scope.TimeSlot38);

                        $scope.TimeSlot25 = angular.copy($scope.TimeSlot37);
                        $scope.TimeSlot26 = angular.copy($scope.TimeSlot38);

                        $scope.TimeSlot31 = angular.copy($scope.TimeSlot37);
                        $scope.TimeSlot32 = angular.copy($scope.TimeSlot38);
                    }
                    else {
                        //alert('Please Enter Proper Shift FromTime And ToTime !');
                        toastr.info("Please Enter Proper Shift FromTime And ToTime !", "info");
                        $('#Shift1Select').prop('checked', false);
                        return false;
                    }
                    $("#chatLoaderPV").hide();
                }
            } else {
                $scope.TimeSlot1 = "";
                $scope.TimeSlot2 = "";
                $scope.TimeSlot7 = "";
                $scope.TimeSlot8 = "";
                $scope.TimeSlot13 = "";
                $scope.TimeSlot14 = "";
                $scope.TimeSlot19 = "";
                $scope.TimeSlot20 = "";
                $scope.TimeSlot25 = "";
                $scope.TimeSlot26 = "";
                $scope.TimeSlot31 = "";
                $scope.TimeSlot32 = "";
                $scope.TimeSlot37 = "";
                $scope.TimeSlot38 = "";
            }
        }

        $scope.Shift2_SelectAllClick = function (event) {
            var checked = $('#Shift2Select').is(":checked")
            if (checked == true) {
                if (($scope.TimeSlot3 == 0 && $scope.TimeSlot4 == 0) && ($scope.TimeSlot9 == 0 && $scope.TimeSlot10 == 0) && ($scope.TimeSlot15 == 0 && $scope.TimeSlot16 == 0) && ($scope.TimeSlot21 == 0 && $scope.TimeSlot22 == 0) &&
                    ($scope.TimeSlot27 == 0 && $scope.TimeSlot28 == 0) && ($scope.TimeSlot33 == 0 && $scope.TimeSlot34 == 0) && ($scope.TimeSlot39 == 0 && $scope.TimeSlot40 == 0)) {
                    //alert('Please Enter Any One Shift !');
                    toastr.warning("Please Enter Any One Shift !", "warning");
                    $('#Shift2Select').prop('checked', false);
                }
                else {
                    $("#chatLoaderPV").show();
                    if ($scope.TimeSlot3 != 0 && $scope.TimeSlot4 != 0) {
                        $scope.TimeSlot9 = angular.copy($scope.TimeSlot3);
                        $scope.TimeSlot10 = angular.copy($scope.TimeSlot4);

                        $scope.TimeSlot15 = angular.copy($scope.TimeSlot3);
                        $scope.TimeSlot16 = angular.copy($scope.TimeSlot4);

                        $scope.TimeSlot21 = angular.copy($scope.TimeSlot3);
                        $scope.TimeSlot22 = angular.copy($scope.TimeSlot4);

                        $scope.TimeSlot27 = angular.copy($scope.TimeSlot3);
                        $scope.TimeSlot28 = angular.copy($scope.TimeSlot4);

                        $scope.TimeSlot33 = angular.copy($scope.TimeSlot3);
                        $scope.TimeSlot34 = angular.copy($scope.TimeSlot4);

                        $scope.TimeSlot39 = angular.copy($scope.TimeSlot3);
                        $scope.TimeSlot40 = angular.copy($scope.TimeSlot4);
                    }
                    else if ($scope.TimeSlot9 != 0 && $scope.TimeSlot10 != 0) {
                        $scope.TimeSlot3 = angular.copy($scope.TimeSlot9);
                        $scope.TimeSlot4 = angular.copy($scope.TimeSlot10);

                        $scope.TimeSlot15 = angular.copy($scope.TimeSlot9);
                        $scope.TimeSlot16 = angular.copy($scope.TimeSlot10);

                        $scope.TimeSlot21 = angular.copy($scope.TimeSlot9);
                        $scope.TimeSlot22 = angular.copy($scope.TimeSlot10);

                        $scope.TimeSlot27 = angular.copy($scope.TimeSlot9);
                        $scope.TimeSlot28 = angular.copy($scope.TimeSlot10);

                        $scope.TimeSlot33 = angular.copy($scope.TimeSlot9);
                        $scope.TimeSlot34 = angular.copy($scope.TimeSlot10);

                        $scope.TimeSlot39 = angular.copy($scope.TimeSlot9);
                        $scope.TimeSlot40 = angular.copy($scope.TimeSlot10);
                    }
                    else if ($scope.TimeSlot15 != 0 && $scope.TimeSlot16 != 0) {
                        $scope.TimeSlot3 = angular.copy($scope.TimeSlot15);
                        $scope.TimeSlot4 = angular.copy($scope.TimeSlot16);

                        $scope.TimeSlot9 = angular.copy($scope.TimeSlot15);
                        $scope.TimeSlot10 = angular.copy($scope.TimeSlot16);

                        $scope.TimeSlot21 = angular.copy($scope.TimeSlot15);
                        $scope.TimeSlot22 = angular.copy($scope.TimeSlot16);

                        $scope.TimeSlot27 = angular.copy($scope.TimeSlot15);
                        $scope.TimeSlot28 = angular.copy($scope.TimeSlot16);

                        $scope.TimeSlot33 = angular.copy($scope.TimeSlot15);
                        $scope.TimeSlot34 = angular.copy($scope.TimeSlot16);

                        $scope.TimeSlot39 = angular.copy($scope.TimeSlot15);
                        $scope.TimeSlot40 = angular.copy($scope.TimeSlot16);
                    }
                    else if ($scope.TimeSlot21 != 0 && $scope.TimeSlot22 != 0) {
                        $scope.TimeSlot3 = angular.copy($scope.TimeSlot21);
                        $scope.TimeSlot4 = angular.copy($scope.TimeSlot22);

                        $scope.TimeSlot9 = angular.copy($scope.TimeSlot21);
                        $scope.TimeSlot10 = angular.copy($scope.TimeSlot22);

                        $scope.TimeSlot15 = angular.copy($scope.TimeSlot21);
                        $scope.TimeSlot16 = angular.copy($scope.TimeSlot22);

                        $scope.TimeSlot27 = angular.copy($scope.TimeSlot21);
                        $scope.TimeSlot28 = angular.copy($scope.TimeSlot22);

                        $scope.TimeSlot33 = angular.copy($scope.TimeSlot21);
                        $scope.TimeSlot34 = angular.copy($scope.TimeSlot22);

                        $scope.TimeSlot39 = angular.copy($scope.TimeSlot21);
                        $scope.TimeSlot40 = angular.copy($scope.TimeSlot22);
                    }
                    else if ($scope.TimeSlot27 != 0 && $scope.TimeSlot28 != 0) {
                        $scope.TimeSlot3 = angular.copy($scope.TimeSlot27);
                        $scope.TimeSlot4 = angular.copy($scope.TimeSlot28);

                        $scope.TimeSlot9 = angular.copy($scope.TimeSlot27);
                        $scope.TimeSlot10 = angular.copy($scope.TimeSlot28);

                        $scope.TimeSlot15 = angular.copy($scope.TimeSlot27);
                        $scope.TimeSlot16 = angular.copy($scope.TimeSlot28);

                        $scope.TimeSlot21 = angular.copy($scope.TimeSlot27);
                        $scope.TimeSlot22 = angular.copy($scope.TimeSlot28);

                        $scope.TimeSlot33 = angular.copy($scope.TimeSlot27);
                        $scope.TimeSlot34 = angular.copy($scope.TimeSlot28);

                        $scope.TimeSlot39 = angular.copy($scope.TimeSlot27);
                        $scope.TimeSlot40 = angular.copy($scope.TimeSlot28);
                    }
                    else if ($scope.TimeSlot33 != 0 && $scope.TimeSlot34 != 0) {
                        $scope.TimeSlot3 = angular.copy($scope.TimeSlot33);
                        $scope.TimeSlot4 = angular.copy($scope.TimeSlot34);

                        $scope.TimeSlot9 = angular.copy($scope.TimeSlot33);
                        $scope.TimeSlot10 = angular.copy($scope.TimeSlot34);

                        $scope.TimeSlot15 = angular.copy($scope.TimeSlot33);
                        $scope.TimeSlot16 = angular.copy($scope.TimeSlot34);

                        $scope.TimeSlot21 = angular.copy($scope.TimeSlot33);
                        $scope.TimeSlot22 = angular.copy($scope.TimeSlot34);

                        $scope.TimeSlot27 = angular.copy($scope.TimeSlot33);
                        $scope.TimeSlot28 = angular.copy($scope.TimeSlot34);

                        $scope.TimeSlot39 = angular.copy($scope.TimeSlot33);
                        $scope.TimeSlot40 = angular.copy($scope.TimeSlot34);
                    }
                    else if ($scope.TimeSlot39 != 0 && $scope.TimeSlot40 != 0) {
                        $scope.TimeSlot3 = angular.copy($scope.TimeSlot39);
                        $scope.TimeSlot4 = angular.copy($scope.TimeSlot40);

                        $scope.TimeSlot9 = angular.copy($scope.TimeSlot39);
                        $scope.TimeSlot10 = angular.copy($scope.TimeSlot40);

                        $scope.TimeSlot15 = angular.copy($scope.TimeSlot39);
                        $scope.TimeSlot16 = angular.copy($scope.TimeSlot40);

                        $scope.TimeSlot21 = angular.copy($scope.TimeSlot39);
                        $scope.TimeSlot22 = angular.copy($scope.TimeSlot40);

                        $scope.TimeSlot27 = angular.copy($scope.TimeSlot39);
                        $scope.TimeSlot28 = angular.copy($scope.TimeSlot40);

                        $scope.TimeSlot33 = angular.copy($scope.TimeSlot39);
                        $scope.TimeSlot34 = angular.copy($scope.TimeSlot40);
                    }
                    else {
                        alert('Please Enter Proper Shift FromTime And ToTime !');
                        $('#Shift2Select').prop('checked', false);
                        return false;
                    }
                    $("#chatLoaderPV").hide();
                }
            } else {
                $scope.TimeSlot3 = "";
                $scope.TimeSlot4 = "";
                $scope.TimeSlot9 = "";
                $scope.TimeSlot10 = "";
                $scope.TimeSlot15 = "";
                $scope.TimeSlot16 = "";
                $scope.TimeSlot21 = "";
                $scope.TimeSlot22 = "";
                $scope.TimeSlot27 = "";
                $scope.TimeSlot28 = "";
                $scope.TimeSlot33 = "";
                $scope.TimeSlot34 = "";
                $scope.TimeSlot39 = "";
                $scope.TimeSlot40 = "";

            }
        }

        $scope.Shift3_SelectAllClick = function (event) {
            var checked = $('#Shift3Select').is(":checked")
            if (checked == true) {
                if (($scope.TimeSlot5 == 0 && $scope.TimeSlot6 == 0) && ($scope.TimeSlot11 == 0 && $scope.TimeSlot12 == 0) && ($scope.TimeSlot17 == 0 && $scope.TimeSlot18 == 0) && ($scope.TimeSlot23 == 0 && $scope.TimeSlot24 == 0) &&
                    ($scope.TimeSlot29 == 0 && $scope.TimeSlot30 == 0) && ($scope.TimeSlot35 == 0 && $scope.TimeSlot36 == 0) && ($scope.TimeSlot41 == 0 && $scope.TimeSlot42 == 0)) {
                    //alert('Please Enter Any One Shift !');
                    toastr.warning("Please Enter Any One Shift!", "warning");
                    $('#Shift3Select').prop('checked', false);
                }
                else {
                    $("#chatLoaderPV").show();
                    if ($scope.TimeSlot5 != 0 && $scope.TimeSlot6 != 0) {
                        $scope.TimeSlot11 = angular.copy($scope.TimeSlot5);
                        $scope.TimeSlot12 = angular.copy($scope.TimeSlot6);

                        $scope.TimeSlot17 = angular.copy($scope.TimeSlot5);
                        $scope.TimeSlot18 = angular.copy($scope.TimeSlot6);

                        $scope.TimeSlot23 = angular.copy($scope.TimeSlot5);
                        $scope.TimeSlot24 = angular.copy($scope.TimeSlot6);

                        $scope.TimeSlot29 = angular.copy($scope.TimeSlot5);
                        $scope.TimeSlot30 = angular.copy($scope.TimeSlot6);

                        $scope.TimeSlot35 = angular.copy($scope.TimeSlot5);
                        $scope.TimeSlot36 = angular.copy($scope.TimeSlot6);

                        $scope.TimeSlot41 = angular.copy($scope.TimeSlot5);
                        $scope.TimeSlot42 = angular.copy($scope.TimeSlot6);
                    }
                    else if ($scope.TimeSlot11 != 0 && $scope.TimeSlot12 != 0) {
                        $scope.TimeSlot5 = angular.copy($scope.TimeSlot11);
                        $scope.TimeSlot6 = angular.copy($scope.TimeSlot12);

                        $scope.TimeSlot17 = angular.copy($scope.TimeSlot11);
                        $scope.TimeSlot18 = angular.copy($scope.TimeSlot12);

                        $scope.TimeSlot23 = angular.copy($scope.TimeSlot11);
                        $scope.TimeSlot24 = angular.copy($scope.TimeSlot12);

                        $scope.TimeSlot29 = angular.copy($scope.TimeSlot11);
                        $scope.TimeSlot30 = angular.copy($scope.TimeSlot12);

                        $scope.TimeSlot35 = angular.copy($scope.TimeSlot11);
                        $scope.TimeSlot36 = angular.copy($scope.TimeSlot12);

                        $scope.TimeSlot41 = angular.copy($scope.TimeSlot11);
                        $scope.TimeSlot42 = angular.copy($scope.TimeSlot12);
                    }
                    else if ($scope.TimeSlot17 != 0 && $scope.TimeSlot18 != 0) {
                        $scope.TimeSlot5 = angular.copy($scope.TimeSlot17);
                        $scope.TimeSlot6 = angular.copy($scope.TimeSlot18);

                        $scope.TimeSlot11 = angular.copy($scope.TimeSlot17);
                        $scope.TimeSlot12 = angular.copy($scope.TimeSlot18);

                        $scope.TimeSlot23 = angular.copy($scope.TimeSlot17);
                        $scope.TimeSlot24 = angular.copy($scope.TimeSlot18);

                        $scope.TimeSlot29 = angular.copy($scope.TimeSlot17);
                        $scope.TimeSlot30 = angular.copy($scope.TimeSlot18);

                        $scope.TimeSlot35 = angular.copy($scope.TimeSlot17);
                        $scope.TimeSlot36 = angular.copy($scope.TimeSlot18);

                        $scope.TimeSlot41 = angular.copy($scope.TimeSlot17);
                        $scope.TimeSlot42 = angular.copy($scope.TimeSlot18);
                    }
                    else if ($scope.TimeSlot23 != 0 && $scope.TimeSlot24 != 0) {
                        $scope.TimeSlot5 = angular.copy($scope.TimeSlot23);
                        $scope.TimeSlot6 = angular.copy($scope.TimeSlot24);

                        $scope.TimeSlot11 = angular.copy($scope.TimeSlot23);
                        $scope.TimeSlot12 = angular.copy($scope.TimeSlot24);

                        $scope.TimeSlot17 = angular.copy($scope.TimeSlot23);
                        $scope.TimeSlot18 = angular.copy($scope.TimeSlot24);

                        $scope.TimeSlot29 = angular.copy($scope.TimeSlot23);
                        $scope.TimeSlot30 = angular.copy($scope.TimeSlot24);

                        $scope.TimeSlot35 = angular.copy($scope.TimeSlot23);
                        $scope.TimeSlot36 = angular.copy($scope.TimeSlot24);

                        $scope.TimeSlot41 = angular.copy($scope.TimeSlot23);
                        $scope.TimeSlot42 = angular.copy($scope.TimeSlot24);
                    }
                    else if ($scope.TimeSlot29 != 0 && $scope.TimeSlot30 != 0) {
                        $scope.TimeSlot5 = angular.copy($scope.TimeSlot29);
                        $scope.TimeSlot6 = angular.copy($scope.TimeSlot30);

                        $scope.TimeSlot11 = angular.copy($scope.TimeSlot29);
                        $scope.TimeSlot12 = angular.copy($scope.TimeSlot30);

                        $scope.TimeSlot17 = angular.copy($scope.TimeSlot29);
                        $scope.TimeSlot18 = angular.copy($scope.TimeSlot30);

                        $scope.TimeSlot23 = angular.copy($scope.TimeSlot29);
                        $scope.TimeSlot24 = angular.copy($scope.TimeSlot30);

                        $scope.TimeSlot35 = angular.copy($scope.TimeSlot29);
                        $scope.TimeSlot36 = angular.copy($scope.TimeSlot30);

                        $scope.TimeSlot41 = angular.copy($scope.TimeSlot29);
                        $scope.TimeSlot42 = angular.copy($scope.TimeSlot30);
                    }
                    else if ($scope.TimeSlot35 != 0 && $scope.TimeSlot36 != 0) {
                        $scope.TimeSlot5 = angular.copy($scope.TimeSlot35);
                        $scope.TimeSlot6 = angular.copy($scope.TimeSlot36);

                        $scope.TimeSlot11 = angular.copy($scope.TimeSlot35);
                        $scope.TimeSlot12 = angular.copy($scope.TimeSlot36);

                        $scope.TimeSlot17 = angular.copy($scope.TimeSlot35);
                        $scope.TimeSlot18 = angular.copy($scope.TimeSlot36);

                        $scope.TimeSlot23 = angular.copy($scope.TimeSlot35);
                        $scope.TimeSlot24 = angular.copy($scope.TimeSlot36);

                        $scope.TimeSlot29 = angular.copy($scope.TimeSlot35);
                        $scope.TimeSlot30 = angular.copy($scope.TimeSlot36);

                        $scope.TimeSlot41 = angular.copy($scope.TimeSlot35);
                        $scope.TimeSlot42 = angular.copy($scope.TimeSlot36);
                    }
                    else if ($scope.TimeSlot41 != 0 && $scope.TimeSlot42 != 0) {
                        $scope.TimeSlot5 = angular.copy($scope.TimeSlot41);
                        $scope.TimeSlot6 = angular.copy($scope.TimeSlot42);

                        $scope.TimeSlot11 = angular.copy($scope.TimeSlot41);
                        $scope.TimeSlot12 = angular.copy($scope.TimeSlot42);

                        $scope.TimeSlot17 = angular.copy($scope.TimeSlot41);
                        $scope.TimeSlot18 = angular.copy($scope.TimeSlot42);

                        $scope.TimeSlot23 = angular.copy($scope.TimeSlot41);
                        $scope.TimeSlot24 = angular.copy($scope.TimeSlot42);

                        $scope.TimeSlot29 = angular.copy($scope.TimeSlot41);
                        $scope.TimeSlot30 = angular.copy($scope.TimeSlot42);

                        $scope.TimeSlot35 = angular.copy($scope.TimeSlot41);
                        $scope.TimeSlot36 = angular.copy($scope.TimeSlot42);
                    }
                    else {
                        //alert('Please Enter Proper Shift FromTime And ToTime !');
                        toastr.warning("Please Enter Proper Shift FromTime And ToTime!", "warning");
                        $('#Shift3Select').prop('checked', false);
                        return false;
                    }
                    $("#chatLoaderPV").hide();
                }
            } else {
                $scope.TimeSlot5 = "";
                $scope.TimeSlot6 = "";
                $scope.TimeSlot11 = "";
                $scope.TimeSlot12 = "";
                $scope.TimeSlot17 = "";
                $scope.TimeSlot18 = "";
                $scope.TimeSlot23 = "";
                $scope.TimeSlot24 = "";
                $scope.TimeSlot29 = "";
                $scope.TimeSlot30 = "";
                $scope.TimeSlot35 = "";
                $scope.TimeSlot36 = "";
                $scope.TimeSlot41 = "";
                $scope.TimeSlot42 = "";
            }
        }

        $scope.Shift4_SelectAllClick = function (event) {
            var checked = $('#Shift4Select').is(":checked")
            if (checked == true) {
                if (($scope.TimeSlot43 == 0 && $scope.TimeSlot44 == 0) && ($scope.TimeSlot45 == 0 && $scope.TimeSlot46 == 0) && ($scope.TimeSlot47 == 0 && $scope.TimeSlot48 == 0) && ($scope.TimeSlot49 == 0 && $scope.TimeSlot50 == 0) &&
                    ($scope.TimeSlot51 == 0 && $scope.TimeSlot52 == 0) && ($scope.TimeSlot53 == 0 && $scope.TimeSlot54 == 0) && ($scope.TimeSlot55 == 0 && $scope.TimeSlot56 == 0)) {
                    //alert('Please Enter Any One Shift !');
                    toastr.warning("Please Enter Any One Shift!", "warning");
                    $('#Shift4Select').prop('checked', false);
                }
                else {
                    $("#chatLoaderPV").show();
                    if ($scope.TimeSlot43 != 0 && $scope.TimeSlot44 != 0) {
                        $scope.TimeSlot45 = angular.copy($scope.TimeSlot43);
                        $scope.TimeSlot46 = angular.copy($scope.TimeSlot44);

                        $scope.TimeSlot47 = angular.copy($scope.TimeSlot43);
                        $scope.TimeSlot48 = angular.copy($scope.TimeSlot44);

                        $scope.TimeSlot49 = angular.copy($scope.TimeSlot43);
                        $scope.TimeSlot50 = angular.copy($scope.TimeSlot44);

                        $scope.TimeSlot51 = angular.copy($scope.TimeSlot43);
                        $scope.TimeSlot52 = angular.copy($scope.TimeSlot44);

                        $scope.TimeSlot53 = angular.copy($scope.TimeSlot43);
                        $scope.TimeSlot54 = angular.copy($scope.TimeSlot44);

                        $scope.TimeSlot55 = angular.copy($scope.TimeSlot43);
                        $scope.TimeSlot56 = angular.copy($scope.TimeSlot44);
                    }
                    else if ($scope.TimeSlot45 != 0 && $scope.TimeSlot46 != 0) {
                        $scope.TimeSlot43 = angular.copy($scope.TimeSlot45);
                        $scope.TimeSlot44 = angular.copy($scope.TimeSlot46);

                        $scope.TimeSlot47 = angular.copy($scope.TimeSlot45);
                        $scope.TimeSlot48 = angular.copy($scope.TimeSlot46);

                        $scope.TimeSlot49 = angular.copy($scope.TimeSlot45);
                        $scope.TimeSlot50 = angular.copy($scope.TimeSlot46);

                        $scope.TimeSlot51 = angular.copy($scope.TimeSlot45);
                        $scope.TimeSlot52 = angular.copy($scope.TimeSlot46);

                        $scope.TimeSlot53 = angular.copy($scope.TimeSlot45);
                        $scope.TimeSlot54 = angular.copy($scope.TimeSlot46);

                        $scope.TimeSlot55 = angular.copy($scope.TimeSlot45);
                        $scope.TimeSlot56 = angular.copy($scope.TimeSlot46);
                    }
                    else if ($scope.TimeSlot47 != 0 && $scope.TimeSlot48 != 0) {
                        $scope.TimeSlot43 = angular.copy($scope.TimeSlot47);
                        $scope.TimeSlot44 = angular.copy($scope.TimeSlot48);

                        $scope.TimeSlot45 = angular.copy($scope.TimeSlot47);
                        $scope.TimeSlot46 = angular.copy($scope.TimeSlot48);

                        $scope.TimeSlot49 = angular.copy($scope.TimeSlot47);
                        $scope.TimeSlot50 = angular.copy($scope.TimeSlot48);

                        $scope.TimeSlot51 = angular.copy($scope.TimeSlot47);
                        $scope.TimeSlot52 = angular.copy($scope.TimeSlot48);

                        $scope.TimeSlot53 = angular.copy($scope.TimeSlot47);
                        $scope.TimeSlot54 = angular.copy($scope.TimeSlot48);

                        $scope.TimeSlot55 = angular.copy($scope.TimeSlot47);
                        $scope.TimeSlot56 = angular.copy($scope.TimeSlot48);
                    }
                    else if ($scope.TimeSlot49 != 0 && $scope.TimeSlot50 != 0) {
                        $scope.TimeSlot43 = angular.copy($scope.TimeSlot49);
                        $scope.TimeSlot44 = angular.copy($scope.TimeSlot50);

                        $scope.TimeSlot45 = angular.copy($scope.TimeSlot49);
                        $scope.TimeSlot46 = angular.copy($scope.TimeSlot50);

                        $scope.TimeSlot47 = angular.copy($scope.TimeSlot49);
                        $scope.TimeSlot48 = angular.copy($scope.TimeSlot50);

                        $scope.TimeSlot51 = angular.copy($scope.TimeSlot49);
                        $scope.TimeSlot52 = angular.copy($scope.TimeSlot50);

                        $scope.TimeSlot53 = angular.copy($scope.TimeSlot49);
                        $scope.TimeSlot54 = angular.copy($scope.TimeSlot50);

                        $scope.TimeSlot55 = angular.copy($scope.TimeSlot49);
                        $scope.TimeSlot56 = angular.copy($scope.TimeSlot50);
                    }
                    else if ($scope.TimeSlot51 != 0 && $scope.TimeSlot52 != 0) {
                        $scope.TimeSlot43 = angular.copy($scope.TimeSlot51);
                        $scope.TimeSlot44 = angular.copy($scope.TimeSlot52);

                        $scope.TimeSlot45 = angular.copy($scope.TimeSlot51);
                        $scope.TimeSlot46 = angular.copy($scope.TimeSlot52);

                        $scope.TimeSlot47 = angular.copy($scope.TimeSlot51);
                        $scope.TimeSlot48 = angular.copy($scope.TimeSlot52);

                        $scope.TimeSlot49 = angular.copy($scope.TimeSlot51);
                        $scope.TimeSlot50 = angular.copy($scope.TimeSlot52);

                        $scope.TimeSlot53 = angular.copy($scope.TimeSlot51);
                        $scope.TimeSlot54 = angular.copy($scope.TimeSlot52);

                        $scope.TimeSlot55 = angular.copy($scope.TimeSlot51);
                        $scope.TimeSlot56 = angular.copy($scope.TimeSlot52);
                    }
                    else if ($scope.TimeSlot53 != 0 && $scope.TimeSlot54 != 0) {
                        $scope.TimeSlot43 = angular.copy($scope.TimeSlot53);
                        $scope.TimeSlot44 = angular.copy($scope.TimeSlot54);

                        $scope.TimeSlot45 = angular.copy($scope.TimeSlot53);
                        $scope.TimeSlot46 = angular.copy($scope.TimeSlot54);

                        $scope.TimeSlot47 = angular.copy($scope.TimeSlot53);
                        $scope.TimeSlot48 = angular.copy($scope.TimeSlot54);

                        $scope.TimeSlot49 = angular.copy($scope.TimeSlot53);
                        $scope.TimeSlot50 = angular.copy($scope.TimeSlot54);

                        $scope.TimeSlot51 = angular.copy($scope.TimeSlot53);
                        $scope.TimeSlot52 = angular.copy($scope.TimeSlot54);

                        $scope.TimeSlot55 = angular.copy($scope.TimeSlot53);
                        $scope.TimeSlot56 = angular.copy($scope.TimeSlot54);
                    }
                    else if ($scope.TimeSlot55 != 0 && $scope.TimeSlot56 != 0) {
                        $scope.TimeSlot43 = angular.copy($scope.TimeSlot55);
                        $scope.TimeSlot44 = angular.copy($scope.TimeSlot56);

                        $scope.TimeSlot45 = angular.copy($scope.TimeSlot55);
                        $scope.TimeSlot46 = angular.copy($scope.TimeSlot56);

                        $scope.TimeSlot47 = angular.copy($scope.TimeSlot55);
                        $scope.TimeSlot48 = angular.copy($scope.TimeSlot56);

                        $scope.TimeSlot49 = angular.copy($scope.TimeSlot55);
                        $scope.TimeSlot50 = angular.copy($scope.TimeSlot56);

                        $scope.TimeSlot51 = angular.copy($scope.TimeSlot55);
                        $scope.TimeSlot52 = angular.copy($scope.TimeSlot56);

                        $scope.TimeSlot53 = angular.copy($scope.TimeSlot55);
                        $scope.TimeSlot54 = angular.copy($scope.TimeSlot56);
                    }
                    else {
                        //alert('Please Enter Proper Shift FromTime And ToTime !');
                        toastr.info("Please Enter Proper Shift FromTime And ToTime !", "info");
                        $('#Shift4Select').prop('checked', false);
                        return false;
                    }
                    $("#chatLoaderPV").hide();
                }
            } else {
                $scope.TimeSlot43 = "";
                $scope.TimeSlot44 = "";
                $scope.TimeSlot45 = "";
                $scope.TimeSlot46 = "";
                $scope.TimeSlot47 = "";
                $scope.TimeSlot48 = "";
                $scope.TimeSlot49 = "";
                $scope.TimeSlot50 = "";
                $scope.TimeSlot51 = "";
                $scope.TimeSlot52 = "";
                $scope.TimeSlot53 = "";
                $scope.TimeSlot54 = "";
                $scope.TimeSlot55 = "";
                $scope.TimeSlot56 = "";
            }
        }

        $scope.SundayClick = function (event) {
            var checked = $('#SundayId').is(":checked")
            if (checked == true) {
                $('#SundayCheck').show();
            } else {
                $('#SundayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Sun") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }

        $scope.MondayClick = function (event) {
            var checked = $('#MondayId').is(":checked")
            if (checked == true) {
                $('#MondayCheck').show();
            } else {
                $('#MondayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Mon") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }

        $scope.TuesdayClick = function (event) {
            var checked = $('#TuesdayId').is(":checked")
            if (checked == true) {
                $('#TuesdayCheck').show();
            } else {
                $('#TuesdayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Tue") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }

        $scope.WednesdayClick = function (event) {
            var checked = $('#WednesdayId').is(":checked")
            if (checked == true) {
                $('#WednesdayCheck').show();
            } else {
                $('#WednesdayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Wed") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }

        $scope.ThursdayClick = function (event) {
            var checked = $('#ThursdayId').is(":checked")
            if (checked == true) {
                $('#ThursdayCheck').show();
            } else {
                $('#ThursdayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Thu") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }

        $scope.FridayClick = function (event) {
            var checked = $('#FridayId').is(":checked")
            if (checked == true) {
                $('#FridayCheck').show();
            } else {
                $('#FridayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Fri") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }

        $scope.SaturdayClick = function (event) {
            var checked = $('#SaturdayId').is(":checked")
            if (checked == true) {
                $('#SaturdayCheck').show();
            } else {
                $('#SaturdayCheck').hide();
            }
            angular.forEach($scope.SelectedDays, function (value, index) {
                var Day = new Date(value.Day).toString();
                if (Day.includes("Sat") == true) {
                    if (checked == true) {
                        value.exist = 1;
                    } else {
                        value.exist = 0;
                    }
                }
            });
        }


        $scope.CancelSlot = function () {
            angular.element('#DoctorShiftModal').modal('hide');
        }
        $scope.CancelDoctorShift = function () {
            $scope.DoctorShiftClear();
            angular.element('#DoctorShiftModal').modal('hide');
        }
        $scope.CancelDoctorShift = function () {
            $scope.DoctorShiftClear();
            angular.element('#DoctorShiftModal').modal('hide');
        }
        $scope.ViewAppoinmentpopup = function () {
            angular.element('#ViewDoctorShiftModal').modal('show');
        }

        $scope.DoctorShift_InsertUpdate = function () {
            if ($scope.ValidationcontrolsDoctorShift() == true) {
                /*$("#chatLoaderPV").show();*/
                /*document.getElementById("saveDoctorShift").disabled = true;*/
                $scope.SelectedDepartment_List = [];
                angular.forEach($scope.SelectedDepartment, function (value, index) {
                    var obj = {
                        //ID: 0,
                        Id: value,
                        IsActive: 1
                    }
                    $scope.SelectedDepartment_List.push(obj);
                });
                $scope.SelectedSpecialist_List = [];
                angular.forEach($scope.SelectedSpecialist, function (value, index) {
                    var obj = {
                        //ID: 0,
                        DoctorId: value,
                        IsActive: 1
                    }
                    $scope.SelectedSpecialist_List.push(obj);
                });
                $scope.SelectedCCCG_List = [];
                angular.forEach($scope.SelectedCCCG, function (value, index) {
                    var obj = {
                        //ID: 0,
                        CcCg_Id: value,
                        IsActive: 1
                    }
                    $scope.SelectedCCCG_List.push(obj);
                });

                angular.forEach($scope.SelectedDays, function (value, index) {
                    var Day = new Date(value.Day).toString();
                    if (Day.includes("Sun") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot1), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot2), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot3), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot4), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot5), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot6), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot43), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot44), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    else if (Day.includes("Mon") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot7), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot8), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot9), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot10), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot11), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot12), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot45), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot46), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    else if (Day.includes("Tue") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot13), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot14), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot15), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot16), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot17), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot18), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot47), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot48), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    else if (Day.includes("Wed") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot19), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot20), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot21), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot22), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot23), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot24), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot49), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot50), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    else if (Day.includes("Thu") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot25), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot26), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot27), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot28), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot29), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot30), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot51), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot52), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    else if (Day.includes("Fri") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot31), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot32), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot33), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot34), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot35), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot36), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot53), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot54), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    else if (Day.includes("Sat") == true && value.exist == 1) {
                        var shift1 = {};
                        shift1 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot37), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot38), Shift: 1 }
                        value.TimeSlot[0] = shift1;

                        var shift2 = {};
                        shift2 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot39), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot40), Shift: 2 }
                        value.TimeSlot[1] = shift2;

                        var shift3 = {};
                        shift3 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot41), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot42), Shift: 3 }
                        value.TimeSlot[2] = shift3;

                        var shift4 = {};
                        shift4 = { TimeSlotFromTime: Convert12To24Timeformat($scope.TimeSlot55), TimeSlotToTime: Convert12To24Timeformat($scope.TimeSlot56), Shift: 4 }
                        value.TimeSlot[3] = shift4;
                    }
                    value.Day = moment(value.Day).format('DD-MMM-YYYY');
                });
                var daylen = $scope.SelectedDays.length;
                var chk2 = 0;
                for (let i = 0; i < daylen; i++) {
                    var dateName = '';
                    if (new Date($scope.SelectedDays[i].Day).toString().includes('Sun')) {
                        dateName = 'Sunday';
                    } else if (new Date($scope.SelectedDays[i].Day).toString().includes('Mon')) {
                        dateName = 'Monday';
                    } else if (new Date($scope.SelectedDays[i].Day).toString().includes('Tue')) {
                        dateName = 'Tuesday';
                    } else if (new Date($scope.SelectedDays[i].Day).toString().includes('Wed')) {
                        dateName = 'Wednesday';
                    } else if (new Date($scope.SelectedDays[i].Day).toString().includes('Thu')) {
                        dateName = 'Thursday';
                    } else if (new Date($scope.SelectedDays[i].Day).toString().includes('Fri')) {
                        dateName = 'Friday';
                    } else if (new Date($scope.SelectedDays[i].Day).toString().includes('Sat')) {
                        dateName = 'Saturday';
                    }
                    var y = $scope.SelectedDays[i].TimeSlot.filter(x => x.TimeSlotFromTime === null && x.TimeSlotToTime === null);
                    if (y.length === 4 && $scope.SelectedDays[i].exist == 1) {
                        //alert('Please Enter any one time slot for ' + dateName + '');
                        toastr.warning('Please Enter any one time slot for ' + dateName + '', "warning");
                        chk2 = 1;
                        break;
                    }
                    y = $scope.SelectedDays[i].TimeSlot.filter(x => x.TimeSlotFromTime !== null && x.TimeSlotToTime === null);
                    if (y.length > 0) {
                        //alert('Please Enter To time slot for ' + dateName + '');
                        toastr.warning('Please Enter To time slot for ' + dateName + '', "warning");
                        chk2 = 1;
                        break;
                    }
                    y = $scope.SelectedDays[i].TimeSlot.filter(x => x.TimeSlotFromTime === null && x.TimeSlotToTime !== null);
                    if (y.length > 0) {
                        //alert('Please Enter From time slot for ' + dateName + '');
                        toastr.warning('Please Enter From time slot for ' + dateName + '', "warning");
                        chk2 = 1;
                        break;
                    }
                }
                if (chk2 === 1) {
                    return false;
                }
                var chk = 2;
                for (let y = 0; y < daylen; y++) {
                    var timeshift = $scope.SelectedDays[y].TimeSlot.length;
                    var arr = [];
                    for (let z = 0; z < timeshift; z++) {
                        if ($scope.SelectedDays[y].TimeSlot[z].TimeSlotFromTime !== null && $scope.SelectedDays[y].TimeSlot[z].TimeSlotToTime !== null && $scope.SelectedDays[y].exist == 1) {
                            var from = new Date($scope.SelectedDays[y].Day + ' ' + $scope.SelectedDays[y].TimeSlot[z].TimeSlotFromTime).getTime();
                            var to = new Date($scope.SelectedDays[y].Day + ' ' + $scope.SelectedDays[y].TimeSlot[z].TimeSlotToTime).getTime();
                            if (arr.length == 0) {
                                if (from < to) {
                                    arr.push({ from: from, to: to });
                                } else {
                                    chk = 0;
                                    break;
                                }
                            } else {
                                var len = arr.length;
                                for (let x = 0; x < len; x++) {
                                    if (from > to) {
                                        chk = 0;
                                        break;
                                    } else {
                                        if (arr[x].from < from && arr[x].to < from && arr[x].from < to && arr[x].to < to) {
                                            arr.push({ from: from, to: to });
                                            chk = 1;
                                        } else {
                                            chk = 0;
                                            break;
                                        }
                                    }
                                }
                            }
                            if (chk === 0) {
                                break;
                            }
                        }
                    }
                    if (chk === 0) {
                        break;
                    }
                }
                var selectedCheckedDays = $scope.SelectedDays.filter(x => x.exist == 1);
                if (selectedCheckedDays.length <= 0) {
                    chk = 3;
                }
                if (chk === 1 || chk == 2) {
                    angular.forEach($scope.SelectedDays, function (value, index) {
                        for (let i = 3; i >= 0; i--) {
                            const y = $scope.SelectedDays[index].TimeSlot.filter(x => (x.TimeSlotFromTime === null && x.TimeSlotToTime === null) || (x.TimeSlotFromTime === undefined && x.TimeSlotToTime === undefined));
                            if (y.length !== 0) {
                                const h = $scope.SelectedDays[index].TimeSlot.findIndex(x => x.TimeSlotFromTime === null && x.TimeSlotToTime === null);
                                $scope.SelectedDays[index].TimeSlot.splice(h, 1);
                            }
                        }
                    });
                    //var seldays = $scope.SelectedDays.length;
                    //for (i = seldays - 1; i >= 0; i--) {
                    //    if ($scope.SelectedDays[i].exist == 0) {
                    //        $scope.SelectedDays.splice(i, 1);
                    //    }
                    //}
                    var obj = {
                        ID: $scope.Id,
                        Institution_Id: $window.localStorage['InstitutionId'],
                        CreatedBy: $window.localStorage['UserId'],
                        SelectDepartment: $scope.SelectedDepartment_List,
                        Doctor_Id: $scope.SelectedSpecialist_List,
                        CC_CG: $scope.SelectedCCCG_List,
                        FromDate: $scope.FromDate,
                        ToDate: $scope.ToDate,
                        NewAppointment: $scope.NewAppointment,
                        FollowUp: $scope.followup,
                        Intervel: $scope.IntervalBt,
                        CustomSlot: parseInt($scope.CustomSlot),
                        BookingOpen: $scope.Days,
                        BookingCancelLock: parseInt($scope.Minutes),
                        SelectedDaysList: selectedCheckedDays
                    };
                    $('#saveDoctorShift1').attr("disabled", true);
                    $('#saveDoctorShift2').attr("disabled", true);
                    $('#saveDoctorShift3').attr("disabled", true);
                    $("#chatLoaderPV").show();
                    $http.post(baseUrl + '/api/PatientAppointments/AddDoctorShiftInsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                        //alert(data.Message);
                        if (data.ReturnFlag == 1) {
                            toastr.success(data.Message, "success");
                        }
                        else if (data.ReturnFlag == 0) {
                            toastr.info(data.Message, "info");
                        }
                        $('#saveDoctorShift1').attr("disabled", false);
                        $('#saveDoctorShift2').attr("disabled", false);
                        $('#saveDoctorShift3').attr("disabled", false);
                        $("#chatLoaderPV").hide();
                        if (data.ReturnFlag == 1) {
                            $scope.DoctorShiftClear();
                            $scope.CancelDoctorShift();
                            $scope.DoctorShiftListGo();
                        }
                        else {
                            return false;
                        }

                    }).error(function (data) {
                        $scope.error = "An error has occurred while Adding Docor Shift" + data;
                    });
                } else if (chk == 0) {
                    //alert('Please Enter Valid Timeslot!');
                    toastr.warning("Please Enter Valid Timeslot!", "warning");
                } else if (chk == 3) {
                    //alert('Please Select Any One Day');
                    toastr.warning("Please Select Any One Day", "warning");
                }
            }
        }
        /* THIS IS FOR VALIDATION CONTROL FOR DOCTOR SHIFT TIME SLOT */
        $scope.TimeSlotValidationCheck = function () {
            var SlotChecking = [];
            angular.forEach($scope.SelectedDays, function (value, index) {
                if ($('#SundayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('Sunday Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("Sunday Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
                if ($('#MondayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('Monday Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("Monday Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
                if ($('#TuesdayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('TuesDay Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("TuesDay Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
                if ($('#WednesdayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('WednesDay Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("WednesDay Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
                if ($('#ThursdayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('ThursDay Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("ThursDay Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
                if ($('#FridayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('Friday Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("Friday Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
                if ($('#SaturdayId').prop('disabled') == false) {
                    angular.forEach(value.TimeSlot, function (value1, index1) {
                        if (ParseDate(value1.TimeSlotFromTime) > ParseDate(value1.TimeSlotToTime)) {
                            //alert('Saturday Slot FromTime Can Be Less Than To Time!');
                            toastr.warning("Saturday Slot FromTime Can Be Less Than To Time!", "warning");
                            return false;
                        }
                    });
                }
            });
            return true;
        }

        /* THIS IS FOR VALIDATION CONTROL FOR  DOCTOR SHIFT */
        $scope.ValidationcontrolsDoctorShift = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.FromDate = moment($scope.FromDate).format('DD-MMM-YYYY');
            $scope.ToDate = moment($scope.ToDate).format('DD-MMM-YYYY');

            if (typeof ($scope.SelectedDepartment) == "undefined" || $scope.SelectedDepartment == "") {
                //alert("Please Select Department");
                toastr.warning("Please Select Department", "warning");
                return false;
            }
            else if (typeof ($scope.SelectedSpecialist) == "undefined" || $scope.SelectedSpecialist == "") {
                //alert("Please Select Specialist");
                toastr.warning("Please Select Specialist", "warning");
                return false;
            }
            else if (typeof ($scope.SelectedCCCG) == "undefined" || $scope.SelectedCCCG == "") {
                //alert("Please Select CCCG");
                toastr.warning("Please Select CCCG", "warning");
                return false;
            }
            else if (typeof ($scope.FromDate) == "undefined" || $scope.FromDate == "") {
                //alert("Please select From Date");
                toastr.warning("Please select From Date", "warning");
                return false;
            }
            else if (typeof ($scope.ToDate) == "undefined" || $scope.ToDate == "") {
                //alert("Please select  End Date");
                toastr.warning("Please select  End Date", "warning");
                return false;
            }
            if (($scope.FromDate !== null) && ($scope.ToDate !== null)) {
                if ((ParseDate($scope.ToDate) < ParseDate($scope.FromDate))) {
                    //alert("Start Date should not be greater than End Date");
                    toastr.warning("Start Date should not be greater than End Date", "warning");
                    $scope.FromDate = DateFormatEdit($scope.FromDate);
                    $scope.ToDate = DateFormatEdit($scope.ToDate);
                    return false;
                }
            }
            else if (typeof ($scope.NewAppointment) == "undefined" || $scope.NewAppointment == "0" || $scope.NewAppointment == '') {
                //alert("Please Enter NewAppointment Time Slot");
                toastr.warning("Please Enter NewAppointment Time Slot", "warning");
                return false;
            }
            else if (typeof ($scope.followup) == "undefined" || $scope.followup == "0" || $scope.followup == '') {
                //alert("Please Enter followup Time Slot");
                toastr.warning("Please Enter followup Time Slot", "warning");
                return false;
            }

            else if (typeof ($scope.IntervalBt) == "undefined" || $scope.IntervalBt == "0" || $scope.IntervalBt == '') {
                //alert("Please Enter Interval Time Slot");
                toastr.warning("Please Enter Interval Time Slot", "warning");
                return false;
            }
            /*else if (typeof ($scope.CustomSlot) == "undefined" || $scope.CustomSlot == "0" || $scope.CustomSlot == '') {
                alert("Please Enter CustomSlot Time");
                return false;
            }*/
            else if (typeof ($scope.Days) == "undefined" || $scope.Days == "0" || $scope.Days == '') {
                //alert("Please Enter Days");
                toastr.warning("Please Enter Days", "warning");
                return false;
            }
            else if (typeof ($scope.Minutes) == "undefined" || $scope.Minutes == "0" || $scope.Minutes == '') {
                //alert("Please Enter Minutes");
                toastr.warning("Please Enter Minutes", "warning");
                return false;
            }

            $scope.FromDate = DateFormatEdit($scope.FromDate);
            $scope.ToDate = DateFormatEdit($scope.ToDate);
            return true;
        };
        $scope.OrganisationSettingsSelectedDays = function () {
            $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingView/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $window.localStorage['Login_Session_Id']).success(function (data) {
                if (data != null) {
                    const OrgDay = "";
                    const OrgSelectedDate = data.DefaultWorkingDays.split(',');
                    angular.forEach($scope.SelectedDays, function (value, index) {
                        angular.forEach(OrgSelectedDate, function (value1, index1) {
                            if (value1 == "monday") {
                                value1 = "mon";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Mon") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                            else if (value1 == "tuesday") {
                                value1 = "tue";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Tue") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                            else if (value1 == "wednesday") {
                                value1 = "wed";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Wed") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                            else if (value1 == "thursday") {
                                value1 = "thu";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Thu") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                            else if (value1 == "friday") {
                                value1 = "fri";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Fri") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                            else if (value1 == "saturday") {
                                value1 = "sat";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Sat") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                            else if (value1 == "sunday") {
                                value1 = "sun";
                                var DateDay = $scope.SelectedDays[index].Day;
                                DateDay = DateDay.toString();
                                if (DateDay.includes("Sun") == true) {
                                    $scope.SelectedDays[index].exist = 1;
                                }
                            }
                        });
                    });
                    const xy = $scope.SelectedDays.filter(x => x.exist == 1);
                    $scope.SelectedDays = xy;

                    angular.forEach($scope.SelectedDays, function (value2, index) {
                        var Day = value2.Day.toString();
                        if (Day.includes("Sun") == true) {
                            $("#SundayId").removeAttr("disabled");
                            $('#SundayId').prop('checked', true);
                            $('#SundayCheck').show();
                        }
                        if (Day.includes("Mon") == true) {
                            $("#MondayId").removeAttr("disabled");
                            $('#MondayId').prop('checked', true);
                            $('#MondayCheck').show();
                        }
                        if (Day.includes("Tue") == true) {
                            $("#TuesdayId").removeAttr("disabled");
                            $('#TuesdayId').prop('checked', true);
                            $('#TuesdayCheck').show();
                        }
                        if (Day.includes("Wed") == true) {
                            $("#WednesdayId").removeAttr("disabled");
                            $('#WednesdayId').prop('checked', true);
                            $('#WednesdayCheck').show();
                        }
                        if (Day.includes("Thu") == true) {
                            $("#ThursdayId").removeAttr("disabled");
                            $('#ThursdayId').prop('checked', true);
                            $('#ThursdayCheck').show();
                        }
                        if (Day.includes("Fri") == true) {
                            $("#FridayId").removeAttr("disabled");
                            $('#FridayId').prop('checked', true);
                            $('#FridayCheck').show();
                        }
                        if (Day.includes("Sat") == true) {
                            $("#SaturdayId").removeAttr("disabled");
                            $('#SaturdayId').prop('checked', true);
                            $('#SaturdayCheck').show();
                        }
                    });
                }
                if (data == null) {
                    //alert('Please Check OrgSettings, Default Working Days Is Empty!');
                    toastr.info("Please Check OrgSettings, Default Working Days Is Empty!", "info");
                    return false;
                }
            });

        }
        $scope.TimeslotClear = function () {
            $scope.TimeSlot1 = "";
            $scope.TimeSlot2 = "";
            $scope.TimeSlot3 = "";
            $scope.TimeSlot4 = "";
            $scope.TimeSlot5 = "";
            $scope.TimeSlot6 = "";
            $scope.TimeSlot7 = "";
            $scope.TimeSlot8 = "";
            $scope.TimeSlot9 = "";
            $scope.TimeSlot10 = "";
            $scope.TimeSlot11 = "";
            $scope.TimeSlot12 = "";
            $scope.TimeSlot13 = "";
            $scope.TimeSlot14 = "";
            $scope.TimeSlot15 = "";
            $scope.TimeSlot16 = "";
            $scope.TimeSlot17 = "";
            $scope.TimeSlot18 = "";
            $scope.TimeSlot19 = "";
            $scope.TimeSlot20 = "";
            $scope.TimeSlot21 = "";
            $scope.TimeSlot22 = "";
            $scope.TimeSlot23 = "";
            $scope.TimeSlot24 = "";
            $scope.TimeSlot25 = "";
            $scope.TimeSlot26 = "";
            $scope.TimeSlot27 = "";
            $scope.TimeSlot28 = "";
            $scope.TimeSlot29 = "";
            $scope.TimeSlot30 = "";
            $scope.TimeSlot31 = "";
            $scope.TimeSlot32 = "";
            $scope.TimeSlot33 = "";
            $scope.TimeSlot34 = "";
            $scope.TimeSlot35 = "";
            $scope.TimeSlot36 = "";
            $scope.TimeSlot37 = "";
            $scope.TimeSlot38 = "";
            $scope.TimeSlot39 = "";
            $scope.TimeSlot40 = "";
            $scope.TimeSlot41 = "";
            $scope.TimeSlot42 = "";
            $scope.TimeSlot43 = "";
            $scope.TimeSlot44 = "";
            $scope.TimeSlot45 = "";
            $scope.TimeSlot46 = "";
            $scope.TimeSlot47 = "";
            $scope.TimeSlot48 = "";
            $scope.TimeSlot49 = "";
            $scope.TimeSlot50 = "";
            $scope.TimeSlot51 = "";
            $scope.TimeSlot52 = "";
            $scope.TimeSlot53 = "";
            $scope.TimeSlot54 = "";
            $scope.TimeSlot55 = "";
            $scope.TimeSlot56 = "";
        }
        $scope.onDateRange = function () {
            if ((typeof $scope.FromDate) != undefined && $scope.FromDate != "" && (typeof ($scope.ToDate) != undefined && $scope.ToDate != 0)) {
                $("#chatLoaderPV").show();
                $scope.SelectedDays = dateRange($scope.FromDate, $scope.ToDate);
                $('#SundayCheck').hide();
                $('#MondayCheck').hide();
                $('#TuesdayCheck').hide();
                $('#WednesdayCheck').hide();
                $('#ThursdayCheck').hide();
                $('#FridayCheck').hide();
                $('#SaturdayCheck').hide();
                $("#SundayId").attr("disabled", true);
                $("#MondayId").attr("disabled", true);
                $("#TuesdayId").attr("disabled", true);
                $("#WednesdayId").attr("disabled", true);
                $("#ThursdayId").attr("disabled", true);
                $("#FridayId").attr("disabled", true);
                $("#SaturdayId").attr("disabled", true);
                $scope.TimeslotClear();
                $scope.OrganisationSettingsSelectedDays();
                $("#chatLoaderPV").hide();
            }
        }

        $scope.CancelDoctorShiftpopup = function () {
            angular.element('#ViewDoctorShiftModal').modal('hide');
        }

        $scope.updateCheckSpecialities = function (Id, Department_Name, $event) {

            var checked = $('#' + Id).is(":checked")
            if (checked == true) {
                $scope.SpecialitiesSelectList.push({
                    Id: Id,
                    Department: Department_Name
                })
                $('#Specialities').tagsinput('add', Department_Name);
                //$scope.Specialitiesinput = Department_Name;
                //$('.bootstrap-tagsinput').tagsinput('add', { Id: Id, Department: Department_Name });

            } else {
                angular.forEach($scope.SpecialitiesSelectList, function (Department_Name, index) {
                    if (Id == Department_Name.Id) {
                        $scope.SpecialitiesSelectList.splice(index, 1);
                        $('#Specialities').tagsinput('remove', Department_Name.Department);
                    }
                });
            }
        }

        /* on click view, view popup opened*/
        $scope.ViewDoctorShift = function (DId, DoctorId, Institution_Id) {
            $scope.DoctorShiftClear();
            $scope.Id = DId;
            $scope.DoctorShift_View(DId, DoctorId, Institution_Id);
            $scope.ViewShiftDoctor();
            angular.element('#DoctorShiftModal').modal('show');

        };
        /* on click Edit, edit popup opened*/
        $scope.EditDoctorShift = function (DId, activeFlag, DoctorId, Institution_Id) {
            //if (activeFlag == 1) {
            angular.element('#DoctorShiftModal').modal('show');
            $('#saveDoctorShift1').attr("disabled", false);
            $('#saveDoctorShift2').attr("disabled", false);
            $('#saveDoctorShift3').attr("disabled", false);
            $scope.DoctorShiftClear();
            $scope.Id = DId;
            $scope.DoctorShift_View(DId, DoctorId, Institution_Id);
            $scope.EditShiftDoctor();
            //}
            //else {
            //    alert("Inactive record cannot be edited");
            //}
        };
        /* 
     Calling api method for the dropdown list in the html page for the fields 
     Doctor List
     */
        $scope.InstituteId = $window.localStorage['InstitutionId'];
        $scope.DoctorList = [];
        $scope.DoctorListActive = [];
        $scope.DoctorShiftListTemp = [];
        $http.get(baseUrl + '/api/AppoinmentSlot/Doctors_List/?Institution_Id=' + $scope.InstituteId).success(function (data) {

            //var obj = { "Id": 0, "Name": "Select", "IsActive": 0 };
            //$scope.DoctorShiftListTemp.splice(0, 0, obj);
            ////$scope.InstitutiondetailsListTemp.push(obj);
            //$scope.DoctorList = angular.copy($scope.DoctorShiftListTemp);
            $scope.DoctorList = data;
            //$ff(data, { IsActive: 1 });
            $scope.DoctorListActive = data;
        });
        $scope.DoctorShiftList = [];
        $scope.DoctorShiftListActive = [];
        $http.get(baseUrl + '/api/DoctorShift/Shift_List/?Institution_Id=' + $scope.InstituteId).success(function (data) {
            $scope.DoctorShiftList = $ff(data, { IsActive: 1 });
            $scope.DoctorShiftListActive = data;
        });

        $scope.WeekdayList = [];
        $scope.WeekdayActiveList = [];
        $http.get(baseUrl + '/api/DoctorShift/Days_List/?Institution_Id=' + $scope.InstituteId).success(function (data) {
            $scope.WeekdayList = data;
            $scope.WeekdayActiveList = $ff(data, { IsActive: 1 });

            $scope.day1 = data[0].WeekDayName;
            $scope.day1Id = data[0].Id;
            $scope.day2 = data[1].WeekDayName;
            $scope.day2Id = data[1].Id;
            $scope.day3 = data[2].WeekDayName;
            $scope.day3Id = data[2].Id;
            $scope.day4 = data[3].WeekDayName;
            $scope.day4Id = data[3].Id;
            $scope.day5 = data[4].WeekDayName;
            $scope.day5Id = data[4].Id;
            $scope.day6 = data[5].WeekDayName;
            $scope.day6Id = data[5].Id;
            $scope.day7 = data[6].WeekDayName;
            $scope.day7Id = data[6].Id;
        });

        $scope.searchquery = "";
        /* Filter the master list function.*/
        $scope.filterDoctorShiftList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if (searchstring == "") {
                $scope.rowCollectionFilter = [];
                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
            }
            else {
                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
                    return angular.lowercase(value.Doctor_Name).match(searchstring) ||
                        angular.lowercase(value.ShiftName).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.FromDate, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring) ||
                        angular.lowercase(($filter('date')(value.ToDate, "dd-MMM-yyyy hh:mm:ss a"))).match(searchstring)
                });
                if ($scope.rowCollectionFilter.length > 0) {
                    $scope.flag = 1;
                }
                else {
                    $scope.flag = 0;
                }
            }
        }

        /* Validating the create page mandatory fields
           checking mandatory for the follwing fields
            Doctor Id, Sunday shift, Monday Shift, Tuesday Shift, Wednesday Shift, Thursday Shift, Friday Shift, Saturday Shift, From date, To date
           and showing alert message when it is null.
           */
        $scope.DoctorShiftAddEdit_Validations = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.FromDate = moment($scope.FromDate).format('DD-MMM-YYYY');
            $scope.ToDate = moment($scope.ToDate).format('DD-MMM-YYYY');

            if (($scope.Doctor_Id.length == 0) && $scope.Id == 0) {
                //alert("Please select Doctor");
                toastr.warning("Please select Doctor", "warning");
                return false;
            }
            if (typeof ($scope.Doctor_Id1) == "undefined" || $scope.Doctor_Id1 == "0" && $scope.Id > 0) {
                //alert("Please select Doctor");
                toastr.warning("Please select Doctor", "warning");
                return false;
            }
            //else if ($scope.SundayShift.length == 0) {
            //    alert("Please select " + $scope.day1);
            //    return false;
            //}
            //else if ($scope.MondayShift.length == 0) {
            //    alert("Please select " + $scope.day2);
            //    return false;
            //}
            //else if ($scope.TuesdayShift.length == 0) {
            //    alert("Please select " + $scope.day3);
            //    return false;
            //}
            //else if ($scope.WednessdayShift.length == 0) {
            //    alert("Please select " + $scope.day4);
            //    return false;
            //}
            //else if ($scope.ThursdayShift.length == 0) {
            //    alert("Please select " + $scope.day5);
            //    return false;
            //}
            //else if ($scope.FridayShift.length == 0) {
            //    alert("Please select " + $scope.day6);
            //    return false;
            //}
            //else if ($scope.SaturdayShift.length == 0) {
            //    alert("Please select " + $scope.day7);
            //    return false;
            //}
            else if (typeof ($scope.FromDate) == "undefined" || $scope.FromDate == null) {
                //alert("Please select From Date");
                toastr.warning("Please select From Date", "warning");
                return false;
            }
            else if (typeof ($scope.ToDate) == "undefined" || $scope.ToDate == null) {
                //alert("Please select To Date");
                toastr.warning("Please select To Date", "warning");
                return false;
            }
            else if ((ParseDate($scope.FromDate) < ParseDate(today))) {
                //alert("FromDate Can Be Booked Only For Past");
                toastr.warning("FromDate Can Be Booked Only For Past", "warning");
                $scope.FromDate = DateFormatEdit($scope.FromDate);
                $scope.ToDate = DateFormatEdit($scope.ToDate);
                return false;
            }
            else if ((ParseDate($scope.ToDate) < ParseDate(today))) {
                //alert("To Date Can Be Booked Only For Past");
                toastr.warning("To Date Can Be Booked Only For Past", "warning");
                $scope.FromDate = DateFormatEdit($scope.FromDate);
                $scope.ToDate = DateFormatEdit($scope.ToDate);
                return false;
            }
            if (($scope.FromDate !== null) && ($scope.ToDate !== null)) {
                if ((ParseDate($scope.ToDate) < ParseDate($scope.FromDate))) {
                    //alert("From Date should not be greater than To Date");
                    toastr.warning("From Date should not be greater than To Date", "warning");
                    $scope.FromDate = DateFormatEdit($scope.FromDate);
                    $scope.ToDate = DateFormatEdit($scope.ToDate);
                    return false;
                }
            }
            $scope.FromDate = DateFormatEdit($scope.FromDate);
            $scope.ToDate = DateFormatEdit($scope.ToDate);
            return true;
        }

        $('#AppointmentSlotModal').on('hide.bs.modal', function () {
            console.log('hide');
            //return false;
        })

        /*on click Save calling the insert update function for Doctor shift
         and check the  Doctor shift already exist,if exist it display alert message or its 
         calling the insert update function*/

        $scope.DoctorShift_AddEdit = function () {

            $scope.ShiftDetails = [];
            $scope.DoctorListfiltersDetails = [];
            if ($scope.DoctorShiftAddEdit_Validations() == true) {
                $("#chatLoaderPV").show();

                $scope.SundayShiftDetails = [];
                angular.forEach($scope.SundayShift, function (value, index1) {
                    var obj = {
                        Id: 0,
                        DayMaster_Id: $scope.day1Id == 0 ? null : $scope.day1Id,
                        Shift_Id: value,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.SundayShiftDetails.push(obj);
                });

                $scope.MondayShiftDetails = [];
                angular.forEach($scope.MondayShift, function (Selected1, index) {
                    var obj1 = {
                        Id: 0,
                        DayMaster_Id: $scope.day2Id == 0 ? null : $scope.day2Id,
                        Shift_Id: Selected1,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.MondayShiftDetails.push(obj1);
                });

                $scope.TuesdayShiftDetails = [];
                angular.forEach($scope.TuesdayShift, function (Selected2, index) {
                    var obj2 = {
                        Id: 0,
                        DayMaster_Id: $scope.day3Id == 0 ? null : $scope.day3Id,
                        Shift_Id: Selected2,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.TuesdayShiftDetails.push(obj2);

                });

                $scope.WednessdayShiftDetails = [];
                angular.forEach($scope.WednessdayShift, function (Selected3, index) {
                    var obj3 = {
                        Id: 0,
                        DayMaster_Id: $scope.day4Id == 0 ? null : $scope.day4Id,
                        Shift_Id: Selected3,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.WednessdayShiftDetails.push(obj3);
                });

                $scope.ThursdayShiftDetails = [];
                angular.forEach($scope.ThursdayShift, function (Selected4, index) {
                    var obj4 = {
                        Id: 0,
                        DayMaster_Id: $scope.day5Id == 0 ? null : $scope.day5Id,
                        Shift_Id: Selected4,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.ThursdayShiftDetails.push(obj4);
                });

                $scope.FridayShiftDetails = [];
                angular.forEach($scope.FridayShift, function (Selected5, index) {
                    var obj5 = {
                        Id: 0,
                        DayMaster_Id: $scope.day6Id == 0 ? null : $scope.day6Id,
                        Shift_Id: Selected5,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.FridayShiftDetails.push(obj5);
                });

                $scope.SaturdayShiftDetails = [];
                angular.forEach($scope.SaturdayShift, function (Selected6, index) {

                    var obj6 = {
                        Id: 0,
                        DayMaster_Id: $scope.day7Id == 0 ? null : $scope.day7Id,
                        Shift_Id: Selected6,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                    }
                    $scope.SaturdayShiftDetails.push(obj6);
                });

                if ($scope.Id == 0) {
                    angular.forEach($scope.Doctor_Id, function (Selected, index) {

                        var obj8 = {
                            Id: $scope.Id,
                            Institution_Id: $window.localStorage['InstitutionId'],
                            Doctor_Id: Selected,
                            FromDate: moment($scope.FromDate).format('DD-MMM-YYYY'),
                            ToDate: moment($scope.ToDate).format('DD-MMM-YYYY'),
                            Created_By: $window.localStorage['UserId'],
                            Modified_By: $window.localStorage['UserId'],
                            SundayChildModuleList: $scope.SundayShiftDetails,
                            MondayChildModuleList: $scope.MondayShiftDetails,
                            TuesdayChildModuleList: $scope.TuesdayShiftDetails,
                            WednessdayChildModuleList: $scope.WednessdayShiftDetails,
                            ThursdayChildModuleList: $scope.ThursdayShiftDetails,
                            FridayChildModuleList: $scope.FridayShiftDetails,
                            SaturdayChildModuleList: $scope.SaturdayShiftDetails,
                            DoctorShiftList: $scope.DoctorShiftList
                        };
                        $scope.DoctorListfiltersDetails.push(obj8)
                    })
                }
                else {
                    var obj9 = {
                        Id: $scope.Id,
                        Institution_Id: $window.localStorage['InstitutionId'],
                        Doctor_Id: $scope.Doctor_Id1,
                        FromDate: $scope.FromDate,
                        ToDate: $scope.ToDate,
                        Created_By: $window.localStorage['UserId'],
                        Modified_By: $window.localStorage['UserId'],
                        SundayChildModuleList: $scope.SundayShiftDetails,
                        MondayChildModuleList: $scope.MondayShiftDetails,
                        TuesdayChildModuleList: $scope.TuesdayShiftDetails,
                        WednessdayChildModuleList: $scope.WednessdayShiftDetails,
                        ThursdayChildModuleList: $scope.ThursdayShiftDetails,
                        FridayChildModuleList: $scope.FridayShiftDetails,
                        SaturdayChildModuleList: $scope.SaturdayShiftDetails,
                        DoctorShiftList: $scope.DoctorShiftList
                    };
                    $scope.DoctorListfiltersDetails.push(obj9)
                }

                $http.post(baseUrl + '/api/DoctorShift/DoctorShift_AddEdit/', $scope.DoctorListfiltersDetails).success(function (data) {
                    // $("#chatLoaderPV").hide();
                    alert(data.Message);
                    if (data.ReturnFlag == "1") {
                        $scope.CancelSlot();
                        $scope.DoctorShiftClear();
                        $scope.DoctorShiftListGo();
                    }
                })
                $("#chatLoaderPV").hide();
            }
        }

        $scope.DoctorShiftClear = function () {
            $("#chatLoaderPV").show();
            $scope.currentTab = "1";
            $scope.SelectedDepartment = [];
            $scope.SelectedSpecialist = [];
            $scope.SelectedCCCG = [];
            $scope.FromDate = "";
            $scope.ToDate = "";
            $scope.NewAppointment = "0";
            $scope.followup = "0";
            $scope.IntervalBt = "0";
            $scope.CustomSlot = "0";
            $scope.Days = "0";
            $scope.Minutes = "0";
            $('#SundayCheck').hide();
            $('#MondayCheck').hide();
            $('#TuesdayCheck').hide();
            $('#WednesdayCheck').hide();
            $('#ThursdayCheck').hide();
            $('#FridayCheck').hide();
            $('#SaturdayCheck').hide();
            $("#SundayId").attr("disabled", true);
            $("#MondayId").attr("disabled", true);
            $("#TuesdayId").attr("disabled", true);
            $("#WednesdayId").attr("disabled", true);
            $("#ThursdayId").attr("disabled", true);
            $("#FridayId").attr("disabled", true);
            $("#SaturdayId").attr("disabled", true);
            $('#SundayId').prop('checked', false);
            $('#MondayId').prop("checked", false);
            $('#TuesdayId').prop('checked', false);
            $('#WednesdayId').prop("checked", false);
            $('#ThursdayId').prop('checked', false);
            $('#FridayId').prop('checked', false);
            $('#SaturdayId').prop('checked', false);
            $('#OrgDefaultId').prop('checked', false);
            $('#OrgBookInfoId').prop("checked", false);
            $scope.TimeslotClear();
            $("#chatLoaderPV").hide();
        }

        $scope.ViewShiftDoctor = function () {
            $("#chatLoaderPV").show();
            $scope.currentTab = "1";
            $scope.DoctorSave = false;
            var $sel1 = $('#department');
            $sel1.multiselect('disable');
            var $sel2 = $('#Specialist');
            $sel2.multiselect('disable');
            var $sel3 = $('#CCCG');
            $sel3.multiselect('disable');
            document.getElementById("FromDate").disabled = true;
            document.getElementById("ToDate").disabled = true;
            $("#OrgDefaultId").attr("disabled", true);
            $("#OrgBookInfoId").attr("disabled", true);
            $('#NewAppointment').prop('disabled', true);
            $('#followup').prop('disabled', true);
            $('#IntervalBt').prop('disabled', true);
            $('#CustomSlot').prop('disabled', true);
            $('#Days').prop('disabled', true);
            $('#Minutes').prop('disabled', true);
            $("#SundayId").attr("disabled", true);
            $("#MondayId").attr("disabled", true);
            $("#TuesdayId").attr("disabled", true);
            $("#WednesdayId").attr("disabled", true);
            $("#ThursdayId").attr("disabled", true);
            $("#FridayId").attr("disabled", true);
            $("#SaturdayId").attr("disabled", true);
            $('#timepicker1').prop('disabled', true);
            $('#timepicker2').prop('disabled', true);
            $('#timepicker3').prop('disabled', true);
            $('#timepicker4').prop('disabled', true);
            $('#timepicker5').prop('disabled', true);
            $('#timepicker6').prop('disabled', true);
            $('#timepicker7').prop('disabled', true);
            $('#timepicker8').prop('disabled', true);
            $('#timepicker9').prop('disabled', true);
            $('#timepicker10').prop('disabled', true);
            $('#timepicker11').prop('disabled', true);
            $('#timepicker12').prop('disabled', true);
            $('#timepicker13').prop('disabled', true);
            $('#timepicker14').prop('disabled', true);
            $('#timepicker15').prop('disabled', true);
            $('#timepicker16').prop('disabled', true);
            $('#timepicker17').prop('disabled', true);
            $('#timepicker18').prop('disabled', true);
            $('#timepicker19').prop('disabled', true);
            $('#timepicker20').prop('disabled', true);
            $('#timepicker21').prop('disabled', true);
            $('#timepicker22').prop('disabled', true);
            $('#timepicker23').prop('disabled', true);
            $('#timepicker24').prop('disabled', true);
            $('#timepicker25').prop('disabled', true);
            $('#timepicker26').prop('disabled', true);
            $('#timepicker27').prop('disabled', true);
            $('#timepicker28').prop('disabled', true);
            $('#timepicker29').prop('disabled', true);
            $('#timepicker30').prop('disabled', true);
            $('#timepicker31').prop('disabled', true);
            $('#timepicker32').prop('disabled', true);
            $('#timepicker33').prop('disabled', true);
            $('#timepicker34').prop('disabled', true);
            $('#timepicker35').prop('disabled', true);
            $('#timepicker36').prop('disabled', true);
            $('#timepicker37').prop('disabled', true);
            $('#timepicker38').prop('disabled', true);
            $('#timepicker39').prop('disabled', true);
            $('#timepicker40').prop('disabled', true);
            $('#timepicker41').prop('disabled', true);
            $('#timepicker42').prop('disabled', true);
            $('#timepicker43').prop('disabled', true);
            $('#timepicker44').prop('disabled', true);
            $('#timepicker45').prop('disabled', true);
            $('#timepicker46').prop('disabled', true);
            $('#timepicker47').prop('disabled', true);
            $('#timepicker48').prop('disabled', true);
            $('#timepicker49').prop('disabled', true);
            $('#timepicker50').prop('disabled', true);
            $('#timepicker51').prop('disabled', true);
            $('#timepicker52').prop('disabled', true);
            $('#timepicker53').prop('disabled', true);
            $('#timepicker54').prop('disabled', true);
            $('#timepicker55').prop('disabled', true);
            $('#timepicker56').prop('disabled', true);
            $("#chatLoaderPV").hide();
        }

        $scope.EditShiftDoctor = function () {
            $("#chatLoaderPV").show();
            $scope.currentTab = "1";
            $scope.DoctorSave = true;
            //var $sel1 = $('#department');
            //$sel1.multiselect('enable');
            //var $sel2 = $('#Specialist');
            //$sel2.multiselect('enable');
            //var $sel3 = $('#CCCG');
            //$sel3.multiselect('enable');
            document.getElementById("FromDate").disabled = false;
            document.getElementById("ToDate").disabled = false;
            $("#OrgDefaultId").attr("disabled", false);
            $("#OrgBookInfoId").attr("disabled", false);
            $('#NewAppointment').prop('disabled', false);
            $('#followup').prop('disabled', false);
            $('#IntervalBt').prop('disabled', false);
            $('#CustomSlot').prop('disabled', false);
            $('#Days').prop('disabled', false);
            $('#Minutes').prop('disabled', false);
            $("#SundayId").attr("disabled", false);
            $("#MondayId").attr("disabled", false);
            $("#TuesdayId").attr("disabled", false);
            $("#WednesdayId").attr("disabled", false);
            $("#ThursdayId").attr("disabled", false);
            $("#FridayId").attr("disabled", false);
            $("#SaturdayId").attr("disabled", false);
            $('#timepicker1').prop('disabled', false);
            $('#timepicker2').prop('disabled', false);
            $('#timepicker3').prop('disabled', false);
            $('#timepicker4').prop('disabled', false);
            $('#timepicker5').prop('disabled', false);
            $('#timepicker6').prop('disabled', false);
            $('#timepicker7').prop('disabled', false);
            $('#timepicker8').prop('disabled', false);
            $('#timepicker9').prop('disabled', false);
            $('#timepicker10').prop('disabled', false);
            $('#timepicker11').prop('disabled', false);
            $('#timepicker12').prop('disabled', false);
            $('#timepicker13').prop('disabled', false);
            $('#timepicker14').prop('disabled', false);
            $('#timepicker15').prop('disabled', false);
            $('#timepicker16').prop('disabled', false);
            $('#timepicker17').prop('disabled', false);
            $('#timepicker18').prop('disabled', false);
            $('#timepicker19').prop('disabled', false);
            $('#timepicker20').prop('disabled', false);
            $('#timepicker21').prop('disabled', false);
            $('#timepicker22').prop('disabled', false);
            $('#timepicker23').prop('disabled', false);
            $('#timepicker24').prop('disabled', false);
            $('#timepicker25').prop('disabled', false);
            $('#timepicker26').prop('disabled', false);
            $('#timepicker27').prop('disabled', false);
            $('#timepicker28').prop('disabled', false);
            $('#timepicker29').prop('disabled', false);
            $('#timepicker30').prop('disabled', false);
            $('#timepicker31').prop('disabled', false);
            $('#timepicker32').prop('disabled', false);
            $('#timepicker33').prop('disabled', false);
            $('#timepicker34').prop('disabled', false);
            $('#timepicker35').prop('disabled', false);
            $('#timepicker36').prop('disabled', false);
            $('#timepicker37').prop('disabled', false);
            $('#timepicker38').prop('disabled', false);
            $('#timepicker39').prop('disabled', false);
            $('#timepicker40').prop('disabled', false);
            $('#timepicker41').prop('disabled', false);
            $('#timepicker42').prop('disabled', false);
            $('#timepicker43').prop('disabled', false);
            $('#timepicker44').prop('disabled', false);
            $('#timepicker45').prop('disabled', false);
            $('#timepicker46').prop('disabled', false);
            $('#timepicker47').prop('disabled', false);
            $('#timepicker48').prop('disabled', false);
            $('#timepicker49').prop('disabled', false);
            $('#timepicker50').prop('disabled', false);
            $('#timepicker51').prop('disabled', false);
            $('#timepicker52').prop('disabled', false);
            $('#timepicker53').prop('disabled', false);
            $('#timepicker54').prop('disabled', false);
            $('#timepicker55').prop('disabled', false);
            $('#timepicker56').prop('disabled', false);
            $("#chatLoaderPV").hide();
        }


        $scope.SundayShift2 = [];
        $scope.MondayShift2 = [];
        $scope.TuesdayShift2 = [];
        $scope.WednessdayShift2 = [];
        $scope.ThursdayShift2 = [];
        $scope.FridayShift2 = [];
        $scope.SaturdayShift2 = [];

        /*THIS IS FOR LIST FUNCTION*/
        $scope.DoctorShiftListGo = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.emptydata = [];
                $scope.rowCollection = [];
                $scope.Institution_Id = "";
                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $http.get(baseUrl + '/api/DoctorShift/DoctorShift_List/?IsActive=' + $scope.ISact + '&InstitutionId=' + $scope.InstituteId + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {

                    $scope.emptydata = [];
                    $scope.rowCollection = [];
                    $scope.rowCollection = data;
                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
                    if ($scope.rowCollectionFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };


        $scope.EditSelectedDoctor = [];
        $scope.EditSelectedDoctorList = [];
        $scope.EditSundayChildModuleList = [];
        $scope.EditMondayChildModuleList = [];
        $scope.EditTuesdayChildModuleList = [];
        $scope.EditWednessdayChildModuleList = [];
        $scope.EditThursdayChildModuleList = [];
        $scope.EditFridayChildModuleList = [];
        $scope.EditSaturdayChildModuleList = [];
        $scope.ChildModuleList = [];

        $scope.SundayShift = [];
        $scope.MondayShift = [];
        $scope.TuesdayShift = [];
        $scope.WednessdayShift = [];
        $scope.ThursdayShift = [];
        $scope.FridayShift = [];
        $scope.SaturdayShift = [];
        $scope.SundayShiftview = "";
        $scope.MondayShiftview = "";
        $scope.TuesdayShiftview = "";
        $scope.WednessdayShiftview = "";
        $scope.ThursdayShiftview = "";
        $scope.FridayShiftview = "";
        $scope.SaturdayShiftview = "";

        $scope.EditSundayChildModuleList1 = [];
        /*THIS IS FOR View FUNCTION*/
        $scope.DoctorShift_View = function (DId, DoctorId, Institution_Id) {
            $("#chatLoaderPV").show();
            /*document.getElementById("saveDoctorShift1").disabled = false;
            document.getElementById("saveDoctorShift2").disabled = false;
            document.getElementById("saveDoctorShift3").disabled = false;*/
            $scope.EditSelectedDoctor = [];
            $scope.EditSelectedDepartment = [];
            $scope.EditSelectedCCCG = [];
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/DoctorShift/DoctorShift_View/?DoctorId=' + DoctorId + '&Id=' + DId + '&Login_Session_Id=' + $scope.LoginSessionId + '&Institution_Id=' + Institution_Id).success(function (data) {
                if (data != null) {
                    $scope.EditSelectedDepartment.push(data.DepartmentId);
                    $scope.SelectedDepartment = $scope.EditSelectedDepartment;
                    $scope.onChangeDepartment();
                    $scope.EditSelectedDoctor.push(data.DoctorId);
                    $scope.SelectedSpecialist = $scope.EditSelectedDoctor;
                    $scope.FromDate = DateFormatEdit($filter('date')(data.FromDate, "dd-MMM-yyyy"));
                    $scope.ToDate = DateFormatEdit($filter('date')(data.ToDate, "dd-MMM-yyyy"));
                    $scope.onDateRange();
                    $('#OrgDefaultId').prop('checked', true);
                    $('#OrgBookInfoId').prop("checked", true);
                    $scope.NewAppointment = data.NewAppointment;
                    $scope.followup = data.FollowUp;
                    $scope.IntervalBt = data.Intervel;
                    $scope.CustomSlot = data.CustomSlot;
                    $scope.Days = data.BookingOpen;
                    $scope.Minutes = data.BookingCancelLock;
                    angular.forEach(data.CC_CG, function (value, index) {
                        $scope.EditSelectedCCCG.push(value.CcCg_Id);
                    });
                    $scope.SelectedCCCG = $scope.EditSelectedCCCG;
                    angular.forEach(data.SelectedDaysList, function (value, index) {
                        //Day = value.Day.toString();
                        Day = DateFormatEdit($filter('date')(value.Day, "dd-MMM-yyyy")).toString();
                        if (Day.includes("Sun") == true) {
                            $('#SundayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot1 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot2 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot3 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot4 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot5 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot6 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot43 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot44 = Convert24to12Timeformat(Set_Time1);
                            }

                        }
                        if (Day.includes("Mon") == true) {
                            $('#MondayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot7 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot8 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot9 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot10 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot11 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot12 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot45 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot46 = Convert24to12Timeformat(Set_Time1);
                            }
                        }
                        if (Day.includes("Tue") == true) {
                            $('#TuesdayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot13 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot14 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot15 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot16 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot17 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot18 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot47 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot48 = Convert24to12Timeformat(Set_Time1);
                            }
                        }
                        if (Day.includes("Wed") == true) {
                            $('#WednesdayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot19 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot20 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot21 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot22 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot23 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot24 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot49 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot50 = Convert24to12Timeformat(Set_Time1);
                            }
                        }
                        if (Day.includes("Thu") == true) {
                            $('#ThursdayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot25 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot26 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot27 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot28 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot29 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot30 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot51 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot52 = Convert24to12Timeformat(Set_Time1);
                            }
                        }
                        if (Day.includes("Fri") == true) {
                            $('#FridayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot31 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot32 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot33 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot34 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot35 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot36 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot53 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot54 = Convert24to12Timeformat(Set_Time1);
                            }
                        }
                        if (Day.includes("Sat") == true) {
                            $('#SaturdayId').prop('checked', true);
                            if (value.SHIFT == 1) {
                                var From = value.TimeSlotFromTime;
                                var From1 = From.split('T')[1];
                                var Set_Time = From1.slice(0, 5);
                                $scope.TimeSlot37 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot38 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 2) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot39 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot40 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 3) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot41 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot42 = Convert24to12Timeformat(Set_Time1);
                            }
                            if (value.SHIFT == 4) {
                                var From = value.TimeSlotFromTime;
                                var From_To = From.split('T')[1];
                                var Set_Time = From_To.slice(0, 5);
                                $scope.TimeSlot55 = Convert24to12Timeformat(Set_Time);

                                var To = value.TimeSlotToTime;
                                var To1 = To.split('T')[1];
                                var Set_Time1 = To1.slice(0, 5);
                                $scope.TimeSlot56 = Convert24to12Timeformat(Set_Time1);
                            }
                        }
                    });
                    /*document.getElementById("saveDoctorShift1").disabled = false;
                    document.getElementById("saveDoctorShift2").disabled = false;
                    document.getElementById("saveDoctorShift3").disabled = false;*/
                }
                //$("#chatLoaderPV").hide();
                if ($scope.DoctorSave == true) {
                    var sel1 = $('#department');
                    sel1.multiselect('disable');
                    var sel2 = $('#Specialist');
                    sel2.multiselect('disable');
                    var sel3 = $('#CCCG');
                    sel3.multiselect('enable');
                }
                if ($scope.DoctorSave == false) {
                    $scope.ViewShiftDoctor();
                    var sel1 = $('#department');
                    sel1.multiselect('disable');
                    var sel2 = $('#Specialist');
                    sel2.multiselect('disable');
                    var sel3 = $('#CCCG');
                    sel3.multiselect('disable');
                }
            })
            $("#chatLoaderPV").hide();
        };

        /* 
        Calling the api method to detele the details of the Doctor shift
        for the Doctor shift Id,
        and redirected to the list page.
        */
        $scope.DeleteDoctorShift = function (ID, DoctorId) {
            $scope.Id = ID;
            $scope.DoctorShift_Delete();
        };
        $scope.DoctorShift_Delete = function () {
            var del = confirm("Do you like to deactivate the selected Doctor Shift?");
            if (del == true) {
                $("#chatLoaderPV").show();
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }
                $http.post(baseUrl + '/api/DoctorShift/DoctorShift_Delete/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }

                    $scope.DoctorShiftListGo();
                }).error(function (data) {
                    $scope.error = "AN error has occured while deleting Institution!" + data;
                });
                $("#chatLoaderPV").hide();
            };
        };

        /*'Active' the Doctor shift */
        $scope.ReInsertDoctorShift = function (comId, DoctorId) {
            $scope.Id = comId;
            $scope.ReInsertDoctorShiftList(DoctorId);
        };

        /* 
        Calling the api method to inactived the details of the Doctor shift
        for the Doctor shift Id,
        and redirected to the list page.
        */
        $scope.ReInsertDoctorShiftList = function (DoctorId) {
            $("#chatLoaderPV").show();
            $http.get(baseUrl + '/api/DoctorShift/ActivateDoctorShift_List/?Id=' + $scope.Id
                + '&Institution_Id=' + $window.localStorage['InstitutionId']
                + '&Doctor_Id=' + DoctorId
            ).success(function (data) {
                if (data.returnval == 1) {
                    //alert("Activate Doctor Shift is already created, Please check");
                    toastr.info("Activate Doctor Shift is already created, Please check", "info");
                }
                else {
                    var Ins = confirm("Do you like to activate the selected Doctor Shift?");
                    if (Ins == true) {
                        var obj =
                        {
                            Id: $scope.Id,
                            Modified_By: $window.localStorage['UserId']
                        }
                        $http.post(baseUrl + '/api/DoctorShift/DoctorShift_Active/', obj).success(function (data) {
                            alert(data.Message);
                            $scope.DoctorShiftListGo();
                        }).error(function (data) {
                            $scope.error = "An error has occurred while ReInsertDoctor Shift" + data;
                        });
                    };
                }
            })
            $("#chatLoaderPV").hide();
        }

        //Appointment Settings 

        $scope.NewAppointment = "0";
        $scope.followup = "0";
        $scope.IntervalBt = "0";
        $scope.CustomSlot = "0";
        $scope.Days = "0";
        $scope.AppointmentDay = "";
        $scope.Minutes = "0";
        $scope.TimeZoneList = [];
        $scope.SelectedTimeZone = "";
        $scope.sunday = true;
        $scope.monday = true;
        $scope.tuesday = true;
        $scope.wednesday = true;
        $scope.thursday = true;
        $scope.friday = true;
        $scope.saturday = true;
        $scope.SelectDefHoliday = "0";
        $scope.cc = "1";
        $scope.cg = "1";
        $scope.cl = "1";
        $scope.sc = "1";
        $scope.userpatient = "1";
        $scope.DayLists = [];
        $scope.HourLists = [];
        $scope.MinuteLists = [];
        $scope.SelectedDay = [];
        $scope.SelectedMinute = [];
        $scope.SelectedHour = [];
        $scope.DefaultWorkingDays = [];
        $scope.SelectedDefaultholidayday = [];
        $scope.SelectedDefaultholidayhour = [];
        $scope.SelectedDefaultholidayMinute = [];
        $scope.DefaultHolidayList = [];
        $scope.DayLists = [];
        $scope.HourLists = [];
        $scope.MinuteLists = [];
        $scope.BookEnable = "1";
        $scope.confirmBook = "1";
        $scope.AutoEnable = "1";
        $scope.AppointmentId = "";
        $scope.MyAppointmentRow = "-1";


        $scope.AddReminderParameters = [{
            'ID': $scope.AppointmentId,
            'ReminderDays': $scope.ReminderDays,
            'ReminderHours': $scope.ReminderHours,
            'ReminderMinutes': $scope.ReminderMinutes,
            'IsActive': 1
        }];

        /*This is a Addrow function to add new row and save  */
        $scope.ReminderUserAdd = function () {
            if ($scope.MyAppointmentRow >= 0) {
                var obj = {
                    'ID': $scope.AppointmentId,
                    'ReminderDays': $scope.ReminderDays,
                    'ReminderHours': $scope.ReminderHours,
                    'ReminderMinutes': $scope.ReminderMinutes,
                    'IsActive': 1
                }
                $scope.AddReminderParameters[$scope.MyAppointmentRow] = obj;
            }
            else {
                $scope.AddReminderParameters.push({
                    'ID': $scope.AppointmentId,
                    'ReminderDays': $scope.ReminderDays,
                    'ReminderHours': $scope.ReminderHours,
                    'ReminderMinutes': $scope.ReminderMinutes,
                    'IsActive': 1
                })
            }
        };
        $scope.Reset_MyAppointment = function () {

            var del = confirm("Do you like to Reset the AppointmentSetting  details?");
            if (del == true) {
                $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingDelete/?InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                    //alert("AppointmentSetting  has been Reset Successfully");
                    toastr.success("AppointmentSetting  has been Reset Successfully", "success");
                    $scope.AppointmentSettings();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  AppointmentSettings details" + data;
                });
            }

        }

        $scope.ReminderUserDelete = function (Delete_Id, rowIndex) {
            var del = confirm("Do you like to delete User Remainder Details?");
            if (del == true) {
                var Previous_MyReminderItem = [];
                if ($scope.Id == 0) {
                    angular.forEach($scope.AddReminderParameters, function (selectedPre, index) {
                        if (index != rowIndex)
                            Previous_MyReminderItem.push(selectedPre);
                    });
                    $scope.AddReminderParameters = Previous_MyReminderItem;
                } else if ($scope.Id > 0) {
                    angular.forEach($scope.AddReminderParameters, function (selectedPre, index) {
                        if (index != rowIndex)
                            Previous_MyReminderItem.push(selectedPre);
                    });
                    $scope.AddReminderParameters = Previous_MyReminderItem;
                }
            }
        };
        $http.get(baseUrl + '/api/DoctorShift/TimeZoneList/').success(function (data) {
            $scope.TimeZoneList = data;
        });

        $scope.DefaultHolidayList
        [
            {
                "Name": "1",
                "ID": 1
            },
            {
                "Name": "2",
                "ID": 2
            }
        ]




        $scope.AppointmentSettings = function () {
            $("#chatLoaderPV").show();

            angular.forEach($scope.TimeZoneList, function (value, index) {
                if (value.SelectedTimeZone == $scope.SelectedTimeZone) {
                    $scope.SelectedTimeZone = value.SelectedTimeZone;
                }
            });

            $http.get(baseUrl + '/api/DoctorShift/AppointmentSettingView/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $window.localStorage['Login_Session_Id']).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.sunday = false;
                $scope.monday = false;
                $scope.tuesday = false;
                $scope.wednesday = false;
                $scope.thursday = false;
                $scope.friday = false;
                $scope.saturday = false;
                if (data != '' && data != null && data != undefined) {
                    $scope.DuplicatesId = data.ID;
                    $scope.InstitutionId = data.InstitutionId;
                    $scope.MyAppConfigId = data.MyAppConfigId;
                    $scope.NewAppointment = data.NewAppointmentDuration;
                    $scope.followup = data.FollowUpDuration;
                    $scope.IntervalBt = data.AppointmentInterval;
                    $scope.AppointmentDay = data.MaxScheduleDays;
                    $scope.Minutest = data.MinRescheduleMinutes;
                    $scope.SelectedTimeZone = data.DefautTimeZone;
                    $scope.DefaultworkingDays = data.DefaultWorkingDays;
                    $scope.SelectedDefaultholiday = data.DefaultHoliDays;
                    $scope.BookEnable = data.IsAppointmentInHolidays;
                    $scope.cc = data.IsCc;
                    $scope.cg = data.IsCg;
                    $scope.cl = data.IsCl;
                    $scope.sc = data.IsSc;
                    $scope.userpatient = data.IsPatient;
                    $scope.confirmBook = data.IsDirectAppointment;
                    $scope.AddReminderParameters = data.ReminderTimeInterval;
                    $scope.AutoEnable = data.IsAutoReschedule;
                    $scope.ReduceNumberofavailableAppointmentes = data.MinRescheduleDays;
                    var weekly = data.DefaultWorkingDays.split(',');

                    angular.forEach(weekly, function (value, index) {
                        if ($('#sunday').val() == value) {
                            $scope.sunday = true;
                        }
                        if ($('#monday').val() == value) {
                            $scope.monday = true;
                        }
                        if ($('#tuesday').val() == value) {
                            $scope.tuesday = true;
                        }
                        if ($('#wednesday').val() == value) {
                            $scope.wednesday = true;
                        }
                        if ($('#thursday').val() == value) {
                            $scope.thursday = true;
                        }
                        if ($('#friday').val() == value) {
                            $scope.friday = true;
                        }
                        if ($('#saturday').val() == value) {
                            $scope.saturday = true;
                        }

                    });
                } else {
                    $scope.sunday = true;
                    $scope.monday = true;
                    $scope.tuesday = true;
                    $scope.wednesday = true;
                    $scope.thursday = true;
                    $scope.friday = true;
                    $scope.saturday = true;
                    $scope.cc = true;
                    $scope.cg = true;
                    $scope.cl = true;
                    $scope.sc = true;
                    $scope.userpatient = true;
                }



            });
        }

        $scope.AppointmentSettings1 = function () {
            $("#chatLoaderPV").show();

            $scope.MyAppConfigId = "";
            $scope.NewAppointment = "";
            $scope.followup = "";
            $scope.IntervalBt = "";
            $scope.AppointmentDay = "";
            $scope.Minutest = "";
            $scope.SelectedTimeZone = "";
            $scope.workingdays = "";
            $scope.SelectedDefaultholiday = "";
            $scope.BookEnable = "1";
            $scope.cc = true;
            $scope.cg = true;
            $scope.cl = true;
            $scope.sc = true;
            $scope.userpatient = true;
            $scope.confirmBook = "1";
            $scope.sunday = true;
            $scope.monday = true;
            $scope.tuesday = true;
            $scope.wednesday = true;
            $scope.thursday = true;
            $scope.friday = true;
            $scope.saturday = true;
            $scope.AddReminderParameters = [];
            $scope.AutoEnable = "1";
            $scope.ReduceNumberofavailableAppointmentes = "";
            $("#chatLoaderPV").hide();


        }




        /* THIS IS FOR VALIDATION CONTROL */
        $scope.ValidationcontrolsAppointment = function () {
            if (typeof ($scope.NewAppointment) == "undefined" || $scope.NewAppointment == "0") {
                //alert("Please Enter NewAppointment");
                toastr.warning("Please Enter NewAppointment", "warning");
                return false;
            }
            else if (typeof ($scope.followup) == "undefined" || $scope.followup == "0") {
                //alert("Please Enter FollowUp");
                toastr.warning("Please Enter FollowUp", "warning");
                return false;
            }
            else if (typeof ($scope.IntervalBt) == "undefined" || $scope.IntervalBt == "0") {
                //alert("Please Enter IntervalBetween");
                toastr.warning("Please Enter IntervalBetween", "warning");
                return false;
            }
            else if (typeof ($scope.AppointmentDay) == "undefined" || $scope.AppointmentDay == "0") {
                //alert("Please Enter AppointmentDay");
                toastr.warning("Please Enter AppointmentDay", "warning");
                return false;
            }
            else if (typeof ($scope.Minutest) == "undefined" || $scope.Minutest == "0") {
                //alert("Please Enter Minutes");
                toastr.warning("Please Enter Minutes", "warning");
                return false;
            }

            return true;
        };

        $scope.MyAppointment_InsertUpdate = function () {
            if ($scope.ValidationcontrolsAppointment() == true) {
                $("#chatLoaderPV").show();

                if ($("input[name='bookenable']:checked").val() == "1") {
                    $scope.BookEnable = 1;
                } else {
                    $scope.BookEnable = 0;
                }


                if ($("input[name='confirm']:checked").val() == "1") {
                    $scope.confirmBook = 1;
                } else {
                    $scope.confirmBook = 0;
                }

                if ($("input[name='autoenable']:checked").val() == "1") {
                    $scope.AutoEnable = 1;
                } else {
                    $scope.AutoEnable = 0;
                }

                if ($("input[name='cc']:checked").val() == "1") {
                    $scope.cc = 1;
                } else {
                    $scope.cc = 0;
                }

                if ($("input[name='cg']:checked").val() == "1") {
                    $scope.cg = 1;
                } else {
                    $scope.cg = 0;
                }

                if ($("input[name='cl']:checked").val() == "1") {
                    $scope.cl = 1;
                } else {
                    $scope.cl = 0;
                }

                if ($("input[name='sc']:checked").val() == "1") {
                    $scope.sc = 1;
                } else {
                    $scope.sc = 0;
                }

                if ($("input[name='userpatient']:checked").val() == "1") {
                    $scope.userpatient = 1;
                } else {
                    $scope.userpatient = 0;
                }




                $scope.temp = '';
                if ($("#sunday").is(":checked") == true) {
                    $scope.temp = 'sunday';
                }
                if ($("#monday").is(":checked") == true) {
                    if ($scope.temp != '') {
                        $scope.temp = $scope.temp + ',' + 'monday';
                    } else {
                        $scope.temp = 'monday';
                    }
                }
                if ($("#tuesday").is(":checked") == true) {
                    if ($scope.temp != '') {
                        $scope.temp = $scope.temp + ',' + 'tuesday';
                    } else {
                        $scope.temp = 'tuesday';
                    }
                }
                if ($("#wednesday").is(":checked") == true) {
                    if ($scope.temp != '') {
                        $scope.temp = $scope.temp + ',' + 'wednesday';
                    } else {
                        $scope.temp = 'wednesday';
                    }
                }

                if ($("#thursday").is(":checked") == true) {
                    if ($scope.temp != '') {
                        $scope.temp = $scope.temp + ',' + 'thursday';
                    } else {
                        $scope.temp = 'thursday';
                    }
                }

                if ($("#friday").is(":checked") == true) {
                    if ($scope.temp != '') {
                        $scope.temp = $scope.temp + ',' + 'friday';
                    } else {
                        $scope.temp = 'friday';
                    }
                }

                if ($("#saturday").is(":checked") == true) {
                    if ($scope.temp != '') {
                        $scope.temp = $scope.temp + ',' + 'saturday';
                    } else {
                        $scope.temp = 'saturday';
                    }
                }
                if ($scope.temp != '') {
                    $scope.DefaultWorkingDays = $scope.temp;
                }

                angular.forEach($scope.TimeZoneList, function (value, index) {
                    if (value.TimeZoneName == $scope.SelectedTimeZone) {
                        $scope.SelectedTimeZone = value.TimeZoneName;
                    }
                });

                var obj = {
                    ID: $scope.id,
                    InstitutionId: $window.localStorage['InstitutionId'],
                    CreatedBy: $window.localStorage['UserId'],
                    NewAppointmentDuration: $scope.NewAppointment,
                    FollowUpDuration: $scope.followup,
                    AppointmentInterval: $scope.IntervalBt,
                    MinRescheduleDays: $scope.ReduceNumberofavailableAppointmentes,
                    MinRescheduleMinutes: $scope.Minutest,
                    DefautTimeZone: $scope.SelectedTimeZone,
                    DefaultWorkingDays: $scope.DefaultWorkingDays,
                    DefaultHoliDays: $scope.SelectedDefaultholiday,
                    IsAppointmentInHolidays: $scope.BookEnable,
                    IsCc: $scope.cc,
                    IsCg: $scope.cg,
                    IsCl: $scope.cl,
                    IsSc: $scope.sc,
                    IsPatient: $scope.userpatient,
                    IsDirectAppointment: $scope.confirmBook,
                    ReminderTimeInterval: $scope.AddReminderParameters,
                    IsAutoReschedule: $scope.AutoEnable,
                    MaxScheduleDays: $scope.AppointmentDay
                };
                $('#save').attr("disabled", true);
                $http.post(baseUrl + '/api/DoctorShift/Org_AppointmentSettings_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $('#save').attr("disabled", false);
                    $scope.AppointmentSettings();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Parameter" + data;
                });
            }
        }
    }
]);

MyCortexControllers.controller("AttendanceDetailsController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {
        //  $scope.InstituteId = $window.localStorage['InstitutionId'];
        //Declaration and initialization of Scope Variables.
        $scope.ShiftName = "";
        $scope.IsActive = true;
        $scope.Id = 0;
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.page_size = 0;
        $scope.ConfigCode = "PAGINATION";
        $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            if (data[0] != undefined) {
                $scope.page_size = parseInt(data[0].ConfigValue);
                $window.localStorage['Pagesize'] = $scope.page_size;
            }
        });
        /*List Page Pagination*/
        $scope.listdata = [];
        $scope.current_page = 1;
        $scope.page_size = $window.localStorage['Pagesize'];
        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        /* on click Add New, Add popup opened*/
        $scope.AddAttendance = function () {
            $scope.DoctorName = "";
            $scope.AttendanceFromDate = "";
            $scope.AttendanceToDate = "";
            $scope.Remarks = "";
            angular.element('#AttendanceAddModal').modal('show');
            $('#btnsave').attr("disabled", false);
        }
        /* on click view, view popup opened*/
        $scope.ViewAttendance = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewAttendanceList();
            angular.element('#ViewAttendanceModal').modal('show');
        }
        /* on click Edit, edit popup opened*/
        $scope.EditAttendance = function (CatId, ActiveFlag, AttendanceToDate) {
            $scope.AttendanceTo_Date = $filter('date')(AttendanceToDate, "dd-MMM-yyyy hh:mm:ss a");
            $scope.Today_Date = $filter('date')(new Date(), 'dd-MMM-yyyy hh:mm:ss a');
            $('#btnsave').attr("disabled", false);
            if (ActiveFlag == 1) {
                $scope.ClearAttendancePopUp();
                $scope.Id = CatId;
                $scope.ViewAttendanceList();
                if ((ParseDate($scope.Today_Date) < ParseDate($scope.AttendanceTo_Date))) {
                    angular.element('#AttendanceAddModal').modal('show');
                }
                else {
                    //alert("Completed To date  record cannot be edited");
                    toastr.info("Completed To date  record cannot be edited", "info");
                }
            }
            else {
                //alert("Inactive record cannot be edited");
                toastr.info("Inactive record cannot be edited", "info");
            }
        };

        $scope.CancelSlot = function () {
            angular.element('#AttendanceModal').modal('hide');
        }

        $scope.CancelAttendanceDetails = function () {
            angular.element('#AttendanceAddModal').modal('hide');
        }

        /* User basic details list*/
        /*  $scope.InstituteId=$window.localStorage['InstitutionId'];
          $scope.DoctorList = [];
          $scope.DoctorListActive = [];
      
              $http.get(baseUrl + '/api/Attendance/UserType_List/?Institution_Id=' +$window.localStorage['InstitutionId']).success(function (data) {  
               
                      $scope.UserTypeList =data;   
           
          });*/
        $scope.UserListType = [];
        $http.get(baseUrl + '/api/Attendance/Clinician_UserList/?Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
            $scope.UserTypeList = $ff(data, { IsActive: 1 });;
            $scope.UserTypeList = data;
        });

        //$scope.InstituteId=$window.localStorage['InstitutionId'];
        //$scope.Attendance_List = [];
        //$http.get(baseUrl + '/api/Attendance/Attendance_List/?Institution_Id=' +$scope.InstituteId).success(function (data) {        
        //    $scope.Attendance_List =data;
        //});


        $scope.Convert24to12Timeformat = function (inputTime) {
            var outputTime = null;
            if (inputTime != '' && inputTime != null) {
                inputTime = inputTime.toString(); //value to string for splitting
                var splitTime = inputTime.split(':');
                splitTime.splice(2, 1);
                var ampm = (splitTime[0] >= 12 ? ' PM' : ' AM'); //determine AM or PM
                splitTime[0] = splitTime[0] % 12;
                splitTime[0] = (splitTime[0] == 0 ? 12 : splitTime[0]); //adjust for 0 = 12
                outputTime = splitTime.join(':') + ampm;
            }
            return outputTime;
        };
        $scope.Convert12To24Timeformat = function (timeval) {
            var outputTime = null;
            if (timeval != '' && timeval != null) {
                var time = timeval;
                var hours = Number(time.match(/^(\d+)/)[1]);
                var minutes = Number(time.match(/:(\d+)/)[1]);
                var AMPM = time.match(/\s(.*)$/)[1];
                if (AMPM == "PM" && hours < 12) hours = hours + 12;
                if (AMPM == "AM" && hours == 12) hours = hours - 12;
                var sHours = hours.toString();
                var sMinutes = minutes.toString();
                if (hours < 10) sHours = "0" + sHours;
                if (minutes < 10) sMinutes = "0" + sMinutes;
                outputTime = sHours + ":" + sMinutes;
            }
            return outputTime;
        };

        /* Validating the create page mandatory fields
           checking mandatory for the follwing fields
           Doctor Name,From Date,To Date
           and showing alert message when it is null.
           */
        $scope.DoctorAttendance_InsertUpdateValidations = function () {
            var today = moment(new Date()).format('DD-MMM-YYYY');
            $scope.AttendanceFromDate = moment($('#datetimepickerholiday_From').val()).format('DD-MMM-YYYY');
            $scope.AttendanceToDate = moment($('#datetimepickerholiday_To').val()).format('DD-MMM-YYYY');

            if ($scope.SelectedAttendance == "" || $scope.SelectedAttendance == undefined) {
                //alert("Please select User");
                toastr.warning("Please select User", "warning");
                return false;
            }

            else if (typeof ($scope.AttendanceFromDate) == "undefined" || $scope.AttendanceFromDate == 0) {
                //alert("Please select From Date");
                toastr.warning("Please select From Date", "warning");
                return false;
            }
            else if (typeof ($scope.AttendanceToDate) == "undefined" || $scope.AttendanceToDate == 0) {
                //alert("Please select To Date");
                toastr.warning("Please select To Date", "warning");
                return false;
            }
            else if ((ParseDate($scope.AttendanceFromDate) < ParseDate(today))) {
                //alert("From Date Can Be Booked Only For Future");
                toastr.warning("From Date Can Be Booked Only For Future", "warning");
                $scope.AttendanceFromDate = moment($('#datetimepickerholiday_From').val()).format('DD-MMM-YYYY hh:mm:ss');
                $scope.AttendanceToDate = moment($('#datetimepickerholiday_To').val()).format('DD-MMM-YYYY hh:mm:ss');
                return false;
            }
            else if ((ParseDate($scope.AttendanceToDate) < ParseDate(today))) {
                //alert("To Date Can Be Booked Only For Future");
                toastr.warning("To Date Can Be Booked Only For Future", "warning");
                $scope.AttendanceFromDate = moment($('#datetimepickerholiday_From').val()).format('DD-MMM-YYYY hh:mm:ss');
                $scope.AttendanceToDate = moment($('#datetimepickerholiday_To').val()).format('DD-MMM-YYYY hh:mm:ss');
                return false;
            }

            else if (($scope.AttendanceFromDate !== null) && ($scope.AttendanceToDate !== null)) {
                if ((ParseDate($scope.AttendanceToDate) < ParseDate($scope.AttendanceFromDate))) {
                    //alert("From Date Should not be greater than To Date");
                    toastr.warning("From Date Should not be greater than To Date", "warning");
                    $scope.AttendanceFromDate = moment($('#datetimepickerholiday_From').val()).format('DD-MMM-YYYY hh:mm:ss');
                    $scope.AttendanceToDate = Dmoment($('#datetimepickerholiday_To').val()).format('DD-MMM-YYYY hh:mm:ss');
                    return false;
                }
            }
            $scope.AttendanceFromDate = moment($('#datetimepickerholiday_From').val()).format('DD-MMM-YYYY hh:mm:ss');
            $scope.AttendanceToDate = moment($('#datetimepickerholiday_To').val()).format('DD-MMM-YYYY hh:mm:ss');
            return true;
        };
        /*on click Save calling the insert update function for Doctor Holiday
            and check the Doctor Name  already exist between From Date and To Date,if exist it display alert message or its 
            calling the insert update function*/
        $scope.SelectedAttendance = [];
        $scope.DoctorAttendanceDetails = [];
        $scope.AttendanceAddEdit = function () {
            $scope.DoctorAttendanceDetails = [];
            if ($scope.DoctorAttendance_InsertUpdateValidations() == true) {
                $("#chatLoaderPV").show();
                var AttendanceFromDate = $('#datetimepickerholiday_From').val().split(' ')[0];
                var AttendanceToDate = $('#datetimepickerholiday_To').val().split(' ')[0];
                var AttendanceFromDateTime = $('#datetimepickerholiday_From').val().split(' ')[1];
                var AttendanceToDateTime = $('#datetimepickerholiday_To').val().split(' ')[1];
                $scope.AttendanceFromDate = AttendanceFromDate;
                $scope.AttendanceToDate = AttendanceToDate;
                $scope.fromtime = AttendanceFromDateTime;
                $scope.totime = AttendanceToDateTime;
                if ($scope.Id == 0) {
                    angular.forEach($scope.SelectedAttendance, function (value, index) {
                        var obj = {
                            Id: $scope.Id,
                            Institution_Id: $window.localStorage['InstitutionId'],
                            AttendanceFromDate: moment($scope.AttendanceFromDate).format('DD-MMM-YYYY'),
                            AttendanceToDate: moment($scope.AttendanceToDate).format('DD-MMM-YYYY'),
                            AttendanceFromTime: $scope.fromtime,
                            AttendanceToTime: $scope.totime,
                            Doctor_Id: value,
                            Remarks: $scope.Remarks
                        };
                        $('#btnsave').attr("disabled", true);
                        $scope.DoctorAttendanceDetails.push(obj)
                    });
                }
                else {
                    var obj = {
                        Id: $scope.Id,
                        Institution_Id: $window.localStorage['InstitutionId'],
                        AttendanceFromDate: moment($scope.AttendanceFromDate).format('DD-MMM-YYYY'),
                        AttendanceToDate: moment($scope.AttendanceToDate).format('DD-MMM-YYYY'),
                        AttendanceFromTime: $scope.fromtime,
                        AttendanceToTime: $scope.totime,
                        Doctor_Id: $scope.EditSelectedAttendance,
                        Remarks: $scope.Remarks
                    };
                    $('#btnsave').attr("disabled", true);
                    $scope.DoctorAttendanceDetails.push(obj)
                }
                $http.post(baseUrl + '/api/Attendance/AttendanceDetails_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, $scope.DoctorAttendanceDetails).success(function (data) {
                    if (data.ReturnFlag == 1) {
                        //alert(data.Message);
                        if (data.ReturnFlag == 1) {
                            toastr.success(data.Message, "success");
                        }
                        else if (data.ReturnFlag == 0) {
                            toastr.info(data.Message, "info");
                        }
                        $('#btnsave').attr("disabled", false);
                        $scope.AttendanceList();
                        $scope.ClearAttendancePopUp();
                        $("#chatLoaderPV").hide();
                    } else {
                        $("#chatLoaderPV").hide();
                        //alert(data.Message);
                        if (data.ReturnFlag == 2) {
                            toastr.info(data.Message, "info");
                        }
                        else if (data.ReturnFlag == 0) {
                            toastr.info(data.Message, "info");
                        }
                        $('#btnsave').attr("disabled", false);
                        $scope.ClearAttendancePopUp();
                        return false;
                    }
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Parameter" + data;
                });
            }
        };

        $scope.searchqueryAttendance = "";
        /* Filter the master list function for Search*/
        $scope.FilterAttendanceList = function () {

            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchqueryAttendance);
            if (searchstring == "") {
                $scope.rowCollectionAttendanceFilter = [];
                $scope.rowCollectionAttendanceFilter = angular.copy($scope.rowCollectionAttendance);
            }
            else {
                $scope.rowCollectionAttendanceFilter = $ff($scope.rowCollectionAttendance, function (value) {
                    return angular.lowercase(value.DoctorName).match(searchstring) ||
                        angular.lowercase($filter('date')(value.AttendanceFromDate, "dd-MMM-yyyy")).match(searchstring) ||
                        angular.lowercase($filter('date')(value.AttendanceToDate, "dd-MMM-yyyy")).match(searchstring) ||
                        angular.lowercase(value.CreatedByName).match(searchstring) ||
                        angular.lowercase($filter('date')(value.Created_Dt, "dd-MMM-yyyy hh:mm:ss a")).match(searchstring);

                });
            }
        }
        /*THIS IS FOR LIST FUNCTION*/

        $scope.AttendanceList = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.emptydataAttendance = [];
                $scope.rowCollectionAttendance = [];

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }

                $http.get(baseUrl + '/api/Attendance/Attendance_List/?Id=0' + '&IsActive=' + $scope.ISact + '&Institution_Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId
                ).success(function (data) {
                    $scope.emptydataAttendance = [];
                    $scope.rowCollectionAttendance = [];
                    $scope.rowCollectionAttendance = data;
                    $scope.rowCollectionAttendanceFilter = angular.copy($scope.rowCollectionAttendance);
                    if ($scope.rowCollectionAttendanceFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        /*THIS IS FOR View FUNCTION*/
        $scope.Edit_SelectedDoctor = [];
        $scope.Edit_SelectedDoctorList = [];
        $scope.ViewAttendanceList = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/Attendance/Attendance_View/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId + '&institution_id=' + $window.localStorage['InstitutionId']).success(function (data) {
                $scope.DuplicatesId = data.Id;
                $scope.Doctor_Id = data.Doctor_Id.toString();
                $scope.DoctorName = data.DoctorName;
                var ATT_FROM = moment(data.AttendanceFromDate).format('DD-MMM-YYYY hh:mm:ss');
                //$scope.AttendanceFromDate = DateFormatEdit(ATT_FROM);
                $scope.AttendanceFromDate = ATT_FROM;
                var ATT_TO = moment(data.AttendanceToDate).format('DD-MMM-YYYY hh:mm:ss');
                $scope.AttendanceToDate = ATT_TO;
                $scope.Edit_SelectedDoctor.push(data.Doctor_Id);
                $scope.EditSelectedAttendance = data.Doctor_Id.toString();
                $scope.SelectedAttendance = $scope.Edit_SelectedDoctor;
                $scope.Remarks = data.Remarks;
                $("#chatLoaderPV").hide();
            });
        };

        $scope.ClearAttendancePopUp = function () {
            $scope.Id = 0;
            $scope.InstituteId = "";
            $scope.Remarks = "";
            $scope.SelectedAttendance = [];
            $scope.AttendanceFromDate = "";
            $scope.AttendanceToDate = "";
            $scope.CancelAttendancePopUp();
        }
        /* THIS IS FUNCTION FOR CLOSE Modal Window  */
        $scope.CancelAttendancePopUp = function () {
            angular.element('#AttendanceAddModal').modal('hide');
            angular.element('#ViewAttendanceModal').modal('hide');
        };
        /*InActive the Doctor Holiday*/
        $scope.DeleteAttendance = function (comId) {
            $scope.Id = comId;
            $scope.Attendance_InActive();
        };
        /* 
        Calling the api method to inactived the details of the  Holiday 
        for the  Doctor ,
        and redirected to the list page.
        */
        $scope.Attendance_InActive = function () {
            var del = confirm("Do you like to deactivate the selected Holiday?");
            if (del == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/Attendance/Attendance_InActive/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.AttendanceList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Holiday" + data;
                });
            };
        };

        /*Active the Doctor Holiday*/
        $scope.ReInsertAttendance = function (comId) {
            $scope.Id = comId;
            $scope.Attendance_Active();
        };
        /* 
       Calling the api method to Actived the details of the  Holiday 
       for the  Doctor ,
       and redirected to the list page.
       */
        $scope.Attendance_Active = function () {
            var Ins = confirm("Do you like to activate the selected  Holiday?");
            if (Ins == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/Attendance/Attendance_Active/', obj).success(function (data) {
                    //alert(data.Message);
                    if (data.ReturnFlag == 2) {
                        toastr.success(data.Message, "success");
                    }
                    $scope.AttendanceList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Holiday" + data;
                });
            };
        }

        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }

    }

]);

MyCortexControllers.controller("WebConfigurationController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {
        $scope.IsActive = true;
        $scope.Id = 0;
        $scope.User_Id = 0;
        $scope.Config_value = [];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.IsEdit = false;
        $scope.WebConfigEdit = function () {
            $scope.IsEdit = true;
        }

        $scope.WebConfigCancel = function () {
            $scope.WebConfigurationList();
            $scope.IsEdit = false;
        }

        $scope.searchqueryWebConfiguration = "";
        /* Filter the master list function for Search*/
        $scope.FilterWebConfigurationList = function () {
            var searchstring = angular.lowercase($scope.searchqueryWebConfiguration);
            if ($scope.searchqueryWebConfiguration == "") {
                $scope.rowCollectionWebConfiguration = angular.copy($scope.rowCollectionWebConfigurationFilter);
            }
            else {
                $scope.rowCollectionWebConfiguration = $ff($scope.rowCollectionWebConfigurationFilter, function (value, index) {
                    return angular.lowercase(value.CONFIGCODE).match(searchstring)
                });
            }
        };

        /* on click Add New, Add popup opened*/
        $scope.AddWebConfiguration = function () {
            angular.element('#WebConfigurationAddModal').modal('show');
        }

        $scope.CancelWebConfigurationDetails = function () {
            angular.element('#WebConfigurationAddModal').modal('hide');
        }

        $scope.ClearWebConfigurationPopUp = function () {
            $scope.Id = 0;
            $scope.Institution_Id = "";
            $scope.Remarks = "";
            $scope.Config_Code = "";
            $scope.Config_Name = "";
            $scope.Config_Value = "";
            $scope.Config_Type = "";
            $scope.CancelWebConfigurationPopUp();
        }

        /*THIS IS FOR LIST FUNCTION*/
        $scope.ViewParamList = [];
        $scope.ViewParamList1 = [];
        $scope.WebConfigurationList = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.emptydataWebConfiguration = [];
                $scope.rowCollectionWebConfiguration = [];

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $http.get(baseUrl + '/api/WebConfiguration/WebConfiguration_List/?IsActive=' + $scope.ISact + '&Institution_Id=' + $window.localStorage['InstitutionId']
                ).success(function (data) {
                    $scope.emptydataWebConfiguration = [];
                    $scope.rowCollectionWebConfiguration = [];
                    $scope.rowCollectionWebConfiguration = data;
                    $scope.rowCollectionWebConfigurationFilter = angular.copy($scope.rowCollectionWebConfiguration);
                    if ($scope.rowCollectionWebConfigurationFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    $("#chatLoaderPV").hide();
                    angular.forEach($scope.rowCollectionWebConfiguration, function (masterVal, masterInd) {
                        $scope.Config_value[masterVal.ID] = masterVal.CONFIGVALUE;
                    });
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        /* on click view, view popup opened*/
        $scope.ViewWebConfiguration = function (CatId) {
            $scope.Id = CatId;
            $scope.ViewWebConfigurationList();
            angular.element('#ViewWebConfigurationModal').modal('show');
        }

        $scope.ViewWebConfigurationList = function () {
            $("#chatLoaderPV").show();
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/WebConfiguration/WebConfiguration_View/?Id=' + $scope.Id + '&Login_Session_Id=' + $scope.LoginSessionId).success(function (data) {
                $scope.DuplicatesId = data.ID;
                $scope.Institution_Id = data.INSTITUTION_ID.toString();
                $scope.Config_Code = data.CONFIGCODE;
                $scope.Config_Name = data.CONFIGINFO;
                $scope.Config_Value = data.CONFIGVALUE;
                $scope.Config_Type = data.CONFIG_TYPEDEFINITION;
                $scope.Remarks = data.REMARKS;
                $("#chatLoaderPV").hide();
            });
        };

        /* THIS IS FUNCTION FOR CLOSE Modal Window  */
        $scope.CancelWebConfigurationPopUp = function () {
            angular.element('#WebConfigurationAddModal').modal('hide');
            angular.element('#ViewWebConfigurationModal').modal('hide');
        };

        $scope.WebConfigurationDetails = [];
        $scope.WebConfigurationAddEdit = function () {
            $("#chatLoaderPV").show();
            $scope.WebConfigurationDetails = [];
            var obj = {
                ID: $scope.Id,
                INSTITUTION_ID: $window.localStorage['InstitutionId'],
                CONFIGCODE: $scope.Config_Code,
                CONFIGINFO: $scope.Config_Name,
                CONFIGVALUE: $scope.Config_Value,
                CONFIG_TYPEDEFINITION: $scope.Config_Type,
                REMARKS: $scope.Remarks
            };
            $scope.WebConfigurationDetails.push(obj)
            $http.post(baseUrl + '/api/WebConfiguration/WebConfiguration_InsertUpdate/?Login_Session_Id=' + $scope.LoginSessionId, $scope.WebConfigurationDetails).success(function (data) {
                //alert(data.Message);
                toastr.success(data.Message, "success");
                $scope.WebConfigurationList();
                $scope.ClearWebConfigurationPopUp();
                $scope.searchqueryWebConfiguration = "";
                $("#chatLoaderPV").hide();
            }).error(function (data) {
                $scope.error = "An error has occurred while deleting Parameter" + data;
            });

        };

        $scope.WebConfigurationDetails = [];
        $scope.Configuration_AddEdit = function () {
            $("#chatLoaderPV").show();
            angular.forEach($scope.rowCollectionWebConfiguration, function (value, index) {
                var obj = {
                    Id: value.ID,
                    INSTITUTION_ID: $scope.INSTITUTION_ID,
                    CONFIGVALUE: $scope.Config_value[value.ID] == 0 ? null : $scope.Config_value[value.ID],
                }
                $('#save').attr("disabled", true);
                $scope.WebConfigurationDetails.push(obj);
            });

            $http.post(baseUrl + '/api/WebConfiguration/Configuration_AddEdit/', $scope.WebConfigurationDetails).success(function (data) {
                $("#chatLoaderPV").hide();
                //alert("Configuration Data saved successfully");
                toastr.success("Configuration Data saved successfully", "success");
                $('#save').attr("disabled", false);
                $scope.WebConfigurationDetails = [];
                $scope.Config_value = [];
                $scope.searchqueryWebConfiguration = "";
                $scope.WebConfigurationList();
                $scope.IsEdit = false;
                //$location.path("/ParameterSettings");
            });

        };

        /* on click Edit, edit popup opened*/
        $scope.EditWebConfiguration = function (CatId, ActiveFlag) {
            if (ActiveFlag == 1) {
                $scope.ClearWebConfigurationPopUp();
                $scope.Id = CatId;
                $scope.ViewWebConfigurationList();
                angular.element('#WebConfigurationAddModal').modal('show');
            }
            else {
                //alert("Inactive record cannot be edited");
                toastr.info("Inactive record cannot be edited", "info");
            }
        };

        /*InActive the WebConfiguration*/
        $scope.DeleteWebConfiguration = function (comId) {
            $scope.Id = comId;
            $scope.WebConfiguration_InActive();
        };
        /*
        Calling the api method to inactived the details of the  WebConfiguration ,
            and redirected to the list page.
            */
        $scope.WebConfiguration_InActive = function () {
            var del = confirm("Do you like to deactivate the selected Web Configuration?");
            if (del == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/WebConfiguration/WebConfiguration_InActive/', obj).success(function (data) {
                    //alert(data.Message);
                    toastr.success(data.Message, "success");
                    $scope.WebConfigurationList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting Holiday" + data;
                });
            };
        };

        /*Active the Doctor Holiday*/
        $scope.ReInsertWebConfiguration = function (comId) {
            $scope.Id = comId;
            $scope.WebConfiguration_Active();
        };
        /* 
       Calling the api method to Actived the details of the  WebConfiguration,
       and redirected to the list page.
       */
        $scope.WebConfiguration_Active = function () {
            var Ins = confirm("Do you like to activate the selected  Web Configuration?");
            if (Ins == true) {
                var obj =
                {
                    Id: $scope.Id,
                    Modified_By: $window.localStorage['UserId']
                }

                $http.post(baseUrl + '/api/WebConfiguration/WebConfiguration_Active/', obj).success(function (data) {
                    ///alert(data.Message);
                    toastr.success(data.Message, "success");
                    $scope.WebConfigurationList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while Activating WebConfiguration" + data;
                });
            };
        }
    }
]);

MyCortexControllers.controller("LanguageSettingsController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {
        $scope.IsActive = true;
        $scope.Id = 0;
        $scope.User_Id = 0;
        $scope.LanguageText = [];
        $scope.InstitutionLanguageList = [];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.LanguageList = function () {
            $http.get(baseUrl + '/api/Common/getInstitutionLanguages/?Institution_Id=' + $window.localStorage['InstitutionId']
            ).success(function (data) {
                $scope.InstitutionLanguageList = [];
                $scope.InstitutionLanguageList = data;
                $scope.selectedLanguage = data[0].DefaultLanguageId.toString();
            }).error(function (data) {
                $scope.error = "AN error has occured while Listing the records!" + data;
            });
        };

        $scope.IsEdit = false;
        $scope.LanguageSettingsEdit = function () {
            $scope.IsEdit = true;
        }

        $scope.LanguageSettingsCancel = function () {
            $scope.LanguageSettingsList();
            $scope.IsEdit = false;
        }

        $scope.searchqueryLanguageSettings = "";
        /* Filter the master list function for Search*/
        $scope.FilterLanguageSettingsList = function () {
            var data = $scope.rowCollectionLanguageSettingsFilter.filter(item => item.LANGUAGE_ID === parseInt($scope.selectedLanguage));

            var searchstring = angular.lowercase($scope.searchqueryLanguageSettings);
            if ($scope.searchqueryLanguageSettings == "") {
                $scope.rowCollectionLanguageSettings = angular.copy(data);
            }
            else {
                $scope.rowCollectionLanguageSettings = $ff(data, function (value, index) {
                    return angular.lowercase(value.LANGUAGE_KEY).match(searchstring)
                });
            }
            angular.forEach($scope.rowCollectionLanguageSettings, function (masterVal, masterInd) {
                $scope.LanguageText[masterVal.ID] = masterVal.LANGUAGE_TEXT;
            });
        };

        /*THIS IS FOR LIST FUNCTION*/
        $scope.ViewParamList = [];
        $scope.ViewParamList1 = [];
        $scope.LanguageSettingsList = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.LanguageList();

                $scope.emptydataLanguageSettings = [];
                $scope.rowCollectionLanguageSettings = [];

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $http.get(baseUrl + '/api/LanguageSettings/LanguageSettings_List/?Institution_Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId
                ).success(function (data) {

                    $scope.emptydataLanguageSettings = [];
                    $scope.rowCollectionLanguageSettings = [];
                    $scope.rowCollectionLanguageSettingsFilter = angular.copy(data);
                    $scope.rowCollectionLanguageSettings = data.filter(item => item.LANGUAGE_ID === parseInt($scope.selectedLanguage));
                    if ($scope.rowCollectionLanguageSettingsFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    angular.forEach($scope.rowCollectionLanguageSettings, function (masterVal, masterInd) {
                        $scope.LanguageText[masterVal.ID] = masterVal.LANGUAGE_TEXT;
                    });
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                    $("#chatLoaderPV").hide();
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.LanguageSettingsDetails = [];
        $scope.LanguageSettings_AddEdit = function () {
            $("#chatLoaderPV").show();
            angular.forEach($scope.rowCollectionLanguageSettings, function (value, index) {
                var obj = {
                    ID: value.ID,
                    INSTITUTION_ID: $window.localStorage['InstitutionId'],
                    LANGUAGE_ID: parseInt($scope.selectedLanguage),
                    LANGUAGE_TEXT: $scope.LanguageText[value.ID],
                    LANGUAGE_KEY: $scope.rowCollectionLanguageSettings[index].LANGUAGE_KEY,
                    LANGUAGE_DEFAULT: $scope.rowCollectionLanguageSettings[index].LANGUAGE_DEFAULT
                }
                $('#save').attr("disabled", true);
                $scope.LanguageSettingsDetails.push(obj);
            });

            $http.post(baseUrl + '/api/LanguageSettings/LanguageSettings_AddEdit/', $scope.LanguageSettingsDetails).success(function (data) {
                $scope.LanguageSettingsDetails = [];
                $scope.LanguageText = [];
                $scope.searchqueryLanguageSettings = "";
                $scope.LanguageSettingsList();
                $("#chatLoaderPV").hide();
                //alert("LanguageSettings Data saved successfully");
                toastr.success("LanguageSettings Data saved successfully", "success");
                $('#save').attr("disabled", false);
                $scope.IsEdit = false;
            });

        };

        $scope.LanguageDefaultSave = function () {
            $("#chatLoaderPV").show();
            $('#btnsave').attr("disabled", true);
            $http.get(baseUrl + '/api/LanguageSettings/LanguageDefault_Save/?Institution_Id=' + $window.localStorage['InstitutionId'] + '&Language_Id=' + $scope.selectedLanguage
            ).success(function (data) {
                if (data == 1) {
                    $scope.LanguageList();
                    $("#chatLoaderPV").hide();
                    //alert("Saved successfully.");
                    toastr.success("Saved successfully.", "success");
                    $('#btnsave').attr("disabled", false);
                }
                else {
                    $("#chatLoaderPV").hide();
                    //alert("Error occurred.");
                    toastr.error("Error occurred.", "warning");
                }
            })
        }

        $scope.SampleLanguageExport = function () {
            var data = document.getElementById('language_excel_format');
            var file = XLSX.utils.table_to_book(data, { sheet: "sheet1" });
            XLSX.write(file, { bookType: 'xlsx', bookSST: true, type: 'base64' });
            XLSX.writeFile(file, 'sample.xlsx');
        }

        $scope.LanguageExport = function () {
            var data = document.getElementById('language_table');
            var file = XLSX.utils.table_to_book(data, { sheet: "sheet1" });
            XLSX.write(file, { bookType: 'xlsx', bookSST: true, type: 'base64' });
            XLSX.writeFile(file, 'language.xlsx');
        }

        $scope.SelectFile = function (file) {
            $scope.SelectedFile = file;
        };
        $scope.Upload = function () {
            var regex = /^(.*)+(.xls|.xlsx)$/;
            if (regex.test($scope.SelectedFile.name.toLowerCase())) {
                if (typeof (FileReader) != "undefined") {
                    $scope.rowCollectionLanguageSettings = [];
                    var reader = new FileReader();
                    //For Browsers other than IE.
                    if (reader.readAsBinaryString) {
                        reader.onload = function (e) {
                            $scope.ProcessExcel(e.target.result);
                        };
                        reader.readAsBinaryString($scope.SelectedFile);
                    } else {
                        //For IE Browser.
                        reader.onload = function (e) {
                            var data = "";
                            var bytes = new Uint8Array(e.target.result);
                            for (var i = 0; i < bytes.byteLength; i++) {
                                data += String.fromCharCode(bytes[i]);
                            }
                            $scope.ProcessExcel(data);
                        };
                        reader.readAsArrayBuffer($scope.SelectedFile);
                    }
                } else {
                    toastr.error("This browser does not support HTML5.", "warning");
                }
            } else {
                toastr.error("Please upload a valid Excel file.", "warning");
            }
        };

        $scope.ProcessExcel = function (data) {
            //Read the Excel File data.
            var workbook = XLSX.read(data, {
                type: 'binary'
            });

            //Fetch the name of First Sheet.
            var firstSheet = workbook.SheetNames[0];

            //Read all rows from First Sheet into an JSON array.
            var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);

            //Display the data from Excel file in Table.
            $scope.$apply(function () {
                $scope.LanguageText = excelRows.map(x => x.LANGUAGE_TEXT);
                $scope.rowCollectionLanguageSettings = excelRows;
            });
        };
    }
]);


MyCortexControllers.controller("GateWaySettingsController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {
        $scope.IsActive = true;
        $scope.Id = 0;
        $scope.User_Id = 0;
        $scope.GatewayText = [];
        $scope.InstitutionGatewayList = [];
        $scope.selectedGatewaySettings = "0";
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];

        $scope.PaymentList = function () {
            $http.get(baseUrl + '/api/Common/getInstitutionPayment/?Institution_Id=' + $window.localStorage['InstitutionId']
            ).success(function (data) {
                $scope.InstitutionGatewayList = [];
                $scope.InstitutionGatewayList = data;
                $scope.selectedGateway = data[0].DefaultPaymentGatewayId.toString();
            }).error(function (data) {
                $scope.error = "AN error has occured while Listing the records!" + data;
            });
        };

        $scope.InsuranceList = function () {
            $http.get(baseUrl + '/api/Common/getInstitutionInsurance/?Institution_Id=' + $window.localStorage['InstitutionId']
            ).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.InstitutionGatewayList = [];
                $scope.InstitutionGatewayList = data;
                $scope.selectedGateway = data[0].DefaultPaymentGatewayId.toString();
            }).error(function (data) {
                $scope.error = "AN error has occured while Listing the records!" + data;
            });
        };

        $scope.IsEdit = false;
        $scope.GatewaySettingsEdit = function () {
            $scope.IsEdit = true;
        }

        $scope.GatewaySettingsCancel = function () {
            $scope.GatewaySettingsList();
            $scope.IsEdit = false;
        }

        $scope.searchqueryGatewaySettings = "";
        /* Filter the master list function for Search*/
        $scope.FilterGatewaySettingsList = function () {
            var data = $scope.rowCollectionGatewaySettingsFilter.filter(item => item.GatewayId === parseInt($scope.selectedGateway));

            var searchstring = angular.lowercase($scope.searchqueryGatewaySettings);
            if ($scope.searchqueryGatewaySettings == "") {
                $scope.rowCollectionGatewaySettings = angular.copy(data);
            }
            else {
                $scope.rowCollectionGatewaySettings = $ff(data, function (value, index) {
                    return angular.lowercase(value.GatewayId).match(searchstring)
                });
            }
            angular.forEach($scope.rowCollectionGatewaySettings, function (masterVal, masterInd) {
                $scope.GatewayText[masterVal.Id] = masterVal.GatewayValue;
            });
        };

        /*THIS IS FOR LIST FUNCTION*/
        $scope.ViewParamList = [];
        $scope.ViewParamList1 = [];
        $scope.GatewaySettingsList = function () {
            if ($window.localStorage['UserTypeId'] == 3) {
                $("#chatLoaderPV").show();
                $scope.selectedGateway = 0;
                if ($scope.selectedGatewaySettings == 1) {
                    $scope.PaymentList();
                } else if ($scope.selectedGatewaySettings == 2) {
                    $scope.InsuranceList();
                } else if ($scope.selectedGatewaySettings <= 0) {

                }
                //$scope.LanguageList();

                $scope.emptydataGatewaySettings = [];
                $scope.rowCollectionGatewaySettings = [];

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $http.get(baseUrl + '/api/GatewaySettings/GatewaySettings_List/?Institution_Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId
                ).success(function (data) {

                    $("#chatLoaderPV").hide();
                    $scope.emptydataGatewaySettings = [];
                    $scope.rowCollectionGatewaySettings = [];
                    $scope.rowCollectionGatewaySettingsFilter = angular.copy(data);
                    $scope.rowCollectionGatewaySettings = data.filter(item => item.GatewayId === parseInt($scope.selectedGateway));
                    if ($scope.rowCollectionGatewaySettingsFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }
                    angular.forEach($scope.rowCollectionGatewaySettings, function (masterVal, masterInd) {
                        $scope.GatewayText[masterVal.Id] = masterVal.GatewayValue;
                    });
                    $("#chatLoaderPV").hide();
                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                    $("#chatLoaderPV").hide();
                })
            } else {
                window.location.href = baseUrl + "/Home/LoginIndex";
            }
        };

        $scope.GatewaySettingsDetails = [];
        $scope.GatewaySettings_Edit = function () {
            $("#chatLoaderPV").show();
            angular.forEach($scope.rowCollectionGatewaySettings, function (value, index) {
                var obj = {
                    Id: value.Id,
                    InstitutionId: $window.localStorage['InstitutionId'],
                    GatewayId: parseInt($scope.selectedGateway),
                    GatewayValue: $scope.GatewayText[value.Id],
                }
                $scope.GatewaySettingsDetails.push(obj);
                $('#save').attr("disabled", true);
            });

            $http.post(baseUrl + '/api/GatewaySettings/GatewaySettings_Edit/', $scope.GatewaySettingsDetails).success(function (data) {
                $scope.GatewaySettingsDetails = [];
                $scope.GatewayText = [];
                $scope.searchqueryGatewaySettings = "";
                $scope.GatewaySettingsList();
                $("#chatLoaderPV").hide();
                //alert("GatewaySettings Data saved successfully");
                toastr.success("GatewaySettings Data saved successfully", "success");
                $('#save').attr("disabled", false);
                $scope.IsEdit = false;
            });

        };

        $scope.GatewayDefaultSave = function () {
            $("#chatLoaderPV").show();
            $('#save1').attr("disabled", true);
            $http.get(baseUrl + '/api/GatewaySettings/GatewayDefault_Save/?InstitutionId=' + $window.localStorage['InstitutionId'] + '&GatewayTypeId=' + $scope.selectedGatewaySettings + '&GatewayId=' + $scope.selectedGateway
            ).success(function (data) {
                if (data == 1) {
                    if ($scope.selectedGatewaySettings == 1) {
                        $scope.PaymentList();
                    } else if ($scope.selectedGatewaySettings == 2) {
                        $scope.InsuranceList();
                    }
                    $("#chatLoaderPV").hide();
                    //alert("Saved successfully.");
                    toastr.success("Saved successfully.", "success");
                    $('#save1').attr("disabled", false);
                }
                else {
                    $("#chatLoaderPV").hide();
                    //alert("Error occurred.");
                    toastr.error("Error occurred.", "warning");
                }
            })
        }
    }
]);

MyCortexControllers.controller("DirectCallController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff) {
        $scope.UserId = $window.localStorage['UserId'];
        $scope.UserTypeId = $window.localStorage['UserTypeId'];
        $scope.CallSessionId = $routeParams.CallSessionId;
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        if ($scope.UserTypeId !== "2") {
            $("#directCall-Page").show();
            chatService.initiateDirectCall($scope.CallSessionId);
        } else {
            $("#WaitingCall-Page").show();
            var CustomData = {
                UserId: $scope.UserId,
                CallSessionId: $scope.CallSessionId,
                ReceiverId: "779",
                CallType: "Audio"
            };
            var CustomType = "Join Request";
            chatService.sendCustomMessage(CustomData, CustomType);
        }

        $scope.ResponseFromDoctor = function () {

        }
    }
]);

MyCortexControllers.controller("DirectVideoCallController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff) {
        $scope.UserId = $window.localStorage['UserId'];
        $scope.UserTypeId = $window.localStorage['UserTypeId'];
        $scope.CallSessionId = $routeParams.CallSessionId;
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        if ($scope.UserTypeId !== "2") {
            $("#directCall-Page").show();
            chatService.initiateDirectVideoCall($scope.CallSessionId);
        } else {
            $("#WaitingCall-Page").show();
            var CustomData = {
                UserId: $scope.UserId,
                CallSessionId: $scope.CallSessionId,
                ReceiverId: "779",
                CallType: "Video"
            };
            var CustomType = "Join Request";
            chatService.sendCustomMessage(CustomData, CustomType);
        }
    }
]);

MyCortexControllers.controller("MyHomeController", ['$scope', '$http', '$routeParams', '$location', '$rootScope', '$window', '$filter', 'filterFilter', 'toastr',
    function ($scope, $http, $routeParams, $location, $rootScope, $window, $filter, $ff, toastr) {
        $scope.IsActive = true;
        $scope.currentTab = "1";
        $scope.TabName = "";
        $scope.RefId = "";
        $scope.Model = "";
        $scope.OS = "";
        $scope.current_page = 1;
        $scope.current_MyHomepage = 1;
        $scope.total_page = 1;
        $scope.total_MyHomepage = 1;
        $scope.Id = 0;
        $scope.User_Id = 0;
        $scope.LanguageText = [];
        $scope.DevicesListid = "0";
        $scope.DevicesListid = [];
        $scope.InstitutionLanguageList = [];
        $scope.SelectedTabUser = "0";
        $scope.SelectedDevice = "0";
        $scope.SelectedTabPIN = "0";
        $scope.DevicesLists = [];
        $scope.LoginSessionId = $window.localStorage['Login_Session_Id'];
        $scope.InstitutionId = $window.localStorage['InstitutionId'];
        $scope.CREATED_BY = $window.localStorage['UserId'];
        $scope.IsEdit = false;
        $scope.showSave = true;
        $scope.View = 2;
        $scope.MyHomeRow = "-1";
        $scope.HomeId = "0";
        $scope.UserLists = [];
        $scope.MyHomeflag = "0";
        $scope.DeviceId = "0";
        $scope.MyDeviceflag = "0";
        $scope.ISact = 1;

        //$http.get(baseUrl + '/api/Common/Deviceslist/').success(function (data) {
        //    $scope.DevicesLists = data;
        //});
        $http.get(baseUrl + '/api/MyHome/Device_List/?IsActive=' + $scope.ISact + '&InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
            $scope.DevicesLists = data.TabDeviceList;
        });
        //$http.get(baseUrl + '/api/Common/UserList/?Institution_Id=' + $window.localStorage['InstitutionId']).success(function (data) {
        //    $scope.UserLists = data;
        //});
        $http.get(baseUrl + '/api/Login/Userdetailslist/?UserTypeId=' + 2 + '&InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
            $scope.UserLists = data;
        });

        $scope.onCategoryChange = function () {
            $scope.DeviceId = $scope.DeviceName;
        }
        /* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
        $scope.AddTabPopUP = function () {
            $scope.currentTab = "1";
            //$scope.ClearPopup(); 
            $scope.TabName = "";
            $scope.RefId = "";
            $scope.Model = "";
            $scope.OS = "";
            $scope.Id = "0";
            $scope.PIN = "";
            $scope.SelectedDevice = "0";
            $('#savemytab').attr("disabled", false);
            $('#tabname').prop('disabled', false);
            $('#refidtab').prop('disabled', false);
            $('#modeltab').prop('disabled', false);
            $('#ostab').prop('disabled', false);
            $('#pintab').prop('disabled', false);
            $('#Image2').prop('disabled', false);
            $('#Image2').prop('title', 'Click to Delete');
            $('#tabdevice').prop('disabled', false);
            $scope.IsEdit = false;
            $scope.AddUserParameters = [{
                'Id': 0,
                'UserId': 0,
                'PIN': "",
                'IsActive': true
            }];
            $scope.AddDeviceParameters = [{
                'Id': 0,
                'DeviceId': 0,
                'IsActive': true
            }];
            $scope.showSave = true;
            var $sel2 = $('#tabdevice');
            $sel2.multiselect('enable');
            angular.element('#TabAddModal').modal('show');
        }
        $scope.ClearPopUp = function () {
            $scope.TabName = "";
            $scope.RefId = "";
            $scope.Model = "";
            $scope.OS = "";
            $scope.Id = "0";
            $scope.SelectedDevice = "0";
            $scope.InstitutionId = "";
            $scope.CancelPopup();
        }

        $scope.CancelTabPopUP = function () {
            $scope.Id = 0;
            // $scope.AppoinmentSlotClear();
            angular.element('#TabAddModal').modal('hide');
            angular.element('#TabViewModal').modal('hide');

        }
        $scope.CancelPopup = function () {
            angular.element('#TabAddModal').modal('hide');
        }
        $scope.Cancel_MYTAB = function () {
            $scope.currentTab = "1";
            $location.path("/Hive");
            $scope.ClearPopUp();
        }

        $scope.Cancel_MYTABView = function () {
            angular.element('#TabViewModal').modal('hide');
        }


        $scope.setMyHomePage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else {
                $scope.inputPageNo = PageNo;
            }
            $scope.current_MyHomepage = PageNo;
            $scope.TabList();

        }
        /*THIS IS FOR LIST FUNCTION*/
        $scope.ViewParamList = [];
        $scope.ViewParamList1 = [];
        $scope.TabList = function () {
            $("#chatLoaderPV").show();
            $scope.emptydataTab = [];
            $scope.rowCollectionTab = [];
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_MyHomepage - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_MyHomepage * $scope.page_size;

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = 0 //all
                }

                $http.get(baseUrl + '/api/MyHome/Tab_List/?IsActive=' + $scope.ISact + '&Institution_Id=' + $window.localStorage['InstitutionId'] + '&Login_Session_Id=' + $scope.LoginSessionId + '&StartRowNumber=' + $scope.PageStart + '&EndRowNumber=' + $scope.PageEnd).success(function (data) {
                    $("#chatLoaderPV").hide();
                    if (data != null && data !== undefined) {
                        $scope.emptydataTab = [];
                        $scope.rowCollectionTab = [];
                        $scope.rowCollectionTab = data;
                        if ($scope.rowCollectionTab.length > 0) {
                            $scope.TabDataCount = $scope.rowCollectionTab[0].TotalRecord;
                        } else {
                            $scope.TabDataCount = 0;
                        }
                        $scope.TabData_ListFilterdata = data;
                        $scope.rowCollectionTabFilter = angular.copy($scope.rowCollectionTab);
                        if ($scope.rowCollectionTabFilter.length > 0) {
                            $scope.flag = 1;
                        }
                        else {
                            $scope.flag = 0;
                        }
                    }
                    $scope.total_MyHomepage = Math.ceil(($scope.TabDataCount) / ($scope.page_size));


                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                })
            })

        }

        $scope.searchquery = "";
        /* FILTER THE  MyHome  LIST FUNCTION.*/
        $scope.filterTabList = function () {
            $scope.ResultListFiltered = [];
            var searchstring = angular.lowercase($scope.searchquery);
            if ($scope.searchquery == "") {
                $scope.rowCollectionTabFilter = angular.copy($scope.rowCollectionTab);
            }
            else {
                $scope.rowCollectionTabFilter = $ff($scope.rowCollectionTab, function (value) {
                    return angular.lowercase(value.RefId).match(searchstring) ||
                        angular.lowercase(value.TabName).match(searchstring) ||
                        angular.lowercase(value.OS).match(searchstring) ||
                        angular.lowercase(value.Model).match(searchstring)
                });
                $scope.total_MyHomepage = Math.ceil(($scope.rowCollectionTabFilter) / ($scope.page_size));
            }
        }

        /* THIS IS OPENING POP WINDOW VIEW */
        $scope.ViewMYTABPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.currentTab = "1";
            $('#tabname').prop('disabled', true);
            $('#refidtab').prop('disabled', true);
            $('#modeltab').prop('disabled', true);
            $('#ostab').prop('disabled', true);
            $('#pintab').prop('disabled', true);
            $('#Image2').prop('disabled', true);
            $('#Image2').prop('title', 'Disable the Delete Icon');
            $('#tabdevice').prop('disabled', true);
            $('#tabdevice3').prop('disabled', true);
            $('#MyHomeUserList *').attr('disabled', 'disabled');
            $("#MyHomeUserTable *").attr("disabled", "disabled").off('click');
            $("#MyHomeDeviceTable *").attr("disabled", "disabled").off('click');
            $('.myhomedropdown *').attr("disabled", "disabled").off('click');
            $scope.showSave = false;
            $scope.IsEdit = true;
            var $sel2 = $('#tabdevice');
            $sel2.multiselect('disable');
            var $sel3 = $('#tabdeviceview');
            $sel3.multiselect('disable');
            $scope.ViewMyTab();
            angular.element('#TabViewModal').modal('show');
        }
        /* THIS IS CANCEL VIEW POPUP FUNCTION  */
        $scope.CancelViewPopup = function () {
            angular.element('#TabAddModal').modal('hide');
        }

        /* THIS IS FOR VIEW PROCEDURE */
        $scope.ViewMyTab = function () {
            $("#chatLoaderPV").show();
            $scope.SelectedDevice = [];
            $scope.EditSelectedDevice = [];
            $scope.SelectedTabUser = [];
            $scope.EditSelectedTABUser = [];
            $scope.SelectedTabPIN = [];
            $scope.EditSelectedTABPIN = [];
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }

            $http.get(baseUrl + '/api/MyHome/Tab_ListView/?Id=' + $scope.Id).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.DuplicatesId = data.Id;
                $scope.TabName = data.TabName;
                $scope.RefId = data.RefId;
                $scope.Model = data.Model;
                $scope.OS = data.OS;
                $scope.AddUserParameters = data.UserList;
                angular.forEach(data.UserList, function (value, index) {
                    $scope.EditSelectedTABUser.push(value.ID);
                    $scope.SelectedTabUser = $scope.EditSelectedTABUser;
                });
                if ($scope.AddUserParameters.length > 0) {
                    $scope.MyHomeflag = 1;
                }
                else {
                    $scope.MyHomeflag = 0;
                }
                $scope.AddDeviceParameters = data.SelectedTabDeviceList;
                if ($scope.AddDeviceParameters.length > 0) {
                    $scope.MyDeviceflag = 1;
                }
                else {
                    $scope.MyDeviceflag = 0;
                }
                /*angular.forEach(data.SelectedTabDeviceList, function (value, index) {
                    $scope.EditSelectedDevice.push(value.Id);
                    $scope.SelectedDevice = $scope.EditSelectedDevice;
                });*/

                //$scope.UserPinValidation($scope.SelectedTabPIN);
            });
        }

        /* THIS IS FOR DELETE FUNCTION*/
        $scope.DeleteMYTAB = function (DId) {
            $scope.Id = DId;
            $scope.MyTAB_Delete();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.MyTAB_Delete = function () {

            var del = confirm("Do you like to deactivate the selected My Home details?");
            if (del == true) {
                $http.get(baseUrl + '/api/MyHome/Tab_List_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert(" My Home details has been deactivated Successfully");
                    toastr.success(" My Home details has been deactivated Successfully", "success");
                    $scope.TabList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  My Home details" + data;
                });
            }
        };

        $scope.DeleteMYTABDeactive = function (DId) {
            $scope.Id = DId;
            $scope.MyTAB_DeleteDeactive();
        };
        /*THIS IS FOR DELETE FUNCTION */
        $scope.MyTAB_DeleteDeactive = function () {

            var del = confirm("Do you like to activate the selected My Home details?");
            if (del == true) {
                $http.get(baseUrl + '/api/MyHome/Tab_List_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert(" My Home details has been  Activated Successfully");
                    toastr.success(" My Home details has been  Activated Successfully", "success");
                    $scope.TabList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  My Home details" + data;
                });
            }
        };

        /*calling Alert message for cannot edit inactive record function */
        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }

        /* THIS IS EDIT POPUP FUNCTION */
        $scope.EditMYTABPopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.Editid = CatId;
            $scope.currentTab = "1";
            $('#savemytab').attr("disabled", false);
            $('#tabname').prop('disabled', false);
            $('#refidtab').prop('disabled', false);
            $('#modeltab').prop('disabled', false);
            $('#ostab').prop('disabled', false);
            $('#userlisttab').prop('disabled', false);
            $('#pintab').prop('disabled', false);
            $('#Image2').prop('disabled', false);
            $('#Image2').prop('title', 'Click to Delete');
            $('#tabdevice').prop('disabled', false);
            $('#MyHomeUserList *').removeAttr("disabled");
            $("#MyHomeUserTable *").removeAttr("disabled");
            $('.myhomedropdown').removeAttr("disabled");
            $('#MyHomeDeviceList *').removeAttr("disabled");
            $("#MyHomeDeviceTable *").removeAttr("disabled");
            $('.myhomedevicedropdown').removeAttr("disabled");
            $('#Image3').prop('disabled', false);
            $('#Image3').prop('title', 'Click to Delete');
            $scope.showSave = true;
            $scope.IsEdit = true;
            $scope.ViewMyTab();
            angular.element('#TabAddModal').modal('show');
        }

        $scope.ErrorFunction = function () {
            //alert("Inactive record cannot be edited");
            toastr.info("Inactive record cannot be edited", "info");
        }
        /* THIS IS FOR VALIDATION CONTROL */
        $scope.Validationcontrols = function () {
            if (typeof ($scope.TabName) == "undefined" || $scope.TabName == "") {
                //alert("Please enter Tab Name");
                toastr.warning("Please enter Tab Name", "warning");
                return false;
            }
            //else if (typeof ($scope.RefId) == "undefined" || $scope.RefId == "") {
            //    //alert("Please enter Ref Id");
            //    toastr.warning("Please enter Ref Id", "warning");
            //    return false;
            //}
            /*else if (typeof ($scope.Category_ID) == "undefined" || $scope.Category_ID == "0") {
                alert("Please select Category");
                return false;
            }*/
            return true;
        };



        $scope.MyHomeRow = "-1";
        // Add row concept for Patient Vital Parameters
        $scope.AddUserParameters = [{
            'Id': $scope.HomeId,
            'UserId': $scope.UserId,
            'PIN': $scope.PIN,
            'IsActive': true
        }];


        /*This is a Addrow function to add new row and save  */
        $scope.MyHomeAdd = function () {
            if ($scope.MyHomeRow >= 0) {
                var obj = {
                    'Id': $scope.HomeId,
                    'UserId': $scope.UserId,
                    'PIN': $scope.PIN,
                    'IsActive': true
                }
                $scope.AddUserParameters[$scope.MyHomeRow] = obj;
            }
            else {
                $scope.AddUserParameters.push({
                    'Id': $scope.HomeId,
                    'UserId': $scope.UserId,
                    'PIN': $scope.PIN,
                    'IsActive': true
                })
            }
        };

        $scope.MyHomeDelete = function (Delete_Id, rowIndex) {

            Swal.fire({
                title: 'Do you like to delete this My Home Id Details?',
                html: '',
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: 'Yes',
                denyButtonText: 'No',
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    var Previous_MyHomeItem = [];
                    if ($scope.Id == 0) {
                        angular.forEach($scope.AddUserParameters, function (selectedPre, index) {
                            if (index != rowIndex)
                                Previous_MyHomeItem.push(selectedPre);
                        });
                        $scope.AddUserParameters = Previous_MyHomeItem;
                    } else if ($scope.Id > 0) {
                        angular.forEach($scope.AddUserParameters, function (selectedPre, index) {
                            if (selectedPre.ID == Delete_Id) {
                                selectedPre.IsActive = false;
                            }
                        });
                        if ($ff($scope.AddUserParameters, { IsActive: true }).length > 0) {
                            $scope.MyHomeflag = 1;
                        }
                        else {
                            $scope.MyHomeflag = 0;
                        }
                    }
                } else if (result.isDenied) {
                    //Swal.fire('Changes are not saved', '', 'info')
                }
            })

            //var del = confirm("Do you like to delete this My Home Id Details?");
            //if (del == true) {
            //    var Previous_MyHomeItem = [];
            //    if ($scope.Id == 0) {
            //        angular.forEach($scope.AddUserParameters, function (selectedPre, index) {
            //            if (index != rowIndex)
            //                Previous_MyHomeItem.push(selectedPre);
            //        });
            //        $scope.AddUserParameters = Previous_MyHomeItem;
            //    } else if ($scope.Id > 0) {
            //        angular.forEach($scope.AddUserParameters, function (selectedPre, index) {
            //            if (selectedPre.ID == Delete_Id) {
            //                selectedPre.IsActive = false;
            //            }
            //        });
            //        if ($ff($scope.AddUserParameters, { IsActive: true }).length > 0) {
            //            $scope.MyHomeflag = 1;
            //        }
            //        else {
            //            $scope.MyHomeflag = 0;
            //        }
            //    }
            //}
        };

        $scope.MyDeviceRow = "-1";
        $scope.AddDeviceParameters = [{
            'Id': $scope.DeviceId,
            'DeviceId': $scope.Id
        }];
        $scope.MyDeviceAdd = function () {
            if ($scope.MyDeviceRow >= 0) {
                var obj = {
                    'Id': $scope.DeviceId,
                    'DeviceId': $scope.Id,
                    'IsActive': true
                }
                $scope.AddDeviceParameters[$scope.MyDeviceRow] = obj;
            }
            else {
                $scope.AddDeviceParameters.push({
                    'Id': $scope.DeviceId,
                    'DeviceId': $scope.Id,
                    'IsActive': true
                })
            }
        };

        $scope.MyDeviceDelete = function (Delete_Id, rowIndex) {
            var del = confirm("Do you like to delete this My Home Device Details?");
            if (del == true) {
                var Previous_MyDeviceItem = [];
                if ($scope.Id == 0) {
                    angular.forEach($scope.AddDeviceParameters, function (selectedPre, index) {
                        if (index != rowIndex)
                            Previous_MyDeviceItem.push(selectedPre);
                    });
                    $scope.AddDeviceParameters = Previous_MyDeviceItem;
                } else if ($scope.Id > 0) {
                    angular.forEach($scope.AddDeviceParameters, function (selectedPre, index) {
                        if (selectedPre.Id == Delete_Id) {
                            selectedPre.IsActive = false;
                        }
                    });
                    if ($ff($scope.AddDeviceParameters, { IsActive: true }).length > 0) {
                        $scope.MyDeviceflag = 1;
                    }
                    else {
                        $scope.MyDeviceflag = 0;
                    }
                }
            }
        };


        $scope.MYTAB_InsertUpdate_validation = function () {
            var TSDuplicate = 0;
            var UserEmpty = 0;
            var DuplicateUserId = '';
            angular.forEach($scope.AddUserParameters, function (value1, index1) {
                angular.forEach($scope.AddUserParameters, function (value2, index2) {
                    if (index1 > index2 && value1.UserId == value2.UserId) {
                        TSDuplicate = 1;
                        DuplicateUserId = DuplicateUserId + ' ' + value2.UserId + ',';
                    };
                });
            });
            angular.forEach($ff($scope.AddUserParameters, { IsActive: true }), function (valuser) {
                if (valuser.UserId == undefined || valuser.PIN == undefined) {
                    UserEmpty = 1;
                }
            });
            if (TSDuplicate == 1) {
                //alert('User Name already exist, cannot be Duplicated');
                toastr.info("User Name already exist, cannot be Duplicated", "info");
                return false;
            }
            if (UserEmpty == 1) {
                //alert('Data missing in user info tab');
                toastr.warning("User Name already exist, cannot be Duplicated", "warning");
                return false;
            }
            var DuplicateDevice = 0;
            var DeviceEmpty = 0;
            var DuplicateDeviceId = '';
            angular.forEach($scope.AddDeviceParameters, function (value1, index1) {
                angular.forEach($scope.AddDeviceParameters, function (value2, index2) {
                    if (index1 > index2 && value1.Id == value2.Id) {
                        DuplicateDevice = 1;
                        DuplicateDeviceId = DuplicateDeviceId + ' ' + value2.DeviceName + ',';
                    };
                    /*if (index1)*/
                });
            });
            angular.forEach($ff($scope.AddDeviceParameters, { IsActive: true }), function (valdevice) {
                if (valdevice.Id == "0") {
                    DeviceEmpty = 1;
                }
            });
            if (DuplicateDevice == 1) {
                //alert('Device already exist, cannot be Duplicated');
                toastr.info("Device already exist, cannot be Duplicated", "info");
                return false;
            }
            if (DeviceEmpty == 1) {
                //alert('Data missing in Device tab');
                toastr.warning("Data missing in Device tab", "warning");
                return false;
            }


            return true;
        }

        $scope.MYTAB_InsertUpdate = function () {
            if ($scope.Validationcontrols() == true) {
                if ($scope.MYTAB_InsertUpdate_validation() == true) {
                    $("#chatLoaderPV").show();
                    angular.forEach($ff($scope.AddUserParameters, { IsActive: true }), function (value, index) {
                        return value.UserId != '';
                    });
                    var DevicesListid = $ff($scope.DevicesLists, function (value) {
                        return value.ID != '';
                    });
                    $scope.UserTabDetails_List = [];
                    angular.forEach($scope.SelectedTabUser, function (value, index) {
                        var obj = {
                            Id: 0,
                            Id: value
                        }
                        $scope.UserTabDetails_List.push(obj);
                    });

                    $scope.UserDeviceDetails_List = [];
                    angular.forEach($ff($scope.AddDeviceParameters, { IsActive: true }), function (value, index) {
                        var obj = {
                            Id: 0,
                            DeviceId: value.Id
                        }
                        $scope.UserDeviceDetails_List.push(obj);
                    });


                    var obj = {
                        ID: $scope.Id,
                        TabName: $scope.TabName,
                        RefId: $scope.RefId,
                        Model: $scope.Model,
                        OS: $scope.OS,
                        InstitutionId: $window.localStorage['InstitutionId'],
                        CreatedBy: $scope.CREATED_BY,
                        UserList: $scope.AddUserParameters,
                        DevicesList: $scope.DevicesLists,
                        SelectedTabDeviceList: $scope.UserDeviceDetails_List
                    };
                    $('#savemytab').attr("disabled", true);
                    $http.post(baseUrl + '/api/MyHome/Tab_InsertUpdate/', obj).success(function (data) {
                        $("#chatLoaderPV").hide();
                        //alert(data.Message);
                        if (data.ReturnFlag == 1) {
                            toastr.success(data.Message, "success");
                        }
                        else if (data.ReturnFlag == 0) {
                            toastr.info(data.Message, "info");
                        }
                        $('#savemytab').attr("disabled", false);
                        $scope.TabList();
                        $scope.Cancel_MYTAB();
                    }).error(function (data) {
                        $scope.error = "An error has occurred while deleting Parameter" + data;
                    });

                }
            }
        }

        $scope.rembemberCurrentPage = function (p) {
            $scope.current_page = p
        }
        $scope.setPage = function (PageNo) {
            if (PageNo == 0) {
                PageNo = $scope.inputPageNo;
            }
            else
                $scope.inputPageNo = PageNo;

            $scope.current_page = PageNo;
            $scope.DeviceList();
        }
        /* Device List */
        $scope.DeviceList = function () {
            $("#chatLoaderPV").show();
            $scope.emptydataDevice = [];
            $scope.rowCollectionDevice = [];
            $scope.EditDevice = [];
            $scope.DevicesLists = [];
            $scope.DeviceType = [];
            $scope.ConfigCode = "PATIENTPAGE_COUNT";
            $scope.SelectedInstitutionId = $window.localStorage['InstitutionId'];
            $http.get(baseUrl + '/api/Common/AppConfigurationDetails/?ConfigCode=' + $scope.ConfigCode + '&Institution_Id=' + $scope.SelectedInstitutionId).success(function (data1) {
                $scope.page_size = data1[0].ConfigValue;
                $scope.PageStart = (($scope.current_page - 1) * ($scope.page_size)) + 1;
                $scope.PageEnd = $scope.current_page * $scope.page_size;

                $scope.ISact = 1;       // default active
                if ($scope.IsActive == true) {
                    $scope.ISact = 1  //active
                }
                else if ($scope.IsActive == false) {
                    $scope.ISact = -1 //all
                }
                $http.get(baseUrl + '/api/MyHome/Device_List/?IsActive=' + $scope.ISact + '&InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                    $("#chatLoaderPV").hide();
                    $scope.emptydataDevice = data.TabDeviceList;
                    $scope.rowCollectionDevice = [];
                    $scope.rowCollectionDevice = data.TabDeviceList;
                    if ($scope.rowCollectionDevice.length > 0) {
                        $scope.DeviceDataCount = $scope.rowCollectionDevice[0].TotalRecord;
                    } else {
                        $scope.TabDataCount = 0;
                    }

                    angular.forEach(data.TabDeviceList, function (value, index) {
                        $scope.EditDevice.push(value.ID);
                        $scope.DeviceType = $scope.EditDevice;
                    });
                    $scope.DeviceData_ListFilterdata = data.TabDeviceList;
                    $scope.rowCollectionDeviceFilter = angular.copy($scope.rowCollectionDevice);
                    if ($scope.rowCollectionDeviceFilter.length > 0) {
                        $scope.flag = 1;
                    }
                    else {
                        $scope.flag = 0;
                    }

                }).error(function (data) {
                    $scope.error = "AN error has occured while Listing the records!" + data;
                });
            });
        }

        $scope.DeviceDropDown = function () {
            $("#chatLoaderPV").show();
            $scope.AllDeviceNameList = [];
            //$http.get(baseUrl + '/api/Common/Deviceslist/').success(function (data) {
            $scope.AllDevice = [
                {
                    ID: 1,
                    DeviceTypeName: "Wearable"
                },
                {
                    ID: 2,
                    DeviceTypeName: "Medical Device"
                }
            ];
            //});
            $http.get(baseUrl + '/api/MyHome/DeviceName_List/?IsActive=' + 1).success(function (data1) {
                $scope.AllDeviceNameList = data1.TabDeviceList;
            });

            $http.get(baseUrl + '/api/Protocol/ParameterNameList/?InstitutionId=' + $window.localStorage['InstitutionId']).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.ParameterTypeList = data;
            });
        };

        $scope.AddDevicePopUP = function () {
            $scope.Id = 0;
            $scope.CancelDeviceList();
            $('#btnsave').attr("disabled", false);
            $('#DeviceId').prop('disabled', false);
            $('#DeviceName').prop('disabled', false);
            $('#DeviceType').prop('disabled', false);
            $('#DeviceMake').prop('disabled', false);
            $('#DeviceModel').prop('disabled', false);
            $('#Parameter').prop('disabled', false);
            $scope.showSave = true;
            var $sel2 = $('#Parameter');
            $sel2.multiselect('enable');
            $scope.showSave = true;
            $scope.DeviceDropDown();

            angular.element('#DeviceAddModal').modal('show');
        }

        $scope.EditDevicePopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.Editid = CatId;
            $scope.CancelDeviceList();
            $('#btnsave').attr("disabled", false);
            $('#DeviceId').prop('disabled', false);
            $('#DeviceName').prop('disabled', false);
            $('#DeviceType').prop('disabled', false);
            $('#DeviceMake').prop('disabled', false);
            $('#DeviceModel').prop('disabled', false);
            $('#Parameter').prop('disabled', false);
            $scope.showSave = true;
            var $sel2 = $('#Parameter');
            $sel2.multiselect('enable');
            $scope.DeviceDropDown();
            $scope.ViewDevice();
            angular.element('#DeviceAddModal').modal('show');
        }

        /* THIS IS OPENING POP WINDOW VIEW */
        $scope.ViewDevicePopUP = function (CatId) {
            $scope.Id = CatId;
            $scope.CancelDeviceList();
            $('#DeviceId').prop('disabled', true);
            $('#DeviceName').prop('disabled', true);
            $('#DeviceType').prop('disabled', true);
            $('#DeviceMake').prop('disabled', true);
            $('#DeviceModel').prop('disabled', true);
            $('#Parameter').prop('disabled', true);
            $scope.showSave = false;
            var $sel2 = $('#Parameter');
            $sel2.multiselect('disable');
            $scope.DeviceDropDown();
            $scope.ViewDevice();
            angular.element('#DeviceAddModal').modal('show');
        }

        /* THIS IS FOR VIEW DEVICE*/
        $scope.ViewDevice = function () {
            $("#chatLoaderPV").show();
            $scope.SelectedParamter = [];
            $scope.Editselectedparam = [];
            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
                $scope.Id = $routeParams.Id;
                $scope.DuplicatesId = $routeParams.Id;
            }
            $http.get(baseUrl + '/api/MyHome/ViewDevice_List/?Id=' + $scope.Id).success(function (data) {
                $("#chatLoaderPV").hide();
                $scope.DeviceId = data.DeviceId;
                $scope.DeviceName = data.DeviceName;
                if (data.DeviceType == "Medical Device") {
                    $scope.DeviceType = 2;
                }
                if (data.DeviceType == "Wearable") {
                    $scope.DeviceType = 1;
                }
                if (data.DeviceName == "FORA P20") {
                    $scope.DeviceName = 1;
                }
                //$scope.DeviceType = data.DeviceTypeId;
                $scope.DeviceMake = data.Make;
                $scope.DeviceModel = data.ModelNumber;
                var pname = data.ParameterList[0].ParameterName.toString();
                if (pname.indexOf(',') >= 0) {
                    var det = data.ParameterList[0].ParameterName.split(',');
                    for (i = 0; i < det.length; i++) {
                        $scope.Editselectedparam.push(parseInt(det[i]));
                    }
                }
                $scope.SelectedParamter = $scope.Editselectedparam;
            });
        }

        /*Active the Device*/
        $scope.ReInsertDevice = function (comId) {
            $scope.Id = comId;
            $scope.ReInsertDeviceDetails();

        };
        /* 
        Calling the api method to inactived the details of the Device List,
        and redirected to the list page.
        */
        $scope.ReInsertDeviceDetails = function () {
            var Dev = confirm("Do you like to activate the selected Device?");
            if (Dev == true) {
                $http.get(baseUrl + '/api/MyHome/Device_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert("Selected Device has been activated successfully");
                    toastr.success("Selected Device has been activated successfully", "success");
                    $scope.DeviceList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while ReInsertDeviceDetails" + data;
                });
            };
        }


        /* THIS IS FOR DEACTIVATE FUNCTION*/
        $scope.DeleteDevice = function (DId) {
            $scope.Id = DId;
            $scope.Device_Delete();
        };
        /*THIS IS FOR DEACTIVE FUNCTION */
        $scope.Device_Delete = function () {

            var del = confirm("Do you like to deactivate the selected Device?");
            if (del == true) {
                $http.get(baseUrl + '/api/MyHome/Device_Delete/?Id=' + $scope.Id).success(function (data) {
                    //alert(" Device details has been deactivated Successfully");
                    toastr.success(" Device details has been deactivated Successfully", "success");
                    $scope.DeviceList();
                }).error(function (data) {
                    $scope.error = "An error has occurred while deleting  Device details" + data;
                });
            }
        };

        $scope.CancelDeviceList = function () {
            $scope.DeviceId = "";
            $scope.DeviceName = "";
            $scope.DeviceType = "";
            $scope.DeviceMake = "";
            $scope.DeviceModel = "";
            $scope.SelectedParamter = "0";
            angular.element('#DeviceAddModal').modal('hide');
        }

        $scope.Device_InsertUpdate = function () {
            if ($scope.DeviceValidationcontrols() == true) {
                //if ($scope.Device_InsertUpdate_validation() == true) {
                $("#chatLoaderPV").show();
                //var filteredObj = $ff($scope.AddUserParameters, function (value) {
                //    return value.ID != '';
                //});
                //var DevicesListid = $ff($scope.DevicesLists, function (value) {
                //    return value.ID != '';
                //});
                //var devicetypechange = $scope.DeviceType.toString();
                angular.forEach($scope.AllDevice, function (value, index) {
                    if (value.ID == $scope.DeviceType) {
                        $scope.DeviceType = value.DeviceTypeName
                    }
                });
                angular.forEach($scope.AllDeviceNameList, function (value, index) {
                    /* if (value.ID == $scope.DeviceName) {
                         $scope.DeviceName = value.DeviceName
                     }*/
                    if (value.DeviceId == $scope.DeviceName) {
                        $scope.DeviceName = value.DeviceName
                    }
                });

                $scope.ParameterDetails_List = [];
                angular.forEach($scope.SelectedParamter, function (value, index) {
                    var obj = {
                        //ID: 0,
                        Id: value,
                        IsActive: 1
                    }
                    $scope.ParameterDetails_List.push(obj);
                });

                var obj = {
                    ID: $scope.Id,
                    InstitutionId: $window.localStorage['InstitutionId'],
                    DeviceId: $scope.DeviceId,
                    DeviceName: $scope.DeviceName,
                    DeviceType: $scope.DeviceType,
                    Make: $scope.DeviceMake,
                    ModelNumber: $scope.DeviceModel,
                    ParameterList: $scope.ParameterTypeList,
                    SelectedDeviceParameterList: $scope.ParameterDetails_List,
                    CreatedBy: $window.localStorage['UserId'],
                };
                $('#btnsave').attr("disabled", true);
                $http.post(baseUrl + '/api/MyHome/AddDeviceInsertUpdate/', obj).success(function (data) {
                    $("#chatLoaderPV").hide();
                    //alert(data.Message);
                    if (data.ReturnFlag == 1) {
                        toastr.success(data.Message, "success");
                    }
                    else if (data.ReturnFlag == 0) {
                        toastr.info(data.Message, "info");
                    }
                    $('#btnsave').attr("disabled", false);
                    $scope.DeviceList();
                    $scope.CancelDeviceList();

                }).error(function (data) {
                    $scope.error = "An error has occurred while Addeing Device" + data;
                });

                //}
            }
        }

        /* THIS IS FOR DEVICE ADD EDIT VALIDATION CONTROL */
        $scope.DeviceValidationcontrols = function () {
            if (typeof ($scope.DeviceId) == "undefined" || $scope.DeviceId == "") {
                //alert("Please enter Device Id");
                toastr.warning("Please enter Device Id", "warning");
                return false;
            }
            else if (typeof ($scope.DeviceName) == "undefined" || $scope.DeviceName == "" || $scope.DeviceName == null) {
                //alert("Please Select Device Name");
                toastr.warning("Please enter Device Id", "warning");
                return false;
            }
            else if (typeof ($scope.DeviceMake) == "undefined" || $scope.DeviceMake == "") {
                //alert("Please enter DeviceMake");
                toastr.warning("Please enter DeviceMake", "warning");
                return false;
            }
            else if (typeof ($scope.DeviceModel) == "undefined" || $scope.DeviceModel == "") {
                //alert("Please enter DeviceModel");
                toastr.warning("Please enter DeviceModel", "warning");
                return false;
            }
            else if (typeof ($scope.DeviceType) == "undefined" || $scope.DeviceType == "" || $scope.DeviceType == "0" || $scope.DeviceType == null) {
                //alert("Please Select DeviceType");
                toastr.warning("Please Select DeviceType", "warning");
                return false;
            }
            else if (typeof ($scope.SelectedParamter) == "undefined" || $scope.SelectedParamter == "" || $scope.SelectedParamter == "0") {
                //alert("Please Select Parameter");
                toastr.warning("Please Select Parameter", "warning");
                return false;
            }

            return true;
        };

    }
]);




//MyCortexControllers.controller("SMSTemplateController", ['$scope', '$http', '$filter', '$routeParams', '$location', '$window', 'filterFilter', 'toastr',
//    function ($scope, $http, $filter, $routeParams, $location, $window, $ff, toastr) {
//        $scope.PageParameter = $routeParams.PageParameter;
//        $scope.Id = "0";
//        $scope.DuplicateId = "0";
//        $scope.flag = 0;
//        $scope.IsActive = true;
//        $scope.TemplateName = "";
//        /*List Page Pagination*/
//        $scope.listdata = [];
//        $scope.current_page = 1;
//        $scope.page_size = $window.localStorage['Pagesize'];
//        $scope.rembemberCurrentPage = function (p) {
//            $scope.current_page = p
//        }
//        $scope.Patient_Id = $window.localStorage['UserId'];
//        $scope.InstituteId = $window.localStorage['InstitutionId'];
//        $scope.LoginSessionId = $window.localStorage['Login_Session_Id']
//        $scope.TemplateTagList = [];
//        if ($window.localStorage['UserTypeId'] == 3) {
//            $http.get(baseUrl + '/api/EmailTemplate/TemplateTag_List/?Id=' + $scope.InstituteId).success(function (data) {
//                $scope.TemplateTagList = data;
//            });
//        } else {
//            window.location.href = baseUrl + "/Home/LoginIndex";
//        }

//        $scope.TemplateTagMappingList = [];
//        $scope.TempMappinglist = function () {
//            if ($scope.PageParameter == 1) {
//                $scope.Type = "1"; //For Email
//            }
//            else if ($scope.PageParameter == 2) {
//                $scope.Type = "2";//For Notification
//            }
//            $http.get(baseUrl + '/api/SMSTemplate/SMSTemplateTagMapping_List/?Id=' + $scope.Type + '&Institution_Id=' + $scope.InstituteId).success(function (data) {
//                $scope.TemplateTagMappingList = data;
//            });
//        };

//        /* THIS IS FOR VALIDATION CONTROL */
//        $scope.Validationcontrols = function () {
//            if ($scope.PageParameter == 1) {
//                $scope.Template = (CKEDITOR.instances.editor1.getData());
//            }
//            if (typeof ($scope.TemplateName) == "undefined" || $scope.TemplateName == "") {
//                toastr.warning("Please enter Template Name", "warning");
//                return false;
//            }

//            else if (typeof ($scope.SMSSubject) == "undefined" || $scope.SMSSubject == "") {
//                if ($scope.PageParameter == 1)
//                    toastr.warning("Please enter SMS Subject", "warning");
//                else
//                    warning("Please enter Notification Title", "warning");

//                return false;
//            }
//            else if (typeof ($scope.Template) == "undefined" || $scope.Template == "") {
//                if ($scope.PageParameter == 1)
//                    toastr.warning("Please enter SMS Template", "warning");
//                else
//                    toastr.warning("Please enter Notification Message", "warning");

//                return false;
//            }
//            return true;
//        };

//        /* Array initialization */
//        $scope.SMSTemplateTaglist = [];
//        $scope.SMSTemplateTaglist = [{
//            'Id': 0,
//            'Institution_Id': 0,
//            'SMS_TemplateId': '',
//            'TagName': '',
//            'Institution_Name': '',
//            'IsActive': 0,
//            'Created_By': ''
//        }];

//        $scope.SMSTemplateTagDetails = [];

//        /* THIS IS FOR ADD/EDIT FUNCTION */
//        $scope.SMSTemplateAddEdit = function () {
//            if ($scope.Validationcontrols() == true) {

//                var TemplateChildList = [],

//                    rxp = /{([^}]+)}/g,

//                    TagName = $scope.Template,

//                    arr;
//                while (arr = rxp.exec(TagName)) {
//                    TemplateChildList.push({
//                        'TempName': arr[1]
//                    });
//                }

//                angular.forEach(TemplateChildList, function (value, index) {

//                    angular.forEach($scope.SMSTemplateTaglist, function (Selected, index) {

//                        var obj = {
//                            Id: Selected.Id,
//                            Institution_Id: $scope.InstituteId,
//                            SMS_TemplateId: $scope.PageParameter == 1 ? '1' : $scope.PageParameter == 2 ? '2' : '',
//                            TagName: value.TempName,
//                            IsActive: Selected.IsActive,
//                            Created_By: $scope.Patient_Id
//                        }
//                        $scope.SMSTemplateTagDetails.push(obj);
//                    });
//                });

//                var obj = {
//                    Id: $scope.Id,
//                    Institution_Id: $scope.InstituteId,
//                    TemplateType_Id: $scope.PageParameter == 1 ? '1' : $scope.PageParameter == 2 ? '2' : '',
//                    //Type_Id: $scope.Type,
//                    SMSSubject: $scope.SMSSubject,
//                    SMSTemplate: $scope.Template,
//                    ModifiedUser_Id: $scope.Patient_Id,
//                    Created_By: $scope.Patient_Id,
//                    SMSTemplateTagList: $scope.SMSTemplateTagDetails,
//                    TemplateName: $scope.TemplateName
//                }
//                $("#chatLoaderPV").show();
//                $('#btnsave').attr("disabled", true);
//                $http.post(baseUrl + '/api/SMSTemplate/SMSTemplateTag_AddEdit/', obj).success(function (data) {
//                    toastr.success(data.Message, "success");
//                    $("#chatLoaderPV").hide();
//                    $('#btnsave').attr("disabled", false);
//                    if (data.ReturnFlag == 1) {
//                        $scope.ClearPopup();
//                        $scope.EmailTemplatelist();
//                    }
//                    $("#chatLoaderPV").hide();
//                    angular.element('#SMSTemplateModal').modal('hide');
//                })
//            }
//        }

//        /* THIS IS FOR LIST PROCEDURE */
//        $scope.emptydata = [];
//        $scope.rowCollection = [];
//        $scope.flag = 0;
//        $scope.rowCollectionFilter = [];

//        $scope.SMSTemplatelist = function () {
//            if ($window.localStorage['UserTypeId'] == 3) {
//                /*$("#chatLoaderPV").show();*/
//                $scope.ISact = 1;       // default active

//                if ($scope.IsActive == true) {
//                    $scope.ISact = 1  //active
//                }
//                else if ($scope.IsActive == false) {
//                    $scope.ISact = 0 //all
//                }
//                $http.get(baseUrl + '/api/SMSTemplate/SMSTemplateTag_List/?Id=' + $scope.InstituteId + '&IsActive=' + $scope.ISact + '&TemplateType_Id=' + $scope.PageParameter).success(function (data) {
//                    $scope.emptydata = [];
//                    $scope.rowCollection = [];
//                    $scope.rowCollection = data;
//                    $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
//                    if ($scope.rowCollectionFilter.length > 0) {
//                        $scope.flag = 1;
//                    }
//                    else {
//                        $scope.flag = 0;
//                    }
//                    $("#chatLoaderPV").hide();
//                }).error(function (data) {
//                    $scope.error = "AN error has occured while Listing the records!" + data;
//                })
//            } else {
//                window.location.href = baseUrl + "/Home/LoginIndex";
//            }
//        };

//        $scope.searchquery = "";
//        /* FILTER THE LIST FUNCTION.*/
//        $scope.fliterTemplateList = function () {
//            $scope.ResultListFiltered = [];
//            var searchstring = angular.lowercase($scope.searchquery);
//            if ($scope.searchquery == "") {
//                $scope.rowCollectionFilter = angular.copy($scope.rowCollection);
//            }
//            else {
//                $scope.rowCollectionFilter = $ff($scope.rowCollection, function (value) {
//                    return angular.lowercase(value.Institution_Name).match(searchstring) ||
//                        angular.lowercase(value.TemplateName).match(searchstring) ||
//                        angular.lowercase(value.EmailSubject).match(searchstring) ||
//                        angular.lowercase(value.EmailTemplate).match(searchstring);
//                });
//            }
//        }

//        /* THIS IS FOR VIEW FUNCTION */
//        $scope.ViewEmailTempalte = function () {
//            $("#chatLoaderPV").show();
//            if ($routeParams.Id != undefined && $routeParams.Id > 0) {
//                $scope.Id = $routeParams.Id;
//                $scope.DuplicatesId = $routeParams.Id;
//            }

//            $http.get(baseUrl + '/api/EmailTemplate/EmailTemplateDetails_View/?Id=' + $scope.Id).success(function (data) {

//                $scope.DuplicatesId = data.Id;
//                $scope.Institution_Id = data.Institution_Id;
//                $scope.Institution_Name = data.Institution_Name;
//                $scope.TemplateType_Id = data.TemplateType_Id;
//                $scope.TemplateName = data.TemplateName;
//                $scope.EmailSubject = data.EmailSubject;
//                $scope.Template = data.EmailTemplate;
//                $scope.Type = data.Type_Id.toString();
//                $scope.ViewType_Name = data.Type_Name;
//                $scope.TemplateTagMappingList = data.EmailTemplateTagList;
//                if ($scope.TemplateType_Id == 1) {
//                    $scope.ViewTemplate = CKEDITOR.instances.editor1.setData($scope.Template);
//                }
//                $scope.TempMappinglist();
//                $("#chatLoaderPV").hide();
//            });
//        }

//        $scope.DeleteEmailTempalte = function (DId) {
//            $scope.Id = DId;
//            $scope.EmailTempalte_Delete();
//        };
//        /*THIS IS FOR DELETE FUNCTION */
//        $scope.EmailTempalte_Delete = function () {

//            var del = confirm("Do you like to deactivate the selected Template?");
//            if (del == true) {
//                $http.get(baseUrl + '/api/EmailTemplate/EmailTemplate_Delete/?Id=' + $scope.Id).success(function (data) {
//                    //alert("Template has been deactivated Successfully");
//                    toastr.success("Template has been deactivated Successfully", "success");
//                    $scope.EmailTemplatelist();
//                }).error(function (data) {
//                    $scope.error = "An error has occurred while deleting  ICD 10 details" + data;
//                });
//            }
//        };

//        /* THIS IS FOR ACTIVE FUNCTION*/
//        $scope.ActiveEmailTempalte = function (PId) {
//            $scope.Id = PId;
//            $scope.EmailTempalte_Active();
//        };

//        /* 
//            Calling the api method to activate the details of Email Template
//            matching the specified Email Template Id,
//            and redirected to the list page.
//           */
//        $scope.EmailTempalte_Active = function () {

//            var Ins = confirm("Do you like to activate the selected Template?");
//            if (Ins == true) {
//                $http.get(baseUrl + '/api/EmailTemplate/EmailTemplate_Active/?Id=' + $scope.Id).success(function (data) {
//                    //alert("Selected Template has been activated successfully");
//                    toastr.success("Selected Template has been activated successfully", "success");
//                    $scope.EmailTemplatelist();
//                }).error(function (data) {
//                    $scope.error = "An error has occured while deleting ICD 1O records" + data;
//                });
//            }
//        };

//        $scope.Active_ErrorFunction = function () {
//            //alert("Inactive Template cannot be edited");
//            toastr.info("Inactive Template cannot be edited", "info");
//        };

//        /*calling Alert message for cannot edit inactive record function */
//        $scope.ErrorFunction = function () {
//            //alert("Inactive record cannot be edited");
//            toastr.info("Inactive record cannot be edited", "info");
//        }

//        ///* THIS IS OPENING POP WINDOW FORM LIST FOR ADD */
//        //$scope.AddSMSTemplatePopUP = function () {
//        //    angular.element('#SMSTemplateModal').modal('show');
//        //    $('#btnsave').attr("disabled", false);
//        //    $scope.ClearPopup();
//        //}

//        /* THIS IS OPENING POP WINDOW FORM VIEW */
//        $scope.ViewEmailTemplatePopUP = function (CatId) {
//            $scope.Id = CatId;
//            $scope.ViewEmailTempalte();
//            angular.element('#EmailTemplateViewModal').modal('show');
//        }

//        /* THIS IS OPENING POP WINDOW FORM EDIT */
//        $scope.EditEmailTemplate = function (CatId) {
//            $scope.Id = CatId;
//            $scope.ViewEmailTempalte();
//            angular.element('#EmailTemplateModal').modal('show');
//            $('#btnsave').attr("disabled", false);
//        }

//        /* THIS IS CANCEL POPUP FUNCTION */
//        $scope.CancelPopUP = function () {
//            angular.element('#SMSTemplateModal').modal('hide')
//        }

//        /* THIS IS CANCEL VIEW POPUP FUNCTION*/
//        $scope.CancelViewPopup = function () {
//            angular.element('#EmailTemplateViewModal').modal('hide')
//        }

//        /* THIS IS CLEAR POPUP FUNCTION */
//        $scope.ClearPopup = function () {
//            $scope.Id = "0";
//            $scope.Institution_Id = "0";
//            $scope.Institution_Name = "";
//            $scope.TemplateType_Id = "0";
//            $scope.TemplateName = "";
//            $scope.EmailSubject = "";
//            $scope.EmailTemplate = "";
//            $scope.Type = "0";
//            $scope.Template = "";
//            if ($scope.PageParameter == 1) {
//                $scope.Template = CKEDITOR.instances.editor1.setData($scope.Template);
//            }
//        }

//        /* THIS IS OPENING POP WINDOW FORM LIST */
//        $scope.ListICD10PopUP = function (EmailTemplateCatId) {
//            if ($routeParams.Id == 0) {
//                $scope.rowCollection = [];
//            }
//            $scope.Id = CatId;
//            $scope.EmailTemplateList();
//        }
//    }
//]);


angular.module("angular-bootstrap-select", [])
    .directive("selectpicker",
        [
            "$parse", "$timeout",
            function ($parse, $timeout) {
                return {
                    restrict: "A",
                    require: ["?ngModel", "?collectionName"],
                    compile: function (tElement, tAttrs, transclude) {
                        //tElement.selectpicker();

                        if (angular.isUndefined(tAttrs.ngModel)) {
                            throw new Error("Please add ng-model attribute!");
                        } else if (angular.isUndefined(tAttrs.collectionName)) {
                            throw new Error("Please add data-collection-name attribute!");
                        }

                        return function (scope, element, attrs, ngModel) {
                            if (angular.isUndefined(ngModel)) {
                                return;
                            }
                            function refresh(newVal) {
                                scope.$applyAsync(function () {
                                    if (attrs.ngOptions && /track by/.test(attrs.ngOptions)) element.val(newVal);
                                    element.selectpicker('refresh');
                                });
                            }
                            attrs.$observe('spTheme', function (val) {
                                $timeout(function () {
                                    element.data('selectpicker').$button.removeClass(function (i, c) {
                                        return (c.match(/(^|\s)?btn-\S+/g) || []).join(' ');
                                    });
                                    element.selectpicker('setStyle', val);
                                });
                            });

                            scope.$watch(attrs.ngModel, function (newVal, oldVal) {
                                if (newVal !== oldVal) {
                                    $timeout(function () {
                                        element.selectpicker("val", element.val());
                                    });
                                }
                            });

                            scope.$watch(attrs.collectionName, function (newVal, oldVal) {
                                $timeout(function () {
                                    element.selectpicker("refresh");
                                });
                            });

                            $timeout(function () {
                                element.selectpicker($parse(attrs.selectpicker)());
                                element.selectpicker('refresh');
                            });

                            if (attrs.ngModel) {
                                scope.$watch(attrs.ngModel, refresh, true);
                            }

                            if (attrs.ngDisabled) {
                                scope.$watch(attrs.ngDisabled, refresh, true);
                            }

                            scope.$on('$destroy', function () {
                                $timeout(function () {
                                    element.selectpicker('destroy');
                                });
                            });
                            ngModel.$render = function () {
                                element.selectpicker("val", ngModel.$viewValue || "");
                            };

                            ngModel.$viewValue = element.val();
                        };
                    }
                }
            }
        ]
    );